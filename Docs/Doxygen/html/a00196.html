<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>BestRoombaNA: /home/iot/Downloads/mosquitto-1.4.14/src/mosquitto_broker.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BestRoombaNA
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">Roomba Project voor SEL2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00196.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">mosquitto_broker.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="a00141_source.html">config.h</a>&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;<a class="el" href="a00160_source.html">mosquitto_internal.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00198_source.html">mosquitto_plugin.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="a00159_source.html">mosquitto.h</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="a00180_source.html">tls_mosq.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="a00209_source.html">uthash.h</a>&quot;</code><br />
<code>#include &lt;<a class="el" href="a00163_source.html">net_mosq.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for mosquitto_broker.h:</div>
<div class="dyncontent">
<div class="center"><img src="a00602.png" border="0" usemap="#_2home_2iot_2_downloads_2mosquitto-1_84_814_2src_2mosquitto__broker_8h" alt=""/></div>
<map name="_2home_2iot_2_downloads_2mosquitto-1_84_814_2src_2mosquitto__broker_8h" id="_2home_2iot_2_downloads_2mosquitto-1_84_814_2src_2mosquitto__broker_8h">
<area shape="rect" id="node2" href="a00142.html" title="config.h" alt="" coords="391,333,459,360"/>
<area shape="rect" id="node11" href="a00197.html" title="mosquitto_broker.h" alt="" coords="686,109,819,136"/>
<area shape="rect" id="node18" href="a00179.html" title="time_mosq.h" alt="" coords="1312,333,1409,360"/>
<area shape="rect" id="node26" href="a00155.html" title="memory_mosq.h" alt="" coords="1207,109,1325,136"/>
<area shape="rect" id="node28" href="a00173.html" title="send_mosq.h" alt="" coords="1284,259,1384,285"/>
<area shape="rect" id="node29" href="a00183.html" title="util_mosq.h" alt="" coords="1041,109,1131,136"/>
<area shape="rect" id="node12" href="a00161.html" title="mosquitto_internal.h" alt="" coords="799,259,938,285"/>
<area shape="rect" id="node16" href="a00160.html" title="mosquitto.h" alt="" coords="1074,333,1165,360"/>
<area shape="rect" id="node19" href="a00199.html" title="mosquitto_plugin.h" alt="" coords="687,184,818,211"/>
<area shape="rect" id="node20" href="a00181.html" title="tls_mosq.h" alt="" coords="1059,184,1145,211"/>
<area shape="rect" id="node21" href="a00210.html" title="uthash.h" alt="" coords="541,184,613,211"/>
<area shape="rect" id="node24" href="a00164.html" title="net_mosq.h" alt="" coords="893,184,983,211"/>
<area shape="rect" id="node14" href="a00151.html" title="dummypthread.h" alt="" coords="917,333,1036,360"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="a00603.png" border="0" usemap="#_2home_2iot_2_downloads_2mosquitto-1_84_814_2src_2mosquitto__broker_8hdep" alt=""/></div>
<map name="_2home_2iot_2_downloads_2mosquitto-1_84_814_2src_2mosquitto__broker_8hdep" id="_2home_2iot_2_downloads_2mosquitto-1_84_814_2src_2mosquitto__broker_8hdep">
<area shape="rect" id="node2" href="a00142.html" title="config.h" alt="" coords="5,259,73,285"/>
<area shape="rect" id="node4" href="a00161.html" title="mosquitto_internal.h" alt="" coords="382,184,521,211"/>
<area shape="rect" id="node9" href="a00160.html" title="mosquitto.h" alt="" coords="657,259,747,285"/>
<area shape="rect" id="node12" href="a00199.html" title="mosquitto_plugin.h" alt="" coords="809,109,939,136"/>
<area shape="rect" id="node13" href="a00181.html" title="tls_mosq.h" alt="" coords="964,109,1051,136"/>
<area shape="rect" id="node14" href="a00210.html" title="uthash.h" alt="" coords="218,109,290,136"/>
<area shape="rect" id="node18" href="a00164.html" title="net_mosq.h" alt="" coords="527,109,618,136"/>
<area shape="rect" id="node7" href="a00151.html" title="dummypthread.h" alt="" coords="220,259,339,285"/>
<area shape="rect" id="node11" href="a00179.html" title="time_mosq.h" alt="" coords="452,259,549,285"/>
</map>
</div>
</div>
<p><a href="a00196_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00017.html">_mqtt3_listener</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00097.html">mqtt3_config</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00013.html">_mosquitto_subleaf</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00012.html">_mosquitto_subhier</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00093.html">mosquitto_msg_store_load</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00092.html">mosquitto_msg_store</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00088.html">mosquitto_client_msg</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00014.html">_mosquitto_unpwd</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html">_mosquitto_acl</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00009.html">_mosquitto_acl_user</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00010.html">_mosquitto_auth_plugin</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00089.html">mosquitto_db</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00016.html">_mqtt3_bridge_topic</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00026.html">bridge_address</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00015.html">_mqtt3_bridge</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1b7a007e4ff9af164b12af9b42c46ee1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a1b7a007e4ff9af164b12af9b42c46ee1">__attribute__</a>(attrib)</td></tr>
<tr class="separator:a1b7a007e4ff9af164b12af9b42c46ee1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf28c51f4b3e3552a160950de938421d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aaf28c51f4b3e3552a160950de938421d">MQTT3_LOG_NONE</a>&#160;&#160;&#160;0x00</td></tr>
<tr class="separator:aaf28c51f4b3e3552a160950de938421d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3c1f3254dec106a3f762c90c1cec113"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ac3c1f3254dec106a3f762c90c1cec113">MQTT3_LOG_SYSLOG</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:ac3c1f3254dec106a3f762c90c1cec113"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb1ed89c5b0349726632c68a1960e0ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#afb1ed89c5b0349726632c68a1960e0ca">MQTT3_LOG_FILE</a>&#160;&#160;&#160;0x02</td></tr>
<tr class="separator:afb1ed89c5b0349726632c68a1960e0ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84ae62bba5b8701fc159fe74d5c05ab7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a84ae62bba5b8701fc159fe74d5c05ab7">MQTT3_LOG_STDOUT</a>&#160;&#160;&#160;0x04</td></tr>
<tr class="separator:a84ae62bba5b8701fc159fe74d5c05ab7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45919568a54c27470e1cd90c4a144010"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a45919568a54c27470e1cd90c4a144010">MQTT3_LOG_STDERR</a>&#160;&#160;&#160;0x08</td></tr>
<tr class="separator:a45919568a54c27470e1cd90c4a144010"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59baa91bd9bfef3695c347db5c36762a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a59baa91bd9bfef3695c347db5c36762a">MQTT3_LOG_TOPIC</a>&#160;&#160;&#160;0x10</td></tr>
<tr class="separator:a59baa91bd9bfef3695c347db5c36762a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5381237fa12b0b14e574d1ddc4221286"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a5381237fa12b0b14e574d1ddc4221286">MQTT3_LOG_ALL</a>&#160;&#160;&#160;0xFF</td></tr>
<tr class="separator:a5381237fa12b0b14e574d1ddc4221286"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab250f47506fea591e288613abca1d55e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ab250f47506fea591e288613abca1d55e">WEBSOCKET_CLIENT</a>&#160;&#160;&#160;-2</td></tr>
<tr class="separator:ab250f47506fea591e288613abca1d55e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ac559238ed1772ef8840999d66b48b9c4"><td class="memItemLeft" align="right" valign="top">typedef uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ac559238ed1772ef8840999d66b48b9c4">dbid_t</a></td></tr>
<tr class="separator:ac559238ed1772ef8840999d66b48b9c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a2016ca244d8a59290552cd83840faa17"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a2016ca244d8a59290552cd83840faa17">mosquitto_protocol</a> { <a class="el" href="a00196.html#a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0">mp_mqtt</a>, 
<a class="el" href="a00196.html#a2016ca244d8a59290552cd83840faa17a536f740ec0603b9b2f02089a84e16f27">mp_mqttsn</a>, 
<a class="el" href="a00196.html#a2016ca244d8a59290552cd83840faa17ab30ef4e2f330b8a1c0849bcb58b6f6d3">mp_websockets</a>
 }</td></tr>
<tr class="separator:a2016ca244d8a59290552cd83840faa17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c9951678faa52bd7a1c19be5f175689"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689">mqtt3_bridge_direction</a> { <a class="el" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a7bcdf04926a05a68948f9af357617ba1">bd_out</a> = 0, 
<a class="el" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8">bd_in</a> = 1, 
<a class="el" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75">bd_both</a> = 2
 }</td></tr>
<tr class="separator:a0c9951678faa52bd7a1c19be5f175689"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31e03d23fb1912cb7983c4b123417e53"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53">mosquitto_bridge_start_type</a> { <a class="el" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a72c992c5c2b3279fc0b2941b697fcd1f">bst_automatic</a> = 0, 
<a class="el" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431">bst_lazy</a> = 1, 
<a class="el" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a8311a658b22562fba92ef15b90866278">bst_manual</a> = 2, 
<a class="el" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a72ff7cd1f23a0fd5eddb11cbce494ae1">bst_once</a> = 3
 }</td></tr>
<tr class="separator:a31e03d23fb1912cb7983c4b123417e53"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae88a6ec7610ccaf2ccd1506780302a4b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ae88a6ec7610ccaf2ccd1506780302a4b">mosquitto_main_loop</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, <a class="el" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a> *listensock, int listensock_count, int listener_max)</td></tr>
<tr class="separator:ae88a6ec7610ccaf2ccd1506780302a4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5970ed3ba87bd3fe42bd275db57ad26d"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a5970ed3ba87bd3fe42bd275db57ad26d">_mosquitto_get_db</a> (void)</td></tr>
<tr class="separator:a5970ed3ba87bd3fe42bd275db57ad26d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58703d0c046c1fa12b618e69123f1ccd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a58703d0c046c1fa12b618e69123f1ccd">mqtt3_config_init</a> (struct <a class="el" href="a00097.html">mqtt3_config</a> *config)</td></tr>
<tr class="separator:a58703d0c046c1fa12b618e69123f1ccd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a532d3d5ac88981498b567e4c476bac49"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a532d3d5ac88981498b567e4c476bac49">mqtt3_config_parse_args</a> (struct <a class="el" href="a00097.html">mqtt3_config</a> *config, int argc, char *argv[])</td></tr>
<tr class="separator:a532d3d5ac88981498b567e4c476bac49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a900ac578c7d954a97e51ed424d02d6bb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a900ac578c7d954a97e51ed424d02d6bb">mqtt3_config_read</a> (struct <a class="el" href="a00097.html">mqtt3_config</a> *config, bool reload)</td></tr>
<tr class="separator:a900ac578c7d954a97e51ed424d02d6bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7269c99227e58e2e0b30f998898468b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ae7269c99227e58e2e0b30f998898468b">mqtt3_config_cleanup</a> (struct <a class="el" href="a00097.html">mqtt3_config</a> *config)</td></tr>
<tr class="separator:ae7269c99227e58e2e0b30f998898468b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58d0ace4df75ecf8a8a0eb995e8f9cd6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a58d0ace4df75ecf8a8a0eb995e8f9cd6">drop_privileges</a> (struct <a class="el" href="a00097.html">mqtt3_config</a> *config, bool temporary)</td></tr>
<tr class="separator:a58d0ace4df75ecf8a8a0eb995e8f9cd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05c162f84fcabc09090f53489e3ab27f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a05c162f84fcabc09090f53489e3ab27f">restore_privileges</a> (void)</td></tr>
<tr class="separator:a05c162f84fcabc09090f53489e3ab27f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfb0b5d2c57d066432343097452b9094"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a> (struct <a class="el" href="a00086.html">mosquitto</a> *context, int ack, int result)</td></tr>
<tr class="separator:acfb0b5d2c57d066432343097452b9094"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ddecfe61813ca01280eb8e3417f8b2f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a3ddecfe61813ca01280eb8e3417f8b2f">_mosquitto_send_suback</a> (struct <a class="el" href="a00086.html">mosquitto</a> *context, uint16_t mid, uint32_t payloadlen, const void *payload)</td></tr>
<tr class="separator:a3ddecfe61813ca01280eb8e3417f8b2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f89551c5a87457efb044a33b91a76dd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a3f89551c5a87457efb044a33b91a76dd">mqtt3_socket_accept</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, <a class="el" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a> listensock)</td></tr>
<tr class="separator:a3f89551c5a87457efb044a33b91a76dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82f30f5e1002c310cdee164c9af71ea0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a82f30f5e1002c310cdee164c9af71ea0">mqtt3_socket_listen</a> (struct <a class="el" href="a00017.html">_mqtt3_listener</a> *listener)</td></tr>
<tr class="separator:a82f30f5e1002c310cdee164c9af71ea0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76632d665060f0325b7a5a639de9cc40"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a76632d665060f0325b7a5a639de9cc40">_mosquitto_socket_get_address</a> (<a class="el" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a> sock, char *buf, int len)</td></tr>
<tr class="separator:a76632d665060f0325b7a5a639de9cc40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09d1e4a05c245369c22ecae0e8a42bfb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb">mqtt3_packet_handle</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:a09d1e4a05c245369c22ecae0e8a42bfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6b09e9305be77b254fbff1759f3c7c7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7">mqtt3_handle_connack</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:ad6b09e9305be77b254fbff1759f3c7c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7f0afc1ca9700b58f5e6a817687d081"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081">mqtt3_handle_connect</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:ab7f0afc1ca9700b58f5e6a817687d081"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e6ad6e84cfeebd256ba58cd2553aca2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2">mqtt3_handle_disconnect</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:a1e6ad6e84cfeebd256ba58cd2553aca2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab73094667db8b9226ef81e7895b934f6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ab73094667db8b9226ef81e7895b934f6">mqtt3_handle_publish</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:ab73094667db8b9226ef81e7895b934f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad028e30a6047ea57b94d503668d6ea80"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80">mqtt3_handle_subscribe</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:ad028e30a6047ea57b94d503668d6ea80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fb8082975605cecae2cd5e0a5789a13"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13">mqtt3_handle_unsubscribe</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:a2fb8082975605cecae2cd5e0a5789a13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8961746b21163f586af2a417a04fc46"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aa8961746b21163f586af2a417a04fc46">mqtt3_db_open</a> (struct <a class="el" href="a00097.html">mqtt3_config</a> *config, struct <a class="el" href="a00089.html">mosquitto_db</a> *db)</td></tr>
<tr class="separator:aa8961746b21163f586af2a417a04fc46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe01bca4333bfd05ae9626306ef3d7cf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#afe01bca4333bfd05ae9626306ef3d7cf">mqtt3_db_close</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db)</td></tr>
<tr class="separator:afe01bca4333bfd05ae9626306ef3d7cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a344e751637f964b69fff2a34f772001f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a344e751637f964b69fff2a34f772001f">mqtt3_db_limits_set</a> (int inflight, int queued)</td></tr>
<tr class="separator:a344e751637f964b69fff2a34f772001f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee03621862afddaa10cfa01bcfa9f1a5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aee03621862afddaa10cfa01bcfa9f1a5">mqtt3_db_message_count</a> (int *count)</td></tr>
<tr class="separator:aee03621862afddaa10cfa01bcfa9f1a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd644b64d7bc7a0f7a06688a3aca8e4f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#afd644b64d7bc7a0f7a06688a3aca8e4f">mqtt3_db_message_delete</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, uint16_t mid, enum <a class="el" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84">mosquitto_msg_direction</a> dir)</td></tr>
<tr class="separator:afd644b64d7bc7a0f7a06688a3aca8e4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a273c85b4bc9f22d097948f4021190bc8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a273c85b4bc9f22d097948f4021190bc8">mqtt3_db_message_insert</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, uint16_t mid, enum <a class="el" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84">mosquitto_msg_direction</a> dir, int qos, bool retain, struct <a class="el" href="a00092.html">mosquitto_msg_store</a> *stored)</td></tr>
<tr class="separator:a273c85b4bc9f22d097948f4021190bc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab17a596b2baedf8dace3f85db644b4ec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ab17a596b2baedf8dace3f85db644b4ec">mqtt3_db_message_release</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, uint16_t mid, enum <a class="el" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84">mosquitto_msg_direction</a> dir)</td></tr>
<tr class="separator:ab17a596b2baedf8dace3f85db644b4ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89e1a33a5ba53721bbb006eb9ff6c048"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a89e1a33a5ba53721bbb006eb9ff6c048">mqtt3_db_message_update</a> (struct <a class="el" href="a00086.html">mosquitto</a> *context, uint16_t mid, enum <a class="el" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84">mosquitto_msg_direction</a> dir, enum <a class="el" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8ea">mosquitto_msg_state</a> state)</td></tr>
<tr class="separator:a89e1a33a5ba53721bbb006eb9ff6c048"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee64ee8f7ce7e65f696aa1bbf5c0674c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aee64ee8f7ce7e65f696aa1bbf5c0674c">mqtt3_db_message_write</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:aee64ee8f7ce7e65f696aa1bbf5c0674c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa62ed0d7c268d8756b3b91951d59bac2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aa62ed0d7c268d8756b3b91951d59bac2">mqtt3_db_messages_delete</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:aa62ed0d7c268d8756b3b91951d59bac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe58c783467b8953116641c9a2eb81a9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#abe58c783467b8953116641c9a2eb81a9">mqtt3_db_messages_easy_queue</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, const char *topic, int qos, uint32_t payloadlen, const void *payload, int retain)</td></tr>
<tr class="separator:abe58c783467b8953116641c9a2eb81a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a90d0b3b46b09f07e3fa99074e80eca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca">mqtt3_db_messages_queue</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, const char *source_id, const char *topic, int qos, int retain, struct <a class="el" href="a00092.html">mosquitto_msg_store</a> **stored)</td></tr>
<tr class="separator:a7a90d0b3b46b09f07e3fa99074e80eca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36e4902f860237756538cc4a58e1321b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a36e4902f860237756538cc4a58e1321b">mqtt3_db_message_store</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, const char *source, uint16_t source_mid, const char *topic, int qos, uint32_t payloadlen, const void *payload, int retain, struct <a class="el" href="a00092.html">mosquitto_msg_store</a> **stored, <a class="el" href="a00196.html#ac559238ed1772ef8840999d66b48b9c4">dbid_t</a> store_id)</td></tr>
<tr class="separator:a36e4902f860237756538cc4a58e1321b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69b7b5c13ef8ca9d3968a208b3cbb7f6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a69b7b5c13ef8ca9d3968a208b3cbb7f6">mqtt3_db_message_store_find</a> (struct <a class="el" href="a00086.html">mosquitto</a> *context, uint16_t mid, struct <a class="el" href="a00092.html">mosquitto_msg_store</a> **stored)</td></tr>
<tr class="separator:a69b7b5c13ef8ca9d3968a208b3cbb7f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a838cff02f4134c5c060e16009cc7254c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a838cff02f4134c5c060e16009cc7254c">mosquitto__db_msg_store_add</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00092.html">mosquitto_msg_store</a> *store)</td></tr>
<tr class="separator:a838cff02f4134c5c060e16009cc7254c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cdc24cdccc64a0e398b093e2a1bf1b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a0cdc24cdccc64a0e398b093e2a1bf1b3">mosquitto__db_msg_store_remove</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00092.html">mosquitto_msg_store</a> *store)</td></tr>
<tr class="separator:a0cdc24cdccc64a0e398b093e2a1bf1b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af19cbc47cd971cdb22e9f48566bb3e68"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00092.html">mosquitto_msg_store</a> **store)</td></tr>
<tr class="separator:af19cbc47cd971cdb22e9f48566bb3e68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3cded7beb61e6c31048a7aa8ebadac2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#af3cded7beb61e6c31048a7aa8ebadac2">mosquitto__db_msg_store_clean</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db)</td></tr>
<tr class="separator:af3cded7beb61e6c31048a7aa8ebadac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60d56ad7041c6e40c30db6a71c03f7e8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a60d56ad7041c6e40c30db6a71c03f7e8">mqtt3_db_message_timeout_check</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, unsigned int timeout)</td></tr>
<tr class="separator:a60d56ad7041c6e40c30db6a71c03f7e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e9e6632cd5553fd9aa4529b6416447b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a0e9e6632cd5553fd9aa4529b6416447b">mqtt3_db_message_reconnect_reset</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:a0e9e6632cd5553fd9aa4529b6416447b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59294f37b85b3e5b13ccf682e9a4de68"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a59294f37b85b3e5b13ccf682e9a4de68">mqtt3_retain_queue</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, const char *<a class="el" href="a00126.html">sub</a>, int sub_qos)</td></tr>
<tr class="separator:a59294f37b85b3e5b13ccf682e9a4de68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1a5b88e8e067a6175a68014713053d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ab1a5b88e8e067a6175a68014713053d0">mqtt3_db_sys_update</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, int interval, time_t start_time)</td></tr>
<tr class="separator:ab1a5b88e8e067a6175a68014713053d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f3a0c01054059f3f2aa16072dbe3f84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a7f3a0c01054059f3f2aa16072dbe3f84">mqtt3_db_vacuum</a> (void)</td></tr>
<tr class="separator:a7f3a0c01054059f3f2aa16072dbe3f84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe850bdd3f238f7c555bdd861944d6fc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#afe850bdd3f238f7c555bdd861944d6fc">mqtt3_sub_add</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, const char *<a class="el" href="a00126.html">sub</a>, int qos, struct <a class="el" href="a00012.html">_mosquitto_subhier</a> *root)</td></tr>
<tr class="separator:afe850bdd3f238f7c555bdd861944d6fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25dfd4d59b3e689243ef6187b45fadeb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a25dfd4d59b3e689243ef6187b45fadeb">mqtt3_sub_remove</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, const char *<a class="el" href="a00126.html">sub</a>, struct <a class="el" href="a00012.html">_mosquitto_subhier</a> *root)</td></tr>
<tr class="separator:a25dfd4d59b3e689243ef6187b45fadeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1720ad6940222086291d6bf505cfbba0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a1720ad6940222086291d6bf505cfbba0">mqtt3_sub_search</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00012.html">_mosquitto_subhier</a> *root, const char *source_id, const char *topic, int qos, int retain, struct <a class="el" href="a00092.html">mosquitto_msg_store</a> *stored)</td></tr>
<tr class="separator:a1720ad6940222086291d6bf505cfbba0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70c65656337b203d320f63e798e79f9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a70c65656337b203d320f63e798e79f9f">mqtt3_sub_tree_print</a> (struct <a class="el" href="a00012.html">_mosquitto_subhier</a> *root, int level)</td></tr>
<tr class="separator:a70c65656337b203d320f63e798e79f9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f5d696cb546ec16f63ef7855b624fe0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a6f5d696cb546ec16f63ef7855b624fe0">mqtt3_subs_clean_session</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:a6f5d696cb546ec16f63ef7855b624fe0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5caa657eeafaaf5aaddf16d5c8d77773"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a5caa657eeafaaf5aaddf16d5c8d77773">mqtt3_context_init</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, <a class="el" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a> sock)</td></tr>
<tr class="separator:a5caa657eeafaaf5aaddf16d5c8d77773"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac919bd8bbc017773fc9d75c098faaae0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#ac919bd8bbc017773fc9d75c098faaae0">mqtt3_context_cleanup</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, bool do_free)</td></tr>
<tr class="separator:ac919bd8bbc017773fc9d75c098faaae0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3807fa7a82234429efbb913a141f4eaf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a3807fa7a82234429efbb913a141f4eaf">mqtt3_context_disconnect</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:a3807fa7a82234429efbb913a141f4eaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7310ffcd887c91eef7b5f087ff04af3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a7310ffcd887c91eef7b5f087ff04af3f">mosquitto__add_context_to_disused</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:a7310ffcd887c91eef7b5f087ff04af3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b4b98c96c9b4596e5277f7477dd7013"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a1b4b98c96c9b4596e5277f7477dd7013">mosquitto__free_disused_contexts</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db)</td></tr>
<tr class="separator:a1b4b98c96c9b4596e5277f7477dd7013"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9017edc4b06c590c90dbcd13f14fbf21"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a9017edc4b06c590c90dbcd13f14fbf21">mqtt3_context_send_will</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:a9017edc4b06c590c90dbcd13f14fbf21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a429931ef889c50f3a75f674c7029843b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a429931ef889c50f3a75f674c7029843b">mqtt3_log_init</a> (struct <a class="el" href="a00097.html">mqtt3_config</a> *config)</td></tr>
<tr class="separator:a429931ef889c50f3a75f674c7029843b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90e4e3b03b0226658f92987b81d31de8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a90e4e3b03b0226658f92987b81d31de8">mqtt3_log_close</a> (struct <a class="el" href="a00097.html">mqtt3_config</a> *config)</td></tr>
<tr class="separator:a90e4e3b03b0226658f92987b81d31de8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fdaf3ea3f59ff04a208756a2dfe0acc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a7fdaf3ea3f59ff04a208756a2dfe0acc">_mosquitto_log_printf</a> (struct <a class="el" href="a00086.html">mosquitto</a> *mosq, int level, const char *fmt,...) <a class="el" href="a00196.html#a1b7a007e4ff9af164b12af9b42c46ee1">__attribute__</a>((format(printf</td></tr>
<tr class="separator:a7fdaf3ea3f59ff04a208756a2dfe0acc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68ae3159d8956163ab492b3e925fd16d"><td class="memItemLeft" align="right" valign="top">int int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a68ae3159d8956163ab492b3e925fd16d">mosquitto_security_module_init</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db)</td></tr>
<tr class="separator:a68ae3159d8956163ab492b3e925fd16d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9ed37d9ab03d503edacbee8cb477ff2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#af9ed37d9ab03d503edacbee8cb477ff2">mosquitto_security_module_cleanup</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db)</td></tr>
<tr class="separator:af9ed37d9ab03d503edacbee8cb477ff2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa561902dbf33ea1ab2ce328d9486181d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aa561902dbf33ea1ab2ce328d9486181d">mosquitto_security_init</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, bool reload)</td></tr>
<tr class="separator:aa561902dbf33ea1ab2ce328d9486181d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a953626642aecf59c7ae6c7e45518351e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a953626642aecf59c7ae6c7e45518351e">mosquitto_security_apply</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db)</td></tr>
<tr class="separator:a953626642aecf59c7ae6c7e45518351e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13baab4bb8c48922ec24ecef1938932e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a13baab4bb8c48922ec24ecef1938932e">mosquitto_security_cleanup</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, bool reload)</td></tr>
<tr class="separator:a13baab4bb8c48922ec24ecef1938932e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c132b4fe96e98b267516e77036cd409"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, const char *topic, int access)</td></tr>
<tr class="separator:a6c132b4fe96e98b267516e77036cd409"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb27e1ef0cdde6bee2d77265380bef54"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#afb27e1ef0cdde6bee2d77265380bef54">mosquitto_unpwd_check</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, const char *username, const char *password)</td></tr>
<tr class="separator:afb27e1ef0cdde6bee2d77265380bef54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa17174a4b0aedc61fac238bb6d89b56d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aa17174a4b0aedc61fac238bb6d89b56d">mosquitto_psk_key_get</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, const char *hint, const char *identity, char *key, int max_key_len)</td></tr>
<tr class="separator:aa17174a4b0aedc61fac238bb6d89b56d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab9402f5cad5f77a95a652fccb585b23"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aab9402f5cad5f77a95a652fccb585b23">mosquitto_security_init_default</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, bool reload)</td></tr>
<tr class="separator:aab9402f5cad5f77a95a652fccb585b23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fc953b05bda405a0d88312be23d4981"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a0fc953b05bda405a0d88312be23d4981">mosquitto_security_apply_default</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db)</td></tr>
<tr class="separator:a0fc953b05bda405a0d88312be23d4981"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4244d5e2409405c58a5366f31842cdf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#af4244d5e2409405c58a5366f31842cdf">mosquitto_security_cleanup_default</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, bool reload)</td></tr>
<tr class="separator:af4244d5e2409405c58a5366f31842cdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a084d088ea3e95fcd1745f2707d669e4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a">mosquitto_acl_check_default</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context, const char *topic, int access)</td></tr>
<tr class="separator:a084d088ea3e95fcd1745f2707d669e4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20315c474619e67362c6472ac7d46e3f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#a20315c474619e67362c6472ac7d46e3f">mosquitto_unpwd_check_default</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, const char *username, const char *password)</td></tr>
<tr class="separator:a20315c474619e67362c6472ac7d46e3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadb5a441176967dc1937d0f702edbdb7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#aadb5a441176967dc1937d0f702edbdb7">mosquitto_psk_key_get_default</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, const char *hint, const char *identity, char *key, int max_key_len)</td></tr>
<tr class="separator:aadb5a441176967dc1937d0f702edbdb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af52acda25b9090675773beafeca25264"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00196.html#af52acda25b9090675773beafeca25264">do_disconnect</a> (struct <a class="el" href="a00089.html">mosquitto_db</a> *db, struct <a class="el" href="a00086.html">mosquitto</a> *context)</td></tr>
<tr class="separator:af52acda25b9090675773beafeca25264"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a1b7a007e4ff9af164b12af9b42c46ee1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __attribute__</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">attrib</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00050">50</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5381237fa12b0b14e574d1ddc4221286"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MQTT3_LOG_ALL&#160;&#160;&#160;0xFF</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00060">60</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<a class="anchor" id="afb1ed89c5b0349726632c68a1960e0ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MQTT3_LOG_FILE&#160;&#160;&#160;0x02</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00056">56</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<a class="anchor" id="aaf28c51f4b3e3552a160950de938421d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MQTT3_LOG_NONE&#160;&#160;&#160;0x00</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00054">54</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<a class="anchor" id="a45919568a54c27470e1cd90c4a144010"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MQTT3_LOG_STDERR&#160;&#160;&#160;0x08</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00058">58</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<a class="anchor" id="a84ae62bba5b8701fc159fe74d5c05ab7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MQTT3_LOG_STDOUT&#160;&#160;&#160;0x04</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00057">57</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac3c1f3254dec106a3f762c90c1cec113"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MQTT3_LOG_SYSLOG&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00055">55</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<a class="anchor" id="a59baa91bd9bfef3695c347db5c36762a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MQTT3_LOG_TOPIC&#160;&#160;&#160;0x10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00059">59</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab250f47506fea591e288613abca1d55e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WEBSOCKET_CLIENT&#160;&#160;&#160;-2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00062">62</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ac559238ed1772ef8840999d66b48b9c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint64_t <a class="el" href="a00196.html#ac559238ed1772ef8840999d66b48b9c4">dbid_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00196_source.html#l00070">70</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a31e03d23fb1912cb7983c4b123417e53"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53">mosquitto_bridge_start_type</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a31e03d23fb1912cb7983c4b123417e53a72c992c5c2b3279fc0b2941b697fcd1f"></a>bst_automatic&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431"></a>bst_lazy&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a31e03d23fb1912cb7983c4b123417e53a8311a658b22562fba92ef15b90866278"></a>bst_manual&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a31e03d23fb1912cb7983c4b123417e53a72ff7cd1f23a0fd5eddb11cbce494ae1"></a>bst_once&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="a00196_source.html#l00279">279</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a72c992c5c2b3279fc0b2941b697fcd1f">bst_automatic</a> = 0,</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431">bst_lazy</a> = 1,</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a8311a658b22562fba92ef15b90866278">bst_manual</a> = 2,</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a72ff7cd1f23a0fd5eddb11cbce494ae1">bst_once</a> = 3</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;};</div><div class="ttc" id="a00196_html_a31e03d23fb1912cb7983c4b123417e53a72ff7cd1f23a0fd5eddb11cbce494ae1"><div class="ttname"><a href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a72ff7cd1f23a0fd5eddb11cbce494ae1">bst_once</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00283">mosquitto_broker.h:283</a></div></div>
<div class="ttc" id="a00196_html_a31e03d23fb1912cb7983c4b123417e53a8311a658b22562fba92ef15b90866278"><div class="ttname"><a href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a8311a658b22562fba92ef15b90866278">bst_manual</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00282">mosquitto_broker.h:282</a></div></div>
<div class="ttc" id="a00196_html_a31e03d23fb1912cb7983c4b123417e53a72c992c5c2b3279fc0b2941b697fcd1f"><div class="ttname"><a href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a72c992c5c2b3279fc0b2941b697fcd1f">bst_automatic</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00280">mosquitto_broker.h:280</a></div></div>
<div class="ttc" id="a00196_html_a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431"><div class="ttname"><a href="a00196.html#a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431">bst_lazy</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00281">mosquitto_broker.h:281</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2016ca244d8a59290552cd83840faa17"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00196.html#a2016ca244d8a59290552cd83840faa17">mosquitto_protocol</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0"></a>mp_mqtt&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a2016ca244d8a59290552cd83840faa17a536f740ec0603b9b2f02089a84e16f27"></a>mp_mqttsn&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a2016ca244d8a59290552cd83840faa17ab30ef4e2f330b8a1c0849bcb58b6f6d3"></a>mp_websockets&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="a00196_source.html#l00064">64</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                        {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="a00196.html#a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0">mp_mqtt</a>,</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="a00196.html#a2016ca244d8a59290552cd83840faa17a536f740ec0603b9b2f02089a84e16f27">mp_mqttsn</a>,</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="a00196.html#a2016ca244d8a59290552cd83840faa17ab30ef4e2f330b8a1c0849bcb58b6f6d3">mp_websockets</a></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;};</div><div class="ttc" id="a00196_html_a2016ca244d8a59290552cd83840faa17a536f740ec0603b9b2f02089a84e16f27"><div class="ttname"><a href="a00196.html#a2016ca244d8a59290552cd83840faa17a536f740ec0603b9b2f02089a84e16f27">mp_mqttsn</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00066">mosquitto_broker.h:66</a></div></div>
<div class="ttc" id="a00196_html_a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0"><div class="ttname"><a href="a00196.html#a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0">mp_mqtt</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00065">mosquitto_broker.h:65</a></div></div>
<div class="ttc" id="a00196_html_a2016ca244d8a59290552cd83840faa17ab30ef4e2f330b8a1c0849bcb58b6f6d3"><div class="ttname"><a href="a00196.html#a2016ca244d8a59290552cd83840faa17ab30ef4e2f330b8a1c0849bcb58b6f6d3">mp_websockets</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00067">mosquitto_broker.h:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0c9951678faa52bd7a1c19be5f175689"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689">mqtt3_bridge_direction</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a0c9951678faa52bd7a1c19be5f175689a7bcdf04926a05a68948f9af357617ba1"></a>bd_out&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8"></a>bd_in&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75"></a>bd_both&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="a00196_source.html#l00273">273</a> of file <a class="el" href="a00196_source.html">mosquitto_broker.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                           {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a7bcdf04926a05a68948f9af357617ba1">bd_out</a> = 0,</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8">bd_in</a> = 1,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75">bd_both</a> = 2</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;};</div><div class="ttc" id="a00196_html_a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75"><div class="ttname"><a href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75">bd_both</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00276">mosquitto_broker.h:276</a></div></div>
<div class="ttc" id="a00196_html_a0c9951678faa52bd7a1c19be5f175689a7bcdf04926a05a68948f9af357617ba1"><div class="ttname"><a href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a7bcdf04926a05a68948f9af357617ba1">bd_out</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00274">mosquitto_broker.h:274</a></div></div>
<div class="ttc" id="a00196_html_a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8"><div class="ttname"><a href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8">bd_in</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00275">mosquitto_broker.h:275</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a5970ed3ba87bd3fe42bd275db57ad26d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="a00089.html">mosquitto_db</a>* _mosquitto_get_db </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00158_source.html#l00072">72</a> of file <a class="el" href="a00158_source.html">mosquitto.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;{</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">return</span> &amp;<a class="code" href="a00158.html#a2905f81749485e2510355e17e68477f1">int_db</a>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div><div class="ttc" id="a00158_html_a2905f81749485e2510355e17e68477f1"><div class="ttname"><a href="a00158.html#a2905f81749485e2510355e17e68477f1">int_db</a></div><div class="ttdeci">struct mosquitto_db int_db</div><div class="ttdef"><b>Definition:</b> <a href="a00158_source.html#l00054">mosquitto.c:54</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7fdaf3ea3f59ff04a208756a2dfe0acc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _mosquitto_log_printf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>mosq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00151_source.html#l00025">25</a> of file <a class="el" href="a00151_source.html">logging_mosq.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    va_list va;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordtype">char</span> *s;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordtype">int</span> len;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    assert(mosq);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    assert(fmt);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="a00150.html#a2726154dadd99f6ec33dcd12266d4811">pthread_mutex_lock</a>(&amp;mosq-&gt;log_callback_mutex);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">if</span>(mosq-&gt;<a class="code" href="a00086.html#aa2144ac762c83874574c119899cf494a">on_log</a>){</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        len = strlen(fmt) + 500;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        s = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(len*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keywordflow">if</span>(!s){</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            <a class="code" href="a00150.html#ac130da7532d3b537cbd31b46ea1112a3">pthread_mutex_unlock</a>(&amp;mosq-&gt;log_callback_mutex);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        }</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        va_start(va, fmt);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        vsnprintf(s, len, fmt, va);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        va_end(va);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        s[len-1] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* Ensure string is null terminated. */</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        mosq-&gt;<a class="code" href="a00086.html#aa2144ac762c83874574c119899cf494a">on_log</a>(mosq, mosq-&gt;<a class="code" href="a00086.html#a3603e0befb1a5692e434de7757fec986">userdata</a>, priority, s);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(s);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    }</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="a00150.html#ac130da7532d3b537cbd31b46ea1112a3">pthread_mutex_unlock</a>(&amp;mosq-&gt;log_callback_mutex);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00086_html_a3603e0befb1a5692e434de7757fec986"><div class="ttname"><a href="a00086.html#a3603e0befb1a5692e434de7757fec986">mosquitto::userdata</a></div><div class="ttdeci">void * userdata</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00237">mosquitto_internal.h:237</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00150_html_a2726154dadd99f6ec33dcd12266d4811"><div class="ttname"><a href="a00150.html#a2726154dadd99f6ec33dcd12266d4811">pthread_mutex_lock</a></div><div class="ttdeci">#define pthread_mutex_lock(A)</div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00010">dummypthread.h:10</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00150_html_ac130da7532d3b537cbd31b46ea1112a3"><div class="ttname"><a href="a00150.html#ac130da7532d3b537cbd31b46ea1112a3">pthread_mutex_unlock</a></div><div class="ttdeci">#define pthread_mutex_unlock(A)</div><div class="ttdef"><b>Definition:</b> <a href="a00150_source.html#l00011">dummypthread.h:11</a></div></div>
<div class="ttc" id="a00086_html_aa2144ac762c83874574c119899cf494a"><div class="ttname"><a href="a00086.html#aa2144ac762c83874574c119899cf494a">mosquitto::on_log</a></div><div class="ttdeci">void(* on_log)(struct mosquitto *, void *userdata, int level, const char *str)</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00251">mosquitto_internal.h:251</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a7fdaf3ea3f59ff04a208756a2dfe0acc_cgraph.png" border="0" usemap="#a00196_a7fdaf3ea3f59ff04a208756a2dfe0acc_cgraph" alt=""/></div>
<map name="a00196_a7fdaf3ea3f59ff04a208756a2dfe0acc_cgraph" id="a00196_a7fdaf3ea3f59ff04a208756a2dfe0acc_cgraph">
<area shape="rect" id="node2" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="200,5,331,32"/>
<area shape="rect" id="node3" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="208,56,323,83"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acfb0b5d2c57d066432343097452b9094"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _mosquitto_send_connack </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00205_source.html#l00024">24</a> of file <a class="el" href="a00205_source.html">send_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00011.html">_mosquitto_packet</a> *packet = NULL;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">if</span>(context){</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>){</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Sending CONNACK to %s (%d, %d)&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, ack, result);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Sending CONNACK to %s (%d, %d)&quot;</span>, context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>, ack, result);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    packet = <a class="code" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00011.html">_mosquitto_packet</a>));</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">if</span>(!packet) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    packet-&gt;<a class="code" href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">command</a> = <a class="code" href="a00161.html#a8fdbc4a06d36325fba03cafa89fabcd5">CONNACK</a>;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    packet-&gt;<a class="code" href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">remaining_length</a> = 2;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    rc = <a class="code" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e">_mosquitto_packet_alloc</a>(packet);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(packet);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    }</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    packet-&gt;<a class="code" href="a00011.html#a20a0584aff8e49470954547d32d32028">payload</a>[packet-&gt;<a class="code" href="a00011.html#aee3849504ce401add5fdf9235541f274">pos</a>+0] = ack;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    packet-&gt;<a class="code" href="a00011.html#a20a0584aff8e49470954547d32d32028">payload</a>[packet-&gt;<a class="code" href="a00011.html#aee3849504ce401add5fdf9235541f274">pos</a>+1] = result;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986">_mosquitto_packet_queue</a>(context, packet);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div><div class="ttc" id="a00011_html_a20a0584aff8e49470954547d32d32028"><div class="ttname"><a href="a00011.html#a20a0584aff8e49470954547d32d32028">_mosquitto_packet::payload</a></div><div class="ttdeci">uint8_t * payload</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00132">mosquitto_internal.h:132</a></div></div>
<div class="ttc" id="a00011_html_aee3849504ce401add5fdf9235541f274"><div class="ttname"><a href="a00011.html#aee3849504ce401add5fdf9235541f274">_mosquitto_packet::pos</a></div><div class="ttdeci">uint32_t pos</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00138">mosquitto_internal.h:138</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00181_html_a3c897feee454d60aec163e3bd0eab52e"><div class="ttname"><a href="a00181.html#a3c897feee454d60aec163e3bd0eab52e">_mosquitto_packet_alloc</a></div><div class="ttdeci">int _mosquitto_packet_alloc(struct _mosquitto_packet *packet)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00046">util_mosq.c:46</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00011_html_a42171b2c83d8c83babc555d32ef84f7f"><div class="ttname"><a href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">_mosquitto_packet::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00140">mosquitto_internal.h:140</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00086_html_a962322fe14ee02b439cc236a85dab410"><div class="ttname"><a href="a00086.html#a962322fe14ee02b439cc236a85dab410">mosquitto::address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00162">mosquitto_internal.h:162</a></div></div>
<div class="ttc" id="a00161_html_a8fdbc4a06d36325fba03cafa89fabcd5"><div class="ttname"><a href="a00161.html#a8fdbc4a06d36325fba03cafa89fabcd5">CONNACK</a></div><div class="ttdeci">#define CONNACK</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00030">mqtt3_protocol.h:30</a></div></div>
<div class="ttc" id="a00159_html_a9a0714eb912755e4dc621c1e902c0bcf"><div class="ttname"><a href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a></div><div class="ttdeci">#define MOSQ_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00058">mosquitto.h:58</a></div></div>
<div class="ttc" id="a00162_html_ae1643651ecb33c5a8d5138851bcfd986"><div class="ttname"><a href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986">_mosquitto_packet_queue</a></div><div class="ttdeci">int _mosquitto_packet_queue(struct mosquitto *mosq, struct _mosquitto_packet *packet)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00151">net_mosq.c:151</a></div></div>
<div class="ttc" id="a00011_html"><div class="ttname"><a href="a00011.html">_mosquitto_packet</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00131">mosquitto_internal.h:131</a></div></div>
<div class="ttc" id="a00153_html_a1ecbcb0ab8e51c000672d9d2bdf8172c"><div class="ttname"><a href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a></div><div class="ttdeci">void * _mosquitto_calloc(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00040">memory_mosq.c:40</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00011_html_a5616fcfbaf0e409e06b1c857c940471a"><div class="ttname"><a href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">_mosquitto_packet::remaining_length</a></div><div class="ttdeci">uint32_t remaining_length</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00135">mosquitto_internal.h:135</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_acfb0b5d2c57d066432343097452b9094_cgraph.png" border="0" usemap="#a00196_acfb0b5d2c57d066432343097452b9094_cgraph" alt=""/></div>
<map name="a00196_acfb0b5d2c57d066432343097452b9094_cgraph" id="a00196_acfb0b5d2c57d066432343097452b9094_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2531,1650,2677,1677"/>
<area shape="rect" id="node3" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2297,2157,2424,2183"/>
<area shape="rect" id="node4" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="231,1879,397,1906"/>
<area shape="rect" id="node11" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="2303,165,2418,191"/>
<area shape="rect" id="node16" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1117,1829,1292,1855"/>
<area shape="rect" id="node5" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="469,1931,612,1972"/>
<area shape="rect" id="node6" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2539,241,2669,267"/>
<area shape="rect" id="node7" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="445,2031,636,2058"/>
<area shape="rect" id="node8" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2741,2410,2852,2437"/>
<area shape="rect" id="node9" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1555,2031,1725,2058"/>
<area shape="rect" id="node14" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="684,2246,855,2273"/>
<area shape="rect" id="node10" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1788,2083,1949,2124"/>
<area shape="rect" id="node12" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1788,2148,1949,2189"/>
<area shape="rect" id="node13" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1773,2031,1964,2058"/>
<area shape="rect" id="node15" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="903,1876,1069,1917"/>
<area shape="rect" id="node17" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="1340,1829,1507,1855"/>
<area shape="rect" id="node18" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1567,1955,1713,1982"/>
<area shape="rect" id="node19" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="1777,367,1961,394"/>
<area shape="rect" id="node20" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="1558,1726,1722,1753"/>
<area shape="rect" id="node21" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="1797,1794,1940,1821"/>
<area shape="rect" id="node22" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="1795,1422,1942,1449"/>
<area shape="rect" id="node48" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="1780,1726,1957,1753"/>
<area shape="rect" id="node23" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2019,1802,2199,1829"/>
<area shape="rect" id="node25" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2016,1751,2203,1778"/>
<area shape="rect" id="node30" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2255,2055,2467,2082"/>
<area shape="rect" id="node31" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2035,1042,2183,1069"/>
<area shape="rect" id="node39" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2272,1397,2449,1423"/>
<area shape="rect" id="node40" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2023,1498,2196,1525"/>
<area shape="rect" id="node41" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="2033,798,2186,825"/>
<area shape="rect" id="node42" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="2024,1447,2195,1474"/>
<area shape="rect" id="node43" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="2028,621,2191,647"/>
<area shape="rect" id="node44" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="2021,519,2198,546"/>
<area shape="rect" id="node45" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="2031,63,2187,90"/>
<area shape="rect" id="node46" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="2019,469,2199,495"/>
<area shape="rect" id="node47" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="2012,1549,2207,1575"/>
<area shape="rect" id="node24" href="a00171.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="2272,1954,2449,1981"/>
<area shape="rect" id="node26" href="a00169.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2255,1903,2467,1930"/>
<area shape="rect" id="node27" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="2524,1169,2684,1195"/>
<area shape="rect" id="node28" href="a00191.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="2515,1989,2693,2015"/>
<area shape="rect" id="node29" href="a00155.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="2531,2040,2677,2081"/>
<area shape="rect" id="node32" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="2282,621,2439,647"/>
<area shape="rect" id="node33" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2261,1194,2460,1221"/>
<area shape="rect" id="node34" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2296,941,2425,967"/>
<area shape="rect" id="node35" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319" title="mosquitto_pub_topic\l_check" alt="" coords="2289,875,2432,916"/>
<area shape="rect" id="node36" href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9" title="_mosquitto_read_bytes" alt="" coords="2282,1093,2439,1119"/>
<area shape="rect" id="node37" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="2288,823,2433,850"/>
<area shape="rect" id="node38" href="a00191.html#a69b7b5c13ef8ca9d3968a208b3cbb7f6" title="mqtt3_db_message_store_find" alt="" coords="2261,1143,2461,1170"/>
<area shape="rect" id="node49" href="a00164.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="2020,1701,2199,1727"/>
<area shape="rect" id="node50" href="a00166.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="2016,2005,2203,2031"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3ddecfe61813ca01280eb8e3417f8b2f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _mosquitto_send_suback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>mid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>payloadlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>payload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00205_source.html#l00053">53</a> of file <a class="el" href="a00205_source.html">send_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00011.html">_mosquitto_packet</a> *packet = NULL;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Sending SUBACK to %s&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    packet = <a class="code" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00011.html">_mosquitto_packet</a>));</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span>(!packet) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    packet-&gt;<a class="code" href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">command</a> = <a class="code" href="a00161.html#afe3cc225212c5765b3a2ed0700237db5">SUBACK</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    packet-&gt;<a class="code" href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">remaining_length</a> = 2+payloadlen;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    rc = <a class="code" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e">_mosquitto_packet_alloc</a>(packet);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(packet);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f">_mosquitto_write_uint16</a>(packet, <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a>);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">if</span>(payloadlen){</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <a class="code" href="a00162.html#a307413f45257069e76295c70a6d899d8">_mosquitto_write_bytes</a>(packet, <a class="code" href="a00011.html#a20a0584aff8e49470954547d32d32028">payload</a>, payloadlen);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986">_mosquitto_packet_queue</a>(context, packet);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div><div class="ttc" id="a00011_html_a20a0584aff8e49470954547d32d32028"><div class="ttname"><a href="a00011.html#a20a0584aff8e49470954547d32d32028">_mosquitto_packet::payload</a></div><div class="ttdeci">uint8_t * payload</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00132">mosquitto_internal.h:132</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00181_html_a3c897feee454d60aec163e3bd0eab52e"><div class="ttname"><a href="a00181.html#a3c897feee454d60aec163e3bd0eab52e">_mosquitto_packet_alloc</a></div><div class="ttdeci">int _mosquitto_packet_alloc(struct _mosquitto_packet *packet)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00046">util_mosq.c:46</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00011_html_a42171b2c83d8c83babc555d32ef84f7f"><div class="ttname"><a href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">_mosquitto_packet::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00140">mosquitto_internal.h:140</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00159_html_a9a0714eb912755e4dc621c1e902c0bcf"><div class="ttname"><a href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a></div><div class="ttdeci">#define MOSQ_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00058">mosquitto.h:58</a></div></div>
<div class="ttc" id="a00162_html_ae1643651ecb33c5a8d5138851bcfd986"><div class="ttname"><a href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986">_mosquitto_packet_queue</a></div><div class="ttdeci">int _mosquitto_packet_queue(struct mosquitto *mosq, struct _mosquitto_packet *packet)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00151">net_mosq.c:151</a></div></div>
<div class="ttc" id="a00162_html_a307413f45257069e76295c70a6d899d8"><div class="ttname"><a href="a00162.html#a307413f45257069e76295c70a6d899d8">_mosquitto_write_bytes</a></div><div class="ttdeci">void _mosquitto_write_bytes(struct _mosquitto_packet *packet, const void *bytes, uint32_t count)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00692">net_mosq.c:692</a></div></div>
<div class="ttc" id="a00011_html"><div class="ttname"><a href="a00011.html">_mosquitto_packet</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00131">mosquitto_internal.h:131</a></div></div>
<div class="ttc" id="a00162_html_a73189d0cf764846d8b74fe2d4a55d79f"><div class="ttname"><a href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f">_mosquitto_write_uint16</a></div><div class="ttdeci">void _mosquitto_write_uint16(struct _mosquitto_packet *packet, uint16_t word)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00748">net_mosq.c:748</a></div></div>
<div class="ttc" id="a00153_html_a1ecbcb0ab8e51c000672d9d2bdf8172c"><div class="ttname"><a href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a></div><div class="ttdeci">void * _mosquitto_calloc(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00040">memory_mosq.c:40</a></div></div>
<div class="ttc" id="a00161_html_afe3cc225212c5765b3a2ed0700237db5"><div class="ttname"><a href="a00161.html#afe3cc225212c5765b3a2ed0700237db5">SUBACK</a></div><div class="ttdeci">#define SUBACK</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00037">mqtt3_protocol.h:37</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00011_html_a5616fcfbaf0e409e06b1c857c940471a"><div class="ttname"><a href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">_mosquitto_packet::remaining_length</a></div><div class="ttdeci">uint32_t remaining_length</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00135">mosquitto_internal.h:135</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a3ddecfe61813ca01280eb8e3417f8b2f_cgraph.png" border="0" usemap="#a00196_a3ddecfe61813ca01280eb8e3417f8b2f_cgraph" alt=""/></div>
<map name="a00196_a3ddecfe61813ca01280eb8e3417f8b2f_cgraph" id="a00196_a3ddecfe61813ca01280eb8e3417f8b2f_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2516,752,2663,779"/>
<area shape="rect" id="node3" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2283,2187,2409,2213"/>
<area shape="rect" id="node4" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="224,1672,391,1699"/>
<area shape="rect" id="node11" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="2289,1461,2403,1488"/>
<area shape="rect" id="node16" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1111,1841,1285,1868"/>
<area shape="rect" id="node48" href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f" title="_mosquitto_write_uint16" alt="" coords="226,2203,389,2229"/>
<area shape="rect" id="node50" href="a00162.html#a307413f45257069e76295c70a6d899d8" title="_mosquitto_write_bytes" alt="" coords="227,2253,387,2280"/>
<area shape="rect" id="node5" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="463,1606,605,1647"/>
<area shape="rect" id="node6" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2524,1867,2655,1893"/>
<area shape="rect" id="node7" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="439,195,629,221"/>
<area shape="rect" id="node8" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2727,295,2837,321"/>
<area shape="rect" id="node9" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1548,1917,1719,1944"/>
<area shape="rect" id="node14" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="677,195,848,221"/>
<area shape="rect" id="node10" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1781,2086,1943,2127"/>
<area shape="rect" id="node12" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1781,1969,1943,2010"/>
<area shape="rect" id="node13" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1767,2035,1957,2061"/>
<area shape="rect" id="node15" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="896,1585,1063,1626"/>
<area shape="rect" id="node17" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="1333,1664,1500,1691"/>
<area shape="rect" id="node18" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1560,1461,1707,1488"/>
<area shape="rect" id="node19" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="1770,1715,1954,1741"/>
<area shape="rect" id="node20" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="1551,1563,1715,1589"/>
<area shape="rect" id="node21" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="1791,575,1933,601"/>
<area shape="rect" id="node22" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="1789,1157,1935,1184"/>
<area shape="rect" id="node45" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="1773,803,1951,829"/>
<area shape="rect" id="node23" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2009,752,2189,779"/>
<area shape="rect" id="node25" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2005,593,2192,620"/>
<area shape="rect" id="node30" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2240,448,2452,475"/>
<area shape="rect" id="node31" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2025,1765,2173,1792"/>
<area shape="rect" id="node36" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2257,955,2435,981"/>
<area shape="rect" id="node37" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2259,853,2433,880"/>
<area shape="rect" id="node38" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="2022,1816,2175,1843"/>
<area shape="rect" id="node39" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="2013,853,2184,880"/>
<area shape="rect" id="node40" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="2017,1715,2180,1741"/>
<area shape="rect" id="node41" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="2010,1360,2187,1387"/>
<area shape="rect" id="node42" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="2021,1284,2177,1311"/>
<area shape="rect" id="node43" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="2009,1208,2189,1235"/>
<area shape="rect" id="node44" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="2249,904,2443,931"/>
<area shape="rect" id="node24" href="a00171.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="2257,600,2435,627"/>
<area shape="rect" id="node26" href="a00169.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2240,499,2452,525"/>
<area shape="rect" id="node27" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="2509,1132,2669,1159"/>
<area shape="rect" id="node28" href="a00191.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="2500,511,2679,537"/>
<area shape="rect" id="node29" href="a00155.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="2516,445,2663,486"/>
<area shape="rect" id="node32" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="2267,1664,2425,1691"/>
<area shape="rect" id="node33" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2247,1867,2445,1893"/>
<area shape="rect" id="node34" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2281,2035,2411,2061"/>
<area shape="rect" id="node35" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319" title="mosquitto_pub_topic\l_check" alt="" coords="2275,1969,2417,2010"/>
<area shape="rect" id="node46" href="a00164.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="2009,1157,2188,1184"/>
<area shape="rect" id="node47" href="a00166.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="2005,701,2192,728"/>
<area shape="rect" id="node49" href="a00162.html#adc64d22375628582aa20cb1f8e9435a3" title="_mosquitto_write_byte" alt="" coords="457,2203,611,2229"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a76632d665060f0325b7a5a639de9cc40"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _mosquitto_socket_get_address </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a>&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00199_source.html#l00514">514</a> of file <a class="el" href="a00199_source.html">net.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;{</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keyword">struct </span>sockaddr_storage addr;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    socklen_t addrlen;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    addrlen = <span class="keyword">sizeof</span>(addr);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span>(!getpeername(<a class="code" href="a00427.html#a7908f70ce5b165788133870c881f016a">sock</a>, (<span class="keyword">struct</span> sockaddr *)&amp;addr, &amp;addrlen)){</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">if</span>(addr.ss_family == AF_INET){</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">if</span>(inet_ntop(AF_INET, &amp;((<span class="keyword">struct</span> sockaddr_in *)&amp;addr)-&gt;sin_addr.s_addr, buf, len)){</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(addr.ss_family == AF_INET6){</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keywordflow">if</span>(inet_ntop(AF_INET6, &amp;((<span class="keyword">struct</span> sockaddr_in6 *)&amp;addr)-&gt;sin6_addr.s6_addr, buf, len)){</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        }</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    }</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;}</div><div class="ttc" id="a00427_html_a7908f70ce5b165788133870c881f016a"><div class="ttname"><a href="a00427.html#a7908f70ce5b165788133870c881f016a">01-connect-anon-denied.sock</a></div><div class="ttdeci">sock</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00021">01-connect-anon-denied.py:21</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af52acda25b9090675773beafeca25264"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void do_disconnect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00195_source.html#l00424">424</a> of file <a class="el" href="a00195_source.html">loop.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;{</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordtype">char</span> *id;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> == <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732a1d737de8ae3c143613c2febf2bdbbfc1">mosq_cs_disconnected</a>){</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="preprocessor">#ifdef WITH_WEBSOCKETS</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">if</span>(context-&gt;wsi){</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> != <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a>){</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ad2acd3e5fa035acc687e9e9a6d41c2fb">mosq_cs_disconnect_ws</a>;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">if</span>(context-&gt;wsi){</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            libwebsocket_callback_on_writable(context-&gt;ws_context, context-&gt;wsi);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> != <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>){</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <a class="code" href="a00209.html#a3f83117e1108d63844a58d2d79c3b980">HASH_DELETE</a>(hh_sock, db-&gt;<a class="code" href="a00089.html#acef8c251ec284f40de65517454659178">contexts_by_sock</a>, context);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> = <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            context-&gt;pollfd_index = -1;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }<span class="keywordflow">else</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">connection_messages</a> == <span class="keyword">true</span>){</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>){</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keywordtype">id</span> = context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <span class="keywordtype">id</span> = <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> != <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a>){</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;Socket error on client %s, disconnecting.&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;Client %s disconnected.&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <a class="code" href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738">mqtt3_context_disconnect</a>(db, context);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> &amp;&amp; !context-&gt;bridge){</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a>){</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <a class="code" href="a00190.html#a7310ffcd887c91eef7b5f087ff04af3f">mosquitto__add_context_to_disused</a>(db, context);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>){</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                <a class="code" href="a00209.html#a3f83117e1108d63844a58d2d79c3b980">HASH_DELETE</a>(hh_id, db-&gt;<a class="code" href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">contexts_by_id</a>, context);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a> = NULL;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732a1d737de8ae3c143613c2febf2bdbbfc1">mosq_cs_disconnected</a>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;}</div><div class="ttc" id="a00190_html_a7310ffcd887c91eef7b5f087ff04af3f"><div class="ttname"><a href="a00190.html#a7310ffcd887c91eef7b5f087ff04af3f">mosquitto__add_context_to_disused</a></div><div class="ttdeci">void mosquitto__add_context_to_disused(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00210">context.c:210</a></div></div>
<div class="ttc" id="a00089_html_acef8c251ec284f40de65517454659178"><div class="ttname"><a href="a00089.html#acef8c251ec284f40de65517454659178">mosquitto_db::contexts_by_sock</a></div><div class="ttdeci">struct mosquitto * contexts_by_sock</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00251">mosquitto_broker.h:251</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00089_html_ac5b775be8b87233bb22f20b10bbac0bd"><div class="ttname"><a href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">mosquitto_db::contexts_by_id</a></div><div class="ttdeci">struct mosquitto * contexts_by_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00250">mosquitto_broker.h:250</a></div></div>
<div class="ttc" id="a00163_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00045">net_mosq.h:45</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00190_html_a1952df5bc9a6a0c54817fb60c955c738"><div class="ttname"><a href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738">mqtt3_context_disconnect</a></div><div class="ttdeci">void mqtt3_context_disconnect(struct mosquitto_db *db, struct mosquitto *ctxt)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00202">context.c:202</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00095">mosquitto_internal.h:95</a></div></div>
<div class="ttc" id="a00086_html_ab9d8935077ef424c322233a19a9cbf5c"><div class="ttname"><a href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">mosquitto::clean_session</a></div><div class="ttdeci">bool clean_session</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00205">mosquitto_internal.h:205</a></div></div>
<div class="ttc" id="a00209_html_a3f83117e1108d63844a58d2d79c3b980"><div class="ttname"><a href="a00209.html#a3f83117e1108d63844a58d2d79c3b980">HASH_DELETE</a></div><div class="ttdeci">#define HASH_DELETE(hh, head, delptr)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00215">uthash.h:215</a></div></div>
<div class="ttc" id="a00159_html_a9813111aaf5eaafd2eaac66e1dc4659d"><div class="ttname"><a href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a></div><div class="ttdeci">#define MOSQ_LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00055">mosquitto.h:55</a></div></div>
<div class="ttc" id="a00086_html_a26a90a9bba5628b617203725c220aca5"><div class="ttname"><a href="a00086.html#a26a90a9bba5628b617203725c220aca5">mosquitto::state</a></div><div class="ttdeci">enum mosquitto_client_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00168">mosquitto_internal.h:168</a></div></div>
<div class="ttc" id="a00086_html_a31930c9d3d288fc2fdf253ccf01d10a3"><div class="ttname"><a href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">mosquitto::sock</a></div><div class="ttdeci">mosq_sock_t sock</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00154">mosquitto_internal.h:154</a></div></div>
<div class="ttc" id="a00097_html_a2bc58933451bd6d17a5e9a58ebea1428"><div class="ttname"><a href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">mqtt3_config::connection_messages</a></div><div class="ttdeci">bool connection_messages</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00115">mosquitto_broker.h:115</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732a1d737de8ae3c143613c2febf2bdbbfc1"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732a1d737de8ae3c143613c2febf2bdbbfc1">mosq_cs_disconnected</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00100">mosquitto_internal.h:100</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ad2acd3e5fa035acc687e9e9a6d41c2fb"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ad2acd3e5fa035acc687e9e9a6d41c2fb">mosq_cs_disconnect_ws</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00099">mosquitto_internal.h:99</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_af52acda25b9090675773beafeca25264_cgraph.png" border="0" usemap="#a00196_af52acda25b9090675773beafeca25264_cgraph" alt=""/></div>
<map name="a00196_af52acda25b9090675773beafeca25264_cgraph" id="a00196_af52acda25b9090675773beafeca25264_cgraph">
<area shape="rect" id="node2" href="a00152.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2026,2376,2173,2402"/>
<area shape="rect" id="node3" href="a00191.html#a1952df5bc9a6a0c54817fb60c955c738" title="mqtt3_context_disconnect" alt="" coords="1039,358,1213,385"/>
<area shape="rect" id="node9" href="a00154.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="2042,602,2157,629"/>
<area shape="rect" id="node19" href="a00191.html#a7310ffcd887c91eef7b5f087ff04af3f" title="mosquitto__add_context\l_to_disused" alt="" coords="161,3178,325,3219"/>
<area shape="rect" id="node20" href="a00163.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="160,1809,327,1836"/>
<area shape="rect" id="node24" href="a00163.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="375,2072,539,2098"/>
<area shape="rect" id="node4" href="a00191.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="1277,592,1443,618"/>
<area shape="rect" id="node15" href="a00163.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1275,257,1445,284"/>
<area shape="rect" id="node5" href="a00197.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="1539,1505,1684,1532"/>
<area shape="rect" id="node12" href="a00192.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="1522,612,1701,654"/>
<area shape="rect" id="node6" href="a00197.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="1786,1186,1931,1227"/>
<area shape="rect" id="node7" href="a00160.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2000,1164,2199,1190"/>
<area shape="rect" id="node8" href="a00154.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2034,1454,2165,1481"/>
<area shape="rect" id="node10" href="a00154.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2035,906,2164,933"/>
<area shape="rect" id="node11" href="a00154.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2036,1084,2163,1110"/>
<area shape="rect" id="node13" href="a00192.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="1773,1033,1945,1060"/>
<area shape="rect" id="node14" href="a00197.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="1766,628,1951,654"/>
<area shape="rect" id="node16" href="a00164.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1531,75,1692,116"/>
<area shape="rect" id="node17" href="a00164.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1531,140,1692,182"/>
<area shape="rect" id="node18" href="a00163.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1516,206,1707,233"/>
<area shape="rect" id="node21" href="a00163.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="383,1809,530,1836"/>
<area shape="rect" id="node22" href="a00163.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="587,577,771,604"/>
<area shape="rect" id="node23" href="a00178.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2044,3025,2155,3052"/>
<area shape="rect" id="node25" href="a00163.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="833,2974,975,3001"/>
<area shape="rect" id="node26" href="a00197.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="605,2116,752,2142"/>
<area shape="rect" id="node48" href="a00165.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="1037,2518,1215,2545"/>
<area shape="rect" id="node27" href="a00167.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="1270,2721,1450,2748"/>
<area shape="rect" id="node29" href="a00167.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="1267,2620,1453,2646"/>
<area shape="rect" id="node34" href="a00167.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="1505,2569,1717,2596"/>
<area shape="rect" id="node35" href="a00166.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="1286,1416,1434,1442"/>
<area shape="rect" id="node39" href="a00167.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="1523,2518,1700,2545"/>
<area shape="rect" id="node40" href="a00167.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="1273,2366,1447,2393"/>
<area shape="rect" id="node41" href="a00197.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="827,990,981,1017"/>
<area shape="rect" id="node42" href="a00197.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="819,2924,989,2950"/>
<area shape="rect" id="node43" href="a00197.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="1279,1809,1441,1836"/>
<area shape="rect" id="node44" href="a00197.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="1271,2012,1449,2038"/>
<area shape="rect" id="node45" href="a00197.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="1282,678,1438,705"/>
<area shape="rect" id="node46" href="a00167.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="1521,1961,1701,1988"/>
<area shape="rect" id="node47" href="a00167.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="1263,2316,1457,2342"/>
<area shape="rect" id="node28" href="a00172.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="1770,2772,1947,2798"/>
<area shape="rect" id="node30" href="a00170.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="1505,2620,1717,2646"/>
<area shape="rect" id="node31" href="a00163.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="1779,2232,1939,2258"/>
<area shape="rect" id="node32" href="a00192.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="1769,2620,1948,2646"/>
<area shape="rect" id="node33" href="a00156.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="1785,2503,1932,2544"/>
<area shape="rect" id="node36" href="a00163.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="1533,1910,1690,1937"/>
<area shape="rect" id="node37" href="a00160.html#a37608453ba85c5b8f9f15cff802a8319" title="mosquitto_pub_topic\l_check" alt="" coords="1540,983,1683,1024"/>
<area shape="rect" id="node38" href="a00163.html#a668e43fc39fa0ae062aaa427b15382a9" title="_mosquitto_read_bytes" alt="" coords="1533,1606,1690,1633"/>
<area shape="rect" id="node49" href="a00165.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="1271,2214,1449,2241"/>
<area shape="rect" id="node50" href="a00167.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="1765,2974,1952,3001"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a58d0ace4df75ecf8a8a0eb995e8f9cd6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int drop_privileges </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00097.html">mqtt3_config</a> *&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>temporary</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00158_source.html#l00085">85</a> of file <a class="el" href="a00158_source.html">mosquitto.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;{</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#if !defined(__CYGWIN__) &amp;&amp; !defined(WIN32)</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keyword">struct </span>passwd *pwd;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">char</span> err[256];</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span>(geteuid() == 0){</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a> &amp;&amp; strcmp(config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a>, <span class="stringliteral">&quot;root&quot;</span>)){</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            pwd = getpwnam(config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a>);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordflow">if</span>(!pwd){</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Invalid user &#39;%s&#39;.&quot;</span>, config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a>);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <span class="keywordflow">if</span>(initgroups(config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a>, pwd-&gt;pw_gid) == -1){</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                strerror_r(errno, err, 256);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error setting groups whilst dropping privileges: %s.&quot;</span>, err);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">if</span>(temporary){</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                rc = setegid(pwd-&gt;pw_gid);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                rc = setgid(pwd-&gt;pw_gid);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">if</span>(rc == -1){</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                strerror_r(errno, err, 256);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error setting gid whilst dropping privileges: %s.&quot;</span>, err);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keywordflow">if</span>(temporary){</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                rc = seteuid(pwd-&gt;pw_uid);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                rc = setuid(pwd-&gt;pw_uid);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">if</span>(rc == -1){</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                strerror_r(errno, err, 256);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error setting uid whilst dropping privileges: %s.&quot;</span>, err);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">if</span>(geteuid() == 0 || getegid() == 0){</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#af42b074947ad51304b224e61307ff523">MOSQ_LOG_WARNING</a>, <span class="stringliteral">&quot;Warning: Mosquitto should not be run as root/administrator.&quot;</span>);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00097_html_a419267339dfc7093068db4eced13c349"><div class="ttname"><a href="a00097.html#a419267339dfc7093068db4eced13c349">mqtt3_config::user</a></div><div class="ttdeci">char * user</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00139">mosquitto_broker.h:139</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00159_html_af42b074947ad51304b224e61307ff523"><div class="ttname"><a href="a00159.html#af42b074947ad51304b224e61307ff523">MOSQ_LOG_WARNING</a></div><div class="ttdeci">#define MOSQ_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00056">mosquitto.h:56</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a58d0ace4df75ecf8a8a0eb995e8f9cd6_cgraph.png" border="0" usemap="#a00196_a58d0ace4df75ecf8a8a0eb995e8f9cd6_cgraph" alt=""/></div>
<map name="a00196_a58d0ace4df75ecf8a8a0eb995e8f9cd6_cgraph" id="a00196_a58d0ace4df75ecf8a8a0eb995e8f9cd6_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="163,5,309,32"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7310ffcd887c91eef7b5f087ff04af3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mosquitto__add_context_to_disused </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00190_source.html#l00210">210</a> of file <a class="el" href="a00190_source.html">context.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#add5e5f3f2a13b2ae5fc346f4171d904d">ll_for_free</a>){</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        context-&gt;for_free_next = db-&gt;<a class="code" href="a00089.html#add5e5f3f2a13b2ae5fc346f4171d904d">ll_for_free</a>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        db-&gt;<a class="code" href="a00089.html#add5e5f3f2a13b2ae5fc346f4171d904d">ll_for_free</a> = context;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        db-&gt;<a class="code" href="a00089.html#add5e5f3f2a13b2ae5fc346f4171d904d">ll_for_free</a> = context;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div><div class="ttc" id="a00089_html_add5e5f3f2a13b2ae5fc346f4171d904d"><div class="ttname"><a href="a00089.html#add5e5f3f2a13b2ae5fc346f4171d904d">mosquitto_db::ll_for_free</a></div><div class="ttdeci">struct mosquitto * ll_for_free</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00270">mosquitto_broker.h:270</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a838cff02f4134c5c060e16009cc7254c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mosquitto__db_msg_store_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00092.html">mosquitto_msg_store</a> *&#160;</td>
          <td class="paramname"><em>store</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00135">135</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    store-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a> = db-&gt;<a class="code" href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">msg_store</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    store-&gt;<a class="code" href="a00092.html#afebce6488f474153ec48988055270e92">prev</a> = NULL;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">msg_store</a>){</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        db-&gt;<a class="code" href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">msg_store</a>-&gt;<a class="code" href="a00092.html#afebce6488f474153ec48988055270e92">prev</a> = store;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    db-&gt;<a class="code" href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">msg_store</a> = store;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div><div class="ttc" id="a00092_html_afebce6488f474153ec48988055270e92"><div class="ttname"><a href="a00092.html#afebce6488f474153ec48988055270e92">mosquitto_msg_store::prev</a></div><div class="ttdeci">struct mosquitto_msg_store * prev</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00178">mosquitto_broker.h:178</a></div></div>
<div class="ttc" id="a00089_html_abf110ad0dc01421cae84a539c80a1fb0"><div class="ttname"><a href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">mosquitto_db::msg_store</a></div><div class="ttdeci">struct mosquitto_msg_store * msg_store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00257">mosquitto_broker.h:257</a></div></div>
<div class="ttc" id="a00092_html_adc0c2cef8a8fba862810c5f0acf70777"><div class="ttname"><a href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">mosquitto_msg_store::next</a></div><div class="ttdeci">struct mosquitto_msg_store * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00177">mosquitto_broker.h:177</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af3cded7beb61e6c31048a7aa8ebadac2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mosquitto__db_msg_store_clean </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00176">176</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00092.html">mosquitto_msg_store</a> *store, *<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>;;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    store = db-&gt;<a class="code" href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">msg_store</a>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">while</span>(store){</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        next = store-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3">mosquitto__db_msg_store_remove</a>(db, store);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        store = <a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div><div class="ttc" id="a00191_html_a0cdc24cdccc64a0e398b093e2a1bf1b3"><div class="ttname"><a href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3">mosquitto__db_msg_store_remove</a></div><div class="ttdeci">void mosquitto__db_msg_store_remove(struct mosquitto_db *db, struct mosquitto_msg_store *store)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00146">database.c:146</a></div></div>
<div class="ttc" id="a00089_html_abf110ad0dc01421cae84a539c80a1fb0"><div class="ttname"><a href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">mosquitto_db::msg_store</a></div><div class="ttdeci">struct mosquitto_msg_store * msg_store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00257">mosquitto_broker.h:257</a></div></div>
<div class="ttc" id="a00092_html"><div class="ttname"><a href="a00092.html">mosquitto_msg_store</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00176">mosquitto_broker.h:176</a></div></div>
<div class="ttc" id="a00092_html_adc0c2cef8a8fba862810c5f0acf70777"><div class="ttname"><a href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">mosquitto_msg_store::next</a></div><div class="ttdeci">struct mosquitto_msg_store * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00177">mosquitto_broker.h:177</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_af3cded7beb61e6c31048a7aa8ebadac2_cgraph.png" border="0" usemap="#a00196_af3cded7beb61e6c31048a7aa8ebadac2_cgraph" alt=""/></div>
<map name="a00196_af3cded7beb61e6c31048a7aa8ebadac2_cgraph" id="a00196_af3cded7beb61e6c31048a7aa8ebadac2_cgraph">
<area shape="rect" id="node2" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="228,5,403,47"/>
<area shape="rect" id="node3" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="451,13,565,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af19cbc47cd971cdb22e9f48566bb3e68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mosquitto__db_msg_store_deref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00092.html">mosquitto_msg_store</a> **&#160;</td>
          <td class="paramname"><em>store</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00188">188</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;{</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    (*store)-&gt;ref_count--;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">if</span>((*store)-&gt;ref_count == 0){</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3">mosquitto__db_msg_store_remove</a>(db, *store);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        *store = NULL;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div><div class="ttc" id="a00191_html_a0cdc24cdccc64a0e398b093e2a1bf1b3"><div class="ttname"><a href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3">mosquitto__db_msg_store_remove</a></div><div class="ttdeci">void mosquitto__db_msg_store_remove(struct mosquitto_db *db, struct mosquitto_msg_store *store)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00146">database.c:146</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_af19cbc47cd971cdb22e9f48566bb3e68_cgraph.png" border="0" usemap="#a00196_af19cbc47cd971cdb22e9f48566bb3e68_cgraph" alt=""/></div>
<map name="a00196_af19cbc47cd971cdb22e9f48566bb3e68_cgraph" id="a00196_af19cbc47cd971cdb22e9f48566bb3e68_cgraph">
<area shape="rect" id="node2" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="451,29,625,70"/>
<area shape="rect" id="node3" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="673,36,788,63"/>
<area shape="rect" id="node4" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="228,100,403,141"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0cdc24cdccc64a0e398b093e2a1bf1b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mosquitto__db_msg_store_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00092.html">mosquitto_msg_store</a> *&#160;</td>
          <td class="paramname"><em>store</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00146">146</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">if</span>(store-&gt;<a class="code" href="a00092.html#afebce6488f474153ec48988055270e92">prev</a>){</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        store-&gt;<a class="code" href="a00092.html#afebce6488f474153ec48988055270e92">prev</a>-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a> = store-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">if</span>(store-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>){</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            store-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>-&gt;<a class="code" href="a00092.html#afebce6488f474153ec48988055270e92">prev</a> = store-&gt;<a class="code" href="a00092.html#afebce6488f474153ec48988055270e92">prev</a>;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        db-&gt;<a class="code" href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">msg_store</a> = store-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">if</span>(store-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>){</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            store-&gt;<a class="code" href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">next</a>-&gt;<a class="code" href="a00092.html#afebce6488f474153ec48988055270e92">prev</a> = NULL;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    db-&gt;<a class="code" href="a00089.html#a9dbd28cac7509625e45df1563df9230a">msg_store_count</a>--;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span>(store-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(store-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span>(store-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>){</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;store-&gt;<a class="code" href="a00092.html#a1056110537a89222bc155371a223ae2d">dest_id_count</a>; i++){</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="keywordflow">if</span>(store-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>[i]) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(store-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>[i]);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(store-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span>(store-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(store-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span>(store-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(store-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(store);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div><div class="ttc" id="a00092_html_afebce6488f474153ec48988055270e92"><div class="ttname"><a href="a00092.html#afebce6488f474153ec48988055270e92">mosquitto_msg_store::prev</a></div><div class="ttdeci">struct mosquitto_msg_store * prev</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00178">mosquitto_broker.h:178</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00092_html_a63a59debb4a78b52c937c8e7129b214c"><div class="ttname"><a href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">mosquitto_msg_store::source_id</a></div><div class="ttdeci">char * source_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00180">mosquitto_broker.h:180</a></div></div>
<div class="ttc" id="a00092_html_ad9f78d099469a4300ca282d895855f72"><div class="ttname"><a href="a00092.html#ad9f78d099469a4300ca282d895855f72">mosquitto_msg_store::payload</a></div><div class="ttdeci">void * payload</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00185">mosquitto_broker.h:185</a></div></div>
<div class="ttc" id="a00092_html_a1056110537a89222bc155371a223ae2d"><div class="ttname"><a href="a00092.html#a1056110537a89222bc155371a223ae2d">mosquitto_msg_store::dest_id_count</a></div><div class="ttdeci">int dest_id_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00182">mosquitto_broker.h:182</a></div></div>
<div class="ttc" id="a00089_html_abf110ad0dc01421cae84a539c80a1fb0"><div class="ttname"><a href="a00089.html#abf110ad0dc01421cae84a539c80a1fb0">mosquitto_db::msg_store</a></div><div class="ttdeci">struct mosquitto_msg_store * msg_store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00257">mosquitto_broker.h:257</a></div></div>
<div class="ttc" id="a00092_html_a9a0bdf0801fb982110d423428a8701d9"><div class="ttname"><a href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">mosquitto_msg_store::dest_ids</a></div><div class="ttdeci">char ** dest_ids</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00181">mosquitto_broker.h:181</a></div></div>
<div class="ttc" id="a00092_html_a9f27c2318268a2034571e2bbe91f69c6"><div class="ttname"><a href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">mosquitto_msg_store::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00184">mosquitto_broker.h:184</a></div></div>
<div class="ttc" id="a00089_html_a9dbd28cac7509625e45df1563df9230a"><div class="ttname"><a href="a00089.html#a9dbd28cac7509625e45df1563df9230a">mosquitto_db::msg_store_count</a></div><div class="ttdeci">int msg_store_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00262">mosquitto_broker.h:262</a></div></div>
<div class="ttc" id="a00092_html_adc0c2cef8a8fba862810c5f0acf70777"><div class="ttname"><a href="a00092.html#adc0c2cef8a8fba862810c5f0acf70777">mosquitto_msg_store::next</a></div><div class="ttdeci">struct mosquitto_msg_store * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00177">mosquitto_broker.h:177</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a0cdc24cdccc64a0e398b093e2a1bf1b3_cgraph.png" border="0" usemap="#a00196_a0cdc24cdccc64a0e398b093e2a1bf1b3_cgraph" alt=""/></div>
<map name="a00196_a0cdc24cdccc64a0e398b093e2a1bf1b3_cgraph" id="a00196_a0cdc24cdccc64a0e398b093e2a1bf1b3_cgraph">
<area shape="rect" id="node2" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="228,13,343,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1b4b98c96c9b4596e5277f7477dd7013"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mosquitto__free_disused_contexts </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00190_source.html#l00220">220</a> of file <a class="el" href="a00190_source.html">context.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;{</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00086.html">mosquitto</a> *context, *next;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    assert(db);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    context = db-&gt;<a class="code" href="a00089.html#add5e5f3f2a13b2ae5fc346f4171d904d">ll_for_free</a>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">while</span>(context){</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        next = context-&gt;for_free_next;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <a class="code" href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0">mqtt3_context_cleanup</a>(db, context, <span class="keyword">true</span>);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        context = next;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    db-&gt;<a class="code" href="a00089.html#add5e5f3f2a13b2ae5fc346f4171d904d">ll_for_free</a> = NULL;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div><div class="ttc" id="a00190_html_ac919bd8bbc017773fc9d75c098faaae0"><div class="ttname"><a href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0">mqtt3_context_cleanup</a></div><div class="ttdeci">void mqtt3_context_cleanup(struct mosquitto_db *db, struct mosquitto *context, bool do_free)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00092">context.c:92</a></div></div>
<div class="ttc" id="a00086_html"><div class="ttname"><a href="a00086.html">mosquitto</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00153">mosquitto_internal.h:153</a></div></div>
<div class="ttc" id="a00089_html_add5e5f3f2a13b2ae5fc346f4171d904d"><div class="ttname"><a href="a00089.html#add5e5f3f2a13b2ae5fc346f4171d904d">mosquitto_db::ll_for_free</a></div><div class="ttdeci">struct mosquitto * ll_for_free</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00270">mosquitto_broker.h:270</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a1b4b98c96c9b4596e5277f7477dd7013_cgraph.png" border="0" usemap="#a00196_a1b4b98c96c9b4596e5277f7477dd7013_cgraph" alt=""/></div>
<map name="a00196_a1b4b98c96c9b4596e5277f7477dd7013_cgraph" id="a00196_a1b4b98c96c9b4596e5277f7477dd7013_cgraph">
<area shape="rect" id="node2" href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0" title="mqtt3_context_cleanup" alt="" coords="220,340,377,367"/>
<area shape="rect" id="node3" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1600,508,1715,535"/>
<area shape="rect" id="node4" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1121,144,1291,171"/>
<area shape="rect" id="node9" href="a00196.html#a6f5d696cb546ec16f63ef7855b624fe0" title="mqtt3_subs_clean_session" alt="" coords="657,340,837,367"/>
<area shape="rect" id="node10" href="a00191.html#aa62ed0d7c268d8756b3b91951d59bac2" title="mqtt3_db_messages_delete" alt="" coords="885,391,1071,417"/>
<area shape="rect" id="node11" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="1119,466,1293,507"/>
<area shape="rect" id="node13" href="a00190.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="434,631,601,657"/>
<area shape="rect" id="node27" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="425,239,609,265"/>
<area shape="rect" id="node5" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1362,57,1523,98"/>
<area shape="rect" id="node6" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="1379,609,1506,636"/>
<area shape="rect" id="node7" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1362,122,1523,163"/>
<area shape="rect" id="node8" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1347,5,1538,32"/>
<area shape="rect" id="node12" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="1355,442,1530,483"/>
<area shape="rect" id="node14" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="905,913,1051,940"/>
<area shape="rect" id="node23" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="658,594,837,635"/>
<area shape="rect" id="node15" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="1133,1033,1279,1074"/>
<area shape="rect" id="node17" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="1369,913,1516,940"/>
<area shape="rect" id="node16" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="1343,1268,1542,1295"/>
<area shape="rect" id="node18" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="1592,1065,1723,1092"/>
<area shape="rect" id="node19" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="1380,1217,1505,1244"/>
<area shape="rect" id="node20" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="1405,1015,1480,1041"/>
<area shape="rect" id="node21" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="1593,1015,1722,1041"/>
<area shape="rect" id="node22" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="1382,1065,1503,1092"/>
<area shape="rect" id="node24" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="1120,787,1292,813"/>
<area shape="rect" id="node26" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="885,559,1071,585"/>
<area shape="rect" id="node25" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="1341,761,1544,788"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6c132b4fe96e98b267516e77036cd409"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_acl_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>access</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00203_source.html#l00218">218</a> of file <a class="el" href="a00203_source.html">security.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;{</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span>(!context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>){</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a>){</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a">mosquitto_acl_check_default</a>(db, context, topic, access);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span>(context-&gt;bridge){</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            username = context-&gt;bridge-&gt;local_username;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        }<span class="keywordflow">else</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            username = context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a6d883f3ac6ba9dcdb8bf7f2ac686ff3d">auth_plugin_deny_special_chars</a> == <span class="keyword">true</span>){</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="comment">/* Check whether the client id or username contains a + or # and if</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">            * so deny access.</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">            *</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">            * Do this check for every message regardless, we have to protect the</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">            * plugins against possible pattern based attacks.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">            */</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">if</span>(username &amp;&amp; strpbrk(username, <span class="stringliteral">&quot;+#&quot;</span>)){</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;ACL denying access to client with dangerous username \&quot;%s\&quot;&quot;</span>, username);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a> &amp;&amp; strpbrk(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, <span class="stringliteral">&quot;+#&quot;</span>)){</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;ACL denying access to client with dangerous client id \&quot;%s\&quot;&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">return</span> db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7f11a3ec696d6e7eaa38b18eb2cbec16">acl_check</a>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">user_data</a>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, username, topic, access);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div><div class="ttc" id="a00089_html_a955e8de0edc8e8b484cca2db67bed33b"><div class="ttname"><a href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">mosquitto_db::auth_plugin</a></div><div class="ttdeci">struct _mosquitto_auth_plugin auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00265">mosquitto_broker.h:265</a></div></div>
<div class="ttc" id="a00010_html_acf433aeb82cd031f935e294f9e1c281f"><div class="ttname"><a href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">_mosquitto_auth_plugin::lib</a></div><div class="ttdeci">void * lib</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00231">mosquitto_broker.h:231</a></div></div>
<div class="ttc" id="a00010_html_a7f11a3ec696d6e7eaa38b18eb2cbec16"><div class="ttname"><a href="a00010.html#a7f11a3ec696d6e7eaa38b18eb2cbec16">_mosquitto_auth_plugin::acl_check</a></div><div class="ttdeci">int(* acl_check)(void *user_data, const char *clientid, const char *username, const char *topic, int access)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00238">mosquitto_broker.h:238</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00079">mosquitto.h:79</a></div></div>
<div class="ttc" id="a00159_html_a9813111aaf5eaafd2eaac66e1dc4659d"><div class="ttname"><a href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a></div><div class="ttdeci">#define MOSQ_LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00055">mosquitto.h:55</a></div></div>
<div class="ttc" id="a00086_html_a31ecd6b5e37dbd8ea64c179259561d0f"><div class="ttname"><a href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">mosquitto::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00164">mosquitto_internal.h:164</a></div></div>
<div class="ttc" id="a00097_html_a6d883f3ac6ba9dcdb8bf7f2ac686ff3d"><div class="ttname"><a href="a00097.html#a6d883f3ac6ba9dcdb8bf7f2ac686ff3d">mqtt3_config::auth_plugin_deny_special_chars</a></div><div class="ttdeci">bool auth_plugin_deny_special_chars</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00109">mosquitto_broker.h:109</a></div></div>
<div class="ttc" id="a00196_html_a084d088ea3e95fcd1745f2707d669e4a"><div class="ttname"><a href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a">mosquitto_acl_check_default</a></div><div class="ttdeci">int mosquitto_acl_check_default(struct mosquitto_db *db, struct mosquitto *context, const char *topic, int access)</div><div class="ttdef"><b>Definition:</b> <a href="a00204_source.html#l00224">security_default.c:224</a></div></div>
<div class="ttc" id="a00010_html_a7a2250d98915f6bfd6e1f42bf273eac9"><div class="ttname"><a href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">_mosquitto_auth_plugin::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00232">mosquitto_broker.h:232</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a6c132b4fe96e98b267516e77036cd409_cgraph.png" border="0" usemap="#a00196_a6c132b4fe96e98b267516e77036cd409_cgraph" alt=""/></div>
<map name="a00196_a6c132b4fe96e98b267516e77036cd409_cgraph" id="a00196_a6c132b4fe96e98b267516e77036cd409_cgraph">
<area shape="rect" id="node2" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="199,175,344,217"/>
<area shape="rect" id="node4" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="418,5,565,32"/>
<area shape="rect" id="node3" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="392,208,591,235"/>
<area shape="rect" id="node5" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="639,309,769,336"/>
<area shape="rect" id="node6" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="647,259,761,285"/>
<area shape="rect" id="node7" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="429,107,554,133"/>
<area shape="rect" id="node8" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="454,259,529,285"/>
<area shape="rect" id="node9" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="639,360,769,387"/>
<area shape="rect" id="node10" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="431,309,552,336"/>
<area shape="rect" id="node11" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="428,157,555,184"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a084d088ea3e95fcd1745f2707d669e4a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_acl_check_default </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>access</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00204_source.html#l00224">224</a> of file <a class="el" href="a00204_source.html">security_default.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;{</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">char</span> *local_acl;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00008.html">_mosquitto_acl</a> *acl_root;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordtype">bool</span> result;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordtype">int</span> len, tlen, clen, ulen;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordtype">char</span> *s;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span>(!db || !context || !<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a442ec343cb4b1102971160795eeed54d">acl_list</a> &amp;&amp; !db-&gt;<a class="code" href="a00089.html#a267b91ed086218b46e465dee9092400d">acl_patterns</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span>(context-&gt;bridge) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span>(!context-&gt;acl_list &amp;&amp; !db-&gt;<a class="code" href="a00089.html#a267b91ed086218b46e465dee9092400d">acl_patterns</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span>(context-&gt;acl_list){</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        acl_root = context-&gt;acl_list-&gt;acl;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        acl_root = NULL;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">/* Loop through all ACLs for this client. */</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">while</span>(acl_root){</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="comment">/* Loop through the topic looking for matches to this ACL. */</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="comment">/* If subscription starts with $, acl_root-&gt;topic must also start with $. */</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>[0] == <span class="charliteral">&#39;$&#39;</span> &amp;&amp; acl_root-&gt;<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>[0] != <span class="charliteral">&#39;$&#39;</span>){</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            acl_root = acl_root-&gt;<a class="code" href="a00008.html#a1a9b1dc72fd52e68f217319eefaf7f83">next</a>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <a class="code" href="a00159.html#abebbf4017c11827f1ac999082980cf2f">mosquitto_topic_matches_sub</a>(acl_root-&gt;<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>, <a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>, &amp;result);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">if</span>(result){</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00008.html#ab13c53ebdc119b7efcc5e0210a45b49d">access</a> &amp; acl_root-&gt;<a class="code" href="a00008.html#ab13c53ebdc119b7efcc5e0210a45b49d">access</a>){</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="comment">/* And access is allowed. */</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        acl_root = acl_root-&gt;<a class="code" href="a00008.html#a1a9b1dc72fd52e68f217319eefaf7f83">next</a>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    acl_root = db-&gt;<a class="code" href="a00089.html#a267b91ed086218b46e465dee9092400d">acl_patterns</a>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span>(acl_root){</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="comment">/* We are using pattern based acls. Check whether the username or</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">         * client id contains a + or # and if so deny access.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">         * Without this, a malicious client may configure its username/client</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">         * id to bypass ACL checks (or have a username/client id that cannot</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">         * publish or receive messages to its own place in the hierarchy).</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a> &amp;&amp; strpbrk(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>, <span class="stringliteral">&quot;+#&quot;</span>)){</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;ACL denying access to client with dangerous username \&quot;%s\&quot;&quot;</span>, context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a> &amp;&amp; strpbrk(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, <span class="stringliteral">&quot;+#&quot;</span>)){</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;ACL denying access to client with dangerous client id \&quot;%s\&quot;&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">/* Loop through all pattern ACLs. */</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    clen = strlen(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">while</span>(acl_root){</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        tlen = strlen(acl_root-&gt;<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">if</span>(acl_root-&gt;<a class="code" href="a00008.html#a60a137c1b73133dbec98c7c62b4894ad">ucount</a> &amp;&amp; !context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            acl_root = acl_root-&gt;<a class="code" href="a00008.html#a1a9b1dc72fd52e68f217319eefaf7f83">next</a>;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            ulen = strlen(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            len = tlen + acl_root-&gt;<a class="code" href="a00008.html#a623a4c0d69848322bdd725509c5b7eb0">ccount</a>*(clen-2) + acl_root-&gt;<a class="code" href="a00008.html#a60a137c1b73133dbec98c7c62b4894ad">ucount</a>*(ulen-2);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            ulen = 0;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            len = tlen + acl_root-&gt;<a class="code" href="a00008.html#a623a4c0d69848322bdd725509c5b7eb0">ccount</a>*(clen-2);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        local_acl = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(len+1);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span>(!local_acl) <span class="keywordflow">return</span> 1; <span class="comment">// FIXME</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        s = local_acl;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;tlen; i++){</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keywordflow">if</span>(i&lt;tlen-1 &amp;&amp; acl_root-&gt;<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>[i] == <span class="charliteral">&#39;%&#39;</span>){</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                <span class="keywordflow">if</span>(acl_root-&gt;<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>[i+1] == <span class="charliteral">&#39;c&#39;</span>){</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                    i++;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                    strncpy(s, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, clen);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                    s+=clen;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a> &amp;&amp; acl_root-&gt;<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>[i+1] == <span class="charliteral">&#39;u&#39;</span>){</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    i++;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                    strncpy(s, context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>, ulen);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    s+=ulen;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            s[0] = acl_root-&gt;<a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>[i];</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            s++;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        local_acl[len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <a class="code" href="a00159.html#abebbf4017c11827f1ac999082980cf2f">mosquitto_topic_matches_sub</a>(local_acl, <a class="code" href="a00008.html#a5e99a3357ae5737d5258e0803e482295">topic</a>, &amp;result);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(local_acl);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span>(result){</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00008.html#ab13c53ebdc119b7efcc5e0210a45b49d">access</a> &amp; acl_root-&gt;<a class="code" href="a00008.html#ab13c53ebdc119b7efcc5e0210a45b49d">access</a>){</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="comment">/* And access is allowed. */</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        acl_root = acl_root-&gt;<a class="code" href="a00008.html#a1a9b1dc72fd52e68f217319eefaf7f83">next</a>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;}</div><div class="ttc" id="a00089_html_a442ec343cb4b1102971160795eeed54d"><div class="ttname"><a href="a00089.html#a442ec343cb4b1102971160795eeed54d">mosquitto_db::acl_list</a></div><div class="ttdeci">struct _mosquitto_acl_user * acl_list</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00247">mosquitto_broker.h:247</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00089_html_a267b91ed086218b46e465dee9092400d"><div class="ttname"><a href="a00089.html#a267b91ed086218b46e465dee9092400d">mosquitto_db::acl_patterns</a></div><div class="ttdeci">struct _mosquitto_acl * acl_patterns</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00248">mosquitto_broker.h:248</a></div></div>
<div class="ttc" id="a00008_html_a1a9b1dc72fd52e68f217319eefaf7f83"><div class="ttname"><a href="a00008.html#a1a9b1dc72fd52e68f217319eefaf7f83">_mosquitto_acl::next</a></div><div class="ttdeci">struct _mosquitto_acl * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00217">mosquitto_broker.h:217</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00159_html_abebbf4017c11827f1ac999082980cf2f"><div class="ttname"><a href="a00159.html#abebbf4017c11827f1ac999082980cf2f">mosquitto_topic_matches_sub</a></div><div class="ttdeci">libmosq_EXPORT int mosquitto_topic_matches_sub(const char *sub, const char *topic, bool *result)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00225">util_mosq.c:225</a></div></div>
<div class="ttc" id="a00008_html_ab13c53ebdc119b7efcc5e0210a45b49d"><div class="ttname"><a href="a00008.html#ab13c53ebdc119b7efcc5e0210a45b49d">_mosquitto_acl::access</a></div><div class="ttdeci">int access</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00219">mosquitto_broker.h:219</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00079">mosquitto.h:79</a></div></div>
<div class="ttc" id="a00159_html_a9813111aaf5eaafd2eaac66e1dc4659d"><div class="ttname"><a href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a></div><div class="ttdeci">#define MOSQ_LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00055">mosquitto.h:55</a></div></div>
<div class="ttc" id="a00086_html_a31ecd6b5e37dbd8ea64c179259561d0f"><div class="ttname"><a href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">mosquitto::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00164">mosquitto_internal.h:164</a></div></div>
<div class="ttc" id="a00008_html_a5e99a3357ae5737d5258e0803e482295"><div class="ttname"><a href="a00008.html#a5e99a3357ae5737d5258e0803e482295">_mosquitto_acl::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00218">mosquitto_broker.h:218</a></div></div>
<div class="ttc" id="a00008_html_a60a137c1b73133dbec98c7c62b4894ad"><div class="ttname"><a href="a00008.html#a60a137c1b73133dbec98c7c62b4894ad">_mosquitto_acl::ucount</a></div><div class="ttdeci">int ucount</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00220">mosquitto_broker.h:220</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00008_html"><div class="ttname"><a href="a00008.html">_mosquitto_acl</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00216">mosquitto_broker.h:216</a></div></div>
<div class="ttc" id="a00008_html_a623a4c0d69848322bdd725509c5b7eb0"><div class="ttname"><a href="a00008.html#a623a4c0d69848322bdd725509c5b7eb0">_mosquitto_acl::ccount</a></div><div class="ttdeci">int ccount</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00221">mosquitto_broker.h:221</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a084d088ea3e95fcd1745f2707d669e4a_cgraph.png" border="0" usemap="#a00196_a084d088ea3e95fcd1745f2707d669e4a_cgraph" alt=""/></div>
<map name="a00196_a084d088ea3e95fcd1745f2707d669e4a_cgraph" id="a00196_a084d088ea3e95fcd1745f2707d669e4a_cgraph">
<area shape="rect" id="node2" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="199,5,397,32"/>
<area shape="rect" id="node3" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="225,56,371,83"/>
<area shape="rect" id="node4" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="445,208,576,235"/>
<area shape="rect" id="node5" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="453,259,568,285"/>
<area shape="rect" id="node6" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="235,360,361,387"/>
<area shape="rect" id="node7" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="261,157,335,184"/>
<area shape="rect" id="node8" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="446,157,575,184"/>
<area shape="rect" id="node9" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="237,208,359,235"/>
<area shape="rect" id="node10" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="235,411,361,437"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae88a6ec7610ccaf2ccd1506780302a4b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_main_loop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a> *&#160;</td>
          <td class="paramname"><em>listensock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>listensock_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>listener_max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00195_source.html#l00091">91</a> of file <a class="el" href="a00195_source.html">loop.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    time_t start_time = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    time_t last_backup = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    time_t now = 0;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    time_t now_time;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordtype">int</span> time_count;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordtype">int</span> fdcount;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00086.html">mosquitto</a> *context, *ctxt_tmp;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#ifndef WIN32</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    sigset_t sigblock, origsig;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">struct </span>pollfd *pollfds = NULL;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">int</span> pollfd_index;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordtype">int</span> pollfd_max;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a> bridge_sock;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    time_t expiration_check_time = 0;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    time_t last_timeout_check = 0;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">char</span> *id;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#ifndef WIN32</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    sigemptyset(&amp;sigblock);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    sigaddset(&amp;sigblock, SIGINT);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    sigaddset(&amp;sigblock, SIGTERM);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    sigaddset(&amp;sigblock, SIGHUP);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    pollfd_max = _getmaxstdio();</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    pollfd_max = getdtablesize();</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    pollfds = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> pollfd)*pollfd_max);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">if</span>(!pollfds){</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a82a8968536c2d3a907bd291d024f216a">persistent_client_expiration</a> &gt; 0){</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        expiration_check_time = time(NULL) + 3600;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">while</span>(<a class="code" href="a00195.html#aecd587c4be6cba0dd6af4ea0b4d9c183">run</a>){</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="a00190.html#a1b4b98c96c9b4596e5277f7477dd7013">mosquitto__free_disused_contexts</a>(db);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a9c5c5aadbe7e585ddc88123c0b1f171d">sys_interval</a> &gt; 0){</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <a class="code" href="a00196.html#ab1a5b88e8e067a6175a68014713053d0">mqtt3_db_sys_update</a>(db, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a9c5c5aadbe7e585ddc88123c0b1f171d">sys_interval</a>, start_time);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        memset(pollfds, -1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pollfd)*pollfd_max);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        pollfd_index = 0;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;listensock_count; i++){</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            pollfds[pollfd_index].fd = listensock[i];</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            pollfds[pollfd_index].events = POLLIN;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            pollfds[pollfd_index].revents = 0;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            pollfd_index++;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        now_time = time(NULL);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        time_count = 0;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a>(hh_sock, db-&gt;<a class="code" href="a00089.html#acef8c251ec284f40de65517454659178">contexts_by_sock</a>, context, ctxt_tmp){</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">if</span>(time_count &gt; 0){</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                time_count--;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                time_count = 1000;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                now = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            context-&gt;pollfd_index = -1;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> != <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>){</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                <span class="keywordflow">if</span>(context-&gt;bridge){</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                    <a class="code" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8">_mosquitto_check_keepalive</a>(db, context);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    <span class="keywordflow">if</span>(context-&gt;bridge-&gt;round_robin == <span class="keyword">false</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                            &amp;&amp; context-&gt;bridge-&gt;cur_address != 0</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                            &amp;&amp; now &gt; context-&gt;bridge-&gt;primary_retry){</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a270c7b9d619cd74fae0b1e1b3b83282e">_mosquitto_try_connect</a>(context, context-&gt;bridge-&gt;addresses[0].<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>, context-&gt;bridge-&gt;addresses[0].<a class="code" href="a00086.html#ae2aebd955d302f9673c57f49cb327f9b">port</a>, &amp;bridge_sock, NULL, <span class="keyword">false</span>) &lt;= 0){</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                            <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(bridge_sock);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                            <a class="code" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb">_mosquitto_socket_close</a>(db, context);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                            context-&gt;bridge-&gt;cur_address = context-&gt;bridge-&gt;address_count-1;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                        }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="comment">/* Local bridges never time out in this fashion. */</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                <span class="keywordflow">if</span>(!(context-&gt;<a class="code" href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">keepalive</a>)</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                        || context-&gt;bridge</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                        || now - context-&gt;<a class="code" href="a00086.html#ae44f689954c4c9247d6f6b8f2791cd60">last_msg_in</a> &lt; (time_t)(context-&gt;<a class="code" href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">keepalive</a>)*3/2){</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="a00191.html#aee64ee8f7ce7e65f696aa1bbf5c0674c">mqtt3_db_message_write</a>(db, context) == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                        pollfds[pollfd_index].fd = context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                        pollfds[pollfd_index].events = POLLIN;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                        pollfds[pollfd_index].revents = 0;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">current_out_packet</a> || context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> == <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732acd2fd9c6f8d89d358a085aa130750e24">mosq_cs_connect_pending</a> || context-&gt;ws_want_write){</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                            pollfds[pollfd_index].events |= POLLOUT;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                            context-&gt;ws_want_write = <span class="keyword">false</span>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                        }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                        context-&gt;pollfd_index = pollfd_index;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                        pollfd_index++;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                        <a class="code" href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a>(db, context);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                    }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">connection_messages</a> == <span class="keyword">true</span>){</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>){</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                            <span class="keywordtype">id</span> = context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                            <span class="keywordtype">id</span> = <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                        }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;Client %s has exceeded timeout, disconnecting.&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                    }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                    <span class="comment">/* Client has exceeded keepalive*1.5 */</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                    <a class="code" href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a>(db, context);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        time_count = 0;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;db-&gt;bridge_count; i++){</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">if</span>(!db-&gt;bridges[i]) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            context = db-&gt;bridges[i];</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> == <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>){</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <span class="keywordflow">if</span>(time_count &gt; 0){</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                    time_count--;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                    time_count = 1000;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    now = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <span class="comment">/* Want to try to restart the bridge connection */</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="keywordflow">if</span>(!context-&gt;bridge-&gt;restart_t){</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    context-&gt;bridge-&gt;restart_t = now+context-&gt;bridge-&gt;restart_timeout;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    context-&gt;bridge-&gt;cur_address++;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    <span class="keywordflow">if</span>(context-&gt;bridge-&gt;cur_address == context-&gt;bridge-&gt;address_count){</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                        context-&gt;bridge-&gt;cur_address = 0;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    <span class="keywordflow">if</span>(context-&gt;bridge-&gt;round_robin == <span class="keyword">false</span> &amp;&amp; context-&gt;bridge-&gt;cur_address != 0){</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                        context-&gt;bridge-&gt;primary_retry = now + 5;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    <span class="keywordflow">if</span>((context-&gt;bridge-&gt;start_type == <a class="code" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431">bst_lazy</a> &amp;&amp; context-&gt;bridge-&gt;lazy_reconnect)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                            || (context-&gt;bridge-&gt;start_type == <a class="code" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a72c992c5c2b3279fc0b2941b697fcd1f">bst_automatic</a> &amp;&amp; now &gt; context-&gt;bridge-&gt;restart_t)){</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                        context-&gt;bridge-&gt;restart_t = 0;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">#if defined(__GLIBC__) &amp;&amp; defined(WITH_ADNS)</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        <span class="keywordflow">if</span>(context-&gt;adns){</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                            <span class="comment">/* Waiting on DNS lookup */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                            rc = gai_error(context-&gt;adns);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                            <span class="keywordflow">if</span>(rc == EAI_INPROGRESS){</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                <span class="comment">/* Just keep on waiting */</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                            }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(rc == 0){</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                rc = mqtt3_bridge_connect_step2(db, context);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                <span class="keywordflow">if</span>(rc == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                                    pollfds[pollfd_index].fd = context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                    pollfds[pollfd_index].events = POLLIN;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                    pollfds[pollfd_index].revents = 0;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">current_out_packet</a>){</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                        pollfds[pollfd_index].events |= POLLOUT;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                    }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                    context-&gt;pollfd_index = pollfd_index;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                    pollfd_index++;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                                    context-&gt;bridge-&gt;cur_address++;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                    <span class="keywordflow">if</span>(context-&gt;bridge-&gt;cur_address == context-&gt;bridge-&gt;address_count){</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                                        context-&gt;bridge-&gt;cur_address = 0;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                    }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                <span class="comment">/* Need to retry */</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                <span class="keywordflow">if</span>(context-&gt;adns-&gt;ar_result){</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                    freeaddrinfo(context-&gt;adns-&gt;ar_result);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;adns);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                context-&gt;adns = NULL;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                            }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                            rc = mqtt3_bridge_connect_step1(db, context);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                            <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                context-&gt;bridge-&gt;cur_address++;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                                <span class="keywordflow">if</span>(context-&gt;bridge-&gt;cur_address == context-&gt;bridge-&gt;address_count){</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                                    context-&gt;bridge-&gt;cur_address = 0;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                            }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                        {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                            rc = mqtt3_bridge_connect(db, context);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                            <span class="keywordflow">if</span>(rc == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                pollfds[pollfd_index].fd = context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                pollfds[pollfd_index].events = POLLIN;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                pollfds[pollfd_index].revents = 0;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">current_out_packet</a>){</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                                    pollfds[pollfd_index].events |= POLLOUT;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                                context-&gt;pollfd_index = pollfd_index;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                pollfd_index++;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                context-&gt;bridge-&gt;cur_address++;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                <span class="keywordflow">if</span>(context-&gt;bridge-&gt;cur_address == context-&gt;bridge-&gt;address_count){</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                                    context-&gt;bridge-&gt;cur_address = 0;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                                }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                            }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                        }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                    }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                }</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        now_time = time(NULL);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a82a8968536c2d3a907bd291d024f216a">persistent_client_expiration</a> &gt; 0 &amp;&amp; now_time &gt; expiration_check_time){</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <a class="code" href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a>(hh_id, db-&gt;<a class="code" href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">contexts_by_id</a>, context, ctxt_tmp){</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> == <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a> &amp;&amp; context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> == 0){</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                    <span class="comment">/* This is a persistent client, check to see if the</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">                     * last time it connected was longer than</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">                     * persistent_client_expiration seconds ago. If so,</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">                     * expire it and clean up.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">                     */</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                    <span class="keywordflow">if</span>(now_time &gt; context-&gt;disconnect_t+db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a82a8968536c2d3a907bd291d024f216a">persistent_client_expiration</a>){</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>){</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                            <span class="keywordtype">id</span> = context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                            <span class="keywordtype">id</span> = <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                        }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;Expiring persistent client %s due to timeout.&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                        g_clients_expired++;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                        context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                        context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732a47da1eef583f102ff7ecbf684e6ab20d">mosq_cs_expiring</a>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                        <a class="code" href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a>(db, context);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            expiration_check_time = time(NULL) + 3600;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">if</span>(last_timeout_check &lt; <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>()){</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="comment">/* Only check at most once per second. */</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            <a class="code" href="a00191.html#a60d56ad7041c6e40c30db6a71c03f7e8">mqtt3_db_message_timeout_check</a>(db, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ac0e9185508867844483adadce8f5df61">retry_interval</a>);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            last_timeout_check = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor">#ifndef WIN32</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        sigprocmask(SIG_SETMASK, &amp;sigblock, &amp;origsig);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        fdcount = poll(pollfds, pollfd_index, 100);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        sigprocmask(SIG_SETMASK, &amp;origsig, NULL);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        fdcount = WSAPoll(pollfds, pollfd_index, 100);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">if</span>(fdcount == -1){</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error in poll: %s.&quot;</span>, <a class="code" href="a00525.html#ad2f696a3275eecbb98f8a9fda93e661c">strerror</a>(errno));</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            loop_handle_reads_writes(db, pollfds);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="keywordflow">for</span>(i=0; i&lt;listensock_count; i++){</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="keywordflow">if</span>(pollfds[i].revents &amp; (POLLIN | POLLPRI)){</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    <span class="keywordflow">while</span>(<a class="code" href="a00196.html#a3f89551c5a87457efb044a33b91a76dd">mqtt3_socket_accept</a>(db, listensock[i]) != -1){</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                    }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a93cbad1aadbb9472f12d92bd2b2935a4">persistence</a> &amp;&amp; db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#afbae47609d8225debca17b50b4db0beb">autosave_interval</a>){</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a9011d71e237c60be7fd01cd02fe4d2ef">autosave_on_changes</a>){</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#a85ea76e88408ef3a3c00129214782028">persistence_changes</a> &gt;= db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#afbae47609d8225debca17b50b4db0beb">autosave_interval</a>){</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    mqtt3_db_backup(db, <span class="keyword">false</span>);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    db-&gt;<a class="code" href="a00089.html#a85ea76e88408ef3a3c00129214782028">persistence_changes</a> = 0;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                <span class="keywordflow">if</span>(last_backup + db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#afbae47609d8225debca17b50b4db0beb">autosave_interval</a> &lt; <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>()){</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    mqtt3_db_backup(db, <span class="keyword">false</span>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    last_backup = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">if</span>(flag_db_backup){</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            mqtt3_db_backup(db, <span class="keyword">false</span>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            flag_db_backup = <span class="keyword">false</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00195.html#a1c2245fafa57f7156b2961cdf4e3e4e6">flag_reload</a>){</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Reloading config.&quot;</span>);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <a class="code" href="a00189.html#a900ac578c7d954a97e51ed424d02d6bb">mqtt3_config_read</a>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <a class="code" href="a00196.html#a13baab4bb8c48922ec24ecef1938932e">mosquitto_security_cleanup</a>(db, <span class="keyword">true</span>);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <a class="code" href="a00196.html#aa561902dbf33ea1ab2ce328d9486181d">mosquitto_security_init</a>(db, <span class="keyword">true</span>);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <a class="code" href="a00196.html#a953626642aecf59c7ae6c7e45518351e">mosquitto_security_apply</a>(db);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <a class="code" href="a00194.html#a90e4e3b03b0226658f92987b81d31de8">mqtt3_log_close</a>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <a class="code" href="a00194.html#a429931ef889c50f3a75f674c7029843b">mqtt3_log_init</a>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <a class="code" href="a00195.html#a1c2245fafa57f7156b2961cdf4e3e4e6">flag_reload</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00195.html#a228845d5196a999a02fbe670985318a9">flag_tree_print</a>){</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <a class="code" href="a00196.html#a70c65656337b203d320f63e798e79f9f">mqtt3_sub_tree_print</a>(&amp;db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>, 0);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <a class="code" href="a00195.html#a228845d5196a999a02fbe670985318a9">flag_tree_print</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor">#ifdef WITH_WEBSOCKETS</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>; i++){</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="comment">/* Extremely hacky, should be using the lws provided external poll</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">             * interface, but their interface has changed recently and ours</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">             * will soon, so for now websockets clients are second class</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">             * citizens. */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].ws_context){</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                libwebsocket_service(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].ws_context, 0);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;have_websockets_listener){</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            temp__expire_websockets_clients(db);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">if</span>(pollfds) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(pollfds);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;}</div><div class="ttc" id="a00209_html_a4d524042f1fcb976d8bccae9e4cc63d6"><div class="ttname"><a href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a></div><div class="ttdeci">#define HASH_ITER(hh, head, el, tmp)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00871">uthash.h:871</a></div></div>
<div class="ttc" id="a00191_html_aee64ee8f7ce7e65f696aa1bbf5c0674c"><div class="ttname"><a href="a00191.html#aee64ee8f7ce7e65f696aa1bbf5c0674c">mqtt3_db_message_write</a></div><div class="ttdeci">int mqtt3_db_message_write(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00810">database.c:810</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00525_html_ad2f696a3275eecbb98f8a9fda93e661c"><div class="ttname"><a href="a00525.html#ad2f696a3275eecbb98f8a9fda93e661c">mosqpp::strerror</a></div><div class="ttdeci">const char * strerror(int mosq_errno)</div><div class="ttdef"><b>Definition:</b> <a href="a00148_source.html#l00084">mosquittopp.cpp:84</a></div></div>
<div class="ttc" id="a00097_html_a9011d71e237c60be7fd01cd02fe4d2ef"><div class="ttname"><a href="a00097.html#a9011d71e237c60be7fd01cd02fe4d2ef">mqtt3_config::autosave_on_changes</a></div><div class="ttdeci">bool autosave_on_changes</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00113">mosquitto_broker.h:113</a></div></div>
<div class="ttc" id="a00086_html_a9f06cd82e88a5eaed9dfe8d83e52fb2e"><div class="ttname"><a href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">mosquitto::current_out_packet</a></div><div class="ttdeci">struct _mosquitto_packet * current_out_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00173">mosquitto_internal.h:173</a></div></div>
<div class="ttc" id="a00194_html_a429931ef889c50f3a75f674c7029843b"><div class="ttname"><a href="a00194.html#a429931ef889c50f3a75f674c7029843b">mqtt3_log_init</a></div><div class="ttdeci">int mqtt3_log_init(struct mqtt3_config *config)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00053">logging.c:53</a></div></div>
<div class="ttc" id="a00097_html_a82a8968536c2d3a907bd291d024f216a"><div class="ttname"><a href="a00097.html#a82a8968536c2d3a907bd291d024f216a">mqtt3_config::persistent_client_expiration</a></div><div class="ttdeci">time_t persistent_client_expiration</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00132">mosquitto_broker.h:132</a></div></div>
<div class="ttc" id="a00194_html_a90e4e3b03b0226658f92987b81d31de8"><div class="ttname"><a href="a00194.html#a90e4e3b03b0226658f92987b81d31de8">mqtt3_log_close</a></div><div class="ttdeci">int mqtt3_log_close(struct mqtt3_config *config)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00084">logging.c:84</a></div></div>
<div class="ttc" id="a00191_html_a60d56ad7041c6e40c30db6a71c03f7e8"><div class="ttname"><a href="a00191.html#a60d56ad7041c6e40c30db6a71c03f7e8">mqtt3_db_message_timeout_check</a></div><div class="ttdeci">int mqtt3_db_message_timeout_check(struct mosquitto_db *db, unsigned int timeout)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00700">database.c:700</a></div></div>
<div class="ttc" id="a00196_html_a3f89551c5a87457efb044a33b91a76dd"><div class="ttname"><a href="a00196.html#a3f89551c5a87457efb044a33b91a76dd">mqtt3_socket_accept</a></div><div class="ttdeci">int mqtt3_socket_accept(struct mosquitto_db *db, mosq_sock_t listensock)</div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00086">net.c:86</a></div></div>
<div class="ttc" id="a00195_html_a1c2245fafa57f7156b2961cdf4e3e4e6"><div class="ttname"><a href="a00195.html#a1c2245fafa57f7156b2961cdf4e3e4e6">flag_reload</a></div><div class="ttdeci">bool flag_reload</div><div class="ttdef"><b>Definition:</b> <a href="a00158_source.html#l00056">mosquitto.c:56</a></div></div>
<div class="ttc" id="a00089_html_acef8c251ec284f40de65517454659178"><div class="ttname"><a href="a00089.html#acef8c251ec284f40de65517454659178">mosquitto_db::contexts_by_sock</a></div><div class="ttdeci">struct mosquitto * contexts_by_sock</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00251">mosquitto_broker.h:251</a></div></div>
<div class="ttc" id="a00181_html_ae8314371001e5cbc7ed7f9c03efb3ca8"><div class="ttname"><a href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8">_mosquitto_check_keepalive</a></div><div class="ttdeci">void _mosquitto_check_keepalive(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00088">util_mosq.c:88</a></div></div>
<div class="ttc" id="a00097_html_ac0e9185508867844483adadce8f5df61"><div class="ttname"><a href="a00097.html#ac0e9185508867844483adadce8f5df61">mqtt3_config::retry_interval</a></div><div class="ttdeci">int retry_interval</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00136">mosquitto_broker.h:136</a></div></div>
<div class="ttc" id="a00097_html_aeabd210b57d1ddc66dad927c96d4a74d"><div class="ttname"><a href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">mqtt3_config::listener_count</a></div><div class="ttdeci">int listener_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00119">mosquitto_broker.h:119</a></div></div>
<div class="ttc" id="a00162_html_a270c7b9d619cd74fae0b1e1b3b83282e"><div class="ttname"><a href="a00162.html#a270c7b9d619cd74fae0b1e1b3b83282e">_mosquitto_try_connect</a></div><div class="ttdeci">int _mosquitto_try_connect(struct mosquitto *mosq, const char *host, uint16_t port, mosq_sock_t *sock, const char *bind_address, bool blocking)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00366">net_mosq.c:366</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00089_html_ac5b775be8b87233bb22f20b10bbac0bd"><div class="ttname"><a href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">mosquitto_db::contexts_by_id</a></div><div class="ttdeci">struct mosquitto * contexts_by_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00250">mosquitto_broker.h:250</a></div></div>
<div class="ttc" id="a00097_html_ae4138e4cbbcf7ceb8097672df20faf05"><div class="ttname"><a href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">mqtt3_config::listeners</a></div><div class="ttdeci">struct _mqtt3_listener * listeners</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00118">mosquitto_broker.h:118</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00163_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00045">net_mosq.h:45</a></div></div>
<div class="ttc" id="a00196_html_aa561902dbf33ea1ab2ce328d9486181d"><div class="ttname"><a href="a00196.html#aa561902dbf33ea1ab2ce328d9486181d">mosquitto_security_init</a></div><div class="ttdeci">int mosquitto_security_init(struct mosquitto_db *db, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00186">security.c:186</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00196_html_a953626642aecf59c7ae6c7e45518351e"><div class="ttname"><a href="a00196.html#a953626642aecf59c7ae6c7e45518351e">mosquitto_security_apply</a></div><div class="ttdeci">int mosquitto_security_apply(struct mosquitto_db *db)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00201">security.c:201</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00189_html_a900ac578c7d954a97e51ed424d02d6bb"><div class="ttname"><a href="a00189.html#a900ac578c7d954a97e51ed424d02d6bb">mqtt3_config_read</a></div><div class="ttdeci">int mqtt3_config_read(struct mqtt3_config *config, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00189_source.html#l00452">conf.c:452</a></div></div>
<div class="ttc" id="a00160_html_ae9ecb8ae965b1d3af4bebd2cc031998e"><div class="ttname"><a href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a></div><div class="ttdeci">int mosq_sock_t</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00069">mosquitto_internal.h:69</a></div></div>
<div class="ttc" id="a00086_html_ab9d8935077ef424c322233a19a9cbf5c"><div class="ttname"><a href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">mosquitto::clean_session</a></div><div class="ttdeci">bool clean_session</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00205">mosquitto_internal.h:205</a></div></div>
<div class="ttc" id="a00086_html_a962322fe14ee02b439cc236a85dab410"><div class="ttname"><a href="a00086.html#a962322fe14ee02b439cc236a85dab410">mosquitto::address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00162">mosquitto_internal.h:162</a></div></div>
<div class="ttc" id="a00159_html_a9813111aaf5eaafd2eaac66e1dc4659d"><div class="ttname"><a href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a></div><div class="ttdeci">#define MOSQ_LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00055">mosquitto.h:55</a></div></div>
<div class="ttc" id="a00086_html_a1bba05196d3100d3aa3ea78b7aa0bd14"><div class="ttname"><a href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">mosquitto::keepalive</a></div><div class="ttdeci">uint16_t keepalive</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00166">mosquitto_internal.h:166</a></div></div>
<div class="ttc" id="a00086_html_a26a90a9bba5628b617203725c220aca5"><div class="ttname"><a href="a00086.html#a26a90a9bba5628b617203725c220aca5">mosquitto::state</a></div><div class="ttdeci">enum mosquitto_client_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00168">mosquitto_internal.h:168</a></div></div>
<div class="ttc" id="a00086_html_a31930c9d3d288fc2fdf253ccf01d10a3"><div class="ttname"><a href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">mosquitto::sock</a></div><div class="ttdeci">mosq_sock_t sock</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00154">mosquitto_internal.h:154</a></div></div>
<div class="ttc" id="a00195_html_aecd587c4be6cba0dd6af4ea0b4d9c183"><div class="ttname"><a href="a00195.html#aecd587c4be6cba0dd6af4ea0b4d9c183">run</a></div><div class="ttdeci">int run</div><div class="ttdef"><b>Definition:</b> <a href="a00158_source.html#l00061">mosquitto.c:61</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732acd2fd9c6f8d89d358a085aa130750e24"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732acd2fd9c6f8d89d358a085aa130750e24">mosq_cs_connect_pending</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00097">mosquitto_internal.h:97</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00177_html_a9fb48d8f8ce208443e2e7bae489770fe"><div class="ttname"><a href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a></div><div class="ttdeci">time_t mosquitto_time(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00177_source.html#l00052">time_mosq.c:52</a></div></div>
<div class="ttc" id="a00086_html_ae44f689954c4c9247d6f6b8f2791cd60"><div class="ttname"><a href="a00086.html#ae44f689954c4c9247d6f6b8f2791cd60">mosquitto::last_msg_in</a></div><div class="ttdeci">time_t last_msg_in</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00169">mosquitto_internal.h:169</a></div></div>
<div class="ttc" id="a00196_html_a31e03d23fb1912cb7983c4b123417e53a72c992c5c2b3279fc0b2941b697fcd1f"><div class="ttname"><a href="a00196.html#a31e03d23fb1912cb7983c4b123417e53a72c992c5c2b3279fc0b2941b697fcd1f">bst_automatic</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00280">mosquitto_broker.h:280</a></div></div>
<div class="ttc" id="a00159_html_a53ca7e5700e1a592fc72d43cdff68dd3"><div class="ttname"><a href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a></div><div class="ttdeci">#define MOSQ_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00054">mosquitto.h:54</a></div></div>
<div class="ttc" id="a00196_html_a13baab4bb8c48922ec24ecef1938932e"><div class="ttname"><a href="a00196.html#a13baab4bb8c48922ec24ecef1938932e">mosquitto_security_cleanup</a></div><div class="ttdeci">int mosquitto_security_cleanup(struct mosquitto_db *db, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00209">security.c:209</a></div></div>
<div class="ttc" id="a00086_html"><div class="ttname"><a href="a00086.html">mosquitto</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00153">mosquitto_internal.h:153</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00196_html_ab1a5b88e8e067a6175a68014713053d0"><div class="ttname"><a href="a00196.html#ab1a5b88e8e067a6175a68014713053d0">mqtt3_db_sys_update</a></div><div class="ttdeci">void mqtt3_db_sys_update(struct mosquitto_db *db, int interval, time_t start_time)</div></div>
<div class="ttc" id="a00097_html_a2bc58933451bd6d17a5e9a58ebea1428"><div class="ttname"><a href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">mqtt3_config::connection_messages</a></div><div class="ttdeci">bool connection_messages</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00115">mosquitto_broker.h:115</a></div></div>
<div class="ttc" id="a00097_html_a93cbad1aadbb9472f12d92bd2b2935a4"><div class="ttname"><a href="a00097.html#a93cbad1aadbb9472f12d92bd2b2935a4">mqtt3_config::persistence</a></div><div class="ttdeci">bool persistence</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00128">mosquitto_broker.h:128</a></div></div>
<div class="ttc" id="a00097_html_afbae47609d8225debca17b50b4db0beb"><div class="ttname"><a href="a00097.html#afbae47609d8225debca17b50b4db0beb">mqtt3_config::autosave_interval</a></div><div class="ttdeci">int autosave_interval</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00112">mosquitto_broker.h:112</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00196_html_a70c65656337b203d320f63e798e79f9f"><div class="ttname"><a href="a00196.html#a70c65656337b203d320f63e798e79f9f">mqtt3_sub_tree_print</a></div><div class="ttdeci">void mqtt3_sub_tree_print(struct _mosquitto_subhier *root, int level)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00640">subs.c:640</a></div></div>
<div class="ttc" id="a00163_html_a96f0a0623f6cf73432200776459fa4df"><div class="ttname"><a href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a></div><div class="ttdeci">#define COMPAT_CLOSE(a)</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00038">net_mosq.h:38</a></div></div>
<div class="ttc" id="a00089_html_a85ea76e88408ef3a3c00129214782028"><div class="ttname"><a href="a00089.html#a85ea76e88408ef3a3c00129214782028">mosquitto_db::persistence_changes</a></div><div class="ttdeci">int persistence_changes</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00264">mosquitto_broker.h:264</a></div></div>
<div class="ttc" id="a00190_html_a1b4b98c96c9b4596e5277f7477dd7013"><div class="ttname"><a href="a00190.html#a1b4b98c96c9b4596e5277f7477dd7013">mosquitto__free_disused_contexts</a></div><div class="ttdeci">void mosquitto__free_disused_contexts(struct mosquitto_db *db)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00220">context.c:220</a></div></div>
<div class="ttc" id="a00195_html_a228845d5196a999a02fbe670985318a9"><div class="ttname"><a href="a00195.html#a228845d5196a999a02fbe670985318a9">flag_tree_print</a></div><div class="ttdeci">bool flag_tree_print</div><div class="ttdef"><b>Definition:</b> <a href="a00158_source.html#l00060">mosquitto.c:60</a></div></div>
<div class="ttc" id="a00089_html_a2f96cc353b06a96922b1310c87327e0b"><div class="ttname"><a href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">mosquitto_db::subs</a></div><div class="ttdeci">struct _mosquitto_subhier subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00245">mosquitto_broker.h:245</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732a47da1eef583f102ff7ecbf684e6ab20d"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732a47da1eef583f102ff7ecbf684e6ab20d">mosq_cs_expiring</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00108">mosquitto_internal.h:108</a></div></div>
<div class="ttc" id="a00097_html_a9c5c5aadbe7e585ddc88123c0b1f171d"><div class="ttname"><a href="a00097.html#a9c5c5aadbe7e585ddc88123c0b1f171d">mqtt3_config::sys_interval</a></div><div class="ttdeci">int sys_interval</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00137">mosquitto_broker.h:137</a></div></div>
<div class="ttc" id="a00195_html_af52acda25b9090675773beafeca25264"><div class="ttname"><a href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a></div><div class="ttdeci">void do_disconnect(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00195_source.html#l00424">loop.c:424</a></div></div>
<div class="ttc" id="a00196_html_a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431"><div class="ttname"><a href="a00196.html#a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431">bst_lazy</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00281">mosquitto_broker.h:281</a></div></div>
<div class="ttc" id="a00086_html_ae2aebd955d302f9673c57f49cb327f9b"><div class="ttname"><a href="a00086.html#ae2aebd955d302f9673c57f49cb327f9b">mosquitto::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00254">mosquitto_internal.h:254</a></div></div>
<div class="ttc" id="a00162_html_af8fce1657e21306ca1e448b75774ccfb"><div class="ttname"><a href="a00162.html#af8fce1657e21306ca1e448b75774ccfb">_mosquitto_socket_close</a></div><div class="ttdeci">int _mosquitto_socket_close(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00210">net_mosq.c:210</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_ae88a6ec7610ccaf2ccd1506780302a4b_cgraph.png" border="0" usemap="#a00196_ae88a6ec7610ccaf2ccd1506780302a4b_cgraph" alt=""/></div>
<map name="a00196_ae88a6ec7610ccaf2ccd1506780302a4b_cgraph" id="a00196_ae88a6ec7610ccaf2ccd1506780302a4b_cgraph">
<area shape="rect" id="node2" href="a00178.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="1355,219,1465,246"/>
<area shape="rect" id="node3" href="a00154.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="1345,1005,1475,1031"/>
<area shape="rect" id="node4" href="a00152.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="1337,599,1483,626"/>
<area shape="rect" id="node5" href="a00191.html#a1b4b98c96c9b4596e5277f7477dd7013" title="mosquitto__free_disused\l_contexts" alt="" coords="397,1411,564,1452"/>
<area shape="rect" id="node7" href="a00154.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1353,1309,1467,1335"/>
<area shape="rect" id="node8" href="a00163.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1091,1511,1261,1538"/>
<area shape="rect" id="node13" href="a00197.html#ab1a5b88e8e067a6175a68014713053d0" title="mqtt3_db_sys_update" alt="" coords="199,1629,349,1655"/>
<area shape="rect" id="node14" href="a00182.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="847,295,1037,322"/>
<area shape="rect" id="node16" href="a00163.html#a270c7b9d619cd74fae0b1e1b3b83282e" title="_mosquitto_try_connect" alt="" coords="625,1815,786,1842"/>
<area shape="rect" id="node17" href="a00192.html#aee64ee8f7ce7e65f696aa1bbf5c0674c" title="mqtt3_db_message_write" alt="" coords="857,422,1027,449"/>
<area shape="rect" id="node23" href="a00196.html#af52acda25b9090675773beafeca25264" title="do_disconnect" alt="" coords="652,1106,759,1133"/>
<area shape="rect" id="node28" href="a00192.html#a60d56ad7041c6e40c30db6a71c03f7e8" title="mqtt3_db_message_timeout\l_check" alt="" coords="612,27,799,68"/>
<area shape="rect" id="node29" href="a00526.html#ad2f696a3275eecbb98f8a9fda93e661c" title="mosqpp::strerror" alt="" coords="215,1679,333,1706"/>
<area shape="rect" id="node31" href="a00197.html#a3f89551c5a87457efb044a33b91a76dd" title="mqtt3_socket_accept" alt="" coords="632,1511,779,1538"/>
<area shape="rect" id="node36" href="a00190.html#a900ac578c7d954a97e51ed424d02d6bb" title="mqtt3_config_read" alt="" coords="1111,1106,1241,1133"/>
<area shape="rect" id="node38" href="a00197.html#a13baab4bb8c48922ec24ecef1938932e" title="mosquitto_security\l_cleanup" alt="" coords="208,1731,340,1772"/>
<area shape="rect" id="node40" href="a00197.html#aa561902dbf33ea1ab2ce328d9486181d" title="mosquitto_security_init" alt="" coords="403,650,559,677"/>
<area shape="rect" id="node42" href="a00197.html#a953626642aecf59c7ae6c7e45518351e" title="mosquitto_security\l_apply" alt="" coords="208,1157,340,1199"/>
<area shape="rect" id="node44" href="a00195.html#a90e4e3b03b0226658f92987b81d31de8" title="mqtt3_log_close" alt="" coords="215,1797,333,1823"/>
<area shape="rect" id="node45" href="a00195.html#a429931ef889c50f3a75f674c7029843b" title="mqtt3_log_init" alt="" coords="891,751,993,778"/>
<area shape="rect" id="node50" href="a00197.html#a70c65656337b203d320f63e798e79f9f" title="mqtt3_sub_tree_print" alt="" coords="202,1847,346,1874"/>
<area shape="rect" id="node6" href="a00191.html#ac919bd8bbc017773fc9d75c098faaae0" title="mqtt3_context_cleanup" alt="" coords="863,1511,1021,1538"/>
<area shape="rect" id="node9" href="a00164.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1329,1504,1491,1545"/>
<area shape="rect" id="node10" href="a00154.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="1347,1453,1473,1479"/>
<area shape="rect" id="node11" href="a00164.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1329,1569,1491,1611"/>
<area shape="rect" id="node12" href="a00163.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1315,1781,1505,1807"/>
<area shape="rect" id="node15" href="a00172.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="1091,245,1261,271"/>
<area shape="rect" id="node18" href="a00172.html#a7b111a5ceccb7bbc5fdadab085a33c03" title="_mosquitto_send_publish" alt="" coords="1091,1055,1261,1082"/>
<area shape="rect" id="node20" href="a00172.html#a07fb7f8b0c76e21162abb92404ac8630" title="_mosquitto_send_pubrec" alt="" coords="1093,397,1259,423"/>
<area shape="rect" id="node21" href="a00172.html#afbde2c162bd4b8e9fa52b0d45aa43b81" title="_mosquitto_send_pubrel" alt="" coords="1095,447,1257,474"/>
<area shape="rect" id="node22" href="a00172.html#aaeba60c4fd6e50c8f7f599246c6f91fb" title="_mosquitto_send_pubcomp" alt="" coords="1085,346,1267,373"/>
<area shape="rect" id="node19" href="a00154.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="1345,1207,1475,1234"/>
<area shape="rect" id="node24" href="a00191.html#a1952df5bc9a6a0c54817fb60c955c738" title="mqtt3_context_disconnect" alt="" coords="855,1461,1029,1487"/>
<area shape="rect" id="node25" href="a00191.html#a7310ffcd887c91eef7b5f087ff04af3f" title="mosquitto__add_context\l_to_disused" alt="" coords="860,1040,1024,1081"/>
<area shape="rect" id="node26" href="a00163.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="859,1106,1025,1133"/>
<area shape="rect" id="node27" href="a00163.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="1094,954,1258,981"/>
<area shape="rect" id="node30" href="a00158.html#a1aa2f37d78379bd12a98e393c1ab1056" title="mosquitto_strerror" alt="" coords="417,1679,544,1706"/>
<area shape="rect" id="node32" href="a00200.html#a76632d665060f0325b7a5a639de9cc40" title="_mosquitto_socket_get\l_address" alt="" coords="863,1563,1021,1604"/>
<area shape="rect" id="node33" href="a00191.html#a5caa657eeafaaf5aaddf16d5c8d77773" title="mqtt3_context_init" alt="" coords="1111,1309,1241,1335"/>
<area shape="rect" id="node34" href="a00159.html#a5970ed3ba87bd3fe42bd275db57ad26d" title="_mosquitto_get_db" alt="" coords="876,1679,1008,1706"/>
<area shape="rect" id="node35" href="a00197.html#aa17174a4b0aedc61fac238bb6d89b56d" title="mosquitto_psk_key_get" alt="" coords="862,1730,1022,1757"/>
<area shape="rect" id="node37" href="a00192.html#a344e751637f964b69fff2a34f772001f" title="mqtt3_db_limits_set" alt="" coords="1341,1106,1479,1133"/>
<area shape="rect" id="node39" href="a00197.html#af4244d5e2409405c58a5366f31842cdf" title="mosquitto_security\l_cleanup_default" alt="" coords="415,1731,547,1772"/>
<area shape="rect" id="node41" href="a00197.html#aab9402f5cad5f77a95a652fccb585b23" title="mosquitto_security\l_init_default" alt="" coords="639,617,771,659"/>
<area shape="rect" id="node43" href="a00197.html#a0fc953b05bda405a0d88312be23d4981" title="mosquitto_security\l_apply_default" alt="" coords="415,1157,547,1199"/>
<area shape="rect" id="node46" href="a00159.html#a58d0ace4df75ecf8a8a0eb995e8f9cd6" title="drop_privileges" alt="" coords="1121,802,1231,829"/>
<area shape="rect" id="node47" href="a00182.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="1113,650,1239,677"/>
<area shape="rect" id="node48" href="a00195.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="1103,701,1249,727"/>
<area shape="rect" id="node49" href="a00159.html#a05c162f84fcabc09090f53489e3ab27f" title="restore_privileges" alt="" coords="1114,751,1238,778"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa17174a4b0aedc61fac238bb6d89b56d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_psk_key_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>hint</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>identity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>max_key_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00203_source.html#l00266">266</a> of file <a class="el" href="a00203_source.html">security.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;{</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a>){</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00196.html#aadb5a441176967dc1937d0f702edbdb7">mosquitto_psk_key_get_default</a>(db, hint, identity, key, max_key_len);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">return</span> db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a114da20e1d466edc74a16a76ade50546">psk_key_get</a>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">user_data</a>, hint, identity, key, max_key_len);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div><div class="ttc" id="a00089_html_a955e8de0edc8e8b484cca2db67bed33b"><div class="ttname"><a href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">mosquitto_db::auth_plugin</a></div><div class="ttdeci">struct _mosquitto_auth_plugin auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00265">mosquitto_broker.h:265</a></div></div>
<div class="ttc" id="a00010_html_acf433aeb82cd031f935e294f9e1c281f"><div class="ttname"><a href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">_mosquitto_auth_plugin::lib</a></div><div class="ttdeci">void * lib</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00231">mosquitto_broker.h:231</a></div></div>
<div class="ttc" id="a00196_html_aadb5a441176967dc1937d0f702edbdb7"><div class="ttname"><a href="a00196.html#aadb5a441176967dc1937d0f702edbdb7">mosquitto_psk_key_get_default</a></div><div class="ttdeci">int mosquitto_psk_key_get_default(struct mosquitto_db *db, const char *hint, const char *identity, char *key, int max_key_len)</div><div class="ttdef"><b>Definition:</b> <a href="a00204_source.html#l00772">security_default.c:772</a></div></div>
<div class="ttc" id="a00010_html_a114da20e1d466edc74a16a76ade50546"><div class="ttname"><a href="a00010.html#a114da20e1d466edc74a16a76ade50546">_mosquitto_auth_plugin::psk_key_get</a></div><div class="ttdeci">int(* psk_key_get)(void *user_data, const char *hint, const char *identity, char *key, int max_key_len)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00240">mosquitto_broker.h:240</a></div></div>
<div class="ttc" id="a00010_html_a7a2250d98915f6bfd6e1f42bf273eac9"><div class="ttname"><a href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">_mosquitto_auth_plugin::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00232">mosquitto_broker.h:232</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_aa17174a4b0aedc61fac238bb6d89b56d_cgraph.png" border="0" usemap="#a00196_aa17174a4b0aedc61fac238bb6d89b56d_cgraph" alt=""/></div>
<map name="a00196_aa17174a4b0aedc61fac238bb6d89b56d_cgraph" id="a00196_aa17174a4b0aedc61fac238bb6d89b56d_cgraph">
<area shape="rect" id="node2" href="a00196.html#aadb5a441176967dc1937d0f702edbdb7" title="mosquitto_psk_key_get\l_default" alt="" coords="213,5,373,47"/>
<area shape="rect" id="node3" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="421,13,548,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aadb5a441176967dc1937d0f702edbdb7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_psk_key_get_default </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>hint</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>identity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>max_key_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00204_source.html#l00772">772</a> of file <a class="el" href="a00204_source.html">security_default.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;{</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00014.html">_mosquitto_unpwd</a> *u, *tmp;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">if</span>(!db || !hint || !identity || !key) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a7be003e43a4c1cd603e52417179858a8">psk_id</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a>;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <a class="code" href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a>(<a class="code" href="a00014.html#ae163ee245d5f34c71a964b5203a8ebfa">hh</a>, db-&gt;<a class="code" href="a00089.html#a7be003e43a4c1cd603e52417179858a8">psk_id</a>, u, tmp){</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">if</span>(!strcmp(u-&gt;<a class="code" href="a00014.html#a7c0d15b77b2dd20fa6c147b563c9143b">username</a>, identity)){</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            strncpy(key, u-&gt;<a class="code" href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">password</a>, max_key_len);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00078">mosquitto.h:78</a></div></div>
<div class="ttc" id="a00209_html_a4d524042f1fcb976d8bccae9e4cc63d6"><div class="ttname"><a href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a></div><div class="ttdeci">#define HASH_ITER(hh, head, el, tmp)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00871">uthash.h:871</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00014_html_adb5bda8b38774bd4b0f3796c9f612e57"><div class="ttname"><a href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">_mosquitto_unpwd::password</a></div><div class="ttdeci">char * password</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00207">mosquitto_broker.h:207</a></div></div>
<div class="ttc" id="a00014_html_a7c0d15b77b2dd20fa6c147b563c9143b"><div class="ttname"><a href="a00014.html#a7c0d15b77b2dd20fa6c147b563c9143b">_mosquitto_unpwd::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00206">mosquitto_broker.h:206</a></div></div>
<div class="ttc" id="a00014_html"><div class="ttname"><a href="a00014.html">_mosquitto_unpwd</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00205">mosquitto_broker.h:205</a></div></div>
<div class="ttc" id="a00014_html_ae163ee245d5f34c71a964b5203a8ebfa"><div class="ttname"><a href="a00014.html#ae163ee245d5f34c71a964b5203a8ebfa">_mosquitto_unpwd::hh</a></div><div class="ttdeci">UT_hash_handle hh</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00213">mosquitto_broker.h:213</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00089_html_a7be003e43a4c1cd603e52417179858a8"><div class="ttname"><a href="a00089.html#a7be003e43a4c1cd603e52417179858a8">mosquitto_db::psk_id</a></div><div class="ttdeci">struct _mosquitto_unpwd * psk_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00249">mosquitto_broker.h:249</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_aadb5a441176967dc1937d0f702edbdb7_cgraph.png" border="0" usemap="#a00196_aadb5a441176967dc1937d0f702edbdb7_cgraph" alt=""/></div>
<map name="a00196_aadb5a441176967dc1937d0f702edbdb7_cgraph" id="a00196_aadb5a441176967dc1937d0f702edbdb7_cgraph">
<area shape="rect" id="node2" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="213,13,340,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a953626642aecf59c7ae6c7e45518351e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_security_apply </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00203_source.html#l00201">201</a> of file <a class="el" href="a00203_source.html">security.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;{</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a>){</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00196.html#a0fc953b05bda405a0d88312be23d4981">mosquitto_security_apply_default</a>(db);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00089_html_a955e8de0edc8e8b484cca2db67bed33b"><div class="ttname"><a href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">mosquitto_db::auth_plugin</a></div><div class="ttdeci">struct _mosquitto_auth_plugin auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00265">mosquitto_broker.h:265</a></div></div>
<div class="ttc" id="a00010_html_acf433aeb82cd031f935e294f9e1c281f"><div class="ttname"><a href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">_mosquitto_auth_plugin::lib</a></div><div class="ttdeci">void * lib</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00231">mosquitto_broker.h:231</a></div></div>
<div class="ttc" id="a00196_html_a0fc953b05bda405a0d88312be23d4981"><div class="ttname"><a href="a00196.html#a0fc953b05bda405a0d88312be23d4981">mosquitto_security_apply_default</a></div><div class="ttdeci">int mosquitto_security_apply_default(struct mosquitto_db *db)</div><div class="ttdef"><b>Definition:</b> <a href="a00204_source.html#l00725">security_default.c:725</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a953626642aecf59c7ae6c7e45518351e_cgraph.png" border="0" usemap="#a00196_a953626642aecf59c7ae6c7e45518351e_cgraph" alt=""/></div>
<map name="a00196_a953626642aecf59c7ae6c7e45518351e_cgraph" id="a00196_a953626642aecf59c7ae6c7e45518351e_cgraph">
<area shape="rect" id="node2" href="a00196.html#a0fc953b05bda405a0d88312be23d4981" title="mosquitto_security\l_apply_default" alt="" coords="185,2332,317,2373"/>
<area shape="rect" id="node3" href="a00195.html#af52acda25b9090675773beafeca25264" title="do_disconnect" alt="" coords="365,1748,472,1775"/>
<area shape="rect" id="node50" href="a00204.html#a20315c474619e67362c6472ac7d46e3f" title="mosquitto_unpwd_check\l_default" alt="" coords="735,2920,901,2961"/>
<area shape="rect" id="node4" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2373,676,2519,703"/>
<area shape="rect" id="node5" href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738" title="mqtt3_context_disconnect" alt="" coords="1400,2440,1575,2467"/>
<area shape="rect" id="node11" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="2389,2339,2503,2366"/>
<area shape="rect" id="node20" href="a00190.html#a7310ffcd887c91eef7b5f087ff04af3f" title="mosquitto__add_context\l_to_disused" alt="" coords="521,1800,685,1841"/>
<area shape="rect" id="node21" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="520,2175,687,2202"/>
<area shape="rect" id="node25" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="736,1096,900,1123"/>
<area shape="rect" id="node6" href="a00190.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="1628,2208,1795,2235"/>
<area shape="rect" id="node16" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1626,2550,1797,2576"/>
<area shape="rect" id="node7" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="1871,1614,2016,1640"/>
<area shape="rect" id="node13" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="1854,2172,2033,2213"/>
<area shape="rect" id="node8" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="2120,1766,2265,1808"/>
<area shape="rect" id="node9" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2347,1904,2545,1931"/>
<area shape="rect" id="node10" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2381,1614,2511,1640"/>
<area shape="rect" id="node12" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2383,2086,2509,2112"/>
<area shape="rect" id="node14" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="2107,1934,2279,1960"/>
<area shape="rect" id="node15" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="2100,2187,2285,2214"/>
<area shape="rect" id="node17" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1863,2542,2024,2584"/>
<area shape="rect" id="node18" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1863,2608,2024,2649"/>
<area shape="rect" id="node19" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1848,2674,2039,2700"/>
<area shape="rect" id="node22" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1414,474,1561,500"/>
<area shape="rect" id="node23" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="949,2175,1133,2202"/>
<area shape="rect" id="node24" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2593,220,2704,247"/>
<area shape="rect" id="node26" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="1195,144,1338,171"/>
<area shape="rect" id="node27" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="968,911,1115,938"/>
<area shape="rect" id="node47" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="1623,448,1800,475"/>
<area shape="rect" id="node28" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="1853,448,2033,475"/>
<area shape="rect" id="node30" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="1850,296,2037,323"/>
<area shape="rect" id="node35" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2087,246,2299,272"/>
<area shape="rect" id="node36" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="1637,1766,1785,1792"/>
<area shape="rect" id="node38" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2104,752,2281,779"/>
<area shape="rect" id="node39" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2106,702,2279,728"/>
<area shape="rect" id="node40" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="1190,1683,1343,1710"/>
<area shape="rect" id="node41" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="1181,347,1352,374"/>
<area shape="rect" id="node42" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="1630,1360,1793,1387"/>
<area shape="rect" id="node43" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="1855,1208,2032,1235"/>
<area shape="rect" id="node44" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="1633,2019,1789,2046"/>
<area shape="rect" id="node45" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="2103,1310,2283,1336"/>
<area shape="rect" id="node46" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="2095,651,2290,678"/>
<area shape="rect" id="node29" href="a00171.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="2104,499,2281,526"/>
<area shape="rect" id="node31" href="a00169.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2087,296,2299,323"/>
<area shape="rect" id="node32" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="2366,1107,2526,1134"/>
<area shape="rect" id="node33" href="a00191.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="2357,296,2535,323"/>
<area shape="rect" id="node34" href="a00155.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="2373,230,2519,272"/>
<area shape="rect" id="node37" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="2114,1411,2271,1438"/>
<area shape="rect" id="node48" href="a00164.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="1854,1056,2033,1083"/>
<area shape="rect" id="node49" href="a00166.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="1850,347,2037,374"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0fc953b05bda405a0d88312be23d4981"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_security_apply_default </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00204_source.html#l00725">725</a> of file <a class="el" href="a00204_source.html">security_default.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;{</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00086.html">mosquitto</a> *context, *ctxt_tmp;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00009.html">_mosquitto_acl_user</a> *acl_user_tail;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordtype">bool</span> allow_anonymous;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">if</span>(!db) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    allow_anonymous = db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a5d81a9540395cbfe6d04949f457caf8f">allow_anonymous</a>;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    </div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <a class="code" href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a>(hh_id, db-&gt;<a class="code" href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">contexts_by_id</a>, context, ctxt_tmp){</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="comment">/* Check for anonymous clients when allow_anonymous is false */</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordflow">if</span>(!allow_anonymous &amp;&amp; !context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <a class="code" href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a>(db, context);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="comment">/* Check for connected clients that are no longer authorised */</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00204.html#a20315c474619e67362c6472ac7d46e3f">mosquitto_unpwd_check_default</a>(db, context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>, context-&gt;<a class="code" href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">password</a>) != <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a>;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            <a class="code" href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a>(db, context);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        }</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="comment">/* Check for ACLs and apply to user. */</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#a442ec343cb4b1102971160795eeed54d">acl_list</a>){</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            acl_user_tail = db-&gt;<a class="code" href="a00089.html#a442ec343cb4b1102971160795eeed54d">acl_list</a>;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="keywordflow">while</span>(acl_user_tail){</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                <span class="keywordflow">if</span>(acl_user_tail-&gt;<a class="code" href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">username</a>){</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                        <span class="keywordflow">if</span>(!strcmp(acl_user_tail-&gt;<a class="code" href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">username</a>, context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>)){</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                            context-&gt;acl_list = acl_user_tail;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        }</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                    }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                    <span class="keywordflow">if</span>(!context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                        context-&gt;acl_list = acl_user_tail;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                    }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                acl_user_tail = acl_user_tail-&gt;<a class="code" href="a00009.html#aa97bb7e861123feead61d94ae0e5325f">next</a>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    }</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div><div class="ttc" id="a00089_html_a442ec343cb4b1102971160795eeed54d"><div class="ttname"><a href="a00089.html#a442ec343cb4b1102971160795eeed54d">mosquitto_db::acl_list</a></div><div class="ttdeci">struct _mosquitto_acl_user * acl_list</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00247">mosquitto_broker.h:247</a></div></div>
<div class="ttc" id="a00209_html_a4d524042f1fcb976d8bccae9e4cc63d6"><div class="ttname"><a href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a></div><div class="ttdeci">#define HASH_ITER(hh, head, el, tmp)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00871">uthash.h:871</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00097_html_a5d81a9540395cbfe6d04949f457caf8f"><div class="ttname"><a href="a00097.html#a5d81a9540395cbfe6d04949f457caf8f">mqtt3_config::allow_anonymous</a></div><div class="ttdeci">bool allow_anonymous</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00106">mosquitto_broker.h:106</a></div></div>
<div class="ttc" id="a00204_html_a20315c474619e67362c6472ac7d46e3f"><div class="ttname"><a href="a00204.html#a20315c474619e67362c6472ac7d46e3f">mosquitto_unpwd_check_default</a></div><div class="ttdeci">int mosquitto_unpwd_check_default(struct mosquitto_db *db, const char *username, const char *password)</div><div class="ttdef"><b>Definition:</b> <a href="a00204_source.html#l00653">security_default.c:653</a></div></div>
<div class="ttc" id="a00086_html_ad0dd0827ca5d6aa033c36eb0ad447aa8"><div class="ttname"><a href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">mosquitto::password</a></div><div class="ttdeci">char * password</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00165">mosquitto_internal.h:165</a></div></div>
<div class="ttc" id="a00089_html_ac5b775be8b87233bb22f20b10bbac0bd"><div class="ttname"><a href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">mosquitto_db::contexts_by_id</a></div><div class="ttdeci">struct mosquitto * contexts_by_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00250">mosquitto_broker.h:250</a></div></div>
<div class="ttc" id="a00009_html_a2db3d9318cbb28329cbc748f5e0df14f"><div class="ttname"><a href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">_mosquitto_acl_user::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00226">mosquitto_broker.h:226</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00095">mosquitto_internal.h:95</a></div></div>
<div class="ttc" id="a00009_html"><div class="ttname"><a href="a00009.html">_mosquitto_acl_user</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00224">mosquitto_broker.h:224</a></div></div>
<div class="ttc" id="a00086_html_a26a90a9bba5628b617203725c220aca5"><div class="ttname"><a href="a00086.html#a26a90a9bba5628b617203725c220aca5">mosquitto::state</a></div><div class="ttdeci">enum mosquitto_client_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00168">mosquitto_internal.h:168</a></div></div>
<div class="ttc" id="a00009_html_aa97bb7e861123feead61d94ae0e5325f"><div class="ttname"><a href="a00009.html#aa97bb7e861123feead61d94ae0e5325f">_mosquitto_acl_user::next</a></div><div class="ttdeci">struct _mosquitto_acl_user * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00225">mosquitto_broker.h:225</a></div></div>
<div class="ttc" id="a00086_html_a31ecd6b5e37dbd8ea64c179259561d0f"><div class="ttname"><a href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">mosquitto::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00164">mosquitto_internal.h:164</a></div></div>
<div class="ttc" id="a00086_html"><div class="ttname"><a href="a00086.html">mosquitto</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00153">mosquitto_internal.h:153</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00195_html_af52acda25b9090675773beafeca25264"><div class="ttname"><a href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a></div><div class="ttdeci">void do_disconnect(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00195_source.html#l00424">loop.c:424</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a0fc953b05bda405a0d88312be23d4981_cgraph.png" border="0" usemap="#a00196_a0fc953b05bda405a0d88312be23d4981_cgraph" alt=""/></div>
<map name="a00196_a0fc953b05bda405a0d88312be23d4981_cgraph" id="a00196_a0fc953b05bda405a0d88312be23d4981_cgraph">
<area shape="rect" id="node2" href="a00195.html#af52acda25b9090675773beafeca25264" title="do_disconnect" alt="" coords="185,2519,292,2546"/>
<area shape="rect" id="node50" href="a00204.html#a20315c474619e67362c6472ac7d46e3f" title="mosquitto_unpwd_check\l_default" alt="" coords="555,3059,721,3100"/>
<area shape="rect" id="node3" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2193,654,2339,681"/>
<area shape="rect" id="node4" href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738" title="mqtt3_context_disconnect" alt="" coords="1220,2519,1395,2546"/>
<area shape="rect" id="node10" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="2209,2418,2323,2445"/>
<area shape="rect" id="node20" href="a00190.html#a7310ffcd887c91eef7b5f087ff04af3f" title="mosquitto__add_context\l_to_disused" alt="" coords="341,5,505,47"/>
<area shape="rect" id="node21" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="340,2805,507,2831"/>
<area shape="rect" id="node25" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="556,2570,720,2597"/>
<area shape="rect" id="node5" href="a00190.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="1448,2401,1615,2427"/>
<area shape="rect" id="node16" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1446,2687,1617,2714"/>
<area shape="rect" id="node6" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="1691,1642,1836,1669"/>
<area shape="rect" id="node13" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="1674,2352,1853,2393"/>
<area shape="rect" id="node7" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="1940,1795,2085,1836"/>
<area shape="rect" id="node8" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2167,2013,2365,2039"/>
<area shape="rect" id="node9" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2201,1911,2331,1938"/>
<area shape="rect" id="node11" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2201,1831,2331,1858"/>
<area shape="rect" id="node12" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2203,1693,2329,1719"/>
<area shape="rect" id="node14" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="1927,1911,2099,1938"/>
<area shape="rect" id="node15" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="1920,2317,2105,2343"/>
<area shape="rect" id="node17" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1683,2739,1844,2780"/>
<area shape="rect" id="node18" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1683,2621,1844,2663"/>
<area shape="rect" id="node19" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1668,2687,1859,2714"/>
<area shape="rect" id="node22" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1234,223,1381,250"/>
<area shape="rect" id="node23" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="769,2855,953,2882"/>
<area shape="rect" id="node24" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2413,1695,2524,1722"/>
<area shape="rect" id="node26" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="1015,122,1158,149"/>
<area shape="rect" id="node27" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="788,933,935,959"/>
<area shape="rect" id="node47" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="1443,629,1620,655"/>
<area shape="rect" id="node28" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="1673,578,1853,605"/>
<area shape="rect" id="node30" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="1670,375,1857,402"/>
<area shape="rect" id="node35" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="1907,274,2119,301"/>
<area shape="rect" id="node36" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="1457,1819,1605,1846"/>
<area shape="rect" id="node38" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="1924,730,2101,757"/>
<area shape="rect" id="node39" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="1926,679,2099,706"/>
<area shape="rect" id="node40" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="1010,1591,1163,1618"/>
<area shape="rect" id="node41" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="1001,173,1172,199"/>
<area shape="rect" id="node42" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="1450,1389,1613,1415"/>
<area shape="rect" id="node43" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="1675,1237,1852,1263"/>
<area shape="rect" id="node44" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="1453,2301,1609,2327"/>
<area shape="rect" id="node45" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="1923,1338,2103,1365"/>
<area shape="rect" id="node46" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="1915,781,2110,807"/>
<area shape="rect" id="node29" href="a00171.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="1924,578,2101,605"/>
<area shape="rect" id="node31" href="a00169.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="1907,325,2119,351"/>
<area shape="rect" id="node32" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="2186,1009,2346,1035"/>
<area shape="rect" id="node33" href="a00191.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="2177,333,2355,359"/>
<area shape="rect" id="node34" href="a00155.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="2193,267,2339,308"/>
<area shape="rect" id="node37" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="1934,1439,2091,1466"/>
<area shape="rect" id="node48" href="a00164.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="1674,933,1853,959"/>
<area shape="rect" id="node49" href="a00166.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="1670,477,1857,503"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a13baab4bb8c48922ec24ecef1938932e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_security_cleanup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00203_source.html#l00209">209</a> of file <a class="el" href="a00203_source.html">security.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;{</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a>){</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00196.html#af4244d5e2409405c58a5366f31842cdf">mosquitto_security_cleanup_default</a>(db, reload);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">return</span> db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#afb5b45763c9dd80199033fe4148dc4b4">security_cleanup</a>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">user_data</a>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">auth_option_count</a>, reload);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div><div class="ttc" id="a00089_html_a955e8de0edc8e8b484cca2db67bed33b"><div class="ttname"><a href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">mosquitto_db::auth_plugin</a></div><div class="ttdeci">struct _mosquitto_auth_plugin auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00265">mosquitto_broker.h:265</a></div></div>
<div class="ttc" id="a00010_html_acf433aeb82cd031f935e294f9e1c281f"><div class="ttname"><a href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">_mosquitto_auth_plugin::lib</a></div><div class="ttdeci">void * lib</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00231">mosquitto_broker.h:231</a></div></div>
<div class="ttc" id="a00196_html_af4244d5e2409405c58a5366f31842cdf"><div class="ttname"><a href="a00196.html#af4244d5e2409405c58a5366f31842cdf">mosquitto_security_cleanup_default</a></div><div class="ttdeci">int mosquitto_security_cleanup_default(struct mosquitto_db *db, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00204_source.html#l00070">security_default.c:70</a></div></div>
<div class="ttc" id="a00010_html_afb5b45763c9dd80199033fe4148dc4b4"><div class="ttname"><a href="a00010.html#afb5b45763c9dd80199033fe4148dc4b4">_mosquitto_auth_plugin::security_cleanup</a></div><div class="ttdeci">int(* security_cleanup)(void *user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00237">mosquitto_broker.h:237</a></div></div>
<div class="ttc" id="a00097_html_a5fb755f76a28edbd35bfed132682d0af"><div class="ttname"><a href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">mqtt3_config::auth_options</a></div><div class="ttdeci">struct mosquitto_auth_opt * auth_options</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00150">mosquitto_broker.h:150</a></div></div>
<div class="ttc" id="a00010_html_a7a2250d98915f6bfd6e1f42bf273eac9"><div class="ttname"><a href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">_mosquitto_auth_plugin::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00232">mosquitto_broker.h:232</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00097_html_ac66fb8bbb1e5814bf6beae5282080b80"><div class="ttname"><a href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">mqtt3_config::auth_option_count</a></div><div class="ttdeci">int auth_option_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00151">mosquitto_broker.h:151</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a13baab4bb8c48922ec24ecef1938932e_cgraph.png" border="0" usemap="#a00196_a13baab4bb8c48922ec24ecef1938932e_cgraph" alt=""/></div>
<map name="a00196_a13baab4bb8c48922ec24ecef1938932e_cgraph" id="a00196_a13baab4bb8c48922ec24ecef1938932e_cgraph">
<area shape="rect" id="node2" href="a00196.html#af4244d5e2409405c58a5366f31842cdf" title="mosquitto_security\l_cleanup_default" alt="" coords="185,5,317,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af4244d5e2409405c58a5366f31842cdf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_security_cleanup_default </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00204_source.html#l00070">70</a> of file <a class="el" href="a00204_source.html">security_default.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    rc = _acl_cleanup(db, reload);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span>(rc != <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>) <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    rc = _unpwd_cleanup(&amp;db-&gt;<a class="code" href="a00089.html#a0ae1cdd9ca34f2dac7f1a5c02f3ed359">unpwd</a>, reload);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span>(rc != <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>) <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">return</span> _unpwd_cleanup(&amp;db-&gt;<a class="code" href="a00089.html#a7be003e43a4c1cd603e52417179858a8">psk_id</a>, reload);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00089_html_a7be003e43a4c1cd603e52417179858a8"><div class="ttname"><a href="a00089.html#a7be003e43a4c1cd603e52417179858a8">mosquitto_db::psk_id</a></div><div class="ttdeci">struct _mosquitto_unpwd * psk_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00249">mosquitto_broker.h:249</a></div></div>
<div class="ttc" id="a00089_html_a0ae1cdd9ca34f2dac7f1a5c02f3ed359"><div class="ttname"><a href="a00089.html#a0ae1cdd9ca34f2dac7f1a5c02f3ed359">mosquitto_db::unpwd</a></div><div class="ttdeci">struct _mosquitto_unpwd * unpwd</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00246">mosquitto_broker.h:246</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa561902dbf33ea1ab2ce328d9486181d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_security_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00203_source.html#l00186">186</a> of file <a class="el" href="a00203_source.html">security.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;{</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a>){</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00196.html#aab9402f5cad5f77a95a652fccb585b23">mosquitto_security_init_default</a>(db, reload);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">return</span> db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#aa287a78bf59551612c27d128fea0c9c0">security_init</a>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">user_data</a>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">auth_option_count</a>, reload);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div><div class="ttc" id="a00089_html_a955e8de0edc8e8b484cca2db67bed33b"><div class="ttname"><a href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">mosquitto_db::auth_plugin</a></div><div class="ttdeci">struct _mosquitto_auth_plugin auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00265">mosquitto_broker.h:265</a></div></div>
<div class="ttc" id="a00010_html_acf433aeb82cd031f935e294f9e1c281f"><div class="ttname"><a href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">_mosquitto_auth_plugin::lib</a></div><div class="ttdeci">void * lib</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00231">mosquitto_broker.h:231</a></div></div>
<div class="ttc" id="a00010_html_aa287a78bf59551612c27d128fea0c9c0"><div class="ttname"><a href="a00010.html#aa287a78bf59551612c27d128fea0c9c0">_mosquitto_auth_plugin::security_init</a></div><div class="ttdeci">int(* security_init)(void *user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00236">mosquitto_broker.h:236</a></div></div>
<div class="ttc" id="a00196_html_aab9402f5cad5f77a95a652fccb585b23"><div class="ttname"><a href="a00196.html#aab9402f5cad5f77a95a652fccb585b23">mosquitto_security_init_default</a></div><div class="ttdeci">int mosquitto_security_init_default(struct mosquitto_db *db, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00204_source.html#l00036">security_default.c:36</a></div></div>
<div class="ttc" id="a00097_html_a5fb755f76a28edbd35bfed132682d0af"><div class="ttname"><a href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">mqtt3_config::auth_options</a></div><div class="ttdeci">struct mosquitto_auth_opt * auth_options</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00150">mosquitto_broker.h:150</a></div></div>
<div class="ttc" id="a00010_html_a7a2250d98915f6bfd6e1f42bf273eac9"><div class="ttname"><a href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">_mosquitto_auth_plugin::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00232">mosquitto_broker.h:232</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00097_html_ac66fb8bbb1e5814bf6beae5282080b80"><div class="ttname"><a href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">mqtt3_config::auth_option_count</a></div><div class="ttdeci">int auth_option_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00151">mosquitto_broker.h:151</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_aa561902dbf33ea1ab2ce328d9486181d_cgraph.png" border="0" usemap="#a00196_aa561902dbf33ea1ab2ce328d9486181d_cgraph" alt=""/></div>
<map name="a00196_aa561902dbf33ea1ab2ce328d9486181d_cgraph" id="a00196_aa561902dbf33ea1ab2ce328d9486181d_cgraph">
<area shape="rect" id="node2" href="a00196.html#aab9402f5cad5f77a95a652fccb585b23" title="mosquitto_security\l_init_default" alt="" coords="209,5,341,47"/>
<area shape="rect" id="node3" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="389,13,536,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aab9402f5cad5f77a95a652fccb585b23"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_security_init_default </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00204_source.html#l00036">36</a> of file <a class="el" href="a00204_source.html">security_default.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">/* Load username/password data if required. */</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a1f8ed3ff7988b2b340b0985f1e1d758b">password_file</a>){</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        rc = _unpwd_file_parse(db);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error opening password file \&quot;%s\&quot;.&quot;</span>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a1f8ed3ff7988b2b340b0985f1e1d758b">password_file</a>);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        }</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">/* Load acl data if required. */</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a4410806d7ebee8351069c555e55c0f70">acl_file</a>){</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        rc = _aclfile_parse(db);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error opening acl file \&quot;%s\&quot;.&quot;</span>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a4410806d7ebee8351069c555e55c0f70">acl_file</a>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        }</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">/* Load psk data if required. */</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#aa36e719df4dd9f96c96b2056e71c11bc">psk_file</a>){</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        rc = _psk_file_parse(db);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error opening psk file \&quot;%s\&quot;.&quot;</span>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#aa36e719df4dd9f96c96b2056e71c11bc">psk_file</a>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    }</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00097_html_aa36e719df4dd9f96c96b2056e71c11bc"><div class="ttname"><a href="a00097.html#aa36e719df4dd9f96c96b2056e71c11bc">mqtt3_config::psk_file</a></div><div class="ttdeci">char * psk_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00134">mosquitto_broker.h:134</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00097_html_a4410806d7ebee8351069c555e55c0f70"><div class="ttname"><a href="a00097.html#a4410806d7ebee8351069c555e55c0f70">mqtt3_config::acl_file</a></div><div class="ttdeci">char * acl_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00105">mosquitto_broker.h:105</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00097_html_a1f8ed3ff7988b2b340b0985f1e1d758b"><div class="ttname"><a href="a00097.html#a1f8ed3ff7988b2b340b0985f1e1d758b">mqtt3_config::password_file</a></div><div class="ttdeci">char * password_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00127">mosquitto_broker.h:127</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_aab9402f5cad5f77a95a652fccb585b23_cgraph.png" border="0" usemap="#a00196_aab9402f5cad5f77a95a652fccb585b23_cgraph" alt=""/></div>
<map name="a00196_aab9402f5cad5f77a95a652fccb585b23_cgraph" id="a00196_aab9402f5cad5f77a95a652fccb585b23_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="185,13,332,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af9ed37d9ab03d503edacbee8cb477ff2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_security_module_cleanup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00203_source.html#l00161">161</a> of file <a class="el" href="a00203_source.html">security.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="a00203.html#a13baab4bb8c48922ec24ecef1938932e">mosquitto_security_cleanup</a>(db, <span class="keyword">false</span>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a3b624d6bec4799722e27196e1e1d8d32">plugin_cleanup</a>){</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a3b624d6bec4799722e27196e1e1d8d32">plugin_cleanup</a>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">user_data</a>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">auth_option_count</a>);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">auth_plugin</a>){</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a>){</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a>);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a> = NULL;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab44621c2df675aa679e2024c4f72bd26">plugin_init</a> = NULL;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a3b624d6bec4799722e27196e1e1d8d32">plugin_cleanup</a> = NULL;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#aa287a78bf59551612c27d128fea0c9c0">security_init</a> = NULL;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#afb5b45763c9dd80199033fe4148dc4b4">security_cleanup</a> = NULL;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7f11a3ec696d6e7eaa38b18eb2cbec16">acl_check</a> = NULL;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab841237c5ea426623fb6882febdfc303">unpwd_check</a> = NULL;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a114da20e1d466edc74a16a76ade50546">psk_key_get</a> = NULL;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;}</div><div class="ttc" id="a00010_html_ab841237c5ea426623fb6882febdfc303"><div class="ttname"><a href="a00010.html#ab841237c5ea426623fb6882febdfc303">_mosquitto_auth_plugin::unpwd_check</a></div><div class="ttdeci">int(* unpwd_check)(void *user_data, const char *username, const char *password)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00239">mosquitto_broker.h:239</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00089_html_a955e8de0edc8e8b484cca2db67bed33b"><div class="ttname"><a href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">mosquitto_db::auth_plugin</a></div><div class="ttdeci">struct _mosquitto_auth_plugin auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00265">mosquitto_broker.h:265</a></div></div>
<div class="ttc" id="a00010_html_acf433aeb82cd031f935e294f9e1c281f"><div class="ttname"><a href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">_mosquitto_auth_plugin::lib</a></div><div class="ttdeci">void * lib</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00231">mosquitto_broker.h:231</a></div></div>
<div class="ttc" id="a00010_html_a7f11a3ec696d6e7eaa38b18eb2cbec16"><div class="ttname"><a href="a00010.html#a7f11a3ec696d6e7eaa38b18eb2cbec16">_mosquitto_auth_plugin::acl_check</a></div><div class="ttdeci">int(* acl_check)(void *user_data, const char *clientid, const char *username, const char *topic, int access)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00238">mosquitto_broker.h:238</a></div></div>
<div class="ttc" id="a00203_html_a13baab4bb8c48922ec24ecef1938932e"><div class="ttname"><a href="a00203.html#a13baab4bb8c48922ec24ecef1938932e">mosquitto_security_cleanup</a></div><div class="ttdeci">int mosquitto_security_cleanup(struct mosquitto_db *db, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00209">security.c:209</a></div></div>
<div class="ttc" id="a00010_html_a114da20e1d466edc74a16a76ade50546"><div class="ttname"><a href="a00010.html#a114da20e1d466edc74a16a76ade50546">_mosquitto_auth_plugin::psk_key_get</a></div><div class="ttdeci">int(* psk_key_get)(void *user_data, const char *hint, const char *identity, char *key, int max_key_len)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00240">mosquitto_broker.h:240</a></div></div>
<div class="ttc" id="a00010_html_aa287a78bf59551612c27d128fea0c9c0"><div class="ttname"><a href="a00010.html#aa287a78bf59551612c27d128fea0c9c0">_mosquitto_auth_plugin::security_init</a></div><div class="ttdeci">int(* security_init)(void *user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00236">mosquitto_broker.h:236</a></div></div>
<div class="ttc" id="a00010_html_afb5b45763c9dd80199033fe4148dc4b4"><div class="ttname"><a href="a00010.html#afb5b45763c9dd80199033fe4148dc4b4">_mosquitto_auth_plugin::security_cleanup</a></div><div class="ttdeci">int(* security_cleanup)(void *user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00237">mosquitto_broker.h:237</a></div></div>
<div class="ttc" id="a00010_html_a3b624d6bec4799722e27196e1e1d8d32"><div class="ttname"><a href="a00010.html#a3b624d6bec4799722e27196e1e1d8d32">_mosquitto_auth_plugin::plugin_cleanup</a></div><div class="ttdeci">int(* plugin_cleanup)(void *user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00235">mosquitto_broker.h:235</a></div></div>
<div class="ttc" id="a00010_html_ab44621c2df675aa679e2024c4f72bd26"><div class="ttname"><a href="a00010.html#ab44621c2df675aa679e2024c4f72bd26">_mosquitto_auth_plugin::plugin_init</a></div><div class="ttdeci">int(* plugin_init)(void **user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00234">mosquitto_broker.h:234</a></div></div>
<div class="ttc" id="a00097_html_a5fb755f76a28edbd35bfed132682d0af"><div class="ttname"><a href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">mqtt3_config::auth_options</a></div><div class="ttdeci">struct mosquitto_auth_opt * auth_options</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00150">mosquitto_broker.h:150</a></div></div>
<div class="ttc" id="a00010_html_a7a2250d98915f6bfd6e1f42bf273eac9"><div class="ttname"><a href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">_mosquitto_auth_plugin::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00232">mosquitto_broker.h:232</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00193_html_ae27dddb3d6bf5d5d0352b622830d6592"><div class="ttname"><a href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a></div><div class="ttdeci">#define LIB_CLOSE(A)</div><div class="ttdef"><b>Definition:</b> <a href="a00193_source.html#l00032">lib_load.h:32</a></div></div>
<div class="ttc" id="a00097_html_ac66fb8bbb1e5814bf6beae5282080b80"><div class="ttname"><a href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">mqtt3_config::auth_option_count</a></div><div class="ttdeci">int auth_option_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00151">mosquitto_broker.h:151</a></div></div>
<div class="ttc" id="a00097_html_acb2e0e6ffef06294f307d7b98ecde67d"><div class="ttname"><a href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">mqtt3_config::auth_plugin</a></div><div class="ttdeci">char * auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00149">mosquitto_broker.h:149</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_af9ed37d9ab03d503edacbee8cb477ff2_cgraph.png" border="0" usemap="#a00196_af9ed37d9ab03d503edacbee8cb477ff2_cgraph" alt=""/></div>
<map name="a00196_af9ed37d9ab03d503edacbee8cb477ff2_cgraph" id="a00196_af9ed37d9ab03d503edacbee8cb477ff2_cgraph">
<area shape="rect" id="node2" href="a00203.html#a13baab4bb8c48922ec24ecef1938932e" title="mosquitto_security\l_cleanup" alt="" coords="185,5,317,47"/>
<area shape="rect" id="node3" href="a00196.html#af4244d5e2409405c58a5366f31842cdf" title="mosquitto_security\l_cleanup_default" alt="" coords="365,5,497,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a68ae3159d8956163ab492b3e925fd16d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int int mosquitto_security_module_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00203_source.html#l00049">49</a> of file <a class="el" href="a00203_source.html">security.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">void</span> *lib;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    int (*plugin_version)(void) = NULL;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordtype">int</span> version;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">auth_plugin</a>){</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        lib = <a class="code" href="a00193.html#aedb7a56bd9d9828535b1bba84546df29">LIB_LOAD</a>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">auth_plugin</a>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">if</span>(!lib){</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin \&quot;%s\&quot;.&quot;</span>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">auth_plugin</a>);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        }</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a> = NULL;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">if</span>(!(plugin_version = (<a class="code" href="a00203.html#a0735e3e789149b66ad15544c639183e3">FUNC_auth_plugin_version</a>)<a class="code" href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a>(lib, <span class="stringliteral">&quot;mosquitto_auth_plugin_version&quot;</span>))){</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin function mosquitto_auth_plugin_version().&quot;</span>);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        version = plugin_version();</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">if</span>(version != <a class="code" href="a00198.html#a9ab2127237100d1013802796af3f5296">MOSQ_AUTH_PLUGIN_VERSION</a>){</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                    <span class="stringliteral">&quot;Error: Incorrect auth plugin version (got %d, expected %d).&quot;</span>,</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                    version, <a class="code" href="a00198.html#a9ab2127237100d1013802796af3f5296">MOSQ_AUTH_PLUGIN_VERSION</a>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span>(!(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab44621c2df675aa679e2024c4f72bd26">plugin_init</a> = (<a class="code" href="a00203.html#a0513e44edc8363d6978cb4ce6753caba">FUNC_auth_plugin_init</a>)<a class="code" href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a>(lib, <span class="stringliteral">&quot;mosquitto_auth_plugin_init&quot;</span>))){</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin function mosquitto_auth_plugin_init().&quot;</span>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span>(!(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a3b624d6bec4799722e27196e1e1d8d32">plugin_cleanup</a> = (<a class="code" href="a00203.html#a0a6241b2a2ad4afaf6061182c4460a1b">FUNC_auth_plugin_cleanup</a>)<a class="code" href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a>(lib, <span class="stringliteral">&quot;mosquitto_auth_plugin_cleanup&quot;</span>))){</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin function mosquitto_auth_plugin_cleanup().&quot;</span>);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">if</span>(!(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#aa287a78bf59551612c27d128fea0c9c0">security_init</a> = (<a class="code" href="a00203.html#ab8ba715468020b4cd8c08d35b51e9f33">FUNC_auth_plugin_security_init</a>)<a class="code" href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a>(lib, <span class="stringliteral">&quot;mosquitto_auth_security_init&quot;</span>))){</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin function mosquitto_auth_security_init().&quot;</span>);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">if</span>(!(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#afb5b45763c9dd80199033fe4148dc4b4">security_cleanup</a> = (<a class="code" href="a00203.html#a95ddd54ebee96b3c95772a74a8ffb304">FUNC_auth_plugin_security_cleanup</a>)<a class="code" href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a>(lib, <span class="stringliteral">&quot;mosquitto_auth_security_cleanup&quot;</span>))){</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin function mosquitto_auth_security_cleanup().&quot;</span>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">if</span>(!(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7f11a3ec696d6e7eaa38b18eb2cbec16">acl_check</a> = (<a class="code" href="a00203.html#acded15b69fdf58cf5a125020919a18ed">FUNC_auth_plugin_acl_check</a>)<a class="code" href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a>(lib, <span class="stringliteral">&quot;mosquitto_auth_acl_check&quot;</span>))){</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin function mosquitto_auth_acl_check().&quot;</span>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        }</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span>(!(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab841237c5ea426623fb6882febdfc303">unpwd_check</a> = (<a class="code" href="a00203.html#acc66af82b9046f1140ae51512adae56c">FUNC_auth_plugin_unpwd_check</a>)<a class="code" href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a>(lib, <span class="stringliteral">&quot;mosquitto_auth_unpwd_check&quot;</span>))){</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin function mosquitto_auth_unpwd_check().&quot;</span>);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">if</span>(!(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a114da20e1d466edc74a16a76ade50546">psk_key_get</a> = (<a class="code" href="a00203.html#a234c14b8e42bf32b8ef53a30371cf088">FUNC_auth_plugin_psk_key_get</a>)<a class="code" href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a>(lib, <span class="stringliteral">&quot;mosquitto_auth_psk_key_get&quot;</span>))){</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    <span class="stringliteral">&quot;Error: Unable to load auth plugin function mosquitto_auth_psk_key_get().&quot;</span>);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <a class="code" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a>();</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <a class="code" href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a>(lib);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a> = lib;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">user_data</a> = NULL;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab44621c2df675aa679e2024c4f72bd26">plugin_init</a>){</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            rc = db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab44621c2df675aa679e2024c4f72bd26">plugin_init</a>(&amp;db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">user_data</a>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a>, db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">auth_option_count</a>);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>,</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                        <span class="stringliteral">&quot;Error: Authentication plugin returned %d when initialising.&quot;</span>, rc);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a> = NULL;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab44621c2df675aa679e2024c4f72bd26">plugin_init</a> = NULL;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a3b624d6bec4799722e27196e1e1d8d32">plugin_cleanup</a> = NULL;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#aa287a78bf59551612c27d128fea0c9c0">security_init</a> = NULL;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#afb5b45763c9dd80199033fe4148dc4b4">security_cleanup</a> = NULL;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7f11a3ec696d6e7eaa38b18eb2cbec16">acl_check</a> = NULL;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab841237c5ea426623fb6882febdfc303">unpwd_check</a> = NULL;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a114da20e1d466edc74a16a76ade50546">psk_key_get</a> = NULL;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div><div class="ttc" id="a00203_html_a0a6241b2a2ad4afaf6061182c4460a1b"><div class="ttname"><a href="a00203.html#a0a6241b2a2ad4afaf6061182c4460a1b">FUNC_auth_plugin_cleanup</a></div><div class="ttdeci">int(* FUNC_auth_plugin_cleanup)(void *, struct mosquitto_auth_opt *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00029">security.c:29</a></div></div>
<div class="ttc" id="a00010_html_ab841237c5ea426623fb6882febdfc303"><div class="ttname"><a href="a00010.html#ab841237c5ea426623fb6882febdfc303">_mosquitto_auth_plugin::unpwd_check</a></div><div class="ttdeci">int(* unpwd_check)(void *user_data, const char *username, const char *password)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00239">mosquitto_broker.h:239</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00089_html_a955e8de0edc8e8b484cca2db67bed33b"><div class="ttname"><a href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">mosquitto_db::auth_plugin</a></div><div class="ttdeci">struct _mosquitto_auth_plugin auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00265">mosquitto_broker.h:265</a></div></div>
<div class="ttc" id="a00203_html_a140fbba76cc7844400cc66fa24d034d7"><div class="ttname"><a href="a00203.html#a140fbba76cc7844400cc66fa24d034d7">LIB_ERROR</a></div><div class="ttdeci">void LIB_ERROR(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00036">security.c:36</a></div></div>
<div class="ttc" id="a00203_html_ab8ba715468020b4cd8c08d35b51e9f33"><div class="ttname"><a href="a00203.html#ab8ba715468020b4cd8c08d35b51e9f33">FUNC_auth_plugin_security_init</a></div><div class="ttdeci">int(* FUNC_auth_plugin_security_init)(void *, struct mosquitto_auth_opt *, int, bool)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00030">security.c:30</a></div></div>
<div class="ttc" id="a00203_html_a0735e3e789149b66ad15544c639183e3"><div class="ttname"><a href="a00203.html#a0735e3e789149b66ad15544c639183e3">FUNC_auth_plugin_version</a></div><div class="ttdeci">int(* FUNC_auth_plugin_version)(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00027">security.c:27</a></div></div>
<div class="ttc" id="a00010_html_acf433aeb82cd031f935e294f9e1c281f"><div class="ttname"><a href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">_mosquitto_auth_plugin::lib</a></div><div class="ttdeci">void * lib</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00231">mosquitto_broker.h:231</a></div></div>
<div class="ttc" id="a00203_html_acc66af82b9046f1140ae51512adae56c"><div class="ttname"><a href="a00203.html#acc66af82b9046f1140ae51512adae56c">FUNC_auth_plugin_unpwd_check</a></div><div class="ttdeci">int(* FUNC_auth_plugin_unpwd_check)(void *, const char *, const char *)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00033">security.c:33</a></div></div>
<div class="ttc" id="a00010_html_a7f11a3ec696d6e7eaa38b18eb2cbec16"><div class="ttname"><a href="a00010.html#a7f11a3ec696d6e7eaa38b18eb2cbec16">_mosquitto_auth_plugin::acl_check</a></div><div class="ttdeci">int(* acl_check)(void *user_data, const char *clientid, const char *username, const char *topic, int access)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00238">mosquitto_broker.h:238</a></div></div>
<div class="ttc" id="a00203_html_a234c14b8e42bf32b8ef53a30371cf088"><div class="ttname"><a href="a00203.html#a234c14b8e42bf32b8ef53a30371cf088">FUNC_auth_plugin_psk_key_get</a></div><div class="ttdeci">int(* FUNC_auth_plugin_psk_key_get)(void *, const char *, const char *, char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00034">security.c:34</a></div></div>
<div class="ttc" id="a00010_html_a114da20e1d466edc74a16a76ade50546"><div class="ttname"><a href="a00010.html#a114da20e1d466edc74a16a76ade50546">_mosquitto_auth_plugin::psk_key_get</a></div><div class="ttdeci">int(* psk_key_get)(void *user_data, const char *hint, const char *identity, char *key, int max_key_len)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00240">mosquitto_broker.h:240</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00203_html_a0513e44edc8363d6978cb4ce6753caba"><div class="ttname"><a href="a00203.html#a0513e44edc8363d6978cb4ce6753caba">FUNC_auth_plugin_init</a></div><div class="ttdeci">int(* FUNC_auth_plugin_init)(void **, struct mosquitto_auth_opt *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00028">security.c:28</a></div></div>
<div class="ttc" id="a00010_html_aa287a78bf59551612c27d128fea0c9c0"><div class="ttname"><a href="a00010.html#aa287a78bf59551612c27d128fea0c9c0">_mosquitto_auth_plugin::security_init</a></div><div class="ttdeci">int(* security_init)(void *user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00236">mosquitto_broker.h:236</a></div></div>
<div class="ttc" id="a00203_html_a95ddd54ebee96b3c95772a74a8ffb304"><div class="ttname"><a href="a00203.html#a95ddd54ebee96b3c95772a74a8ffb304">FUNC_auth_plugin_security_cleanup</a></div><div class="ttdeci">int(* FUNC_auth_plugin_security_cleanup)(void *, struct mosquitto_auth_opt *, int, bool)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00031">security.c:31</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00010_html_afb5b45763c9dd80199033fe4148dc4b4"><div class="ttname"><a href="a00010.html#afb5b45763c9dd80199033fe4148dc4b4">_mosquitto_auth_plugin::security_cleanup</a></div><div class="ttdeci">int(* security_cleanup)(void *user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00237">mosquitto_broker.h:237</a></div></div>
<div class="ttc" id="a00193_html_a1d463e49e3f39391e47ab5e041db44d0"><div class="ttname"><a href="a00193.html#a1d463e49e3f39391e47ab5e041db44d0">LIB_SYM</a></div><div class="ttdeci">#define LIB_SYM(HANDLE, SYM)</div><div class="ttdef"><b>Definition:</b> <a href="a00193_source.html#l00033">lib_load.h:33</a></div></div>
<div class="ttc" id="a00010_html_a3b624d6bec4799722e27196e1e1d8d32"><div class="ttname"><a href="a00010.html#a3b624d6bec4799722e27196e1e1d8d32">_mosquitto_auth_plugin::plugin_cleanup</a></div><div class="ttdeci">int(* plugin_cleanup)(void *user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00235">mosquitto_broker.h:235</a></div></div>
<div class="ttc" id="a00198_html_a9ab2127237100d1013802796af3f5296"><div class="ttname"><a href="a00198.html#a9ab2127237100d1013802796af3f5296">MOSQ_AUTH_PLUGIN_VERSION</a></div><div class="ttdeci">#define MOSQ_AUTH_PLUGIN_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="a00198_source.html#l00020">mosquitto_plugin.h:20</a></div></div>
<div class="ttc" id="a00010_html_ab44621c2df675aa679e2024c4f72bd26"><div class="ttname"><a href="a00010.html#ab44621c2df675aa679e2024c4f72bd26">_mosquitto_auth_plugin::plugin_init</a></div><div class="ttdeci">int(* plugin_init)(void **user_data, struct mosquitto_auth_opt *auth_opts, int auth_opt_count)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00234">mosquitto_broker.h:234</a></div></div>
<div class="ttc" id="a00193_html_aedb7a56bd9d9828535b1bba84546df29"><div class="ttname"><a href="a00193.html#aedb7a56bd9d9828535b1bba84546df29">LIB_LOAD</a></div><div class="ttdeci">#define LIB_LOAD(A)</div><div class="ttdef"><b>Definition:</b> <a href="a00193_source.html#l00031">lib_load.h:31</a></div></div>
<div class="ttc" id="a00097_html_a5fb755f76a28edbd35bfed132682d0af"><div class="ttname"><a href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">mqtt3_config::auth_options</a></div><div class="ttdeci">struct mosquitto_auth_opt * auth_options</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00150">mosquitto_broker.h:150</a></div></div>
<div class="ttc" id="a00010_html_a7a2250d98915f6bfd6e1f42bf273eac9"><div class="ttname"><a href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">_mosquitto_auth_plugin::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00232">mosquitto_broker.h:232</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00193_html_ae27dddb3d6bf5d5d0352b622830d6592"><div class="ttname"><a href="a00193.html#ae27dddb3d6bf5d5d0352b622830d6592">LIB_CLOSE</a></div><div class="ttdeci">#define LIB_CLOSE(A)</div><div class="ttdef"><b>Definition:</b> <a href="a00193_source.html#l00032">lib_load.h:32</a></div></div>
<div class="ttc" id="a00203_html_acded15b69fdf58cf5a125020919a18ed"><div class="ttname"><a href="a00203.html#acded15b69fdf58cf5a125020919a18ed">FUNC_auth_plugin_acl_check</a></div><div class="ttdeci">int(* FUNC_auth_plugin_acl_check)(void *, const char *, const char *, const char *, int)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00032">security.c:32</a></div></div>
<div class="ttc" id="a00097_html_ac66fb8bbb1e5814bf6beae5282080b80"><div class="ttname"><a href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">mqtt3_config::auth_option_count</a></div><div class="ttdeci">int auth_option_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00151">mosquitto_broker.h:151</a></div></div>
<div class="ttc" id="a00097_html_acb2e0e6ffef06294f307d7b98ecde67d"><div class="ttname"><a href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">mqtt3_config::auth_plugin</a></div><div class="ttdeci">char * auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00149">mosquitto_broker.h:149</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a68ae3159d8956163ab492b3e925fd16d_cgraph.png" border="0" usemap="#a00196_a68ae3159d8956163ab492b3e925fd16d_cgraph" alt=""/></div>
<map name="a00196_a68ae3159d8956163ab492b3e925fd16d_cgraph" id="a00196_a68ae3159d8956163ab492b3e925fd16d_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="332,13,479,39"/>
<area shape="rect" id="node3" href="a00203.html#a140fbba76cc7844400cc66fa24d034d7" title="LIB_ERROR" alt="" coords="185,38,284,65"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afb27e1ef0cdde6bee2d77265380bef54"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_unpwd_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>password</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00203_source.html#l00257">257</a> of file <a class="el" href="a00203_source.html">security.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;{</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">lib</a>){</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00196.html#a20315c474619e67362c6472ac7d46e3f">mosquitto_unpwd_check_default</a>(db, <a class="code" href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">username</a>, password);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">return</span> db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#ab841237c5ea426623fb6882febdfc303">unpwd_check</a>(db-&gt;<a class="code" href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">auth_plugin</a>.<a class="code" href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">user_data</a>, <a class="code" href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">username</a>, password);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div><div class="ttc" id="a00010_html_ab841237c5ea426623fb6882febdfc303"><div class="ttname"><a href="a00010.html#ab841237c5ea426623fb6882febdfc303">_mosquitto_auth_plugin::unpwd_check</a></div><div class="ttdeci">int(* unpwd_check)(void *user_data, const char *username, const char *password)</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00239">mosquitto_broker.h:239</a></div></div>
<div class="ttc" id="a00089_html_a955e8de0edc8e8b484cca2db67bed33b"><div class="ttname"><a href="a00089.html#a955e8de0edc8e8b484cca2db67bed33b">mosquitto_db::auth_plugin</a></div><div class="ttdeci">struct _mosquitto_auth_plugin auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00265">mosquitto_broker.h:265</a></div></div>
<div class="ttc" id="a00010_html_acf433aeb82cd031f935e294f9e1c281f"><div class="ttname"><a href="a00010.html#acf433aeb82cd031f935e294f9e1c281f">_mosquitto_auth_plugin::lib</a></div><div class="ttdeci">void * lib</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00231">mosquitto_broker.h:231</a></div></div>
<div class="ttc" id="a00009_html_a2db3d9318cbb28329cbc748f5e0df14f"><div class="ttname"><a href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">_mosquitto_acl_user::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00226">mosquitto_broker.h:226</a></div></div>
<div class="ttc" id="a00196_html_a20315c474619e67362c6472ac7d46e3f"><div class="ttname"><a href="a00196.html#a20315c474619e67362c6472ac7d46e3f">mosquitto_unpwd_check_default</a></div><div class="ttdeci">int mosquitto_unpwd_check_default(struct mosquitto_db *db, const char *username, const char *password)</div><div class="ttdef"><b>Definition:</b> <a href="a00204_source.html#l00653">security_default.c:653</a></div></div>
<div class="ttc" id="a00010_html_a7a2250d98915f6bfd6e1f42bf273eac9"><div class="ttname"><a href="a00010.html#a7a2250d98915f6bfd6e1f42bf273eac9">_mosquitto_auth_plugin::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00232">mosquitto_broker.h:232</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_afb27e1ef0cdde6bee2d77265380bef54_cgraph.png" border="0" usemap="#a00196_afb27e1ef0cdde6bee2d77265380bef54_cgraph" alt=""/></div>
<map name="a00196_afb27e1ef0cdde6bee2d77265380bef54_cgraph" id="a00196_afb27e1ef0cdde6bee2d77265380bef54_cgraph">
<area shape="rect" id="node2" href="a00196.html#a20315c474619e67362c6472ac7d46e3f" title="mosquitto_unpwd_check\l_default" alt="" coords="220,5,387,47"/>
<area shape="rect" id="node3" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="435,13,549,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a20315c474619e67362c6472ac7d46e3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mosquitto_unpwd_check_default </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>password</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00204_source.html#l00653">653</a> of file <a class="el" href="a00204_source.html">security_default.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;{</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00014.html">_mosquitto_unpwd</a> *u, *tmp;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hash[EVP_MAX_MD_SIZE];</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash_len;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">if</span>(!db) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">if</span>(!db-&gt;<a class="code" href="a00089.html#a0ae1cdd9ca34f2dac7f1a5c02f3ed359">unpwd</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="a00014.html#a7c0d15b77b2dd20fa6c147b563c9143b">username</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>; <span class="comment">/* Check must be made only after checking db-&gt;unpwd. */</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <a class="code" href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a>(<a class="code" href="a00014.html#ae163ee245d5f34c71a964b5203a8ebfa">hh</a>, db-&gt;<a class="code" href="a00089.html#a0ae1cdd9ca34f2dac7f1a5c02f3ed359">unpwd</a>, u, tmp){</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">if</span>(!strcmp(u-&gt;<a class="code" href="a00014.html#a7c0d15b77b2dd20fa6c147b563c9143b">username</a>, <a class="code" href="a00014.html#a7c0d15b77b2dd20fa6c147b563c9143b">username</a>)){</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="keywordflow">if</span>(u-&gt;<a class="code" href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">password</a>){</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">password</a>){</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                    rc = _pw_digest(<a class="code" href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">password</a>, u-&gt;salt, u-&gt;salt_len, hash, &amp;hash_len);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                    <span class="keywordflow">if</span>(rc == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                        <span class="keywordflow">if</span>(hash_len == u-&gt;password_len &amp;&amp; !memcmp(u-&gt;<a class="code" href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">password</a>, hash, hash_len)){</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                        }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                    }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                    <span class="keywordflow">if</span>(!strcmp(u-&gt;<a class="code" href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">password</a>, <a class="code" href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">password</a>)){</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                    }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            }</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        }</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00078">mosquitto.h:78</a></div></div>
<div class="ttc" id="a00209_html_a4d524042f1fcb976d8bccae9e4cc63d6"><div class="ttname"><a href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a></div><div class="ttdeci">#define HASH_ITER(hh, head, el, tmp)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00871">uthash.h:871</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00014_html_adb5bda8b38774bd4b0f3796c9f612e57"><div class="ttname"><a href="a00014.html#adb5bda8b38774bd4b0f3796c9f612e57">_mosquitto_unpwd::password</a></div><div class="ttdeci">char * password</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00207">mosquitto_broker.h:207</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00014_html_a7c0d15b77b2dd20fa6c147b563c9143b"><div class="ttname"><a href="a00014.html#a7c0d15b77b2dd20fa6c147b563c9143b">_mosquitto_unpwd::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00206">mosquitto_broker.h:206</a></div></div>
<div class="ttc" id="a00014_html"><div class="ttname"><a href="a00014.html">_mosquitto_unpwd</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00205">mosquitto_broker.h:205</a></div></div>
<div class="ttc" id="a00014_html_ae163ee245d5f34c71a964b5203a8ebfa"><div class="ttname"><a href="a00014.html#ae163ee245d5f34c71a964b5203a8ebfa">_mosquitto_unpwd::hh</a></div><div class="ttdeci">UT_hash_handle hh</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00213">mosquitto_broker.h:213</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00089_html_a0ae1cdd9ca34f2dac7f1a5c02f3ed359"><div class="ttname"><a href="a00089.html#a0ae1cdd9ca34f2dac7f1a5c02f3ed359">mosquitto_db::unpwd</a></div><div class="ttdeci">struct _mosquitto_unpwd * unpwd</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00246">mosquitto_broker.h:246</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a20315c474619e67362c6472ac7d46e3f_cgraph.png" border="0" usemap="#a00196_a20315c474619e67362c6472ac7d46e3f_cgraph" alt=""/></div>
<map name="a00196_a20315c474619e67362c6472ac7d46e3f_cgraph" id="a00196_a20315c474619e67362c6472ac7d46e3f_cgraph">
<area shape="rect" id="node2" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="220,13,335,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae7269c99227e58e2e0b30f998898468b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_config_cleanup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00097.html">mqtt3_config</a> *&#160;</td>
          <td class="paramname"><em>config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00189_source.html#l00212">212</a> of file <a class="el" href="a00189_source.html">conf.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;{</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordtype">int</span> j;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a4410806d7ebee8351069c555e55c0f70">acl_file</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a4410806d7ebee8351069c555e55c0f70">acl_file</a>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a989c6bfc51a17b5dc91b727d1b53dd4d">auto_id_prefix</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a989c6bfc51a17b5dc91b727d1b53dd4d">auto_id_prefix</a>);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a1c1eac5ebdeac653c7a20f08eca128e2">clientid_prefixes</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a1c1eac5ebdeac653c7a20f08eca128e2">clientid_prefixes</a>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">config_file</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">config_file</a>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a1f8ed3ff7988b2b340b0985f1e1d758b">password_file</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a1f8ed3ff7988b2b340b0985f1e1d758b">password_file</a>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a3c34a7f20a5af7b8cd66e27f84df18d5">persistence_location</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a3c34a7f20a5af7b8cd66e27f84df18d5">persistence_location</a>);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a2793765fb58b2a09682608fde9d62729">persistence_file</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a2793765fb58b2a09682608fde9d62729">persistence_file</a>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#aa36e719df4dd9f96c96b2056e71c11bc">psk_file</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#aa36e719df4dd9f96c96b2056e71c11bc">psk_file</a>);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ac3469a68981b92f7f098e0f8d88a9276">pid_file</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ac3469a68981b92f7f098e0f8d88a9276">pid_file</a>);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>){</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>; i++){</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a>);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">mount_point</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">mount_point</a>);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a>);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].cafile) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].cafile);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].capath) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].capath);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].certfile) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].certfile);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].keyfile) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].keyfile);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].ciphers) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].ciphers);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].psk_hint) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].psk_hint);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].crlfile) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].crlfile);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].tls_version) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].tls_version);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].ssl_ctx) SSL_CTX_free(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].ssl_ctx);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">#ifdef WITH_WEBSOCKETS</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].http_dir) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].http_dir);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">if</span>(config-&gt;bridges){</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;config-&gt;bridge_count; i++){</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].name) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].name);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].addresses){</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="keywordflow">for</span>(j=0; j&lt;config-&gt;bridges[i].address_count; j++){</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].addresses[j].address);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].addresses);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].remote_clientid) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].remote_clientid);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].remote_username) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].remote_username);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].remote_password) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].remote_password);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].local_clientid) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].local_clientid);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].local_username) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].local_username);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].local_password) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].local_password);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].topics){</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keywordflow">for</span>(j=0; j&lt;config-&gt;bridges[i].topic_count; j++){</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                    <span class="keywordflow">if</span>(config-&gt;bridges[i].topics[j].topic) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].topics[j].topic);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    <span class="keywordflow">if</span>(config-&gt;bridges[i].topics[j].local_prefix) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].topics[j].local_prefix);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    <span class="keywordflow">if</span>(config-&gt;bridges[i].topics[j].remote_prefix) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].topics[j].remote_prefix);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    <span class="keywordflow">if</span>(config-&gt;bridges[i].topics[j].local_topic) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].topics[j].local_topic);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    <span class="keywordflow">if</span>(config-&gt;bridges[i].topics[j].remote_topic) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].topics[j].remote_topic);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].topics);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].notification_topic) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].notification_topic);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].tls_version) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].tls_version);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].tls_cafile) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].tls_cafile);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor">#ifdef REAL_WITH_TLS_PSK</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].tls_psk_identity) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].tls_psk_identity);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">if</span>(config-&gt;bridges[i].tls_psk) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges[i].tls_psk);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;bridges);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">auth_plugin</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">auth_plugin</a>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a>){</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;config-&gt;<a class="code" href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">auth_option_count</a>; i++){</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a>[i].<a class="code" href="a00087.html#a32eed6c6f63a1ec9cf614bd87b19c94a">key</a>);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a>[i].<a class="code" href="a00087.html#a61c89b1d4640ee14c89df228c32a2de5">value</a>);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a>);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        config-&gt;<a class="code" href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">auth_options</a> = NULL;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        config-&gt;<a class="code" href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">auth_option_count</a> = 0;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a39e2542bceca984969543bfbaafd336a">log_fptr</a>){</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        fclose(config-&gt;<a class="code" href="a00097.html#a39e2542bceca984969543bfbaafd336a">log_fptr</a>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        config-&gt;<a class="code" href="a00097.html#a39e2542bceca984969543bfbaafd336a">log_fptr</a> = NULL;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a6b85d63153f6da0aff7aa461888d5a59">log_file</a>){</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a6b85d63153f6da0aff7aa461888d5a59">log_file</a>);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        config-&gt;<a class="code" href="a00097.html#a6b85d63153f6da0aff7aa461888d5a59">log_file</a> = NULL;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div><div class="ttc" id="a00097_html_a1e549eb6e0ee7d9dcce491f57616a07b"><div class="ttname"><a href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">mqtt3_config::config_file</a></div><div class="ttdeci">char * config_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00104">mosquitto_broker.h:104</a></div></div>
<div class="ttc" id="a00097_html_a93b8a8cb4b6b2f919ab98d3716b35cb0"><div class="ttname"><a href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">mqtt3_config::persistence_filepath</a></div><div class="ttdeci">char * persistence_filepath</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00131">mosquitto_broker.h:131</a></div></div>
<div class="ttc" id="a00097_html_aeabd210b57d1ddc66dad927c96d4a74d"><div class="ttname"><a href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">mqtt3_config::listener_count</a></div><div class="ttdeci">int listener_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00119">mosquitto_broker.h:119</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00087_html_a61c89b1d4640ee14c89df228c32a2de5"><div class="ttname"><a href="a00087.html#a61c89b1d4640ee14c89df228c32a2de5">mosquitto_auth_opt::value</a></div><div class="ttdeci">char * value</div><div class="ttdef"><b>Definition:</b> <a href="a00198_source.html#l00028">mosquitto_plugin.h:28</a></div></div>
<div class="ttc" id="a00097_html_aa36e719df4dd9f96c96b2056e71c11bc"><div class="ttname"><a href="a00097.html#aa36e719df4dd9f96c96b2056e71c11bc">mqtt3_config::psk_file</a></div><div class="ttdeci">char * psk_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00134">mosquitto_broker.h:134</a></div></div>
<div class="ttc" id="a00097_html_ae4138e4cbbcf7ceb8097672df20faf05"><div class="ttname"><a href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">mqtt3_config::listeners</a></div><div class="ttdeci">struct _mqtt3_listener * listeners</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00118">mosquitto_broker.h:118</a></div></div>
<div class="ttc" id="a00097_html_a1c1eac5ebdeac653c7a20f08eca128e2"><div class="ttname"><a href="a00097.html#a1c1eac5ebdeac653c7a20f08eca128e2">mqtt3_config::clientid_prefixes</a></div><div class="ttdeci">char * clientid_prefixes</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00114">mosquitto_broker.h:114</a></div></div>
<div class="ttc" id="a00017_html_a0a8cd1be8f3eb14461532b260c78d1a8"><div class="ttname"><a href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">_mqtt3_listener::mount_point</a></div><div class="ttdeci">char * mount_point</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00077">mosquitto_broker.h:77</a></div></div>
<div class="ttc" id="a00097_html_a39e2542bceca984969543bfbaafd336a"><div class="ttname"><a href="a00097.html#a39e2542bceca984969543bfbaafd336a">mqtt3_config::log_fptr</a></div><div class="ttdeci">FILE * log_fptr</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00125">mosquitto_broker.h:125</a></div></div>
<div class="ttc" id="a00097_html_ac3469a68981b92f7f098e0f8d88a9276"><div class="ttname"><a href="a00097.html#ac3469a68981b92f7f098e0f8d88a9276">mqtt3_config::pid_file</a></div><div class="ttdeci">char * pid_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00133">mosquitto_broker.h:133</a></div></div>
<div class="ttc" id="a00017_html_a8f3e15dab6e5bae10bb2d930034f4d9f"><div class="ttname"><a href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">_mqtt3_listener::host</a></div><div class="ttdeci">char * host</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00074">mosquitto_broker.h:74</a></div></div>
<div class="ttc" id="a00097_html_a2793765fb58b2a09682608fde9d62729"><div class="ttname"><a href="a00097.html#a2793765fb58b2a09682608fde9d62729">mqtt3_config::persistence_file</a></div><div class="ttdeci">char * persistence_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00130">mosquitto_broker.h:130</a></div></div>
<div class="ttc" id="a00097_html_a6b85d63153f6da0aff7aa461888d5a59"><div class="ttname"><a href="a00097.html#a6b85d63153f6da0aff7aa461888d5a59">mqtt3_config::log_file</a></div><div class="ttdeci">char * log_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00124">mosquitto_broker.h:124</a></div></div>
<div class="ttc" id="a00097_html_a3c34a7f20a5af7b8cd66e27f84df18d5"><div class="ttname"><a href="a00097.html#a3c34a7f20a5af7b8cd66e27f84df18d5">mqtt3_config::persistence_location</a></div><div class="ttdeci">char * persistence_location</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00129">mosquitto_broker.h:129</a></div></div>
<div class="ttc" id="a00087_html_a32eed6c6f63a1ec9cf614bd87b19c94a"><div class="ttname"><a href="a00087.html#a32eed6c6f63a1ec9cf614bd87b19c94a">mosquitto_auth_opt::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="a00198_source.html#l00027">mosquitto_plugin.h:27</a></div></div>
<div class="ttc" id="a00097_html_a5fb755f76a28edbd35bfed132682d0af"><div class="ttname"><a href="a00097.html#a5fb755f76a28edbd35bfed132682d0af">mqtt3_config::auth_options</a></div><div class="ttdeci">struct mosquitto_auth_opt * auth_options</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00150">mosquitto_broker.h:150</a></div></div>
<div class="ttc" id="a00097_html_a989c6bfc51a17b5dc91b727d1b53dd4d"><div class="ttname"><a href="a00097.html#a989c6bfc51a17b5dc91b727d1b53dd4d">mqtt3_config::auto_id_prefix</a></div><div class="ttdeci">char * auto_id_prefix</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00110">mosquitto_broker.h:110</a></div></div>
<div class="ttc" id="a00097_html_a4410806d7ebee8351069c555e55c0f70"><div class="ttname"><a href="a00097.html#a4410806d7ebee8351069c555e55c0f70">mqtt3_config::acl_file</a></div><div class="ttdeci">char * acl_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00105">mosquitto_broker.h:105</a></div></div>
<div class="ttc" id="a00017_html_a60a8b4323b336b3033ebcf904716fe09"><div class="ttname"><a href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">_mqtt3_listener::socks</a></div><div class="ttdeci">mosq_sock_t * socks</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00078">mosquitto_broker.h:78</a></div></div>
<div class="ttc" id="a00097_html_ac66fb8bbb1e5814bf6beae5282080b80"><div class="ttname"><a href="a00097.html#ac66fb8bbb1e5814bf6beae5282080b80">mqtt3_config::auth_option_count</a></div><div class="ttdeci">int auth_option_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00151">mosquitto_broker.h:151</a></div></div>
<div class="ttc" id="a00097_html_acb2e0e6ffef06294f307d7b98ecde67d"><div class="ttname"><a href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">mqtt3_config::auth_plugin</a></div><div class="ttdeci">char * auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00149">mosquitto_broker.h:149</a></div></div>
<div class="ttc" id="a00097_html_a1f8ed3ff7988b2b340b0985f1e1d758b"><div class="ttname"><a href="a00097.html#a1f8ed3ff7988b2b340b0985f1e1d758b">mqtt3_config::password_file</a></div><div class="ttdeci">char * password_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00127">mosquitto_broker.h:127</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_ae7269c99227e58e2e0b30f998898468b_cgraph.png" border="0" usemap="#a00196_ae7269c99227e58e2e0b30f998898468b_cgraph" alt=""/></div>
<map name="a00196_ae7269c99227e58e2e0b30f998898468b_cgraph" id="a00196_ae7269c99227e58e2e0b30f998898468b_cgraph">
<area shape="rect" id="node2" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="203,5,317,32"/>
<area shape="rect" id="node3" href="a00139.html#aa1187b70998f73cdb598833d6afaa30a" title="print_usage" alt="" coords="215,56,305,83"/>
<area shape="rect" id="node4" href="a00157.html#a6f2738a9105e0b1177ef0e0004b3a8de" title="mosquitto_lib_version" alt="" coords="365,56,513,83"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a58703d0c046c1fa12b618e69123f1ccd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_config_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00097.html">mqtt3_config</a> *&#160;</td>
          <td class="paramname"><em>config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00189_source.html#l00171">171</a> of file <a class="el" href="a00189_source.html">conf.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;{</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    memset(config, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00097.html">mqtt3_config</a>));</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    _config_init_reload(config);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    config-&gt;<a class="code" href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">config_file</a> = NULL;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    config-&gt;<a class="code" href="a00097.html#af0a3f8e15bc452a14106e9043ff13b17">daemon</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a> = NULL;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a> = 0;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a802f0208ed0cc099a4e3cbaa5383b44e">max_connections</a> = -1;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">mount_point</a> = NULL;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a> = NULL;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a> = 0;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#ad5d4b8710a09924861317deac08472fb">client_count</a> = 0;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a7d78649594bccaac148977ebfbc7e367">protocol</a> = <a class="code" href="a00196.html#a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0">mp_mqtt</a>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#aa90c9af6612aaf612ecd5917989a423c">use_username_as_clientid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.tls_version = NULL;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.cafile = NULL;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.capath = NULL;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.certfile = NULL;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.keyfile = NULL;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.ciphers = NULL;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.psk_hint = NULL;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.require_certificate = <span class="keyword">false</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.crlfile = NULL;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.use_identity_as_username = <span class="keyword">false</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a> = NULL;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a> = 0;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    config-&gt;<a class="code" href="a00097.html#ac3469a68981b92f7f098e0f8d88a9276">pid_file</a> = NULL;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a> = NULL;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    config-&gt;bridges = NULL;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    config-&gt;bridge_count = 0;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    config-&gt;<a class="code" href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">auth_plugin</a> = NULL;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    config-&gt;<a class="code" href="a00097.html#a6d883f3ac6ba9dcdb8bf7f2ac686ff3d">auth_plugin_deny_special_chars</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    config-&gt;<a class="code" href="a00097.html#ac9e2bbf930885dc9be00b028cf4ece66">verbose</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    config-&gt;<a class="code" href="a00097.html#a2debc661bbf726e22a560f511a181979">message_size_limit</a> = 0;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;}</div><div class="ttc" id="a00017_html_aac74fcfd0ef8ab1775b8e8292b9a5b95"><div class="ttname"><a href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">_mqtt3_listener::sock_count</a></div><div class="ttdeci">int sock_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00079">mosquitto_broker.h:79</a></div></div>
<div class="ttc" id="a00017_html_a802f0208ed0cc099a4e3cbaa5383b44e"><div class="ttname"><a href="a00017.html#a802f0208ed0cc099a4e3cbaa5383b44e">_mqtt3_listener::max_connections</a></div><div class="ttdeci">int max_connections</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00076">mosquitto_broker.h:76</a></div></div>
<div class="ttc" id="a00097_html_a1e549eb6e0ee7d9dcce491f57616a07b"><div class="ttname"><a href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">mqtt3_config::config_file</a></div><div class="ttdeci">char * config_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00104">mosquitto_broker.h:104</a></div></div>
<div class="ttc" id="a00017_html_ae260347bb57e825c09097bff30b69c88"><div class="ttname"><a href="a00017.html#ae260347bb57e825c09097bff30b69c88">_mqtt3_listener::port</a></div><div class="ttdeci">uint16_t port</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00075">mosquitto_broker.h:75</a></div></div>
<div class="ttc" id="a00097_html_aeabd210b57d1ddc66dad927c96d4a74d"><div class="ttname"><a href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">mqtt3_config::listener_count</a></div><div class="ttdeci">int listener_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00119">mosquitto_broker.h:119</a></div></div>
<div class="ttc" id="a00097_html_ae4138e4cbbcf7ceb8097672df20faf05"><div class="ttname"><a href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">mqtt3_config::listeners</a></div><div class="ttdeci">struct _mqtt3_listener * listeners</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00118">mosquitto_broker.h:118</a></div></div>
<div class="ttc" id="a00017_html_a0a8cd1be8f3eb14461532b260c78d1a8"><div class="ttname"><a href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">_mqtt3_listener::mount_point</a></div><div class="ttdeci">char * mount_point</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00077">mosquitto_broker.h:77</a></div></div>
<div class="ttc" id="a00196_html_a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0"><div class="ttname"><a href="a00196.html#a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0">mp_mqtt</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00065">mosquitto_broker.h:65</a></div></div>
<div class="ttc" id="a00097_html_ac9e2bbf930885dc9be00b028cf4ece66"><div class="ttname"><a href="a00097.html#ac9e2bbf930885dc9be00b028cf4ece66">mqtt3_config::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00140">mosquitto_broker.h:140</a></div></div>
<div class="ttc" id="a00097_html_af0a3f8e15bc452a14106e9043ff13b17"><div class="ttname"><a href="a00097.html#af0a3f8e15bc452a14106e9043ff13b17">mqtt3_config::daemon</a></div><div class="ttdeci">bool daemon</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00116">mosquitto_broker.h:116</a></div></div>
<div class="ttc" id="a00097_html_ac3469a68981b92f7f098e0f8d88a9276"><div class="ttname"><a href="a00097.html#ac3469a68981b92f7f098e0f8d88a9276">mqtt3_config::pid_file</a></div><div class="ttdeci">char * pid_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00133">mosquitto_broker.h:133</a></div></div>
<div class="ttc" id="a00017_html_ad5d4b8710a09924861317deac08472fb"><div class="ttname"><a href="a00017.html#ad5d4b8710a09924861317deac08472fb">_mqtt3_listener::client_count</a></div><div class="ttdeci">int client_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00080">mosquitto_broker.h:80</a></div></div>
<div class="ttc" id="a00017_html_a8f3e15dab6e5bae10bb2d930034f4d9f"><div class="ttname"><a href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">_mqtt3_listener::host</a></div><div class="ttdeci">char * host</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00074">mosquitto_broker.h:74</a></div></div>
<div class="ttc" id="a00097_html_a6d883f3ac6ba9dcdb8bf7f2ac686ff3d"><div class="ttname"><a href="a00097.html#a6d883f3ac6ba9dcdb8bf7f2ac686ff3d">mqtt3_config::auth_plugin_deny_special_chars</a></div><div class="ttdeci">bool auth_plugin_deny_special_chars</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00109">mosquitto_broker.h:109</a></div></div>
<div class="ttc" id="a00017_html_a7d78649594bccaac148977ebfbc7e367"><div class="ttname"><a href="a00017.html#a7d78649594bccaac148977ebfbc7e367">_mqtt3_listener::protocol</a></div><div class="ttdeci">enum mosquitto_protocol protocol</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00081">mosquitto_broker.h:81</a></div></div>
<div class="ttc" id="a00097_html_aaecab4a1b44858118a74b0dc42b92e29"><div class="ttname"><a href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">mqtt3_config::default_listener</a></div><div class="ttdeci">struct _mqtt3_listener default_listener</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00117">mosquitto_broker.h:117</a></div></div>
<div class="ttc" id="a00097_html_a419267339dfc7093068db4eced13c349"><div class="ttname"><a href="a00097.html#a419267339dfc7093068db4eced13c349">mqtt3_config::user</a></div><div class="ttdeci">char * user</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00139">mosquitto_broker.h:139</a></div></div>
<div class="ttc" id="a00017_html_aa90c9af6612aaf612ecd5917989a423c"><div class="ttname"><a href="a00017.html#aa90c9af6612aaf612ecd5917989a423c">_mqtt3_listener::use_username_as_clientid</a></div><div class="ttdeci">bool use_username_as_clientid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00082">mosquitto_broker.h:82</a></div></div>
<div class="ttc" id="a00097_html_a2debc661bbf726e22a560f511a181979"><div class="ttname"><a href="a00097.html#a2debc661bbf726e22a560f511a181979">mqtt3_config::message_size_limit</a></div><div class="ttdeci">uint32_t message_size_limit</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00126">mosquitto_broker.h:126</a></div></div>
<div class="ttc" id="a00017_html_a60a8b4323b336b3033ebcf904716fe09"><div class="ttname"><a href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">_mqtt3_listener::socks</a></div><div class="ttdeci">mosq_sock_t * socks</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00078">mosquitto_broker.h:78</a></div></div>
<div class="ttc" id="a00097_html_acb2e0e6ffef06294f307d7b98ecde67d"><div class="ttname"><a href="a00097.html#acb2e0e6ffef06294f307d7b98ecde67d">mqtt3_config::auth_plugin</a></div><div class="ttdeci">char * auth_plugin</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00149">mosquitto_broker.h:149</a></div></div>
<div class="ttc" id="a00097_html"><div class="ttname"><a href="a00097.html">mqtt3_config</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00103">mosquitto_broker.h:103</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a532d3d5ac88981498b567e4c476bac49"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_config_parse_args </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00097.html">mqtt3_config</a> *&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00189_source.html#l00325">325</a> of file <a class="el" href="a00189_source.html">conf.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;{</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordtype">int</span> port_tmp;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">for</span>(i=1; i&lt;argc; i++){</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">&quot;-c&quot;</span>) || !strcmp(argv[i], <span class="stringliteral">&quot;--config-file&quot;</span>)){</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">if</span>(i&lt;argc-1){</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                config-&gt;<a class="code" href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">config_file</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(argv[i+1]);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">config_file</a>){</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="a00189.html#a900ac578c7d954a97e51ed424d02d6bb">mqtt3_config_read</a>(config, <span class="keyword">false</span>)){</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to open configuration file.&quot;</span>);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: -c argument given, but no config file specified.&quot;</span>);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            i++;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">&quot;-d&quot;</span>) || !strcmp(argv[i], <span class="stringliteral">&quot;--daemon&quot;</span>)){</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            config-&gt;<a class="code" href="a00097.html#af0a3f8e15bc452a14106e9043ff13b17">daemon</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">&quot;-h&quot;</span>) || !strcmp(argv[i], <span class="stringliteral">&quot;--help&quot;</span>)){</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <a class="code" href="a00139.html#aa1187b70998f73cdb598833d6afaa30a">print_usage</a>();</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">&quot;-p&quot;</span>) || !strcmp(argv[i], <span class="stringliteral">&quot;--port&quot;</span>)){</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">if</span>(i&lt;argc-1){</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                port_tmp = atoi(argv[i+1]);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                <span class="keywordflow">if</span>(port_tmp&lt;1 || port_tmp&gt;65535){</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Invalid port specified (%d).&quot;</span>, port_tmp);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a>){</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#af42b074947ad51304b224e61307ff523">MOSQ_LOG_WARNING</a>, <span class="stringliteral">&quot;Warning: Default listener port specified multiple times. Only the latest will be used.&quot;</span>);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a> = port_tmp;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: -p argument given, but no port specified.&quot;</span>);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            i++;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(argv[i], <span class="stringliteral">&quot;-v&quot;</span>) || !strcmp(argv[i], <span class="stringliteral">&quot;--verbose&quot;</span>)){</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            config-&gt;<a class="code" href="a00097.html#ac9e2bbf930885dc9be00b028cf4ece66">verbose</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            fprintf(stderr, <span class="stringliteral">&quot;Error: Unknown option &#39;%s&#39;.\n&quot;</span>,argv[i]);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <a class="code" href="a00139.html#aa1187b70998f73cdb598833d6afaa30a">print_usage</a>();</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        }</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a> == 0</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;#ifdef WITH_TLS</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.cafile</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.capath</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.certfile</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.keyfile</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.ciphers</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.psk_hint</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.require_certificate</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.crlfile</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.use_identity_as_username</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;#endif</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#aa90c9af6612aaf612ecd5917989a423c">use_username_as_clientid</a></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a802f0208ed0cc099a4e3cbaa5383b44e">max_connections</a> != -1</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">mount_point</a></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            || config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a7d78649594bccaac148977ebfbc7e367">protocol</a> != <a class="code" href="a00196.html#a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0">mp_mqtt</a>){</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>++;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a> = <a class="code" href="a00153.html#a60e49e66df31d85392b2000c75a088dd">_mosquitto_realloc</a>(config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00017.html">_mqtt3_listener</a>)*config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>){</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        memset(&amp;config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1], 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00017.html">_mqtt3_listener</a>));</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a>){</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a> = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a> = 1883;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a>){</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a> = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a> = NULL;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">mount_point</a>){</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">mount_point</a> = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">mount_point</a>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">mount_point</a> = NULL;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#a802f0208ed0cc099a4e3cbaa5383b44e">max_connections</a> = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a802f0208ed0cc099a4e3cbaa5383b44e">max_connections</a>;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#a7d78649594bccaac148977ebfbc7e367">protocol</a> = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#a7d78649594bccaac148977ebfbc7e367">protocol</a>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#ad5d4b8710a09924861317deac08472fb">client_count</a> = 0;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a> = NULL;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a> = 0;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#ad5d4b8710a09924861317deac08472fb">client_count</a> = 0;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].<a class="code" href="a00017.html#aa90c9af6612aaf612ecd5917989a423c">use_username_as_clientid</a> = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.<a class="code" href="a00017.html#aa90c9af6612aaf612ecd5917989a423c">use_username_as_clientid</a>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].tls_version = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.tls_version;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].cafile = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.cafile;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].capath = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.capath;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].certfile = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.certfile;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].keyfile = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.keyfile;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].ciphers = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.ciphers;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].psk_hint = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.psk_hint;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].require_certificate = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.require_certificate;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].ssl_ctx = NULL;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].crlfile = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.crlfile;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        config-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[config-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>-1].use_identity_as_username = config-&gt;<a class="code" href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">default_listener</a>.use_identity_as_username;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">/* Default to drop to mosquitto user if we are privileged and no user specified. */</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a>){</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a> = <span class="stringliteral">&quot;mosquitto&quot;</span>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ac9e2bbf930885dc9be00b028cf4ece66">verbose</a>){</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        config-&gt;<a class="code" href="a00097.html#ad3732c093fcc47811af63c25b259b008">log_type</a> = INT_MAX;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div><div class="ttc" id="a00097_html_ad3732c093fcc47811af63c25b259b008"><div class="ttname"><a href="a00097.html#ad3732c093fcc47811af63c25b259b008">mqtt3_config::log_type</a></div><div class="ttdeci">int log_type</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00122">mosquitto_broker.h:122</a></div></div>
<div class="ttc" id="a00017_html_aac74fcfd0ef8ab1775b8e8292b9a5b95"><div class="ttname"><a href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">_mqtt3_listener::sock_count</a></div><div class="ttdeci">int sock_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00079">mosquitto_broker.h:79</a></div></div>
<div class="ttc" id="a00017_html_a802f0208ed0cc099a4e3cbaa5383b44e"><div class="ttname"><a href="a00017.html#a802f0208ed0cc099a4e3cbaa5383b44e">_mqtt3_listener::max_connections</a></div><div class="ttdeci">int max_connections</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00076">mosquitto_broker.h:76</a></div></div>
<div class="ttc" id="a00097_html_a1e549eb6e0ee7d9dcce491f57616a07b"><div class="ttname"><a href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">mqtt3_config::config_file</a></div><div class="ttdeci">char * config_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00104">mosquitto_broker.h:104</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00017_html_ae260347bb57e825c09097bff30b69c88"><div class="ttname"><a href="a00017.html#ae260347bb57e825c09097bff30b69c88">_mqtt3_listener::port</a></div><div class="ttdeci">uint16_t port</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00075">mosquitto_broker.h:75</a></div></div>
<div class="ttc" id="a00097_html_aeabd210b57d1ddc66dad927c96d4a74d"><div class="ttname"><a href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">mqtt3_config::listener_count</a></div><div class="ttdeci">int listener_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00119">mosquitto_broker.h:119</a></div></div>
<div class="ttc" id="a00097_html_ae4138e4cbbcf7ceb8097672df20faf05"><div class="ttname"><a href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">mqtt3_config::listeners</a></div><div class="ttdeci">struct _mqtt3_listener * listeners</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00118">mosquitto_broker.h:118</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00017_html_a0a8cd1be8f3eb14461532b260c78d1a8"><div class="ttname"><a href="a00017.html#a0a8cd1be8f3eb14461532b260c78d1a8">_mqtt3_listener::mount_point</a></div><div class="ttdeci">char * mount_point</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00077">mosquitto_broker.h:77</a></div></div>
<div class="ttc" id="a00196_html_a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0"><div class="ttname"><a href="a00196.html#a2016ca244d8a59290552cd83840faa17aa08f4a487703e9644a5989a71ba6a5c0">mp_mqtt</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00065">mosquitto_broker.h:65</a></div></div>
<div class="ttc" id="a00097_html_ac9e2bbf930885dc9be00b028cf4ece66"><div class="ttname"><a href="a00097.html#ac9e2bbf930885dc9be00b028cf4ece66">mqtt3_config::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00140">mosquitto_broker.h:140</a></div></div>
<div class="ttc" id="a00189_html_a900ac578c7d954a97e51ed424d02d6bb"><div class="ttname"><a href="a00189.html#a900ac578c7d954a97e51ed424d02d6bb">mqtt3_config_read</a></div><div class="ttdeci">int mqtt3_config_read(struct mqtt3_config *config, bool reload)</div><div class="ttdef"><b>Definition:</b> <a href="a00189_source.html#l00452">conf.c:452</a></div></div>
<div class="ttc" id="a00097_html_af0a3f8e15bc452a14106e9043ff13b17"><div class="ttname"><a href="a00097.html#af0a3f8e15bc452a14106e9043ff13b17">mqtt3_config::daemon</a></div><div class="ttdeci">bool daemon</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00116">mosquitto_broker.h:116</a></div></div>
<div class="ttc" id="a00139_html_aa1187b70998f73cdb598833d6afaa30a"><div class="ttname"><a href="a00139.html#aa1187b70998f73cdb598833d6afaa30a">print_usage</a></div><div class="ttdeci">void print_usage(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00139_source.html#l00201">pub_client.c:201</a></div></div>
<div class="ttc" id="a00017_html"><div class="ttname"><a href="a00017.html">_mqtt3_listener</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00072">mosquitto_broker.h:72</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00017_html_ad5d4b8710a09924861317deac08472fb"><div class="ttname"><a href="a00017.html#ad5d4b8710a09924861317deac08472fb">_mqtt3_listener::client_count</a></div><div class="ttdeci">int client_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00080">mosquitto_broker.h:80</a></div></div>
<div class="ttc" id="a00017_html_a8f3e15dab6e5bae10bb2d930034f4d9f"><div class="ttname"><a href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">_mqtt3_listener::host</a></div><div class="ttdeci">char * host</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00074">mosquitto_broker.h:74</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00017_html_a7d78649594bccaac148977ebfbc7e367"><div class="ttname"><a href="a00017.html#a7d78649594bccaac148977ebfbc7e367">_mqtt3_listener::protocol</a></div><div class="ttdeci">enum mosquitto_protocol protocol</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00081">mosquitto_broker.h:81</a></div></div>
<div class="ttc" id="a00097_html_aaecab4a1b44858118a74b0dc42b92e29"><div class="ttname"><a href="a00097.html#aaecab4a1b44858118a74b0dc42b92e29">mqtt3_config::default_listener</a></div><div class="ttdeci">struct _mqtt3_listener default_listener</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00117">mosquitto_broker.h:117</a></div></div>
<div class="ttc" id="a00097_html_a419267339dfc7093068db4eced13c349"><div class="ttname"><a href="a00097.html#a419267339dfc7093068db4eced13c349">mqtt3_config::user</a></div><div class="ttdeci">char * user</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00139">mosquitto_broker.h:139</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00017_html_aa90c9af6612aaf612ecd5917989a423c"><div class="ttname"><a href="a00017.html#aa90c9af6612aaf612ecd5917989a423c">_mqtt3_listener::use_username_as_clientid</a></div><div class="ttdeci">bool use_username_as_clientid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00082">mosquitto_broker.h:82</a></div></div>
<div class="ttc" id="a00153_html_a60e49e66df31d85392b2000c75a088dd"><div class="ttname"><a href="a00153.html#a60e49e66df31d85392b2000c75a088dd">_mosquitto_realloc</a></div><div class="ttdeci">void * _mosquitto_realloc(void *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00091">memory_mosq.c:91</a></div></div>
<div class="ttc" id="a00017_html_a60a8b4323b336b3033ebcf904716fe09"><div class="ttname"><a href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">_mqtt3_listener::socks</a></div><div class="ttdeci">mosq_sock_t * socks</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00078">mosquitto_broker.h:78</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00159_html_af42b074947ad51304b224e61307ff523"><div class="ttname"><a href="a00159.html#af42b074947ad51304b224e61307ff523">MOSQ_LOG_WARNING</a></div><div class="ttdeci">#define MOSQ_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00056">mosquitto.h:56</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a532d3d5ac88981498b567e4c476bac49_cgraph.png" border="0" usemap="#a00196_a532d3d5ac88981498b567e4c476bac49_cgraph" alt=""/></div>
<map name="a00196_a532d3d5ac88981498b567e4c476bac49_cgraph" id="a00196_a532d3d5ac88981498b567e4c476bac49_cgraph">
<area shape="rect" id="node2" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="409,5,539,32"/>
<area shape="rect" id="node3" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="401,56,547,83"/>
<area shape="rect" id="node4" href="a00189.html#a900ac578c7d954a97e51ed424d02d6bb" title="mqtt3_config_read" alt="" coords="222,107,351,133"/>
<area shape="rect" id="node8" href="a00139.html#aa1187b70998f73cdb598833d6afaa30a" title="print_usage" alt="" coords="242,157,331,184"/>
<area shape="rect" id="node10" href="a00153.html#a60e49e66df31d85392b2000c75a088dd" title="_mosquitto_realloc" alt="" coords="221,208,352,235"/>
<area shape="rect" id="node5" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="417,107,531,133"/>
<area shape="rect" id="node6" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="409,157,539,184"/>
<area shape="rect" id="node7" href="a00191.html#a344e751637f964b69fff2a34f772001f" title="mqtt3_db_limits_set" alt="" coords="405,208,543,235"/>
<area shape="rect" id="node9" href="a00157.html#a6f2738a9105e0b1177ef0e0004b3a8de" title="mosquitto_lib_version" alt="" coords="400,259,548,285"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a900ac578c7d954a97e51ed424d02d6bb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_config_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00097.html">mqtt3_config</a> *&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00189_source.html#l00452">452</a> of file <a class="el" href="a00189_source.html">conf.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;{</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00029.html">config_recurse</a> cr;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordtype">int</span> lineno;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordtype">int</span> len;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    cr.<a class="code" href="a00029.html#a566e626fb1b3067f3db72c0a23586446">log_dest</a> = <a class="code" href="a00196.html#aaf28c51f4b3e3552a160950de938421d">MQTT3_LOG_NONE</a>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    cr.log_dest_set = 0;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    cr.log_type = <a class="code" href="a00159.html#a4e191905c0cbbb683ae5f5d3615cb66b">MOSQ_LOG_NONE</a>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    cr.log_type_set = 0;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    cr.max_inflight_messages = 20;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    cr.max_queued_messages = 100;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">config_file</a>) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span>(reload){</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="comment">/* Re-initialise appropriate config vars to default for reload. */</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        _config_init_reload(config);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    rc = _config_read_file(config, reload, config-&gt;<a class="code" href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">config_file</a>, &amp;cr, 0, &amp;lineno);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error found at %s:%d.&quot;</span>, config-&gt;<a class="code" href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">config_file</a>, lineno);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a93cbad1aadbb9472f12d92bd2b2935a4">persistence</a>){</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a2793765fb58b2a09682608fde9d62729">persistence_file</a>){</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            config-&gt;<a class="code" href="a00097.html#a2793765fb58b2a09682608fde9d62729">persistence_file</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(<span class="stringliteral">&quot;mosquitto.db&quot;</span>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a2793765fb58b2a09682608fde9d62729">persistence_file</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a>){</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a>);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a3c34a7f20a5af7b8cd66e27f84df18d5">persistence_location</a> &amp;&amp; strlen(config-&gt;<a class="code" href="a00097.html#a3c34a7f20a5af7b8cd66e27f84df18d5">persistence_location</a>)){</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            len = strlen(config-&gt;<a class="code" href="a00097.html#a3c34a7f20a5af7b8cd66e27f84df18d5">persistence_location</a>) + strlen(config-&gt;<a class="code" href="a00097.html#a2793765fb58b2a09682608fde9d62729">persistence_file</a>) + 1;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a> = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(len);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            snprintf(config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a>, len, <span class="stringliteral">&quot;%s%s&quot;</span>, config-&gt;<a class="code" href="a00097.html#a3c34a7f20a5af7b8cd66e27f84df18d5">persistence_location</a>, config-&gt;<a class="code" href="a00097.html#a2793765fb58b2a09682608fde9d62729">persistence_file</a>);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(config-&gt;<a class="code" href="a00097.html#a2793765fb58b2a09682608fde9d62729">persistence_file</a>);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">/* Default to drop to mosquitto user if no other user specified. This must</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">     * remain here even though it is covered in mqtt3_parse_args() because this</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">     * function may be called on its own. */</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a>){</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        config-&gt;<a class="code" href="a00097.html#a419267339dfc7093068db4eced13c349">user</a> = <span class="stringliteral">&quot;mosquitto&quot;</span>;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="a00191.html#a344e751637f964b69fff2a34f772001f">mqtt3_db_limits_set</a>(cr.max_inflight_messages, cr.max_queued_messages);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;config-&gt;bridge_count; i++){</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span>(!config-&gt;bridges[i].name || !config-&gt;bridges[i].addresses || !config-&gt;bridges[i].topic_count){</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Invalid bridge configuration.&quot;</span>);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="preprocessor">#ifdef REAL_WITH_TLS_PSK</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordflow">if</span>(config-&gt;bridges[i].tls_psk &amp;&amp; !config-&gt;bridges[i].tls_psk_identity){</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Invalid bridge configuration: missing bridge_identity.\n&quot;</span>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">if</span>(config-&gt;bridges[i].tls_psk_identity &amp;&amp; !config-&gt;bridges[i].tls_psk){</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Invalid bridge configuration: missing bridge_psk.\n&quot;</span>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">if</span>(cr.log_dest_set){</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        config-&gt;<a class="code" href="a00097.html#a86b6c8f306e5586f7a1b4dd51d31f03c">log_dest</a> = cr.log_dest;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#ac9e2bbf930885dc9be00b028cf4ece66">verbose</a>){</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        config-&gt;<a class="code" href="a00097.html#ad3732c093fcc47811af63c25b259b008">log_type</a> = INT_MAX;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(cr.log_type_set){</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        config-&gt;<a class="code" href="a00097.html#ad3732c093fcc47811af63c25b259b008">log_type</a> = cr.log_type;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;}</div><div class="ttc" id="a00097_html_ad3732c093fcc47811af63c25b259b008"><div class="ttname"><a href="a00097.html#ad3732c093fcc47811af63c25b259b008">mqtt3_config::log_type</a></div><div class="ttdeci">int log_type</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00122">mosquitto_broker.h:122</a></div></div>
<div class="ttc" id="a00097_html_a1e549eb6e0ee7d9dcce491f57616a07b"><div class="ttname"><a href="a00097.html#a1e549eb6e0ee7d9dcce491f57616a07b">mqtt3_config::config_file</a></div><div class="ttdeci">char * config_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00104">mosquitto_broker.h:104</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00097_html_a93b8a8cb4b6b2f919ab98d3716b35cb0"><div class="ttname"><a href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">mqtt3_config::persistence_filepath</a></div><div class="ttdeci">char * persistence_filepath</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00131">mosquitto_broker.h:131</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00097_html_ac9e2bbf930885dc9be00b028cf4ece66"><div class="ttname"><a href="a00097.html#ac9e2bbf930885dc9be00b028cf4ece66">mqtt3_config::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00140">mosquitto_broker.h:140</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00097_html_a86b6c8f306e5586f7a1b4dd51d31f03c"><div class="ttname"><a href="a00097.html#a86b6c8f306e5586f7a1b4dd51d31f03c">mqtt3_config::log_dest</a></div><div class="ttdeci">int log_dest</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00120">mosquitto_broker.h:120</a></div></div>
<div class="ttc" id="a00196_html_aaf28c51f4b3e3552a160950de938421d"><div class="ttname"><a href="a00196.html#aaf28c51f4b3e3552a160950de938421d">MQTT3_LOG_NONE</a></div><div class="ttdeci">#define MQTT3_LOG_NONE</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00054">mosquitto_broker.h:54</a></div></div>
<div class="ttc" id="a00029_html"><div class="ttname"><a href="a00029.html">config_recurse</a></div><div class="ttdef"><b>Definition:</b> <a href="a00189_source.html#l00048">conf.c:48</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00191_html_a344e751637f964b69fff2a34f772001f"><div class="ttname"><a href="a00191.html#a344e751637f964b69fff2a34f772001f">mqtt3_db_limits_set</a></div><div class="ttdeci">void mqtt3_db_limits_set(int inflight, int queued)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00936">database.c:936</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00097_html_a2793765fb58b2a09682608fde9d62729"><div class="ttname"><a href="a00097.html#a2793765fb58b2a09682608fde9d62729">mqtt3_config::persistence_file</a></div><div class="ttdeci">char * persistence_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00130">mosquitto_broker.h:130</a></div></div>
<div class="ttc" id="a00097_html_a419267339dfc7093068db4eced13c349"><div class="ttname"><a href="a00097.html#a419267339dfc7093068db4eced13c349">mqtt3_config::user</a></div><div class="ttdeci">char * user</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00139">mosquitto_broker.h:139</a></div></div>
<div class="ttc" id="a00159_html_a4e191905c0cbbb683ae5f5d3615cb66b"><div class="ttname"><a href="a00159.html#a4e191905c0cbbb683ae5f5d3615cb66b">MOSQ_LOG_NONE</a></div><div class="ttdeci">#define MOSQ_LOG_NONE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00053">mosquitto.h:53</a></div></div>
<div class="ttc" id="a00097_html_a3c34a7f20a5af7b8cd66e27f84df18d5"><div class="ttname"><a href="a00097.html#a3c34a7f20a5af7b8cd66e27f84df18d5">mqtt3_config::persistence_location</a></div><div class="ttdeci">char * persistence_location</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00129">mosquitto_broker.h:129</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00097_html_a93cbad1aadbb9472f12d92bd2b2935a4"><div class="ttname"><a href="a00097.html#a93cbad1aadbb9472f12d92bd2b2935a4">mqtt3_config::persistence</a></div><div class="ttdeci">bool persistence</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00128">mosquitto_broker.h:128</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00029_html_a566e626fb1b3067f3db72c0a23586446"><div class="ttname"><a href="a00029.html#a566e626fb1b3067f3db72c0a23586446">config_recurse::log_dest</a></div><div class="ttdeci">int log_dest</div><div class="ttdef"><b>Definition:</b> <a href="a00189_source.html#l00049">conf.c:49</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a900ac578c7d954a97e51ed424d02d6bb_cgraph.png" border="0" usemap="#a00196_a900ac578c7d954a97e51ed424d02d6bb_cgraph" alt=""/></div>
<map name="a00196_a900ac578c7d954a97e51ed424d02d6bb_cgraph" id="a00196_a900ac578c7d954a97e51ed424d02d6bb_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="183,5,329,32"/>
<area shape="rect" id="node3" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="191,56,321,83"/>
<area shape="rect" id="node4" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="199,107,313,133"/>
<area shape="rect" id="node5" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="191,157,321,184"/>
<area shape="rect" id="node6" href="a00191.html#a344e751637f964b69fff2a34f772001f" title="mqtt3_db_limits_set" alt="" coords="187,208,325,235"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac919bd8bbc017773fc9d75c098faaae0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_context_cleanup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>do_free</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00190_source.html#l00092">92</a> of file <a class="el" href="a00190_source.html">context.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;{</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00011.html">_mosquitto_packet</a> *packet;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *msg, *<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a> = NULL;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">password</a>){</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;<a class="code" href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">password</a>);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        context-&gt;<a class="code" href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">password</a> = NULL;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span>(context-&gt;bridge){</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;db-&gt;bridge_count; i++){</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordflow">if</span>(db-&gt;bridges[i] == context){</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                db-&gt;bridges[i] = NULL;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keywordflow">if</span>(context-&gt;bridge-&gt;local_clientid){</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;bridge-&gt;local_clientid);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            context-&gt;bridge-&gt;local_clientid = NULL;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span>(context-&gt;bridge-&gt;remote_username){</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            context-&gt;bridge-&gt;remote_username = NULL;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">if</span>(context-&gt;bridge-&gt;remote_password){</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            context-&gt;bridge-&gt;remote_password = NULL;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">if</span>(context-&gt;bridge-&gt;local_username){</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            context-&gt;bridge-&gt;local_username = NULL;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">if</span>(context-&gt;bridge-&gt;local_password){</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            context-&gt;bridge-&gt;local_password = NULL;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span>(context-&gt;bridge-&gt;local_clientid){</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            context-&gt;bridge-&gt;local_clientid = NULL;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb">_mosquitto_socket_close</a>(db, context);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span>((do_free || context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a>) &amp;&amp; db){</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <a class="code" href="a00196.html#a6f5d696cb546ec16f63ef7855b624fe0">mqtt3_subs_clean_session</a>(db, context);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <a class="code" href="a00191.html#aa62ed0d7c268d8756b3b91951d59bac2">mqtt3_db_messages_delete</a>(db, context);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>){</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a> = NULL;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="a00190.html#ae4b59315a689849d8f78a1361271acc5">mqtt3_context_send_will</a>(db, context);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>){</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        assert(db); <span class="comment">/* db can only be NULL here if the client hasn&#39;t sent a</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">                       CONNECT and hence wouldn&#39;t have an id. */</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="a00209.html#a3f83117e1108d63844a58d2d79c3b980">HASH_DELETE</a>(hh_id, db-&gt;<a class="code" href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">contexts_by_id</a>, context);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a> = NULL;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5">_mosquitto_packet_cleanup</a>(&amp;(context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>));</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">current_out_packet</a>){</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5">_mosquitto_packet_cleanup</a>(context-&gt;<a class="code" href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">current_out_packet</a>);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;<a class="code" href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">current_out_packet</a>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        context-&gt;<a class="code" href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">current_out_packet</a> = NULL;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">while</span>(context-&gt;<a class="code" href="a00086.html#a936d7da311a94014bfffc9719dda6ed4">out_packet</a>){</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5">_mosquitto_packet_cleanup</a>(context-&gt;<a class="code" href="a00086.html#a936d7da311a94014bfffc9719dda6ed4">out_packet</a>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        packet = context-&gt;<a class="code" href="a00086.html#a936d7da311a94014bfffc9719dda6ed4">out_packet</a>;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        context-&gt;<a class="code" href="a00086.html#a936d7da311a94014bfffc9719dda6ed4">out_packet</a> = context-&gt;<a class="code" href="a00086.html#a936d7da311a94014bfffc9719dda6ed4">out_packet</a>-&gt;<a class="code" href="a00011.html#a2d60d6ef9f616696d0eba4b470ea8893">next</a>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(packet);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">if</span>(do_free || context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a>){</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        msg = context-&gt;msgs;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">while</span>(msg){</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            next = msg-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <a class="code" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a>(db, &amp;msg-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(msg);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            msg = <a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        context-&gt;msgs = NULL;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        context-&gt;last_msg = NULL;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span>(do_free){</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="ttc" id="a00088_html_a3a37d2ec3ec40dbb0ee15332baf82b45"><div class="ttname"><a href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">mosquitto_client_msg::store</a></div><div class="ttdeci">struct mosquitto_msg_store * store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00195">mosquitto_broker.h:195</a></div></div>
<div class="ttc" id="a00086_html_a9f06cd82e88a5eaed9dfe8d83e52fb2e"><div class="ttname"><a href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">mosquitto::current_out_packet</a></div><div class="ttdeci">struct _mosquitto_packet * current_out_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00173">mosquitto_internal.h:173</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00011_html_a2d60d6ef9f616696d0eba4b470ea8893"><div class="ttname"><a href="a00011.html#a2d60d6ef9f616696d0eba4b470ea8893">_mosquitto_packet::next</a></div><div class="ttdeci">struct _mosquitto_packet * next</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00133">mosquitto_internal.h:133</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00086_html_ad0dd0827ca5d6aa033c36eb0ad447aa8"><div class="ttname"><a href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">mosquitto::password</a></div><div class="ttdeci">char * password</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00165">mosquitto_internal.h:165</a></div></div>
<div class="ttc" id="a00089_html_ac5b775be8b87233bb22f20b10bbac0bd"><div class="ttname"><a href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">mosquitto_db::contexts_by_id</a></div><div class="ttdeci">struct mosquitto * contexts_by_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00250">mosquitto_broker.h:250</a></div></div>
<div class="ttc" id="a00196_html_a6f5d696cb546ec16f63ef7855b624fe0"><div class="ttname"><a href="a00196.html#a6f5d696cb546ec16f63ef7855b624fe0">mqtt3_subs_clean_session</a></div><div class="ttdeci">int mqtt3_subs_clean_session(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00592">subs.c:592</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00086_html_ab9d8935077ef424c322233a19a9cbf5c"><div class="ttname"><a href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">mosquitto::clean_session</a></div><div class="ttdeci">bool clean_session</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00205">mosquitto_internal.h:205</a></div></div>
<div class="ttc" id="a00086_html_a962322fe14ee02b439cc236a85dab410"><div class="ttname"><a href="a00086.html#a962322fe14ee02b439cc236a85dab410">mosquitto::address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00162">mosquitto_internal.h:162</a></div></div>
<div class="ttc" id="a00162_html_a1f5ae38a1ad0ff58a7c7aba084282cb5"><div class="ttname"><a href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5">_mosquitto_packet_cleanup</a></div><div class="ttdeci">void _mosquitto_packet_cleanup(struct _mosquitto_packet *packet)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00136">net_mosq.c:136</a></div></div>
<div class="ttc" id="a00209_html_a3f83117e1108d63844a58d2d79c3b980"><div class="ttname"><a href="a00209.html#a3f83117e1108d63844a58d2d79c3b980">HASH_DELETE</a></div><div class="ttdeci">#define HASH_DELETE(hh, head, delptr)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00215">uthash.h:215</a></div></div>
<div class="ttc" id="a00086_html_a31ecd6b5e37dbd8ea64c179259561d0f"><div class="ttname"><a href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">mosquitto::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00164">mosquitto_internal.h:164</a></div></div>
<div class="ttc" id="a00191_html_af19cbc47cd971cdb22e9f48566bb3e68"><div class="ttname"><a href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a></div><div class="ttdeci">void mosquitto__db_msg_store_deref(struct mosquitto_db *db, struct mosquitto_msg_store **store)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00188">database.c:188</a></div></div>
<div class="ttc" id="a00191_html_aa62ed0d7c268d8756b3b91951d59bac2"><div class="ttname"><a href="a00191.html#aa62ed0d7c268d8756b3b91951d59bac2">mqtt3_db_messages_delete</a></div><div class="ttdeci">int mqtt3_db_messages_delete(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00486">database.c:486</a></div></div>
<div class="ttc" id="a00011_html"><div class="ttname"><a href="a00011.html">_mosquitto_packet</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00131">mosquitto_internal.h:131</a></div></div>
<div class="ttc" id="a00086_html_a936d7da311a94014bfffc9719dda6ed4"><div class="ttname"><a href="a00086.html#a936d7da311a94014bfffc9719dda6ed4">mosquitto::out_packet</a></div><div class="ttdeci">struct _mosquitto_packet * out_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00174">mosquitto_internal.h:174</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
<div class="ttc" id="a00190_html_ae4b59315a689849d8f78a1361271acc5"><div class="ttname"><a href="a00190.html#ae4b59315a689849d8f78a1361271acc5">mqtt3_context_send_will</a></div><div class="ttdeci">void mqtt3_context_send_will(struct mosquitto_db *db, struct mosquitto *ctxt)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00185">context.c:185</a></div></div>
<div class="ttc" id="a00162_html_af8fce1657e21306ca1e448b75774ccfb"><div class="ttname"><a href="a00162.html#af8fce1657e21306ca1e448b75774ccfb">_mosquitto_socket_close</a></div><div class="ttdeci">int _mosquitto_socket_close(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00210">net_mosq.c:210</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_ac919bd8bbc017773fc9d75c098faaae0_cgraph.png" border="0" usemap="#a00196_ac919bd8bbc017773fc9d75c098faaae0_cgraph" alt=""/></div>
<map name="a00196_ac919bd8bbc017773fc9d75c098faaae0_cgraph" id="a00196_ac919bd8bbc017773fc9d75c098faaae0_cgraph">
<area shape="rect" id="node2" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1385,508,1500,535"/>
<area shape="rect" id="node3" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="906,144,1077,171"/>
<area shape="rect" id="node8" href="a00196.html#a6f5d696cb546ec16f63ef7855b624fe0" title="mqtt3_subs_clean_session" alt="" coords="443,340,623,367"/>
<area shape="rect" id="node9" href="a00191.html#aa62ed0d7c268d8756b3b91951d59bac2" title="mqtt3_db_messages_delete" alt="" coords="671,391,856,417"/>
<area shape="rect" id="node10" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="904,466,1079,507"/>
<area shape="rect" id="node12" href="a00190.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="219,631,386,657"/>
<area shape="rect" id="node26" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="211,239,395,265"/>
<area shape="rect" id="node4" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1147,57,1309,98"/>
<area shape="rect" id="node5" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="1165,609,1291,636"/>
<area shape="rect" id="node6" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1147,122,1309,163"/>
<area shape="rect" id="node7" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1133,5,1323,32"/>
<area shape="rect" id="node11" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="1141,442,1315,483"/>
<area shape="rect" id="node13" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="691,913,836,940"/>
<area shape="rect" id="node22" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="443,594,622,635"/>
<area shape="rect" id="node14" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="919,1033,1064,1074"/>
<area shape="rect" id="node16" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="1155,913,1301,940"/>
<area shape="rect" id="node15" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="1129,1268,1327,1295"/>
<area shape="rect" id="node17" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="1377,1065,1508,1092"/>
<area shape="rect" id="node18" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="1165,1217,1291,1244"/>
<area shape="rect" id="node19" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="1191,1015,1265,1041"/>
<area shape="rect" id="node20" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="1378,1015,1507,1041"/>
<area shape="rect" id="node21" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="1167,1065,1289,1092"/>
<area shape="rect" id="node23" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="905,787,1077,813"/>
<area shape="rect" id="node25" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="671,559,856,585"/>
<area shape="rect" id="node24" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="1127,761,1329,788"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3807fa7a82234429efbb913a141f4eaf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_context_disconnect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00190_source.html#l00202">202</a> of file <a class="el" href="a00190_source.html">context.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;{</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="a00190.html#ae4b59315a689849d8f78a1361271acc5">mqtt3_context_send_will</a>(db, ctxt);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    ctxt-&gt;disconnect_t = time(NULL);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb">_mosquitto_socket_close</a>(db, ctxt);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div><div class="ttc" id="a00190_html_ae4b59315a689849d8f78a1361271acc5"><div class="ttname"><a href="a00190.html#ae4b59315a689849d8f78a1361271acc5">mqtt3_context_send_will</a></div><div class="ttdeci">void mqtt3_context_send_will(struct mosquitto_db *db, struct mosquitto *ctxt)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00185">context.c:185</a></div></div>
<div class="ttc" id="a00162_html_af8fce1657e21306ca1e448b75774ccfb"><div class="ttname"><a href="a00162.html#af8fce1657e21306ca1e448b75774ccfb">_mosquitto_socket_close</a></div><div class="ttdeci">int _mosquitto_socket_close(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00210">net_mosq.c:210</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a3807fa7a82234429efbb913a141f4eaf_cgraph.png" border="0" usemap="#a00196_a3807fa7a82234429efbb913a141f4eaf_cgraph" alt=""/></div>
<map name="a00196_a3807fa7a82234429efbb913a141f4eaf_cgraph" id="a00196_a3807fa7a82234429efbb913a141f4eaf_cgraph">
<area shape="rect" id="node2" href="a00190.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="228,789,395,816"/>
<area shape="rect" id="node20" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="905,921,1075,948"/>
<area shape="rect" id="node3" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="689,360,835,387"/>
<area shape="rect" id="node8" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1384,613,1499,640"/>
<area shape="rect" id="node14" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="443,655,621,697"/>
<area shape="rect" id="node4" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="917,226,1063,267"/>
<area shape="rect" id="node6" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="1153,360,1300,387"/>
<area shape="rect" id="node5" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="1127,5,1326,32"/>
<area shape="rect" id="node7" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="1376,157,1507,184"/>
<area shape="rect" id="node9" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="1164,259,1289,285"/>
<area shape="rect" id="node10" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="1189,208,1264,235"/>
<area shape="rect" id="node11" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="1377,208,1506,235"/>
<area shape="rect" id="node12" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="1166,157,1287,184"/>
<area shape="rect" id="node13" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="1163,731,1290,757"/>
<area shape="rect" id="node15" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="904,487,1076,513"/>
<area shape="rect" id="node17" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="669,663,855,689"/>
<area shape="rect" id="node16" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="1125,563,1328,589"/>
<area shape="rect" id="node18" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="903,689,1077,730"/>
<area shape="rect" id="node19" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="1139,665,1314,706"/>
<area shape="rect" id="node21" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1146,985,1307,1026"/>
<area shape="rect" id="node22" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1146,1050,1307,1091"/>
<area shape="rect" id="node23" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1131,933,1322,960"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5caa657eeafaaf5aaddf16d5c8d77773"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="a00086.html">mosquitto</a>* mqtt3_context_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a>&#160;</td>
          <td class="paramname"><em>sock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00190_source.html#l00028">28</a> of file <a class="el" href="a00190_source.html">context.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00086.html">mosquitto</a> *context;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="a00483.html#ac8d0c7ffaf90c43eaeaf251e3b0f3bdb">address</a>[1024];</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    context = <a class="code" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00086.html">mosquitto</a>));</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    </div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732a1ac025e41ce0956042188241aaa91c02">mosq_cs_new</a>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> = <a class="code" href="a00427.html#a7908f70ce5b165788133870c881f016a">sock</a>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    context-&gt;<a class="code" href="a00086.html#ae44f689954c4c9247d6f6b8f2791cd60">last_msg_in</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    context-&gt;<a class="code" href="a00086.html#a309a4bd6dda31c853a8198956bf08fb3">next_msg_out</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>() + 60;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    context-&gt;<a class="code" href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">keepalive</a> = 60; <span class="comment">/* Default to 60s */</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    context-&gt;disconnect_t = 0;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a> = NULL;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    context-&gt;<a class="code" href="a00086.html#ac51d22e18aab61d6cef627d58d8721ff">last_mid</a> = 0;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a> = NULL;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a> = NULL;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    context-&gt;<a class="code" href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">password</a> = NULL;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    context-&gt;listener = NULL;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    context-&gt;acl_list = NULL;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">/* is_bridge records whether this client is a bridge or not. This could be</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">     * done by looking at context-&gt;bridge for bridges that we create ourself,</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">     * but incoming bridges need some other way of being recorded. */</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    context-&gt;is_bridge = <span class="keyword">false</span>;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a20a0584aff8e49470954547d32d32028">payload</a> = NULL;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5">_mosquitto_packet_cleanup</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    context-&gt;<a class="code" href="a00086.html#a936d7da311a94014bfffc9719dda6ed4">out_packet</a> = NULL;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    context-&gt;<a class="code" href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">current_out_packet</a> = NULL;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a> = NULL;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)<a class="code" href="a00427.html#a7908f70ce5b165788133870c881f016a">sock</a> &gt;= 0){</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="a00196.html#a76632d665060f0325b7a5a639de9cc40">_mosquitto_socket_get_address</a>(<a class="code" href="a00427.html#a7908f70ce5b165788133870c881f016a">sock</a>, address, 1024)){</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(address);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">if</span>(!context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>){</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="comment">/* getpeername and inet_ntop failed and not a bridge */</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    context-&gt;bridge = NULL;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    context-&gt;msgs = NULL;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    context-&gt;last_msg = NULL;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    context-&gt;msg_count = 0;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    context-&gt;msg_count12 = 0;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    context-&gt;ssl = NULL;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> &gt;= 0){</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="a00209.html#aaf01358e257c8d838eb5e4b189f0c399">HASH_ADD</a>(hh_sock, db-&gt;<a class="code" href="a00089.html#acef8c251ec284f40de65517454659178">contexts_by_sock</a>, <a class="code" href="a00427.html#a7908f70ce5b165788133870c881f016a">sock</a>, <span class="keyword">sizeof</span>(context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a>), context);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">return</span> context;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="a00011_html_a20a0584aff8e49470954547d32d32028"><div class="ttname"><a href="a00011.html#a20a0584aff8e49470954547d32d32028">_mosquitto_packet::payload</a></div><div class="ttdeci">uint8_t * payload</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00132">mosquitto_internal.h:132</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732a1ac025e41ce0956042188241aaa91c02"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732a1ac025e41ce0956042188241aaa91c02">mosq_cs_new</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00093">mosquitto_internal.h:93</a></div></div>
<div class="ttc" id="a00086_html_a9f06cd82e88a5eaed9dfe8d83e52fb2e"><div class="ttname"><a href="a00086.html#a9f06cd82e88a5eaed9dfe8d83e52fb2e">mosquitto::current_out_packet</a></div><div class="ttdeci">struct _mosquitto_packet * current_out_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00173">mosquitto_internal.h:173</a></div></div>
<div class="ttc" id="a00089_html_acef8c251ec284f40de65517454659178"><div class="ttname"><a href="a00089.html#acef8c251ec284f40de65517454659178">mosquitto_db::contexts_by_sock</a></div><div class="ttdeci">struct mosquitto * contexts_by_sock</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00251">mosquitto_broker.h:251</a></div></div>
<div class="ttc" id="a00086_html_ac51d22e18aab61d6cef627d58d8721ff"><div class="ttname"><a href="a00086.html#ac51d22e18aab61d6cef627d58d8721ff">mosquitto::last_mid</a></div><div class="ttdeci">uint16_t last_mid</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00167">mosquitto_internal.h:167</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00086_html_ad0dd0827ca5d6aa033c36eb0ad447aa8"><div class="ttname"><a href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">mosquitto::password</a></div><div class="ttdeci">char * password</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00165">mosquitto_internal.h:165</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00086_html_ab9d8935077ef424c322233a19a9cbf5c"><div class="ttname"><a href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">mosquitto::clean_session</a></div><div class="ttdeci">bool clean_session</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00205">mosquitto_internal.h:205</a></div></div>
<div class="ttc" id="a00086_html_a962322fe14ee02b439cc236a85dab410"><div class="ttname"><a href="a00086.html#a962322fe14ee02b439cc236a85dab410">mosquitto::address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00162">mosquitto_internal.h:162</a></div></div>
<div class="ttc" id="a00427_html_a7908f70ce5b165788133870c881f016a"><div class="ttname"><a href="a00427.html#a7908f70ce5b165788133870c881f016a">01-connect-anon-denied.sock</a></div><div class="ttdeci">sock</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00021">01-connect-anon-denied.py:21</a></div></div>
<div class="ttc" id="a00162_html_a1f5ae38a1ad0ff58a7c7aba084282cb5"><div class="ttname"><a href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5">_mosquitto_packet_cleanup</a></div><div class="ttdeci">void _mosquitto_packet_cleanup(struct _mosquitto_packet *packet)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00136">net_mosq.c:136</a></div></div>
<div class="ttc" id="a00196_html_a76632d665060f0325b7a5a639de9cc40"><div class="ttname"><a href="a00196.html#a76632d665060f0325b7a5a639de9cc40">_mosquitto_socket_get_address</a></div><div class="ttdeci">int _mosquitto_socket_get_address(mosq_sock_t sock, char *buf, int len)</div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00514">net.c:514</a></div></div>
<div class="ttc" id="a00086_html_a1bba05196d3100d3aa3ea78b7aa0bd14"><div class="ttname"><a href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">mosquitto::keepalive</a></div><div class="ttdeci">uint16_t keepalive</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00166">mosquitto_internal.h:166</a></div></div>
<div class="ttc" id="a00086_html_a26a90a9bba5628b617203725c220aca5"><div class="ttname"><a href="a00086.html#a26a90a9bba5628b617203725c220aca5">mosquitto::state</a></div><div class="ttdeci">enum mosquitto_client_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00168">mosquitto_internal.h:168</a></div></div>
<div class="ttc" id="a00086_html_a31930c9d3d288fc2fdf253ccf01d10a3"><div class="ttname"><a href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">mosquitto::sock</a></div><div class="ttdeci">mosq_sock_t sock</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00154">mosquitto_internal.h:154</a></div></div>
<div class="ttc" id="a00086_html_a03bed0e0b9a2f3eeecc5f26a6c247448"><div class="ttname"><a href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">mosquitto::will</a></div><div class="ttdeci">struct mosquitto_message * will</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00175">mosquitto_internal.h:175</a></div></div>
<div class="ttc" id="a00086_html_a31ecd6b5e37dbd8ea64c179259561d0f"><div class="ttname"><a href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">mosquitto::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00164">mosquitto_internal.h:164</a></div></div>
<div class="ttc" id="a00177_html_a9fb48d8f8ce208443e2e7bae489770fe"><div class="ttname"><a href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a></div><div class="ttdeci">time_t mosquitto_time(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00177_source.html#l00052">time_mosq.c:52</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00086_html_ae44f689954c4c9247d6f6b8f2791cd60"><div class="ttname"><a href="a00086.html#ae44f689954c4c9247d6f6b8f2791cd60">mosquitto::last_msg_in</a></div><div class="ttdeci">time_t last_msg_in</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00169">mosquitto_internal.h:169</a></div></div>
<div class="ttc" id="a00086_html"><div class="ttname"><a href="a00086.html">mosquitto</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00153">mosquitto_internal.h:153</a></div></div>
<div class="ttc" id="a00153_html_a1ecbcb0ab8e51c000672d9d2bdf8172c"><div class="ttname"><a href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a></div><div class="ttdeci">void * _mosquitto_calloc(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00040">memory_mosq.c:40</a></div></div>
<div class="ttc" id="a00086_html_a309a4bd6dda31c853a8198956bf08fb3"><div class="ttname"><a href="a00086.html#a309a4bd6dda31c853a8198956bf08fb3">mosquitto::next_msg_out</a></div><div class="ttdeci">time_t next_msg_out</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00170">mosquitto_internal.h:170</a></div></div>
<div class="ttc" id="a00086_html_a936d7da311a94014bfffc9719dda6ed4"><div class="ttname"><a href="a00086.html#a936d7da311a94014bfffc9719dda6ed4">mosquitto::out_packet</a></div><div class="ttdeci">struct _mosquitto_packet * out_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00174">mosquitto_internal.h:174</a></div></div>
<div class="ttc" id="a00209_html_aaf01358e257c8d838eb5e4b189f0c399"><div class="ttname"><a href="a00209.html#aaf01358e257c8d838eb5e4b189f0c399">HASH_ADD</a></div><div class="ttdeci">#define HASH_ADD(hh, head, fieldname, keylen_in, add)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00160">uthash.h:160</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
<div class="ttc" id="a00483_html_ac8d0c7ffaf90c43eaeaf251e3b0f3bdb"><div class="ttname"><a href="a00483.html#ac8d0c7ffaf90c43eaeaf251e3b0f3bdb">06-bridge-b2br-disconnect-qos1.address</a></div><div class="ttdeci">address</div><div class="ttdef"><b>Definition:</b> <a href="a00256_source.html#l00047">06-bridge-b2br-disconnect-qos1.py:47</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a5caa657eeafaaf5aaddf16d5c8d77773_cgraph.png" border="0" usemap="#a00196_a5caa657eeafaaf5aaddf16d5c8d77773_cgraph" alt=""/></div>
<map name="a00196_a5caa657eeafaaf5aaddf16d5c8d77773_cgraph" id="a00196_a5caa657eeafaaf5aaddf16d5c8d77773_cgraph">
<area shape="rect" id="node2" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="211,5,338,32"/>
<area shape="rect" id="node3" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="219,56,330,83"/>
<area shape="rect" id="node4" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="183,107,367,133"/>
<area shape="rect" id="node5" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="415,132,529,159"/>
<area shape="rect" id="node6" href="a00196.html#a76632d665060f0325b7a5a639de9cc40" title="_mosquitto_socket_get\l_address" alt="" coords="196,209,353,250"/>
<area shape="rect" id="node7" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="210,275,339,301"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9017edc4b06c590c90dbcd13f14fbf21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_context_send_will </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00190_source.html#l00185">185</a> of file <a class="el" href="a00190_source.html">context.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;{</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span>(ctxt-&gt;state != <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a> &amp;&amp; ctxt-&gt;will){</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a>(db, ctxt, ctxt-&gt;will-&gt;topic, <a class="code" href="a00198.html#a8297ba287fb051c8890c2d27c692e389">MOSQ_ACL_WRITE</a>) == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="comment">/* Unexpected disconnect, queue the client will. */</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <a class="code" href="a00191.html#abe58c783467b8953116641c9a2eb81a9">mqtt3_db_messages_easy_queue</a>(db, ctxt, ctxt-&gt;will-&gt;topic, ctxt-&gt;will-&gt;qos, ctxt-&gt;will-&gt;payloadlen, ctxt-&gt;will-&gt;payload, ctxt-&gt;will-&gt;retain);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span>(ctxt-&gt;will){</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">if</span>(ctxt-&gt;will-&gt;topic) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(ctxt-&gt;will-&gt;topic);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">if</span>(ctxt-&gt;will-&gt;payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(ctxt-&gt;will-&gt;payload);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(ctxt-&gt;will);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        ctxt-&gt;will = NULL;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div><div class="ttc" id="a00191_html_abe58c783467b8953116641c9a2eb81a9"><div class="ttname"><a href="a00191.html#abe58c783467b8953116641c9a2eb81a9">mqtt3_db_messages_easy_queue</a></div><div class="ttdeci">int mqtt3_db_messages_easy_queue(struct mosquitto_db *db, struct mosquitto *context, const char *topic, int qos, uint32_t payloadlen, const void *payload, int retain)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00507">database.c:507</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00198_html_a8297ba287fb051c8890c2d27c692e389"><div class="ttname"><a href="a00198.html#a8297ba287fb051c8890c2d27c692e389">MOSQ_ACL_WRITE</a></div><div class="ttdeci">#define MOSQ_ACL_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="a00198_source.html#l00024">mosquitto_plugin.h:24</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00196_html_a6c132b4fe96e98b267516e77036cd409"><div class="ttname"><a href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a></div><div class="ttdeci">int mosquitto_acl_check(struct mosquitto_db *db, struct mosquitto *context, const char *topic, int access)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00218">security.c:218</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00095">mosquitto_internal.h:95</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a9017edc4b06c590c90dbcd13f14fbf21_cgraph.png" border="0" usemap="#a00196_a9017edc4b06c590c90dbcd13f14fbf21_cgraph" alt=""/></div>
<map name="a00196_a9017edc4b06c590c90dbcd13f14fbf21_cgraph" id="a00196_a9017edc4b06c590c90dbcd13f14fbf21_cgraph">
<area shape="rect" id="node2" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="467,267,612,293"/>
<area shape="rect" id="node7" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1161,639,1276,665"/>
<area shape="rect" id="node13" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="220,619,399,661"/>
<area shape="rect" id="node3" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="695,259,840,301"/>
<area shape="rect" id="node5" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="931,208,1077,235"/>
<area shape="rect" id="node4" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="905,157,1103,184"/>
<area shape="rect" id="node6" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="1153,385,1284,412"/>
<area shape="rect" id="node8" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="941,5,1067,32"/>
<area shape="rect" id="node9" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="967,411,1041,437"/>
<area shape="rect" id="node10" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="1154,284,1283,311"/>
<area shape="rect" id="node11" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="943,309,1065,336"/>
<area shape="rect" id="node12" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="941,107,1067,133"/>
<area shape="rect" id="node14" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="681,537,853,564"/>
<area shape="rect" id="node16" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="447,664,632,691"/>
<area shape="rect" id="node15" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="903,563,1105,589"/>
<area shape="rect" id="node17" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="680,739,855,781"/>
<area shape="rect" id="node18" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="917,715,1091,757"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afe01bca4333bfd05ae9626306ef3d7cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_close </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00126">126</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    subhier_clean(db, db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>.<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="a00191.html#af3cded7beb61e6c31048a7aa8ebadac2">mosquitto__db_msg_store_clean</a>(db);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00191_html_af3cded7beb61e6c31048a7aa8ebadac2"><div class="ttname"><a href="a00191.html#af3cded7beb61e6c31048a7aa8ebadac2">mosquitto__db_msg_store_clean</a></div><div class="ttdeci">void mosquitto__db_msg_store_clean(struct mosquitto_db *db)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00176">database.c:176</a></div></div>
<div class="ttc" id="a00012_html_a33db1bd6285c730939b53887cf9e2226"><div class="ttname"><a href="a00012.html#a33db1bd6285c730939b53887cf9e2226">_mosquitto_subhier::children</a></div><div class="ttdeci">struct _mosquitto_subhier * children</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00163">mosquitto_broker.h:163</a></div></div>
<div class="ttc" id="a00089_html_a2f96cc353b06a96922b1310c87327e0b"><div class="ttname"><a href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">mosquitto_db::subs</a></div><div class="ttdeci">struct _mosquitto_subhier subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00245">mosquitto_broker.h:245</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_afe01bca4333bfd05ae9626306ef3d7cf_cgraph.png" border="0" usemap="#a00196_afe01bca4333bfd05ae9626306ef3d7cf_cgraph" alt=""/></div>
<map name="a00196_afe01bca4333bfd05ae9626306ef3d7cf_cgraph" id="a00196_afe01bca4333bfd05ae9626306ef3d7cf_cgraph">
<area shape="rect" id="node2" href="a00191.html#af3cded7beb61e6c31048a7aa8ebadac2" title="mosquitto__db_msg_store\l_clean" alt="" coords="168,5,343,47"/>
<area shape="rect" id="node3" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="391,5,565,47"/>
<area shape="rect" id="node4" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="613,13,728,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a344e751637f964b69fff2a34f772001f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_db_limits_set </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inflight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>queued</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00936">936</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;{</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    max_inflight = inflight;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    max_queued = queued;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aee03621862afddaa10cfa01bcfa9f1a5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_count </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="afd644b64d7bc7a0f7a06688a3aca8e4f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>mid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84">mosquitto_msg_direction</a>&#160;</td>
          <td class="paramname"><em>dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00256">256</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;{</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *tail, *last = NULL;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordtype">int</span> msg_index = 0;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">bool</span> deleted = <span class="keyword">false</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    tail = context-&gt;msgs;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">while</span>(tail){</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        msg_index++;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> == <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a> &amp;&amp; msg_index &lt;= max_inflight){</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            tail-&gt;<a class="code" href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">timestamp</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a>){</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                <span class="keywordflow">switch</span>(tail-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>){</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a>;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> == 2){</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mid</a> == <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a> &amp;&amp; tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == dir){</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            msg_index--;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            _message_remove(db, context, &amp;tail, last);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            deleted = <span class="keyword">true</span>;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            last = tail;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">if</span>(msg_index &gt; max_inflight &amp;&amp; deleted){</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div><div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00082">mosquitto_internal.h:82</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a9b214e12e7bd4d2fa48273ad82554ac1"><div class="ttname"><a href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">mosquitto_client_msg::state</a></div><div class="ttdeci">enum mosquitto_msg_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00201">mosquitto_broker.h:201</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00088_html_a5b27db513724cdddca30cd56b0bb1208"><div class="ttname"><a href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mosquitto_client_msg::mid</a></div><div class="ttdeci">uint16_t mid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00197">mosquitto_broker.h:197</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00080">mosquitto_internal.h:80</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00085">mosquitto_internal.h:85</a></div></div>
<div class="ttc" id="a00160_html_a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032"><div class="ttname"><a href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00074">mosquitto_internal.h:74</a></div></div>
<div class="ttc" id="a00177_html_a9fb48d8f8ce208443e2e7bae489770fe"><div class="ttname"><a href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a></div><div class="ttdeci">time_t mosquitto_time(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00177_source.html#l00052">time_mosq.c:52</a></div></div>
<div class="ttc" id="a00088_html_a5b04e3d4a8ab404de8b432efabd1f583"><div class="ttname"><a href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">mosquitto_client_msg::timestamp</a></div><div class="ttdeci">time_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00196">mosquitto_broker.h:196</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00079">mosquitto_internal.h:79</a></div></div>
<div class="ttc" id="a00088_html_a323f6ea0b036b886cf7998e24d60c997"><div class="ttname"><a href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">mosquitto_client_msg::direction</a></div><div class="ttdeci">enum mosquitto_msg_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00200">mosquitto_broker.h:200</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00088_html_aeb7b0700522773bb8d21e0c0e0603f34"><div class="ttname"><a href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">mosquitto_client_msg::qos</a></div><div class="ttdeci">uint8_t qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00198">mosquitto_broker.h:198</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00089">mosquitto_internal.h:89</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_afd644b64d7bc7a0f7a06688a3aca8e4f_cgraph.png" border="0" usemap="#a00196_afd644b64d7bc7a0f7a06688a3aca8e4f_cgraph" alt=""/></div>
<map name="a00196_afd644b64d7bc7a0f7a06688a3aca8e4f_cgraph" id="a00196_afd644b64d7bc7a0f7a06688a3aca8e4f_cgraph">
<area shape="rect" id="node2" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="232,5,343,32"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a273c85b4bc9f22d097948f4021190bc8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_insert </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>mid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84">mosquitto_msg_direction</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>retain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00092.html">mosquitto_msg_store</a> *&#160;</td>
          <td class="paramname"><em>stored</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00303">303</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;{</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *msg;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keyword">enum</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8ea">mosquitto_msg_state</a> <a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaaa952562e8bb74c983d6dc8ea29c6c8ea">mosq_ms_invalid</a>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = 0;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordtype">char</span> **dest_ids;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    assert(stored);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span>(!context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>; <span class="comment">/* Protect against unlikely &quot;client is disconnected but not entirely freed&quot; scenario */</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">/* Check whether we&#39;ve already sent this message to this client</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">     * for outgoing messages only.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">     * If retain==true then this is a stale retained message and so should be</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">     * sent regardless. FIXME - this does mean retained messages will received</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">     * multiple times for overlapping subscriptions, although this is only the</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">     * case for SUBSCRIPTION with multiple subs in so is a minor concern.</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a9a66169a509cf8323028d4011d3eec16">allow_duplicate_messages</a> == <span class="keyword">false</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            &amp;&amp; dir == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a> &amp;&amp; <a class="code" href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">retain</a> == <span class="keyword">false</span> &amp;&amp; stored-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>){</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;stored-&gt;<a class="code" href="a00092.html#a1056110537a89222bc155371a223ae2d">dest_id_count</a>; i++){</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span>(!strcmp(stored-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>[i], context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>)){</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="comment">/* We have already sent this message to this client. */</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    }</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> == <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>){</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment">/* Client is not connected only queue messages with QoS&gt;0. */</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> == 0 &amp;&amp; !db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a22a46d21f367aee4cdf4de4196359b9c">queue_qos0_messages</a>){</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordflow">if</span>(!context-&gt;bridge){</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="keywordflow">if</span>(context-&gt;bridge-&gt;start_type != <a class="code" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431">bst_lazy</a>){</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> != <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>){</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> == 0 || max_inflight == 0 || context-&gt;msg_count12 &lt; max_inflight){</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">if</span>(dir == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a>){</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <span class="keywordflow">switch</span>(<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>){</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                        state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a>;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                        state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                    <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                        state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> == 2){</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                    state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(max_queued == 0 || context-&gt;msg_count12-max_inflight &lt; max_queued){</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            rc = 2;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="comment">/* Dropping message due to full queue. */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="keywordflow">if</span>(context-&gt;is_dropping == <span class="keyword">false</span>){</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                context-&gt;is_dropping = <span class="keyword">true</span>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>,</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                        <span class="stringliteral">&quot;Outgoing messages are being dropped for client %s.&quot;</span>,</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                        context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            }</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            g_msgs_dropped++;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">if</span>(max_queued &gt; 0 &amp;&amp; context-&gt;msg_count12 &gt;= max_queued){</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            g_msgs_dropped++;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">if</span>(context-&gt;is_dropping == <span class="keyword">false</span>){</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                context-&gt;is_dropping = <span class="keyword">true</span>;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>,</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                        <span class="stringliteral">&quot;Outgoing messages are being dropped for client %s.&quot;</span>,</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                        context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a>;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    assert(state != <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaaa952562e8bb74c983d6dc8ea29c6c8ea">mosq_ms_invalid</a>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span>(state == <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a>){</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        db-&gt;<a class="code" href="a00089.html#a85ea76e88408ef3a3c00129214782028">persistence_changes</a>++;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    msg = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00088.html">mosquitto_client_msg</a>));</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">if</span>(!msg) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    msg-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a> = NULL;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    msg-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a> = stored;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    msg-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#a693f049167450b7f65c23da58b4b0ff5">ref_count</a>++;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    msg-&gt;<a class="code" href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mid</a> = <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    msg-&gt;<a class="code" href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">timestamp</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    msg-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> = dir;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    msg-&gt;<a class="code" href="a00088.html#a700ce2e47ef2ebedcf9454ec6f9ddaba">dup</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    msg-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> = <a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    msg-&gt;<a class="code" href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">retain</a> = <a class="code" href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">retain</a>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span>(context-&gt;last_msg){</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        context-&gt;last_msg-&gt;next = msg;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        context-&gt;last_msg = msg;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        context-&gt;msgs = msg;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        context-&gt;last_msg = msg;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    context-&gt;msg_count++;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> &gt; 0){</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        context-&gt;msg_count12++;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a9a66169a509cf8323028d4011d3eec16">allow_duplicate_messages</a> == <span class="keyword">false</span> &amp;&amp; dir == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a> &amp;&amp; <a class="code" href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">retain</a> == <span class="keyword">false</span>){</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="comment">/* Record which client ids this message has been sent to so we can avoid duplicates.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">         * Outgoing messages only.</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">         * If retain==true then this is a stale retained message and so should be</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">         * sent regardless. FIXME - this does mean retained messages will received</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">         * multiple times for overlapping subscriptions, although this is only the</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">         * case for SUBSCRIPTION with multiple subs in so is a minor concern.</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        dest_ids = <a class="code" href="a00153.html#a60e49e66df31d85392b2000c75a088dd">_mosquitto_realloc</a>(stored-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *)*(stored-&gt;<a class="code" href="a00092.html#a1056110537a89222bc155371a223ae2d">dest_id_count</a>+1));</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span>(dest_ids){</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            stored-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a> = dest_ids;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            stored-&gt;<a class="code" href="a00092.html#a1056110537a89222bc155371a223ae2d">dest_id_count</a>++;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            stored-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>[stored-&gt;<a class="code" href="a00092.html#a1056110537a89222bc155371a223ae2d">dest_id_count</a>-1] = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="keywordflow">if</span>(!stored-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a>[stored-&gt;<a class="code" href="a00092.html#a1056110537a89222bc155371a223ae2d">dest_id_count</a>-1]){</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">if</span>(context-&gt;bridge &amp;&amp; context-&gt;bridge-&gt;start_type == <a class="code" href="a00196.html#a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431">bst_lazy</a></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            &amp;&amp; context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> == <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            &amp;&amp; context-&gt;msg_count &gt;= context-&gt;bridge-&gt;threshold){</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        context-&gt;bridge-&gt;lazy_reconnect = <span class="keyword">true</span>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor">#ifdef WITH_WEBSOCKETS</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span>(context-&gt;wsi &amp;&amp; rc == 0){</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00191.html#aee64ee8f7ce7e65f696aa1bbf5c0674c">mqtt3_db_message_write</a>(db, context);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div><div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00082">mosquitto_internal.h:82</a></div></div>
<div class="ttc" id="a00092_html_a693f049167450b7f65c23da58b4b0ff5"><div class="ttname"><a href="a00092.html#a693f049167450b7f65c23da58b4b0ff5">mosquitto_msg_store::ref_count</a></div><div class="ttdeci">int ref_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00183">mosquitto_broker.h:183</a></div></div>
<div class="ttc" id="a00191_html_aee64ee8f7ce7e65f696aa1bbf5c0674c"><div class="ttname"><a href="a00191.html#aee64ee8f7ce7e65f696aa1bbf5c0674c">mqtt3_db_message_write</a></div><div class="ttdeci">int mqtt3_db_message_write(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00810">database.c:810</a></div></div>
<div class="ttc" id="a00088_html_a700ce2e47ef2ebedcf9454ec6f9ddaba"><div class="ttname"><a href="a00088.html#a700ce2e47ef2ebedcf9454ec6f9ddaba">mosquitto_client_msg::dup</a></div><div class="ttdeci">bool dup</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00202">mosquitto_broker.h:202</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a9b214e12e7bd4d2fa48273ad82554ac1"><div class="ttname"><a href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">mosquitto_client_msg::state</a></div><div class="ttdeci">enum mosquitto_msg_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00201">mosquitto_broker.h:201</a></div></div>
<div class="ttc" id="a00088_html_a3a37d2ec3ec40dbb0ee15332baf82b45"><div class="ttname"><a href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">mosquitto_client_msg::store</a></div><div class="ttdeci">struct mosquitto_msg_store * store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00195">mosquitto_broker.h:195</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8ea"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8ea">mosquitto_msg_state</a></div><div class="ttdeci">mosquitto_msg_state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00077">mosquitto_internal.h:77</a></div></div>
<div class="ttc" id="a00088_html_a5b27db513724cdddca30cd56b0bb1208"><div class="ttname"><a href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mosquitto_client_msg::mid</a></div><div class="ttdeci">uint16_t mid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00197">mosquitto_broker.h:197</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00080">mosquitto_internal.h:80</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00163_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00045">net_mosq.h:45</a></div></div>
<div class="ttc" id="a00097_html_a22a46d21f367aee4cdf4de4196359b9c"><div class="ttname"><a href="a00097.html#a22a46d21f367aee4cdf4de4196359b9c">mqtt3_config::queue_qos0_messages</a></div><div class="ttdeci">bool queue_qos0_messages</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00135">mosquitto_broker.h:135</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00097_html_a9a66169a509cf8323028d4011d3eec16"><div class="ttname"><a href="a00097.html#a9a66169a509cf8323028d4011d3eec16">mqtt3_config::allow_duplicate_messages</a></div><div class="ttdeci">bool allow_duplicate_messages</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00107">mosquitto_broker.h:107</a></div></div>
<div class="ttc" id="a00159_html_a9813111aaf5eaafd2eaac66e1dc4659d"><div class="ttname"><a href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a></div><div class="ttdeci">#define MOSQ_LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00055">mosquitto.h:55</a></div></div>
<div class="ttc" id="a00086_html_a31930c9d3d288fc2fdf253ccf01d10a3"><div class="ttname"><a href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">mosquitto::sock</a></div><div class="ttdeci">mosq_sock_t sock</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00154">mosquitto_internal.h:154</a></div></div>
<div class="ttc" id="a00092_html_a1056110537a89222bc155371a223ae2d"><div class="ttname"><a href="a00092.html#a1056110537a89222bc155371a223ae2d">mosquitto_msg_store::dest_id_count</a></div><div class="ttdeci">int dest_id_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00182">mosquitto_broker.h:182</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00085">mosquitto_internal.h:85</a></div></div>
<div class="ttc" id="a00160_html_a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032"><div class="ttname"><a href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00074">mosquitto_internal.h:74</a></div></div>
<div class="ttc" id="a00088_html_aaf2d9b795432e04d07fbb18b23fd253e"><div class="ttname"><a href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">mosquitto_client_msg::retain</a></div><div class="ttdeci">bool retain</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00199">mosquitto_broker.h:199</a></div></div>
<div class="ttc" id="a00177_html_a9fb48d8f8ce208443e2e7bae489770fe"><div class="ttname"><a href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a></div><div class="ttdeci">time_t mosquitto_time(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00177_source.html#l00052">time_mosq.c:52</a></div></div>
<div class="ttc" id="a00092_html_a9a0bdf0801fb982110d423428a8701d9"><div class="ttname"><a href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">mosquitto_msg_store::dest_ids</a></div><div class="ttdeci">char ** dest_ids</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00181">mosquitto_broker.h:181</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00088_html_a5b04e3d4a8ab404de8b432efabd1f583"><div class="ttname"><a href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">mosquitto_client_msg::timestamp</a></div><div class="ttdeci">time_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00196">mosquitto_broker.h:196</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00079">mosquitto_internal.h:79</a></div></div>
<div class="ttc" id="a00088_html_a323f6ea0b036b886cf7998e24d60c997"><div class="ttname"><a href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">mosquitto_client_msg::direction</a></div><div class="ttdeci">enum mosquitto_msg_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00200">mosquitto_broker.h:200</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00153_html_a60e49e66df31d85392b2000c75a088dd"><div class="ttname"><a href="a00153.html#a60e49e66df31d85392b2000c75a088dd">_mosquitto_realloc</a></div><div class="ttdeci">void * _mosquitto_realloc(void *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00091">memory_mosq.c:91</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00089_html_a85ea76e88408ef3a3c00129214782028"><div class="ttname"><a href="a00089.html#a85ea76e88408ef3a3c00129214782028">mosquitto_db::persistence_changes</a></div><div class="ttdeci">int persistence_changes</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00264">mosquitto_broker.h:264</a></div></div>
<div class="ttc" id="a00088_html_aeb7b0700522773bb8d21e0c0e0603f34"><div class="ttname"><a href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">mosquitto_client_msg::qos</a></div><div class="ttdeci">uint8_t qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00198">mosquitto_broker.h:198</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaaa952562e8bb74c983d6dc8ea29c6c8ea"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaaa952562e8bb74c983d6dc8ea29c6c8ea">mosq_ms_invalid</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00078">mosquitto_internal.h:78</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00089">mosquitto_internal.h:89</a></div></div>
<div class="ttc" id="a00196_html_a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431"><div class="ttname"><a href="a00196.html#a31e03d23fb1912cb7983c4b123417e53ad977bb3a862549a41464534b54d61431">bst_lazy</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00281">mosquitto_broker.h:281</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a273c85b4bc9f22d097948f4021190bc8_cgraph.png" border="0" usemap="#a00196_a273c85b4bc9f22d097948f4021190bc8_cgraph" alt=""/></div>
<map name="a00196_a273c85b4bc9f22d097948f4021190bc8_cgraph" id="a00196_a273c85b4bc9f22d097948f4021190bc8_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="3169,1021,3315,1048"/>
<area shape="rect" id="node3" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2937,1781,3067,1808"/>
<area shape="rect" id="node4" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2444,584,2555,610"/>
<area shape="rect" id="node5" href="a00153.html#a60e49e66df31d85392b2000c75a088dd" title="_mosquitto_realloc" alt="" coords="2937,1984,3067,2010"/>
<area shape="rect" id="node6" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2937,1629,3067,1656"/>
<area shape="rect" id="node7" href="a00191.html#aee64ee8f7ce7e65f696aa1bbf5c0674c" title="mqtt3_db_message_write" alt="" coords="228,321,399,348"/>
<area shape="rect" id="node8" href="a00171.html#a7b111a5ceccb7bbc5fdadab085a33c03" title="_mosquitto_send_publish" alt="" coords="447,1680,616,1706"/>
<area shape="rect" id="node33" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630" title="_mosquitto_send_pubrec" alt="" coords="2919,565,3085,592"/>
<area shape="rect" id="node36" href="a00171.html#afbde2c162bd4b8e9fa52b0d45aa43b81" title="_mosquitto_send_pubrel" alt="" coords="2921,464,3083,490"/>
<area shape="rect" id="node38" href="a00171.html#aaeba60c4fd6e50c8f7f599246c6f91fb" title="_mosquitto_send_pubcomp" alt="" coords="2911,514,3093,541"/>
<area shape="rect" id="node9" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2903,1933,3101,1960"/>
<area shape="rect" id="node10" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="3389,1376,3503,1402"/>
<area shape="rect" id="node11" href="a00171.html#aec1dbc12b0482663fdfbc95c13124bf3" title="_mosquitto_send_real\l_publish" alt="" coords="664,1419,813,1460"/>
<area shape="rect" id="node12" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="3383,350,3509,377"/>
<area shape="rect" id="node13" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="861,797,1028,824"/>
<area shape="rect" id="node22" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1748,920,1923,946"/>
<area shape="rect" id="node47" href="a00162.html#a74c4a3cbe02bca478cb9621cca8191e8" title="_mosquitto_write_string" alt="" coords="865,1528,1025,1554"/>
<area shape="rect" id="node48" href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f" title="_mosquitto_write_uint16" alt="" coords="1090,1578,1253,1605"/>
<area shape="rect" id="node50" href="a00162.html#a307413f45257069e76295c70a6d899d8" title="_mosquitto_write_bytes" alt="" coords="1091,1502,1251,1529"/>
<area shape="rect" id="node14" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="1100,819,1243,860"/>
<area shape="rect" id="node15" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="1076,768,1267,794"/>
<area shape="rect" id="node16" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="2185,920,2356,946"/>
<area shape="rect" id="node20" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="1315,662,1485,689"/>
<area shape="rect" id="node17" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="2419,854,2580,895"/>
<area shape="rect" id="node18" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="2419,736,2580,778"/>
<area shape="rect" id="node19" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="2404,802,2595,829"/>
<area shape="rect" id="node21" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="1533,550,1700,591"/>
<area shape="rect" id="node23" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="1971,970,2137,997"/>
<area shape="rect" id="node24" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="2197,970,2344,997"/>
<area shape="rect" id="node25" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="2407,1426,2591,1453"/>
<area shape="rect" id="node26" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="2189,1072,2353,1098"/>
<area shape="rect" id="node27" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="2428,1198,2571,1225"/>
<area shape="rect" id="node28" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="2426,1072,2573,1098"/>
<area shape="rect" id="node46" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="2411,1021,2588,1048"/>
<area shape="rect" id="node29" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2659,920,2839,946"/>
<area shape="rect" id="node30" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2655,970,2842,997"/>
<area shape="rect" id="node31" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2643,1021,2855,1048"/>
<area shape="rect" id="node32" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2675,1426,2823,1453"/>
<area shape="rect" id="node35" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2660,768,2837,794"/>
<area shape="rect" id="node37" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2662,818,2835,845"/>
<area shape="rect" id="node39" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="2672,1376,2825,1402"/>
<area shape="rect" id="node40" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="2917,1122,3087,1149"/>
<area shape="rect" id="node41" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="2667,1578,2830,1605"/>
<area shape="rect" id="node42" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="2913,1072,3091,1098"/>
<area shape="rect" id="node43" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="2671,1882,2827,1909"/>
<area shape="rect" id="node44" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="2659,1173,2839,1200"/>
<area shape="rect" id="node45" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="2651,869,2846,896"/>
<area shape="rect" id="node34" href="a00171.html#a45df200bf3b771869380b69c143ed251" title="_mosquitto_send_command\l_with_mid" alt="" coords="3149,482,3335,523"/>
<area shape="rect" id="node49" href="a00162.html#adc64d22375628582aa20cb1f8e9435a3" title="_mosquitto_write_byte" alt="" coords="1323,1578,1477,1605"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0e9e6632cd5553fd9aa4529b6416447b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_reconnect_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00621">621</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;{</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *msg;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *prev = NULL;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordtype">int</span> count;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    msg = context-&gt;msgs;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    context-&gt;msg_count = 0;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    context-&gt;msg_count12 = 0;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">while</span>(msg){</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        context-&gt;last_msg = msg;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        context-&gt;msg_count++;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span>(msg-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> &gt; 0){</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            context-&gt;msg_count12++;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">if</span>(msg-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a>){</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">if</span>(msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> != <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a>){</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                <span class="keywordflow">switch</span>(msg-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>){</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                        msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                        msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                    <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        <span class="keywordflow">if</span>(msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> == <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184">mosq_ms_wait_for_pubcomp</a>){</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                            msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d">mosq_ms_resend_pubrel</a>;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                            msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a>;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                        }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">if</span>(msg-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> != 2){</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <span class="comment">/* Anything &lt;QoS 2 can be completely retried by the client at</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">                 * no harm. */</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                _message_remove(db, context, &amp;msg, prev);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                <span class="comment">/* Message state can be preserved here because it should match</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">                 * whatever the client has got. */</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        prev = msg;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">if</span>(msg) msg = msg-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">/* Messages received when the client was disconnected are put</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">     * in the mosq_ms_queued state. If we don&#39;t change them to the</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">     * appropriate &quot;publish&quot; state, then the queued messages won&#39;t</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">     * get sent until the client next receives a message - and they</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">     * will be sent out of order.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">if</span>(context-&gt;msgs){</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        count = 0;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        msg = context-&gt;msgs;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">while</span>(msg &amp;&amp; (max_inflight == 0 || count &lt; max_inflight)){</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <span class="keywordflow">if</span>(msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> == <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a>){</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                <span class="keywordflow">switch</span>(msg-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>){</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                        msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a>;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                        msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a>;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                    <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                        msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a>;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                }</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            }</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            msg = msg-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            count++;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    }</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;}</div><div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00082">mosquitto_internal.h:82</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a9b214e12e7bd4d2fa48273ad82554ac1"><div class="ttname"><a href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">mosquitto_client_msg::state</a></div><div class="ttdeci">enum mosquitto_msg_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00201">mosquitto_broker.h:201</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00080">mosquitto_internal.h:80</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184">mosq_ms_wait_for_pubcomp</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00087">mosquitto_internal.h:87</a></div></div>
<div class="ttc" id="a00160_html_a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032"><div class="ttname"><a href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00074">mosquitto_internal.h:74</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00079">mosquitto_internal.h:79</a></div></div>
<div class="ttc" id="a00088_html_a323f6ea0b036b886cf7998e24d60c997"><div class="ttname"><a href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">mosquitto_client_msg::direction</a></div><div class="ttdeci">enum mosquitto_msg_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00200">mosquitto_broker.h:200</a></div></div>
<div class="ttc" id="a00088_html_aeb7b0700522773bb8d21e0c0e0603f34"><div class="ttname"><a href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">mosquitto_client_msg::qos</a></div><div class="ttdeci">uint8_t qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00198">mosquitto_broker.h:198</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00089">mosquitto_internal.h:89</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d">mosq_ms_resend_pubrel</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00084">mosquitto_internal.h:84</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab17a596b2baedf8dace3f85db644b4ec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_release </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>mid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84">mosquitto_msg_direction</a>&#160;</td>
          <td class="paramname"><em>dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00743">743</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;{</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *tail, *last = NULL;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">retain</a>;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordtype">char</span> *topic;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordtype">char</span> *source_id;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordtype">int</span> msg_index = 0;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordtype">bool</span> deleted = <span class="keyword">false</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    tail = context-&gt;msgs;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">while</span>(tail){</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        msg_index++;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> == <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a> &amp;&amp; msg_index &lt;= max_inflight){</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            tail-&gt;<a class="code" href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">timestamp</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a>){</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                <span class="keywordflow">switch</span>(tail-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>){</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a>;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a>;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> == 2){</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                    <a class="code" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630">_mosquitto_send_pubrec</a>(context, tail-&gt;<a class="code" href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mid</a>);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                    tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            }</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mid</a> == <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a> &amp;&amp; tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == dir){</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            qos = tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#ad277fe117cd8e5f97fb043c00ca66964">qos</a>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            topic = tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            retain = tail-&gt;<a class="code" href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">retain</a>;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            source_id = tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <span class="comment">/* topic==NULL should be a QoS 2 message that was</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">             * denied/dropped and is being processed so the client doesn&#39;t</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">             * keep resending it. That means we don&#39;t send it to other</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">             * clients. */</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="keywordflow">if</span>(!topic || !<a class="code" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca">mqtt3_db_messages_queue</a>(db, source_id, topic, qos, retain, &amp;tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>)){</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                _message_remove(db, context, &amp;tail, last);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                deleted = <span class="keyword">true</span>;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            last = tail;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">if</span>(msg_index &gt; max_inflight &amp;&amp; deleted){</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">if</span>(deleted){</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    }</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;}</div><div class="ttc" id="a00092_html_ad277fe117cd8e5f97fb043c00ca66964"><div class="ttname"><a href="a00092.html#ad277fe117cd8e5f97fb043c00ca66964">mosquitto_msg_store::qos</a></div><div class="ttdeci">uint8_t qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00189">mosquitto_broker.h:189</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00082">mosquitto_internal.h:82</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a9b214e12e7bd4d2fa48273ad82554ac1"><div class="ttname"><a href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">mosquitto_client_msg::state</a></div><div class="ttdeci">enum mosquitto_msg_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00201">mosquitto_broker.h:201</a></div></div>
<div class="ttc" id="a00088_html_a3a37d2ec3ec40dbb0ee15332baf82b45"><div class="ttname"><a href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">mosquitto_client_msg::store</a></div><div class="ttdeci">struct mosquitto_msg_store * store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00195">mosquitto_broker.h:195</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00088_html_a5b27db513724cdddca30cd56b0bb1208"><div class="ttname"><a href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mosquitto_client_msg::mid</a></div><div class="ttdeci">uint16_t mid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00197">mosquitto_broker.h:197</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00080">mosquitto_internal.h:80</a></div></div>
<div class="ttc" id="a00171_html_a07fb7f8b0c76e21162abb92404ac8630"><div class="ttname"><a href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630">_mosquitto_send_pubrec</a></div><div class="ttdeci">int _mosquitto_send_pubrec(struct mosquitto *mosq, uint16_t mid)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00179">send_mosq.c:179</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00092_html_a63a59debb4a78b52c937c8e7129b214c"><div class="ttname"><a href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">mosquitto_msg_store::source_id</a></div><div class="ttdeci">char * source_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00180">mosquitto_broker.h:180</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00085">mosquitto_internal.h:85</a></div></div>
<div class="ttc" id="a00160_html_a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032"><div class="ttname"><a href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00074">mosquitto_internal.h:74</a></div></div>
<div class="ttc" id="a00088_html_aaf2d9b795432e04d07fbb18b23fd253e"><div class="ttname"><a href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">mosquitto_client_msg::retain</a></div><div class="ttdeci">bool retain</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00199">mosquitto_broker.h:199</a></div></div>
<div class="ttc" id="a00177_html_a9fb48d8f8ce208443e2e7bae489770fe"><div class="ttname"><a href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a></div><div class="ttdeci">time_t mosquitto_time(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00177_source.html#l00052">time_mosq.c:52</a></div></div>
<div class="ttc" id="a00092_html_a9f27c2318268a2034571e2bbe91f69c6"><div class="ttname"><a href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">mosquitto_msg_store::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00184">mosquitto_broker.h:184</a></div></div>
<div class="ttc" id="a00088_html_a5b04e3d4a8ab404de8b432efabd1f583"><div class="ttname"><a href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">mosquitto_client_msg::timestamp</a></div><div class="ttdeci">time_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00196">mosquitto_broker.h:196</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00079">mosquitto_internal.h:79</a></div></div>
<div class="ttc" id="a00088_html_a323f6ea0b036b886cf7998e24d60c997"><div class="ttname"><a href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">mosquitto_client_msg::direction</a></div><div class="ttdeci">enum mosquitto_msg_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00200">mosquitto_broker.h:200</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00088_html_aeb7b0700522773bb8d21e0c0e0603f34"><div class="ttname"><a href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">mosquitto_client_msg::qos</a></div><div class="ttdeci">uint8_t qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00198">mosquitto_broker.h:198</a></div></div>
<div class="ttc" id="a00196_html_a7a90d0b3b46b09f07e3fa99074e80eca"><div class="ttname"><a href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca">mqtt3_db_messages_queue</a></div><div class="ttdeci">int mqtt3_db_messages_queue(struct mosquitto_db *db, const char *source_id, const char *topic, int qos, int retain, struct mosquitto_msg_store **stored)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00507">subs.c:507</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00089">mosquitto_internal.h:89</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_ab17a596b2baedf8dace3f85db644b4ec_cgraph.png" border="0" usemap="#a00196_ab17a596b2baedf8dace3f85db644b4ec_cgraph" alt=""/></div>
<map name="a00196_ab17a596b2baedf8dace3f85db644b4ec_cgraph" id="a00196_ab17a596b2baedf8dace3f85db644b4ec_cgraph">
<area shape="rect" id="node2" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="3229,1153,3340,1180"/>
<area shape="rect" id="node3" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630" title="_mosquitto_send_pubrec" alt="" coords="239,1901,405,1928"/>
<area shape="rect" id="node36" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="2724,2627,2909,2653"/>
<area shape="rect" id="node4" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2987,853,3133,880"/>
<area shape="rect" id="node5" href="a00171.html#a45df200bf3b771869380b69c143ed251" title="_mosquitto_send_command\l_with_mid" alt="" coords="453,1814,639,1855"/>
<area shape="rect" id="node6" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2753,2323,2880,2349"/>
<area shape="rect" id="node7" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="687,1460,853,1487"/>
<area shape="rect" id="node13" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="3420,1917,3535,1944"/>
<area shape="rect" id="node18" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1573,1775,1748,1801"/>
<area shape="rect" id="node8" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="925,1394,1068,1435"/>
<area shape="rect" id="node9" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2995,1917,3125,1944"/>
<area shape="rect" id="node10" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="901,347,1092,373"/>
<area shape="rect" id="node11" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="2011,2003,2181,2029"/>
<area shape="rect" id="node16" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="1140,271,1311,297"/>
<area shape="rect" id="node12" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="2244,2054,2405,2095"/>
<area shape="rect" id="node14" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="2244,1937,2405,1978"/>
<area shape="rect" id="node15" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="2229,2003,2420,2029"/>
<area shape="rect" id="node17" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="1359,1163,1525,1205"/>
<area shape="rect" id="node19" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="1796,1749,1963,1776"/>
<area shape="rect" id="node20" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="2023,1031,2169,1057"/>
<area shape="rect" id="node21" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="2233,2221,2417,2248"/>
<area shape="rect" id="node22" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="2014,1461,2178,1488"/>
<area shape="rect" id="node23" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="2253,904,2396,931"/>
<area shape="rect" id="node24" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="2251,1461,2398,1488"/>
<area shape="rect" id="node48" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="2236,1157,2413,1184"/>
<area shape="rect" id="node25" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2475,828,2655,855"/>
<area shape="rect" id="node27" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2472,1005,2659,1032"/>
<area shape="rect" id="node32" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2711,1208,2923,1235"/>
<area shape="rect" id="node33" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2491,2424,2639,2451"/>
<area shape="rect" id="node39" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2728,1309,2905,1336"/>
<area shape="rect" id="node40" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2730,1360,2903,1387"/>
<area shape="rect" id="node41" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="2489,1943,2642,1969"/>
<area shape="rect" id="node42" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="2480,1107,2651,1133"/>
<area shape="rect" id="node43" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="2484,1740,2647,1767"/>
<area shape="rect" id="node44" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="2477,1613,2654,1640"/>
<area shape="rect" id="node45" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="2739,1715,2895,1741"/>
<area shape="rect" id="node46" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="2727,1512,2907,1539"/>
<area shape="rect" id="node47" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="2468,1157,2663,1184"/>
<area shape="rect" id="node26" href="a00171.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="2728,651,2905,677"/>
<area shape="rect" id="node28" href="a00169.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2711,1157,2923,1184"/>
<area shape="rect" id="node29" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="2980,1487,3140,1513"/>
<area shape="rect" id="node30" href="a00191.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="2971,1153,3149,1180"/>
<area shape="rect" id="node31" href="a00155.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="2987,1205,3133,1246"/>
<area shape="rect" id="node34" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="2738,1816,2895,1843"/>
<area shape="rect" id="node35" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2717,2424,2916,2451"/>
<area shape="rect" id="node37" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="2973,2402,3147,2443"/>
<area shape="rect" id="node38" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="3197,2409,3372,2450"/>
<area shape="rect" id="node49" href="a00164.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="2476,1512,2655,1539"/>
<area shape="rect" id="node50" href="a00166.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="2472,549,2659,576"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a36e4902f860237756538cc4a58e1321b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_store </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>source_mid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>payloadlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>retain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00092.html">mosquitto_msg_store</a> **&#160;</td>
          <td class="paramname"><em>stored</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00196.html#ac559238ed1772ef8840999d66b48b9c4">dbid_t</a>&#160;</td>
          <td class="paramname"><em>store_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00526">526</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;{</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00092.html">mosquitto_msg_store</a> *temp;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    assert(db);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    assert(stored);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    temp = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00092.html">mosquitto_msg_store</a>));</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span>(!temp) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    temp-&gt;<a class="code" href="a00092.html#a693f049167450b7f65c23da58b4b0ff5">ref_count</a> = 0;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">if</span>(source){</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(source);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span>(!temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>){</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    temp-&gt;<a class="code" href="a00092.html#adb2bdfafa23f89fd177aadfd42e78a51">source_mid</a> = <a class="code" href="a00092.html#adb2bdfafa23f89fd177aadfd42e78a51">source_mid</a>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    temp-&gt;<a class="code" href="a00092.html#a5d510bbc415f3e83ad2ff640ea98e93b">mid</a> = 0;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    temp-&gt;<a class="code" href="a00092.html#ad277fe117cd8e5f97fb043c00ca66964">qos</a> = <a class="code" href="a00092.html#ad277fe117cd8e5f97fb043c00ca66964">qos</a>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    temp-&gt;<a class="code" href="a00092.html#a2c3e7f1461c037f0d38c88f3bb3073fb">retain</a> = <a class="code" href="a00092.html#a2c3e7f1461c037f0d38c88f3bb3073fb">retain</a>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>){</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        temp-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">if</span>(!temp-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>){</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        temp-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a> = NULL;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    temp-&gt;<a class="code" href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">payloadlen</a> = <a class="code" href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">payloadlen</a>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">payloadlen</a>){</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a> = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*<a class="code" href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">payloadlen</a>);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span>(!temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>){</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="keywordflow">if</span>(temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <span class="keywordflow">if</span>(temp-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="keywordflow">if</span>(temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        }</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        memcpy(temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>, <a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*<a class="code" href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">payloadlen</a>);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a> = NULL;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    }</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span>(!temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a> || (<a class="code" href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">payloadlen</a> &amp;&amp; !temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>)){</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">if</span>(temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp-&gt;<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">if</span>(temp-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">if</span>(temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(temp);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    temp-&gt;<a class="code" href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">dest_ids</a> = NULL;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    temp-&gt;<a class="code" href="a00092.html#a1056110537a89222bc155371a223ae2d">dest_id_count</a> = 0;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    db-&gt;<a class="code" href="a00089.html#a9dbd28cac7509625e45df1563df9230a">msg_store_count</a>++;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    (*stored) = temp;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span>(!store_id){</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        temp-&gt;<a class="code" href="a00092.html#ac5b098725701e2c7018775e5cd9eb1cc">db_id</a> = ++db-&gt;<a class="code" href="a00089.html#a411d3ba9bf064853c3f89d606dc456be">last_db_id</a>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        temp-&gt;<a class="code" href="a00092.html#ac5b098725701e2c7018775e5cd9eb1cc">db_id</a> = store_id;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <a class="code" href="a00191.html#a838cff02f4134c5c060e16009cc7254c">mosquitto__db_msg_store_add</a>(db, temp);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div><div class="ttc" id="a00191_html_a838cff02f4134c5c060e16009cc7254c"><div class="ttname"><a href="a00191.html#a838cff02f4134c5c060e16009cc7254c">mosquitto__db_msg_store_add</a></div><div class="ttdeci">void mosquitto__db_msg_store_add(struct mosquitto_db *db, struct mosquitto_msg_store *store)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00135">database.c:135</a></div></div>
<div class="ttc" id="a00092_html_ad277fe117cd8e5f97fb043c00ca66964"><div class="ttname"><a href="a00092.html#ad277fe117cd8e5f97fb043c00ca66964">mosquitto_msg_store::qos</a></div><div class="ttdeci">uint8_t qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00189">mosquitto_broker.h:189</a></div></div>
<div class="ttc" id="a00092_html_a693f049167450b7f65c23da58b4b0ff5"><div class="ttname"><a href="a00092.html#a693f049167450b7f65c23da58b4b0ff5">mosquitto_msg_store::ref_count</a></div><div class="ttdeci">int ref_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00183">mosquitto_broker.h:183</a></div></div>
<div class="ttc" id="a00092_html_a5d510bbc415f3e83ad2ff640ea98e93b"><div class="ttname"><a href="a00092.html#a5d510bbc415f3e83ad2ff640ea98e93b">mosquitto_msg_store::mid</a></div><div class="ttdeci">uint16_t mid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00188">mosquitto_broker.h:188</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00092_html_a63a59debb4a78b52c937c8e7129b214c"><div class="ttname"><a href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">mosquitto_msg_store::source_id</a></div><div class="ttdeci">char * source_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00180">mosquitto_broker.h:180</a></div></div>
<div class="ttc" id="a00092_html_ad9f78d099469a4300ca282d895855f72"><div class="ttname"><a href="a00092.html#ad9f78d099469a4300ca282d895855f72">mosquitto_msg_store::payload</a></div><div class="ttdeci">void * payload</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00185">mosquitto_broker.h:185</a></div></div>
<div class="ttc" id="a00092_html_a1056110537a89222bc155371a223ae2d"><div class="ttname"><a href="a00092.html#a1056110537a89222bc155371a223ae2d">mosquitto_msg_store::dest_id_count</a></div><div class="ttdeci">int dest_id_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00182">mosquitto_broker.h:182</a></div></div>
<div class="ttc" id="a00092_html_a64d3652d6f85f1eb574f7b2c2df45306"><div class="ttname"><a href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">mosquitto_msg_store::payloadlen</a></div><div class="ttdeci">uint32_t payloadlen</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00186">mosquitto_broker.h:186</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00092_html_a9a0bdf0801fb982110d423428a8701d9"><div class="ttname"><a href="a00092.html#a9a0bdf0801fb982110d423428a8701d9">mosquitto_msg_store::dest_ids</a></div><div class="ttdeci">char ** dest_ids</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00181">mosquitto_broker.h:181</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00092_html_a9f27c2318268a2034571e2bbe91f69c6"><div class="ttname"><a href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">mosquitto_msg_store::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00184">mosquitto_broker.h:184</a></div></div>
<div class="ttc" id="a00092_html_a2c3e7f1461c037f0d38c88f3bb3073fb"><div class="ttname"><a href="a00092.html#a2c3e7f1461c037f0d38c88f3bb3073fb">mosquitto_msg_store::retain</a></div><div class="ttdeci">bool retain</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00190">mosquitto_broker.h:190</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00089_html_a411d3ba9bf064853c3f89d606dc456be"><div class="ttname"><a href="a00089.html#a411d3ba9bf064853c3f89d606dc456be">mosquitto_db::last_db_id</a></div><div class="ttdeci">dbid_t last_db_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00244">mosquitto_broker.h:244</a></div></div>
<div class="ttc" id="a00092_html"><div class="ttname"><a href="a00092.html">mosquitto_msg_store</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00176">mosquitto_broker.h:176</a></div></div>
<div class="ttc" id="a00089_html_a9dbd28cac7509625e45df1563df9230a"><div class="ttname"><a href="a00089.html#a9dbd28cac7509625e45df1563df9230a">mosquitto_db::msg_store_count</a></div><div class="ttdeci">int msg_store_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00262">mosquitto_broker.h:262</a></div></div>
<div class="ttc" id="a00092_html_adb2bdfafa23f89fd177aadfd42e78a51"><div class="ttname"><a href="a00092.html#adb2bdfafa23f89fd177aadfd42e78a51">mosquitto_msg_store::source_mid</a></div><div class="ttdeci">uint16_t source_mid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00187">mosquitto_broker.h:187</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00092_html_ac5b098725701e2c7018775e5cd9eb1cc"><div class="ttname"><a href="a00092.html#ac5b098725701e2c7018775e5cd9eb1cc">mosquitto_msg_store::db_id</a></div><div class="ttdeci">dbid_t db_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00179">mosquitto_broker.h:179</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a36e4902f860237756538cc4a58e1321b_cgraph.png" border="0" usemap="#a00196_a36e4902f860237756538cc4a58e1321b_cgraph" alt=""/></div>
<map name="a00196_a36e4902f860237756538cc4a58e1321b_cgraph" id="a00196_a36e4902f860237756538cc4a58e1321b_cgraph">
<area shape="rect" id="node2" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="261,5,392,32"/>
<area shape="rect" id="node3" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="262,56,391,83"/>
<area shape="rect" id="node4" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="269,107,384,133"/>
<area shape="rect" id="node5" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="253,157,400,184"/>
<area shape="rect" id="node6" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="225,208,428,235"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a69b7b5c13ef8ca9d3968a208b3cbb7f6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_store_find </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>mid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00092.html">mosquitto_msg_store</a> **&#160;</td>
          <td class="paramname"><em>stored</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00600">600</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;{</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *tail;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    *stored = NULL;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    tail = context-&gt;msgs;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">while</span>(tail){</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#adb2bdfafa23f89fd177aadfd42e78a51">source_mid</a> == <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a> &amp;&amp; tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020">mosq_md_in</a>){</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            *stored = tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a3a37d2ec3ec40dbb0ee15332baf82b45"><div class="ttname"><a href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">mosquitto_client_msg::store</a></div><div class="ttdeci">struct mosquitto_msg_store * store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00195">mosquitto_broker.h:195</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00088_html_a323f6ea0b036b886cf7998e24d60c997"><div class="ttname"><a href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">mosquitto_client_msg::direction</a></div><div class="ttdeci">enum mosquitto_msg_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00200">mosquitto_broker.h:200</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00160_html_a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020"><div class="ttname"><a href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020">mosq_md_in</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00073">mosquitto_internal.h:73</a></div></div>
<div class="ttc" id="a00092_html_adb2bdfafa23f89fd177aadfd42e78a51"><div class="ttname"><a href="a00092.html#adb2bdfafa23f89fd177aadfd42e78a51">mosquitto_msg_store::source_mid</a></div><div class="ttdeci">uint16_t source_mid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00187">mosquitto_broker.h:187</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a60d56ad7041c6e40c30db6a71c03f7e8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_timeout_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00700">700</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;{</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    time_t threshold;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keyword">enum</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8ea">mosquitto_msg_state</a> new_state;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00086.html">mosquitto</a> *context, *ctxt_tmp;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *msg;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    threshold = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>() - timeout;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <a class="code" href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a>(hh_sock, db-&gt;<a class="code" href="a00089.html#acef8c251ec284f40de65517454659178">contexts_by_sock</a>, context, ctxt_tmp){</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        msg = context-&gt;msgs;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">while</span>(msg){</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            new_state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaaa952562e8bb74c983d6dc8ea29c6c8ea">mosq_ms_invalid</a>;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordflow">if</span>(msg-&gt;<a class="code" href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">timestamp</a> &lt; threshold &amp;&amp; msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> != <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a>){</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                <span class="keywordflow">switch</span>(msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a>){</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09b9e20061bc7bcb6ccdb11d33a633b2">mosq_ms_wait_for_puback</a>:</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                        new_state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a>;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa50c490e549790b996a085de91546db6c">mosq_ms_wait_for_pubrec</a>:</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                        new_state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a>:</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                        new_state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa7834baa2a689dc7137952b02cfbf5d61">mosq_ms_send_pubrec</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184">mosq_ms_wait_for_pubcomp</a>:</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                        new_state = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d">mosq_ms_resend_pubrel</a>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                <span class="keywordflow">if</span>(new_state != <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaaa952562e8bb74c983d6dc8ea29c6c8ea">mosq_ms_invalid</a>){</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                    msg-&gt;<a class="code" href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">timestamp</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                    msg-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = new_state;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                    msg-&gt;<a class="code" href="a00088.html#a700ce2e47ef2ebedcf9454ec6f9ddaba">dup</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            msg = msg-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;}</div><div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa7834baa2a689dc7137952b02cfbf5d61"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa7834baa2a689dc7137952b02cfbf5d61">mosq_ms_send_pubrec</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00088">mosquitto_internal.h:88</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa50c490e549790b996a085de91546db6c"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa50c490e549790b996a085de91546db6c">mosq_ms_wait_for_pubrec</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00083">mosquitto_internal.h:83</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00082">mosquitto_internal.h:82</a></div></div>
<div class="ttc" id="a00209_html_a4d524042f1fcb976d8bccae9e4cc63d6"><div class="ttname"><a href="a00209.html#a4d524042f1fcb976d8bccae9e4cc63d6">HASH_ITER</a></div><div class="ttdeci">#define HASH_ITER(hh, head, el, tmp)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00871">uthash.h:871</a></div></div>
<div class="ttc" id="a00088_html_a700ce2e47ef2ebedcf9454ec6f9ddaba"><div class="ttname"><a href="a00088.html#a700ce2e47ef2ebedcf9454ec6f9ddaba">mosquitto_client_msg::dup</a></div><div class="ttdeci">bool dup</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00202">mosquitto_broker.h:202</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a9b214e12e7bd4d2fa48273ad82554ac1"><div class="ttname"><a href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">mosquitto_client_msg::state</a></div><div class="ttdeci">enum mosquitto_msg_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00201">mosquitto_broker.h:201</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00089_html_acef8c251ec284f40de65517454659178"><div class="ttname"><a href="a00089.html#acef8c251ec284f40de65517454659178">mosquitto_db::contexts_by_sock</a></div><div class="ttdeci">struct mosquitto * contexts_by_sock</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00251">mosquitto_broker.h:251</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8ea"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8ea">mosquitto_msg_state</a></div><div class="ttdeci">mosquitto_msg_state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00077">mosquitto_internal.h:77</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00080">mosquitto_internal.h:80</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184">mosq_ms_wait_for_pubcomp</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00087">mosquitto_internal.h:87</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00085">mosquitto_internal.h:85</a></div></div>
<div class="ttc" id="a00177_html_a9fb48d8f8ce208443e2e7bae489770fe"><div class="ttname"><a href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a></div><div class="ttdeci">time_t mosquitto_time(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00177_source.html#l00052">time_mosq.c:52</a></div></div>
<div class="ttc" id="a00088_html_a5b04e3d4a8ab404de8b432efabd1f583"><div class="ttname"><a href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">mosquitto_client_msg::timestamp</a></div><div class="ttdeci">time_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00196">mosquitto_broker.h:196</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa09b9e20061bc7bcb6ccdb11d33a633b2"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09b9e20061bc7bcb6ccdb11d33a633b2">mosq_ms_wait_for_puback</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00081">mosquitto_internal.h:81</a></div></div>
<div class="ttc" id="a00086_html"><div class="ttname"><a href="a00086.html">mosquitto</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00153">mosquitto_internal.h:153</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaaa952562e8bb74c983d6dc8ea29c6c8ea"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaaa952562e8bb74c983d6dc8ea29c6c8ea">mosq_ms_invalid</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00078">mosquitto_internal.h:78</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00089">mosquitto_internal.h:89</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d">mosq_ms_resend_pubrel</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00084">mosquitto_internal.h:84</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a60d56ad7041c6e40c30db6a71c03f7e8_cgraph.png" border="0" usemap="#a00196_a60d56ad7041c6e40c30db6a71c03f7e8_cgraph" alt=""/></div>
<map name="a00196_a60d56ad7041c6e40c30db6a71c03f7e8_cgraph" id="a00196_a60d56ad7041c6e40c30db6a71c03f7e8_cgraph">
<area shape="rect" id="node2" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="240,13,351,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a89e1a33a5ba53721bbb006eb9ff6c048"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>mid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84">mosquitto_msg_direction</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8ea">mosquitto_msg_state</a>&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00470">470</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;{</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *tail;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    tail = context-&gt;msgs;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">while</span>(tail){</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mid</a> == <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a> &amp;&amp; tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == dir){</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a>;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            tail-&gt;<a class="code" href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">timestamp</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a2bc2f56777d402b0d6b80d522efd9a49">MOSQ_ERR_NOT_FOUND</a>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a9b214e12e7bd4d2fa48273ad82554ac1"><div class="ttname"><a href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">mosquitto_client_msg::state</a></div><div class="ttdeci">enum mosquitto_msg_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00201">mosquitto_broker.h:201</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00088_html_a5b27db513724cdddca30cd56b0bb1208"><div class="ttname"><a href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mosquitto_client_msg::mid</a></div><div class="ttdeci">uint16_t mid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00197">mosquitto_broker.h:197</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00177_html_a9fb48d8f8ce208443e2e7bae489770fe"><div class="ttname"><a href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a></div><div class="ttdeci">time_t mosquitto_time(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00177_source.html#l00052">time_mosq.c:52</a></div></div>
<div class="ttc" id="a00088_html_a5b04e3d4a8ab404de8b432efabd1f583"><div class="ttname"><a href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">mosquitto_client_msg::timestamp</a></div><div class="ttdeci">time_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00196">mosquitto_broker.h:196</a></div></div>
<div class="ttc" id="a00088_html_a323f6ea0b036b886cf7998e24d60c997"><div class="ttname"><a href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">mosquitto_client_msg::direction</a></div><div class="ttdeci">enum mosquitto_msg_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00200">mosquitto_broker.h:200</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a2bc2f56777d402b0d6b80d522efd9a49"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a2bc2f56777d402b0d6b80d522efd9a49">MOSQ_ERR_NOT_FOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00073">mosquitto.h:73</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a89e1a33a5ba53721bbb006eb9ff6c048_cgraph.png" border="0" usemap="#a00196_a89e1a33a5ba53721bbb006eb9ff6c048_cgraph" alt=""/></div>
<map name="a00196_a89e1a33a5ba53721bbb006eb9ff6c048_cgraph" id="a00196_a89e1a33a5ba53721bbb006eb9ff6c048_cgraph">
<area shape="rect" id="node2" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="236,5,347,32"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aee64ee8f7ce7e65f696aa1bbf5c0674c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_message_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00810">810</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;{</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *tail, *last = NULL;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    uint16_t <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a>;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordtype">int</span> retries;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">retain</a>;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *topic;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    uint32_t payloadlen;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">void</span> *payload;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00140.html#aeb7ee0c9b71cf3bd38611412ae15f337">msg_count</a> = 0;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">if</span>(!context || context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> == <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            || (context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> == <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d">mosq_cs_connected</a> &amp;&amp; !context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>)){</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    }</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> != <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d">mosq_cs_connected</a>){</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    }</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    tail = context-&gt;msgs;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">while</span>(tail){</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020">mosq_md_in</a>){</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            msg_count++;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        }</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> != <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a>){</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            mid = tail-&gt;<a class="code" href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mid</a>;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            retries = tail-&gt;<a class="code" href="a00088.html#a700ce2e47ef2ebedcf9454ec6f9ddaba">dup</a>;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            retain = tail-&gt;<a class="code" href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">retain</a>;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            topic = tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            qos = tail-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a>;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            payloadlen = tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">payloadlen</a>;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            payload = tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordflow">switch</span>(tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a>){</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a>:</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                    rc = <a class="code" href="a00171.html#a7b111a5ceccb7bbc5fdadab085a33c03">_mosquitto_send_publish</a>(context, mid, topic, payloadlen, payload, qos, retain, retries);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                    <span class="keywordflow">if</span>(!rc){</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                        _message_remove(db, context, &amp;tail, last);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                    }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a>:</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                    rc = <a class="code" href="a00171.html#a7b111a5ceccb7bbc5fdadab085a33c03">_mosquitto_send_publish</a>(context, mid, topic, payloadlen, payload, qos, retain, retries);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                    <span class="keywordflow">if</span>(!rc){</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">timestamp</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a700ce2e47ef2ebedcf9454ec6f9ddaba">dup</a> = 1; <span class="comment">/* Any retry attempts are a duplicate. */</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09b9e20061bc7bcb6ccdb11d33a633b2">mosq_ms_wait_for_puback</a>;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                    }</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                    last = tail;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                    tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a>:</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                    rc = <a class="code" href="a00171.html#a7b111a5ceccb7bbc5fdadab085a33c03">_mosquitto_send_publish</a>(context, mid, topic, payloadlen, payload, qos, retain, retries);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                    <span class="keywordflow">if</span>(!rc){</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">timestamp</a> = <a class="code" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a>();</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a700ce2e47ef2ebedcf9454ec6f9ddaba">dup</a> = 1; <span class="comment">/* Any retry attempts are a duplicate. */</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa50c490e549790b996a085de91546db6c">mosq_ms_wait_for_pubrec</a>;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                    }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                    last = tail;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                    tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                </div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa7834baa2a689dc7137952b02cfbf5d61">mosq_ms_send_pubrec</a>:</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                    rc = <a class="code" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630">_mosquitto_send_pubrec</a>(context, mid);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                    <span class="keywordflow">if</span>(!rc){</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                    }</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                    last = tail;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                    tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d">mosq_ms_resend_pubrel</a>:</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                    rc = <a class="code" href="a00171.html#afbde2c162bd4b8e9fa52b0d45aa43b81">_mosquitto_send_pubrel</a>(context, mid);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                    <span class="keywordflow">if</span>(!rc){</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184">mosq_ms_wait_for_pubcomp</a>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                    }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                    last = tail;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                    tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac1ba83a1212acc454485316b5bd79c82">mosq_ms_resend_pubcomp</a>:</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                    rc = <a class="code" href="a00171.html#aaeba60c4fd6e50c8f7f599246c6f91fb">_mosquitto_send_pubcomp</a>(context, mid);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                    <span class="keywordflow">if</span>(!rc){</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                        tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                    }</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                    last = tail;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                    tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                <span class="keywordflow">default</span>:</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                    last = tail;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                    tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            }</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            <span class="comment">/* state == mosq_ms_queued */</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020">mosq_md_in</a> &amp;&amp; (max_inflight == 0 || msg_count &lt; max_inflight)){</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                <span class="keywordflow">if</span>(tail-&gt;<a class="code" href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">qos</a> == 2){</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                    tail-&gt;<a class="code" href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">state</a> = <a class="code" href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa7834baa2a689dc7137952b02cfbf5d61">mosq_ms_send_pubrec</a>;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                last = tail;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                tail = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            }</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    }</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;}</div><div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa7834baa2a689dc7137952b02cfbf5d61"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa7834baa2a689dc7137952b02cfbf5d61">mosq_ms_send_pubrec</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00088">mosquitto_internal.h:88</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa50c490e549790b996a085de91546db6c"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa50c490e549790b996a085de91546db6c">mosq_ms_wait_for_pubrec</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00083">mosquitto_internal.h:83</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa37f42535922d9838bcf081121d9385fe">mosq_ms_publish_qos2</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00082">mosquitto_internal.h:82</a></div></div>
<div class="ttc" id="a00088_html_a700ce2e47ef2ebedcf9454ec6f9ddaba"><div class="ttname"><a href="a00088.html#a700ce2e47ef2ebedcf9454ec6f9ddaba">mosquitto_client_msg::dup</a></div><div class="ttdeci">bool dup</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00202">mosquitto_broker.h:202</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a9b214e12e7bd4d2fa48273ad82554ac1"><div class="ttname"><a href="a00088.html#a9b214e12e7bd4d2fa48273ad82554ac1">mosquitto_client_msg::state</a></div><div class="ttdeci">enum mosquitto_msg_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00201">mosquitto_broker.h:201</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d">mosq_cs_connected</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00094">mosquitto_internal.h:94</a></div></div>
<div class="ttc" id="a00088_html_a3a37d2ec3ec40dbb0ee15332baf82b45"><div class="ttname"><a href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">mosquitto_client_msg::store</a></div><div class="ttdeci">struct mosquitto_msg_store * store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00195">mosquitto_broker.h:195</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00088_html_a5b27db513724cdddca30cd56b0bb1208"><div class="ttname"><a href="a00088.html#a5b27db513724cdddca30cd56b0bb1208">mosquitto_client_msg::mid</a></div><div class="ttdeci">uint16_t mid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00197">mosquitto_broker.h:197</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa0bd49f7417faa148ce524778706664a7">mosq_ms_publish_qos1</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00080">mosquitto_internal.h:80</a></div></div>
<div class="ttc" id="a00171_html_a07fb7f8b0c76e21162abb92404ac8630"><div class="ttname"><a href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630">_mosquitto_send_pubrec</a></div><div class="ttdeci">int _mosquitto_send_pubrec(struct mosquitto *mosq, uint16_t mid)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00179">send_mosq.c:179</a></div></div>
<div class="ttc" id="a00171_html_aaeba60c4fd6e50c8f7f599246c6f91fb"><div class="ttname"><a href="a00171.html#aaeba60c4fd6e50c8f7f599246c6f91fb">_mosquitto_send_pubcomp</a></div><div class="ttdeci">int _mosquitto_send_pubcomp(struct mosquitto *mosq, uint16_t mid)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00074">send_mosq.c:74</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00163_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00045">net_mosq.h:45</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00086_html_a26a90a9bba5628b617203725c220aca5"><div class="ttname"><a href="a00086.html#a26a90a9bba5628b617203725c220aca5">mosquitto::state</a></div><div class="ttdeci">enum mosquitto_client_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00168">mosquitto_internal.h:168</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa624a9a77ebc8789389ec5592e3425184">mosq_ms_wait_for_pubcomp</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00087">mosquitto_internal.h:87</a></div></div>
<div class="ttc" id="a00092_html_ad9f78d099469a4300ca282d895855f72"><div class="ttname"><a href="a00092.html#ad9f78d099469a4300ca282d895855f72">mosquitto_msg_store::payload</a></div><div class="ttdeci">void * payload</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00185">mosquitto_broker.h:185</a></div></div>
<div class="ttc" id="a00086_html_a31930c9d3d288fc2fdf253ccf01d10a3"><div class="ttname"><a href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">mosquitto::sock</a></div><div class="ttdeci">mosq_sock_t sock</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00154">mosquitto_internal.h:154</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac4c0c3e6169e0077be403c8fcc6e73cf">mosq_ms_wait_for_pubrel</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00085">mosquitto_internal.h:85</a></div></div>
<div class="ttc" id="a00092_html_a64d3652d6f85f1eb574f7b2c2df45306"><div class="ttname"><a href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">mosquitto_msg_store::payloadlen</a></div><div class="ttdeci">uint32_t payloadlen</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00186">mosquitto_broker.h:186</a></div></div>
<div class="ttc" id="a00088_html_aaf2d9b795432e04d07fbb18b23fd253e"><div class="ttname"><a href="a00088.html#aaf2d9b795432e04d07fbb18b23fd253e">mosquitto_client_msg::retain</a></div><div class="ttdeci">bool retain</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00199">mosquitto_broker.h:199</a></div></div>
<div class="ttc" id="a00140_html_aeb7ee0c9b71cf3bd38611412ae15f337"><div class="ttname"><a href="a00140.html#aeb7ee0c9b71cf3bd38611412ae15f337">msg_count</a></div><div class="ttdeci">int msg_count</div><div class="ttdef"><b>Definition:</b> <a href="a00140_source.html#l00034">sub_client.c:34</a></div></div>
<div class="ttc" id="a00177_html_a9fb48d8f8ce208443e2e7bae489770fe"><div class="ttname"><a href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe">mosquitto_time</a></div><div class="ttdeci">time_t mosquitto_time(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00177_source.html#l00052">time_mosq.c:52</a></div></div>
<div class="ttc" id="a00092_html_a9f27c2318268a2034571e2bbe91f69c6"><div class="ttname"><a href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">mosquitto_msg_store::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00184">mosquitto_broker.h:184</a></div></div>
<div class="ttc" id="a00088_html_a5b04e3d4a8ab404de8b432efabd1f583"><div class="ttname"><a href="a00088.html#a5b04e3d4a8ab404de8b432efabd1f583">mosquitto_client_msg::timestamp</a></div><div class="ttdeci">time_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00196">mosquitto_broker.h:196</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09c52d81e93f40b68cd7395f1a72769a">mosq_ms_publish_qos0</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00079">mosquitto_internal.h:79</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa09b9e20061bc7bcb6ccdb11d33a633b2"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa09b9e20061bc7bcb6ccdb11d33a633b2">mosq_ms_wait_for_puback</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00081">mosquitto_internal.h:81</a></div></div>
<div class="ttc" id="a00088_html_a323f6ea0b036b886cf7998e24d60c997"><div class="ttname"><a href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">mosquitto_client_msg::direction</a></div><div class="ttdeci">enum mosquitto_msg_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00200">mosquitto_broker.h:200</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaac1ba83a1212acc454485316b5bd79c82"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaac1ba83a1212acc454485316b5bd79c82">mosq_ms_resend_pubcomp</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00086">mosquitto_internal.h:86</a></div></div>
<div class="ttc" id="a00171_html_a7b111a5ceccb7bbc5fdadab085a33c03"><div class="ttname"><a href="a00171.html#a7b111a5ceccb7bbc5fdadab085a33c03">_mosquitto_send_publish</a></div><div class="ttdeci">int _mosquitto_send_publish(struct mosquitto *mosq, uint16_t mid, const char *topic, uint32_t payloadlen, const void *payload, int qos, bool retain, bool dup)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00084">send_mosq.c:84</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00088_html_aeb7b0700522773bb8d21e0c0e0603f34"><div class="ttname"><a href="a00088.html#aeb7b0700522773bb8d21e0c0e0603f34">mosquitto_client_msg::qos</a></div><div class="ttdeci">uint8_t qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00198">mosquitto_broker.h:198</a></div></div>
<div class="ttc" id="a00160_html_a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020"><div class="ttname"><a href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020">mosq_md_in</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00073">mosquitto_internal.h:73</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa91aaecb7f20dd9470b6c994a821fa8d9">mosq_ms_queued</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00089">mosquitto_internal.h:89</a></div></div>
<div class="ttc" id="a00171_html_afbde2c162bd4b8e9fa52b0d45aa43b81"><div class="ttname"><a href="a00171.html#afbde2c162bd4b8e9fa52b0d45aa43b81">_mosquitto_send_pubrel</a></div><div class="ttdeci">int _mosquitto_send_pubrel(struct mosquitto *mosq, uint16_t mid)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00189">send_mosq.c:189</a></div></div>
<div class="ttc" id="a00160_html_a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d"><div class="ttname"><a href="a00160.html#a0e031a82726a0816cbbe03bc4958a8eaa9a68ac0eaa2a1bbb04b68b6599bbb87d">mosq_ms_resend_pubrel</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00084">mosquitto_internal.h:84</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_aee64ee8f7ce7e65f696aa1bbf5c0674c_cgraph.png" border="0" usemap="#a00196_aee64ee8f7ce7e65f696aa1bbf5c0674c_cgraph" alt=""/></div>
<map name="a00196_aee64ee8f7ce7e65f696aa1bbf5c0674c_cgraph" id="a00196_aee64ee8f7ce7e65f696aa1bbf5c0674c_cgraph">
<area shape="rect" id="node2" href="a00171.html#a7b111a5ceccb7bbc5fdadab085a33c03" title="_mosquitto_send_publish" alt="" coords="224,1289,393,1316"/>
<area shape="rect" id="node13" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2724,424,2835,451"/>
<area shape="rect" id="node31" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630" title="_mosquitto_send_pubrec" alt="" coords="2696,1741,2863,1768"/>
<area shape="rect" id="node34" href="a00171.html#afbde2c162bd4b8e9fa52b0d45aa43b81" title="_mosquitto_send_pubrel" alt="" coords="2698,1792,2861,1819"/>
<area shape="rect" id="node36" href="a00171.html#aaeba60c4fd6e50c8f7f599246c6f91fb" title="_mosquitto_send_pubcomp" alt="" coords="2689,1488,2870,1515"/>
<area shape="rect" id="node3" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2680,2096,2879,2123"/>
<area shape="rect" id="node4" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2715,1944,2844,1971"/>
<area shape="rect" id="node5" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="3166,1691,3281,1717"/>
<area shape="rect" id="node6" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2714,1387,2845,1413"/>
<area shape="rect" id="node7" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2946,1108,3093,1135"/>
<area shape="rect" id="node8" href="a00171.html#aec1dbc12b0482663fdfbc95c13124bf3" title="_mosquitto_send_real\l_publish" alt="" coords="441,1855,591,1897"/>
<area shape="rect" id="node9" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="3160,2248,3287,2275"/>
<area shape="rect" id="node10" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="639,1631,805,1657"/>
<area shape="rect" id="node20" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1525,1921,1700,1948"/>
<area shape="rect" id="node47" href="a00162.html#a74c4a3cbe02bca478cb9621cca8191e8" title="_mosquitto_write_string" alt="" coords="642,1863,802,1889"/>
<area shape="rect" id="node48" href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f" title="_mosquitto_write_uint16" alt="" coords="867,1901,1030,1928"/>
<area shape="rect" id="node50" href="a00162.html#a307413f45257069e76295c70a6d899d8" title="_mosquitto_write_bytes" alt="" coords="869,1837,1029,1864"/>
<area shape="rect" id="node11" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="877,1594,1020,1635"/>
<area shape="rect" id="node12" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="853,551,1044,577"/>
<area shape="rect" id="node14" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1963,1921,2133,1948"/>
<area shape="rect" id="node18" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="1092,551,1263,577"/>
<area shape="rect" id="node15" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="2196,1914,2357,1955"/>
<area shape="rect" id="node16" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="2196,1979,2357,2021"/>
<area shape="rect" id="node17" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="2181,1863,2372,1889"/>
<area shape="rect" id="node19" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="1311,1653,1477,1694"/>
<area shape="rect" id="node21" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="1748,1812,1915,1839"/>
<area shape="rect" id="node22" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1975,1364,2121,1391"/>
<area shape="rect" id="node23" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="2185,1812,2369,1839"/>
<area shape="rect" id="node24" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="1966,1488,2130,1515"/>
<area shape="rect" id="node25" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="2205,1539,2348,1565"/>
<area shape="rect" id="node26" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="2203,1209,2350,1236"/>
<area shape="rect" id="node44" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="2188,1032,2365,1059"/>
<area shape="rect" id="node27" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2436,981,2616,1008"/>
<area shape="rect" id="node28" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2433,1032,2619,1059"/>
<area shape="rect" id="node29" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2420,1083,2632,1109"/>
<area shape="rect" id="node30" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2452,1792,2600,1819"/>
<area shape="rect" id="node33" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2437,1336,2615,1363"/>
<area shape="rect" id="node35" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2439,1235,2613,1261"/>
<area shape="rect" id="node37" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="2449,1691,2603,1717"/>
<area shape="rect" id="node38" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="2694,1285,2865,1312"/>
<area shape="rect" id="node39" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="2445,1184,2607,1211"/>
<area shape="rect" id="node40" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="2691,1640,2868,1667"/>
<area shape="rect" id="node41" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="2448,677,2604,704"/>
<area shape="rect" id="node42" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="2436,1133,2616,1160"/>
<area shape="rect" id="node43" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="2429,931,2623,957"/>
<area shape="rect" id="node32" href="a00171.html#a45df200bf3b771869380b69c143ed251" title="_mosquitto_send_command\l_with_mid" alt="" coords="2927,1763,3112,1805"/>
<area shape="rect" id="node45" href="a00164.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="2437,779,2615,805"/>
<area shape="rect" id="node46" href="a00166.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="2686,829,2873,856"/>
<area shape="rect" id="node49" href="a00162.html#adc64d22375628582aa20cb1f8e9435a3" title="_mosquitto_write_byte" alt="" coords="1101,1901,1254,1928"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa62ed0d7c268d8756b3b91951d59bac2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_messages_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00486">486</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;{</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *tail, *<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    tail = context-&gt;msgs;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">while</span>(tail){</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a>(db, &amp;tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        next = tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(tail);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        tail = <a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    context-&gt;msgs = NULL;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    context-&gt;last_msg = NULL;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    context-&gt;msg_count = 0;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    context-&gt;msg_count12 = 0;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00088_html_a3a37d2ec3ec40dbb0ee15332baf82b45"><div class="ttname"><a href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">mosquitto_client_msg::store</a></div><div class="ttdeci">struct mosquitto_msg_store * store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00195">mosquitto_broker.h:195</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00191_html_af19cbc47cd971cdb22e9f48566bb3e68"><div class="ttname"><a href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a></div><div class="ttdeci">void mosquitto__db_msg_store_deref(struct mosquitto_db *db, struct mosquitto_msg_store **store)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00188">database.c:188</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_aa62ed0d7c268d8756b3b91951d59bac2_cgraph.png" border="0" usemap="#a00196_aa62ed0d7c268d8756b3b91951d59bac2_cgraph" alt=""/></div>
<map name="a00196_aa62ed0d7c268d8756b3b91951d59bac2_cgraph" id="a00196_aa62ed0d7c268d8756b3b91951d59bac2_cgraph">
<area shape="rect" id="node2" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="239,56,413,97"/>
<area shape="rect" id="node4" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="684,71,799,98"/>
<area shape="rect" id="node3" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="461,5,636,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abe58c783467b8953116641c9a2eb81a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_messages_easy_queue </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>payloadlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>retain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00507">507</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;{</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00092.html">mosquitto_msg_store</a> *stored;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">source_id</a>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    assert(db);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span>(context &amp;&amp; context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>){</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        source_id = context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        source_id = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00191.html#a36e4902f860237756538cc4a58e1321b">mqtt3_db_message_store</a>(db, source_id, 0, <a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>, <a class="code" href="a00092.html#ad277fe117cd8e5f97fb043c00ca66964">qos</a>, <a class="code" href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">payloadlen</a>, <a class="code" href="a00092.html#ad9f78d099469a4300ca282d895855f72">payload</a>, <a class="code" href="a00092.html#a2c3e7f1461c037f0d38c88f3bb3073fb">retain</a>, &amp;stored, 0)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca">mqtt3_db_messages_queue</a>(db, source_id, <a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>, <a class="code" href="a00092.html#ad277fe117cd8e5f97fb043c00ca66964">qos</a>, <a class="code" href="a00092.html#a2c3e7f1461c037f0d38c88f3bb3073fb">retain</a>, &amp;stored);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;}</div><div class="ttc" id="a00092_html_ad277fe117cd8e5f97fb043c00ca66964"><div class="ttname"><a href="a00092.html#ad277fe117cd8e5f97fb043c00ca66964">mosquitto_msg_store::qos</a></div><div class="ttdeci">uint8_t qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00189">mosquitto_broker.h:189</a></div></div>
<div class="ttc" id="a00191_html_a36e4902f860237756538cc4a58e1321b"><div class="ttname"><a href="a00191.html#a36e4902f860237756538cc4a58e1321b">mqtt3_db_message_store</a></div><div class="ttdeci">int mqtt3_db_message_store(struct mosquitto_db *db, const char *source, uint16_t source_mid, const char *topic, int qos, uint32_t payloadlen, const void *payload, int retain, struct mosquitto_msg_store **stored, dbid_t store_id)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00526">database.c:526</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00092_html_a63a59debb4a78b52c937c8e7129b214c"><div class="ttname"><a href="a00092.html#a63a59debb4a78b52c937c8e7129b214c">mosquitto_msg_store::source_id</a></div><div class="ttdeci">char * source_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00180">mosquitto_broker.h:180</a></div></div>
<div class="ttc" id="a00092_html_ad9f78d099469a4300ca282d895855f72"><div class="ttname"><a href="a00092.html#ad9f78d099469a4300ca282d895855f72">mosquitto_msg_store::payload</a></div><div class="ttdeci">void * payload</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00185">mosquitto_broker.h:185</a></div></div>
<div class="ttc" id="a00092_html_a64d3652d6f85f1eb574f7b2c2df45306"><div class="ttname"><a href="a00092.html#a64d3652d6f85f1eb574f7b2c2df45306">mosquitto_msg_store::payloadlen</a></div><div class="ttdeci">uint32_t payloadlen</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00186">mosquitto_broker.h:186</a></div></div>
<div class="ttc" id="a00092_html_a9f27c2318268a2034571e2bbe91f69c6"><div class="ttname"><a href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">mosquitto_msg_store::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00184">mosquitto_broker.h:184</a></div></div>
<div class="ttc" id="a00092_html_a2c3e7f1461c037f0d38c88f3bb3073fb"><div class="ttname"><a href="a00092.html#a2c3e7f1461c037f0d38c88f3bb3073fb">mosquitto_msg_store::retain</a></div><div class="ttdeci">bool retain</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00190">mosquitto_broker.h:190</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00092_html"><div class="ttname"><a href="a00092.html">mosquitto_msg_store</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00176">mosquitto_broker.h:176</a></div></div>
<div class="ttc" id="a00196_html_a7a90d0b3b46b09f07e3fa99074e80eca"><div class="ttname"><a href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca">mqtt3_db_messages_queue</a></div><div class="ttdeci">int mqtt3_db_messages_queue(struct mosquitto_db *db, const char *source_id, const char *topic, int qos, int retain, struct mosquitto_msg_store **stored)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00507">subs.c:507</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_abe58c783467b8953116641c9a2eb81a9_cgraph.png" border="0" usemap="#a00196_abe58c783467b8953116641c9a2eb81a9_cgraph" alt=""/></div>
<map name="a00196_abe58c783467b8953116641c9a2eb81a9_cgraph" id="a00196_abe58c783467b8953116641c9a2eb81a9_cgraph">
<area shape="rect" id="node2" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="239,132,411,159"/>
<area shape="rect" id="node8" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="232,259,417,285"/>
<area shape="rect" id="node3" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="501,5,632,32"/>
<area shape="rect" id="node4" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="502,56,631,83"/>
<area shape="rect" id="node5" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="939,284,1053,311"/>
<area shape="rect" id="node6" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="493,157,640,184"/>
<area shape="rect" id="node7" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="465,208,668,235"/>
<area shape="rect" id="node9" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="479,334,654,375"/>
<area shape="rect" id="node10" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="716,361,891,402"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7a90d0b3b46b09f07e3fa99074e80eca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_messages_queue </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>source_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>retain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00092.html">mosquitto_msg_store</a> **&#160;</td>
          <td class="paramname"><em>stored</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00207_source.html#l00507">507</a> of file <a class="el" href="a00207_source.html">subs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;{</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = 0;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00012.html">_mosquitto_subhier</a> *subhier;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00018.html">_sub_token</a> *tokens = NULL;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    assert(db);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    assert(<a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span>(_sub_topic_tokenise(<a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>, &amp;tokens)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="comment">/* Protect this message until we have sent it to all</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">    clients - this is required because websockets client calls</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">    mqtt3_db_message_write(), which could remove the message if ref_count==0.</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    (*stored)-&gt;ref_count++;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    subhier = db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>.<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">while</span>(subhier){</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span>(!strcmp(subhier-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a>, tokens-&gt;<a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>)){</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordflow">if</span>(retain){</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <span class="comment">/* We have a message that needs to be retained, so ensure that the subscription</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">                 * tree for its topic exists.</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                _sub_add(db, NULL, 0, subhier, tokens);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            _sub_search(db, subhier, tokens, source_id, <a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>, qos, retain, *stored, <span class="keyword">true</span>);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        subhier = subhier-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    _sub_topic_tokens_free(tokens);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">/* Remove our reference and free if needed. */</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a>(db, stored);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;}</div><div class="ttc" id="a00012_html_a00428a09aa6cf18392af6a4b3eec8232"><div class="ttname"><a href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">_mosquitto_subhier::next</a></div><div class="ttdeci">struct _mosquitto_subhier * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00164">mosquitto_broker.h:164</a></div></div>
<div class="ttc" id="a00018_html_af44d6135ad74423ca467bc0574e47b36"><div class="ttname"><a href="a00018.html#af44d6135ad74423ca467bc0574e47b36">_sub_token::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00060">subs.c:60</a></div></div>
<div class="ttc" id="a00012_html_a4e5dfd42f0c74c957b234fcecf3c4225"><div class="ttname"><a href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">_mosquitto_subhier::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00166">mosquitto_broker.h:166</a></div></div>
<div class="ttc" id="a00018_html"><div class="ttname"><a href="a00018.html">_sub_token</a></div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00058">subs.c:58</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00012_html"><div class="ttname"><a href="a00012.html">_mosquitto_subhier</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00161">mosquitto_broker.h:161</a></div></div>
<div class="ttc" id="a00191_html_af19cbc47cd971cdb22e9f48566bb3e68"><div class="ttname"><a href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a></div><div class="ttdeci">void mosquitto__db_msg_store_deref(struct mosquitto_db *db, struct mosquitto_msg_store **store)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00188">database.c:188</a></div></div>
<div class="ttc" id="a00012_html_a33db1bd6285c730939b53887cf9e2226"><div class="ttname"><a href="a00012.html#a33db1bd6285c730939b53887cf9e2226">_mosquitto_subhier::children</a></div><div class="ttdeci">struct _mosquitto_subhier * children</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00163">mosquitto_broker.h:163</a></div></div>
<div class="ttc" id="a00089_html_a2f96cc353b06a96922b1310c87327e0b"><div class="ttname"><a href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">mosquitto_db::subs</a></div><div class="ttdeci">struct _mosquitto_subhier subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00245">mosquitto_broker.h:245</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a7a90d0b3b46b09f07e3fa99074e80eca_cgraph.png" border="0" usemap="#a00196_a7a90d0b3b46b09f07e3fa99074e80eca_cgraph" alt=""/></div>
<map name="a00196_a7a90d0b3b46b09f07e3fa99074e80eca_cgraph" id="a00196_a7a90d0b3b46b09f07e3fa99074e80eca_cgraph">
<area shape="rect" id="node2" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="239,56,413,97"/>
<area shape="rect" id="node4" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="684,71,799,98"/>
<area shape="rect" id="node3" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="461,5,636,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa8961746b21163f586af2a417a04fc46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_db_open </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00097.html">mqtt3_config</a> *&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00033">33</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = 0;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00012.html">_mosquitto_subhier</a> *child;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">if</span>(!config || !db) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    db-&gt;<a class="code" href="a00089.html#a411d3ba9bf064853c3f89d606dc456be">last_db_id</a> = 0;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    db-&gt;<a class="code" href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">contexts_by_id</a> = NULL;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    db-&gt;<a class="code" href="a00089.html#acef8c251ec284f40de65517454659178">contexts_by_sock</a> = NULL;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    db-&gt;<a class="code" href="a00089.html#a17c32122ec7e4cb760ae241854a51073">contexts_for_free</a> = NULL;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    db-&gt;bridges = NULL;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    db-&gt;bridge_count = 0;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// Initialize the hashtable</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    db-&gt;<a class="code" href="a00089.html#ab46f597b01c9330f1d593fcf846197f6">clientid_index_hash</a> = NULL;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>.<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a> = NULL;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>.<a class="code" href="a00012.html#ad6054fd88882fc67bdeb291696df6b81">subs</a> = NULL;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>.<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    child = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00012.html">_mosquitto_subhier</a>));</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">if</span>(!child){</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    child-&gt;<a class="code" href="a00012.html#addcde11a0ac8bf0c12d8716ded87fbe4">parent</a> = NULL;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    child-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a> = NULL;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    child-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">if</span>(!child-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a>){</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    child-&gt;<a class="code" href="a00012.html#ad6054fd88882fc67bdeb291696df6b81">subs</a> = NULL;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    child-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a> = NULL;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    child-&gt;<a class="code" href="a00012.html#aeede44aaca8140d0e130be6ce710a6c6">retained</a> = NULL;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>.<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a> = child;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    child = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00012.html">_mosquitto_subhier</a>));</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">if</span>(!child){</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    child-&gt;<a class="code" href="a00012.html#addcde11a0ac8bf0c12d8716ded87fbe4">parent</a> = NULL;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    child-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a> = NULL;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    child-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(<span class="stringliteral">&quot;$SYS&quot;</span>);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span>(!child-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a>){</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    child-&gt;<a class="code" href="a00012.html#ad6054fd88882fc67bdeb291696df6b81">subs</a> = NULL;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    child-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a> = NULL;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    child-&gt;<a class="code" href="a00012.html#aeede44aaca8140d0e130be6ce710a6c6">retained</a> = NULL;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>.<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a> = child;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    db-&gt;<a class="code" href="a00089.html#a0ae1cdd9ca34f2dac7f1a5c02f3ed359">unpwd</a> = NULL;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a93cbad1aadbb9472f12d92bd2b2935a4">persistence</a> &amp;&amp; config-&gt;<a class="code" href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">persistence_filepath</a>){</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span>(mqtt3_db_restore(db)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;}</div><div class="ttc" id="a00012_html_a00428a09aa6cf18392af6a4b3eec8232"><div class="ttname"><a href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">_mosquitto_subhier::next</a></div><div class="ttdeci">struct _mosquitto_subhier * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00164">mosquitto_broker.h:164</a></div></div>
<div class="ttc" id="a00097_html_a93b8a8cb4b6b2f919ab98d3716b35cb0"><div class="ttname"><a href="a00097.html#a93b8a8cb4b6b2f919ab98d3716b35cb0">mqtt3_config::persistence_filepath</a></div><div class="ttdeci">char * persistence_filepath</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00131">mosquitto_broker.h:131</a></div></div>
<div class="ttc" id="a00089_html_acef8c251ec284f40de65517454659178"><div class="ttname"><a href="a00089.html#acef8c251ec284f40de65517454659178">mosquitto_db::contexts_by_sock</a></div><div class="ttdeci">struct mosquitto * contexts_by_sock</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00251">mosquitto_broker.h:251</a></div></div>
<div class="ttc" id="a00012_html_a4e5dfd42f0c74c957b234fcecf3c4225"><div class="ttname"><a href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">_mosquitto_subhier::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00166">mosquitto_broker.h:166</a></div></div>
<div class="ttc" id="a00089_html_ac5b775be8b87233bb22f20b10bbac0bd"><div class="ttname"><a href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">mosquitto_db::contexts_by_id</a></div><div class="ttdeci">struct mosquitto * contexts_by_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00250">mosquitto_broker.h:250</a></div></div>
<div class="ttc" id="a00012_html_addcde11a0ac8bf0c12d8716ded87fbe4"><div class="ttname"><a href="a00012.html#addcde11a0ac8bf0c12d8716ded87fbe4">_mosquitto_subhier::parent</a></div><div class="ttdeci">struct _mosquitto_subhier * parent</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00162">mosquitto_broker.h:162</a></div></div>
<div class="ttc" id="a00012_html_ad6054fd88882fc67bdeb291696df6b81"><div class="ttname"><a href="a00012.html#ad6054fd88882fc67bdeb291696df6b81">_mosquitto_subhier::subs</a></div><div class="ttdeci">struct _mosquitto_subleaf * subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00165">mosquitto_broker.h:165</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00089_html_ab46f597b01c9330f1d593fcf846197f6"><div class="ttname"><a href="a00089.html#ab46f597b01c9330f1d593fcf846197f6">mosquitto_db::clientid_index_hash</a></div><div class="ttdeci">struct _clientid_index_hash * clientid_index_hash</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00256">mosquitto_broker.h:256</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00012_html"><div class="ttname"><a href="a00012.html">_mosquitto_subhier</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00161">mosquitto_broker.h:161</a></div></div>
<div class="ttc" id="a00012_html_aeede44aaca8140d0e130be6ce710a6c6"><div class="ttname"><a href="a00012.html#aeede44aaca8140d0e130be6ce710a6c6">_mosquitto_subhier::retained</a></div><div class="ttdeci">struct mosquitto_msg_store * retained</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00167">mosquitto_broker.h:167</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00089_html_a17c32122ec7e4cb760ae241854a51073"><div class="ttname"><a href="a00089.html#a17c32122ec7e4cb760ae241854a51073">mosquitto_db::contexts_for_free</a></div><div class="ttdeci">struct mosquitto * contexts_for_free</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00252">mosquitto_broker.h:252</a></div></div>
<div class="ttc" id="a00012_html_a33db1bd6285c730939b53887cf9e2226"><div class="ttname"><a href="a00012.html#a33db1bd6285c730939b53887cf9e2226">_mosquitto_subhier::children</a></div><div class="ttdeci">struct _mosquitto_subhier * children</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00163">mosquitto_broker.h:163</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00097_html_a93cbad1aadbb9472f12d92bd2b2935a4"><div class="ttname"><a href="a00097.html#a93cbad1aadbb9472f12d92bd2b2935a4">mqtt3_config::persistence</a></div><div class="ttdeci">bool persistence</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00128">mosquitto_broker.h:128</a></div></div>
<div class="ttc" id="a00089_html_a411d3ba9bf064853c3f89d606dc456be"><div class="ttname"><a href="a00089.html#a411d3ba9bf064853c3f89d606dc456be">mosquitto_db::last_db_id</a></div><div class="ttdeci">dbid_t last_db_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00244">mosquitto_broker.h:244</a></div></div>
<div class="ttc" id="a00089_html_a2f96cc353b06a96922b1310c87327e0b"><div class="ttname"><a href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">mosquitto_db::subs</a></div><div class="ttdeci">struct _mosquitto_subhier subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00245">mosquitto_broker.h:245</a></div></div>
<div class="ttc" id="a00089_html_a0ae1cdd9ca34f2dac7f1a5c02f3ed359"><div class="ttname"><a href="a00089.html#a0ae1cdd9ca34f2dac7f1a5c02f3ed359">mosquitto_db::unpwd</a></div><div class="ttdeci">struct _mosquitto_unpwd * unpwd</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00246">mosquitto_broker.h:246</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_aa8961746b21163f586af2a417a04fc46_cgraph.png" border="0" usemap="#a00196_aa8961746b21163f586af2a417a04fc46_cgraph" alt=""/></div>
<map name="a00196_aa8961746b21163f586af2a417a04fc46_cgraph" id="a00196_aa8961746b21163f586af2a417a04fc46_cgraph">
<area shape="rect" id="node2" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="186,5,317,32"/>
<area shape="rect" id="node3" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="178,56,325,83"/>
<area shape="rect" id="node4" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="187,107,316,133"/>
<area shape="rect" id="node5" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="609,208,724,235"/>
<area shape="rect" id="node6" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="164,233,339,274"/>
<area shape="rect" id="node7" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="387,259,561,301"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab1a5b88e8e067a6175a68014713053d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_db_sys_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>interval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>start_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a7f3a0c01054059f3f2aa16072dbe3f84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_db_vacuum </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00191_source.html#l00942">942</a> of file <a class="el" href="a00191_source.html">database.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;{</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">/* FIXME - reimplement? */</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad6b09e9305be77b254fbff1759f3c7c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_handle_connack </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00168_source.html#l00027">27</a> of file <a class="el" href="a00168_source.html">read_handle_client.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    uint8_t byte;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    uint8_t <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordtype">char</span> *notification_topic;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordtype">int</span> notification_topic_len;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordtype">char</span> notification_payload;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span>(!context){</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Received CONNACK on connection %s.&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1">_mosquitto_read_byte</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;byte)) <span class="keywordflow">return</span> 1; <span class="comment">// Reserved byte, not used</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1">_mosquitto_read_byte</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;rc)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">switch</span>(rc){</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#af091bde70bed3c1da6b8d03eafea7f5d">CONNACK_ACCEPTED</a>:</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="keywordflow">if</span>(context-&gt;bridge){</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                <span class="keywordflow">if</span>(context-&gt;bridge-&gt;notifications){</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                    notification_payload = <span class="charliteral">&#39;1&#39;</span>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                    <span class="keywordflow">if</span>(context-&gt;bridge-&gt;notification_topic){</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="a00171.html#aec1dbc12b0482663fdfbc95c13124bf3">_mosquitto_send_real_publish</a>(context, <a class="code" href="a00181.html#a6c57944aa63895ebcf0edc405e08a92b">_mosquitto_mid_generate</a>(context),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                context-&gt;bridge-&gt;notification_topic, 1, &amp;notification_payload, 1, <span class="keyword">true</span>, 0)){</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                        }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                        <a class="code" href="a00191.html#abe58c783467b8953116641c9a2eb81a9">mqtt3_db_messages_easy_queue</a>(db, context, context-&gt;bridge-&gt;notification_topic, 1, 1, &amp;notification_payload, 1);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                        notification_topic_len = strlen(context-&gt;bridge-&gt;remote_clientid)+strlen(<span class="stringliteral">&quot;$SYS/broker/connection//state&quot;</span>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                        notification_topic = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(notification_topic_len+1));</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                        <span class="keywordflow">if</span>(!notification_topic) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                        snprintf(notification_topic, notification_topic_len+1, <span class="stringliteral">&quot;$SYS/broker/connection/%s/state&quot;</span>, context-&gt;bridge-&gt;remote_clientid);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                        notification_payload = <span class="charliteral">&#39;1&#39;</span>;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="a00171.html#aec1dbc12b0482663fdfbc95c13124bf3">_mosquitto_send_real_publish</a>(context, <a class="code" href="a00181.html#a6c57944aa63895ebcf0edc405e08a92b">_mosquitto_mid_generate</a>(context),</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                notification_topic, 1, &amp;notification_payload, 1, <span class="keyword">true</span>, 0)){</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(notification_topic);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                        }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                        <a class="code" href="a00191.html#abe58c783467b8953116641c9a2eb81a9">mqtt3_db_messages_easy_queue</a>(db, context, notification_topic, 1, 1, &amp;notification_payload, 1);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(notification_topic);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                    }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="keywordflow">for</span>(i=0; i&lt;context-&gt;bridge-&gt;topic_count; i++){</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                    <span class="keywordflow">if</span>(context-&gt;bridge-&gt;topics[i].direction == <a class="code" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8">bd_in</a> || context-&gt;bridge-&gt;topics[i].direction == <a class="code" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75">bd_both</a>){</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                        <span class="keywordflow">if</span>(<a class="code" href="a00170.html#a58e27cf831dfbfa8582f782a9107894a">_mosquitto_send_subscribe</a>(context, NULL, context-&gt;bridge-&gt;topics[i].remote_topic, context-&gt;bridge-&gt;topics[i].qos)){</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                        }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                        <span class="keywordflow">if</span>(context-&gt;bridge-&gt;attempt_unsubscribe){</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                            <span class="keywordflow">if</span>(<a class="code" href="a00170.html#a8b306352802e55aaeb9263c4575f3b48">_mosquitto_send_unsubscribe</a>(context, NULL, context-&gt;bridge-&gt;topics[i].remote_topic)){</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                <span class="comment">/* direction = inwards only. This means we should not be subscribed</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">                                * to the topic. It is possible that we used to be subscribed to</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">                                * this topic so unsubscribe. */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                            }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                        }</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                    }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d">mosq_cs_connected</a>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a8150907b0b3117ce6b043218046d4679">CONNACK_REFUSED_PROTOCOL_VERSION</a>:</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">if</span>(context-&gt;bridge){</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                context-&gt;bridge-&gt;try_private_accepted = <span class="keyword">false</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Connection Refused: unacceptable protocol version&quot;</span>);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a5d9f8225f090dd49b45ea8e91e826118">CONNACK_REFUSED_IDENTIFIER_REJECTED</a>:</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Connection Refused: identifier rejected&quot;</span>);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a05a8e27298d7943dfef752f03f71a54c">CONNACK_REFUSED_SERVER_UNAVAILABLE</a>:</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Connection Refused: broker unavailable&quot;</span>);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#aced9e444e25ec0c595487ca671984f85">CONNACK_REFUSED_BAD_USERNAME_PASSWORD</a>:</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Connection Refused: broker unavailable&quot;</span>);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a4b5a062bd031b6f494ede27ca7b7e528">CONNACK_REFUSED_NOT_AUTHORIZED</a>:</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Connection Refused: not authorised&quot;</span>);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Connection Refused: unknown reason&quot;</span>);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div><div class="ttc" id="a00171_html_aec1dbc12b0482663fdfbc95c13124bf3"><div class="ttname"><a href="a00171.html#aec1dbc12b0482663fdfbc95c13124bf3">_mosquitto_send_real_publish</a></div><div class="ttdeci">int _mosquitto_send_real_publish(struct mosquitto *mosq, uint16_t mid, const char *topic, uint32_t payloadlen, const void *payload, int qos, bool retain, bool dup)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00248">send_mosq.c:248</a></div></div>
<div class="ttc" id="a00191_html_abe58c783467b8953116641c9a2eb81a9"><div class="ttname"><a href="a00191.html#abe58c783467b8953116641c9a2eb81a9">mqtt3_db_messages_easy_queue</a></div><div class="ttdeci">int mqtt3_db_messages_easy_queue(struct mosquitto_db *db, struct mosquitto *context, const char *topic, int qos, uint32_t payloadlen, const void *payload, int retain)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00507">database.c:507</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d">mosq_cs_connected</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00094">mosquitto_internal.h:94</a></div></div>
<div class="ttc" id="a00161_html_aced9e444e25ec0c595487ca671984f85"><div class="ttname"><a href="a00161.html#aced9e444e25ec0c595487ca671984f85">CONNACK_REFUSED_BAD_USERNAME_PASSWORD</a></div><div class="ttdeci">#define CONNACK_REFUSED_BAD_USERNAME_PASSWORD</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00048">mqtt3_protocol.h:48</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00162_html_aa0425b094c40c000e3bdcef6c2766fc1"><div class="ttname"><a href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1">_mosquitto_read_byte</a></div><div class="ttdeci">int _mosquitto_read_byte(struct _mosquitto_packet *packet, uint8_t *byte)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00661">net_mosq.c:661</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00196_html_a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75"><div class="ttname"><a href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75">bd_both</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00276">mosquitto_broker.h:276</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00161_html_a4b5a062bd031b6f494ede27ca7b7e528"><div class="ttname"><a href="a00161.html#a4b5a062bd031b6f494ede27ca7b7e528">CONNACK_REFUSED_NOT_AUTHORIZED</a></div><div class="ttdeci">#define CONNACK_REFUSED_NOT_AUTHORIZED</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00049">mqtt3_protocol.h:49</a></div></div>
<div class="ttc" id="a00086_html_a26a90a9bba5628b617203725c220aca5"><div class="ttname"><a href="a00086.html#a26a90a9bba5628b617203725c220aca5">mosquitto::state</a></div><div class="ttdeci">enum mosquitto_client_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00168">mosquitto_internal.h:168</a></div></div>
<div class="ttc" id="a00161_html_a8150907b0b3117ce6b043218046d4679"><div class="ttname"><a href="a00161.html#a8150907b0b3117ce6b043218046d4679">CONNACK_REFUSED_PROTOCOL_VERSION</a></div><div class="ttdeci">#define CONNACK_REFUSED_PROTOCOL_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00045">mqtt3_protocol.h:45</a></div></div>
<div class="ttc" id="a00159_html_a9a0714eb912755e4dc621c1e902c0bcf"><div class="ttname"><a href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a></div><div class="ttdeci">#define MOSQ_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00058">mosquitto.h:58</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00161_html_a05a8e27298d7943dfef752f03f71a54c"><div class="ttname"><a href="a00161.html#a05a8e27298d7943dfef752f03f71a54c">CONNACK_REFUSED_SERVER_UNAVAILABLE</a></div><div class="ttdeci">#define CONNACK_REFUSED_SERVER_UNAVAILABLE</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00047">mqtt3_protocol.h:47</a></div></div>
<div class="ttc" id="a00170_html_a8b306352802e55aaeb9263c4575f3b48"><div class="ttname"><a href="a00170.html#a8b306352802e55aaeb9263c4575f3b48">_mosquitto_send_unsubscribe</a></div><div class="ttdeci">int _mosquitto_send_unsubscribe(struct mosquitto *mosq, int *mid, const char *topic)</div><div class="ttdef"><b>Definition:</b> <a href="a00170_source.html#l00205">send_client_mosq.c:205</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00161_html_a5d9f8225f090dd49b45ea8e91e826118"><div class="ttname"><a href="a00161.html#a5d9f8225f090dd49b45ea8e91e826118">CONNACK_REFUSED_IDENTIFIER_REJECTED</a></div><div class="ttdeci">#define CONNACK_REFUSED_IDENTIFIER_REJECTED</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00046">mqtt3_protocol.h:46</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00181_html_a6c57944aa63895ebcf0edc405e08a92b"><div class="ttname"><a href="a00181.html#a6c57944aa63895ebcf0edc405e08a92b">_mosquitto_mid_generate</a></div><div class="ttdeci">uint16_t _mosquitto_mid_generate(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00153">util_mosq.c:153</a></div></div>
<div class="ttc" id="a00170_html_a58e27cf831dfbfa8582f782a9107894a"><div class="ttname"><a href="a00170.html#a58e27cf831dfbfa8582f782a9107894a">_mosquitto_send_subscribe</a></div><div class="ttdeci">int _mosquitto_send_subscribe(struct mosquitto *mosq, int *mid, const char *topic, uint8_t topic_qos)</div><div class="ttdef"><b>Definition:</b> <a href="a00170_source.html#l00160">send_client_mosq.c:160</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
<div class="ttc" id="a00196_html_a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8"><div class="ttname"><a href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8">bd_in</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00275">mosquitto_broker.h:275</a></div></div>
<div class="ttc" id="a00161_html_af091bde70bed3c1da6b8d03eafea7f5d"><div class="ttname"><a href="a00161.html#af091bde70bed3c1da6b8d03eafea7f5d">CONNACK_ACCEPTED</a></div><div class="ttdeci">#define CONNACK_ACCEPTED</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00044">mqtt3_protocol.h:44</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_ad6b09e9305be77b254fbff1759f3c7c7_cgraph.png" border="0" usemap="#a00196_ad6b09e9305be77b254fbff1759f3c7c7_cgraph" alt=""/></div>
<map name="a00196_ad6b09e9305be77b254fbff1759f3c7c7_cgraph" id="a00196_ad6b09e9305be77b254fbff1759f3c7c7_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2756,1277,2903,1303"/>
<area shape="rect" id="node3" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1" title="_mosquitto_read_byte" alt="" coords="2754,795,2905,822"/>
<area shape="rect" id="node4" href="a00171.html#aec1dbc12b0482663fdfbc95c13124bf3" title="_mosquitto_send_real\l_publish" alt="" coords="234,1361,383,1403"/>
<area shape="rect" id="node8" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2764,486,2895,513"/>
<area shape="rect" id="node13" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="3201,897,3316,923"/>
<area shape="rect" id="node47" href="a00181.html#a6c57944aa63895ebcf0edc405e08a92b" title="_mosquitto_mid_generate" alt="" coords="456,2002,627,2029"/>
<area shape="rect" id="node48" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="2241,129,2420,171"/>
<area shape="rect" id="node49" href="a00170.html#a58e27cf831dfbfa8582f782a9107894a" title="_mosquitto_send_subscribe" alt="" coords="217,1622,401,1649"/>
<area shape="rect" id="node50" href="a00170.html#a8b306352802e55aaeb9263c4575f3b48" title="_mosquitto_send_unsubscribe" alt="" coords="209,1749,408,1775"/>
<area shape="rect" id="node5" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2511,441,2637,467"/>
<area shape="rect" id="node6" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="458,1293,625,1319"/>
<area shape="rect" id="node18" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1347,1647,1521,1674"/>
<area shape="rect" id="node43" href="a00162.html#a74c4a3cbe02bca478cb9621cca8191e8" title="_mosquitto_write_string" alt="" coords="461,1546,621,1573"/>
<area shape="rect" id="node44" href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f" title="_mosquitto_write_uint16" alt="" coords="689,1597,851,1623"/>
<area shape="rect" id="node46" href="a00162.html#a307413f45257069e76295c70a6d899d8" title="_mosquitto_write_bytes" alt="" coords="690,1546,850,1573"/>
<area shape="rect" id="node7" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="699,1312,841,1353"/>
<area shape="rect" id="node9" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="675,1261,865,1287"/>
<area shape="rect" id="node10" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2043,1109,2153,1135"/>
<area shape="rect" id="node11" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1784,1359,1955,1386"/>
<area shape="rect" id="node16" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="913,1315,1084,1342"/>
<area shape="rect" id="node12" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="2017,1379,2179,1420"/>
<area shape="rect" id="node14" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="2017,1261,2179,1303"/>
<area shape="rect" id="node15" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="2003,1327,2193,1354"/>
<area shape="rect" id="node17" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="1132,1437,1299,1479"/>
<area shape="rect" id="node19" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="1569,1546,1736,1573"/>
<area shape="rect" id="node20" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1796,1546,1943,1573"/>
<area shape="rect" id="node21" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="2006,1597,2190,1623"/>
<area shape="rect" id="node22" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="1787,1210,1951,1237"/>
<area shape="rect" id="node23" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="2259,1447,2402,1474"/>
<area shape="rect" id="node24" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="2025,1049,2171,1075"/>
<area shape="rect" id="node42" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="2242,1251,2419,1278"/>
<area shape="rect" id="node25" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2484,1251,2664,1278"/>
<area shape="rect" id="node26" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2481,1353,2667,1379"/>
<area shape="rect" id="node27" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2468,1403,2680,1430"/>
<area shape="rect" id="node28" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2257,263,2405,290"/>
<area shape="rect" id="node35" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2485,1150,2663,1177"/>
<area shape="rect" id="node36" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2487,1201,2661,1227"/>
<area shape="rect" id="node37" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="2254,745,2407,771"/>
<area shape="rect" id="node38" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="2245,1049,2416,1075"/>
<area shape="rect" id="node39" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="2493,846,2655,873"/>
<area shape="rect" id="node40" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="2485,947,2663,974"/>
<area shape="rect" id="node41" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="2484,897,2664,923"/>
<area shape="rect" id="node29" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2765,329,2894,355"/>
<area shape="rect" id="node30" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="2488,137,2660,163"/>
<area shape="rect" id="node32" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="2481,86,2667,113"/>
<area shape="rect" id="node31" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="2728,137,2931,163"/>
<area shape="rect" id="node33" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="2742,263,2917,304"/>
<area shape="rect" id="node34" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="2979,263,3153,304"/>
<area shape="rect" id="node45" href="a00162.html#adc64d22375628582aa20cb1f8e9435a3" title="_mosquitto_write_byte" alt="" coords="922,1622,1075,1649"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab7f0afc1ca9700b58f5e6a817687d081"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_handle_connect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00202_source.html#l00077">77</a> of file <a class="el" href="a00202_source.html">read_handle_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;{</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">char</span> *protocol_name = NULL;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    uint8_t protocol_version;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    uint8_t connect_flags;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    uint8_t connect_ack = 0;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="a00483.html#a3e9d7ca53320ab5724302431905dac4e">client_id</a> = NULL;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">char</span> *will_payload = NULL, *will_topic = NULL;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">char</span> *will_topic_mount;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    uint16_t will_payloadlen;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00090.html">mosquitto_message</a> *will_struct = NULL;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    uint8_t <a class="code" href="a00493.html#abac88f1e2cd624816e669d98f0e94613">will</a>, will_retain, will_qos, clean_session;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    uint8_t username_flag, password_flag;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordtype">char</span> *username = NULL, *password = NULL;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00009.html">_mosquitto_acl_user</a> *acl_tail;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00088.html">mosquitto_client_msg</a> *msg_tail, *msg_prev;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00086.html">mosquitto</a> *found_context;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">int</span> slen;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00013.html">_mosquitto_subleaf</a> *leaf;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    X509 *client_cert = NULL;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    X509_NAME *name;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    X509_NAME_ENTRY *name_entry;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    g_connection_count++;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">/* Don&#39;t accept multiple CONNECT commands. */</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> != <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732a1ac025e41ce0956042188241aaa91c02">mosq_cs_new</a>){</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;protocol_name)){</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        rc = 1;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">if</span>(!protocol_name){</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        rc = 3;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">return</span> 3;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1">_mosquitto_read_byte</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;protocol_version)){</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        rc = 1;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span>(!strcmp(protocol_name, <a class="code" href="a00161.html#ac58b6d8513e10bbe28bfdb5ea8c82df6">PROTOCOL_NAME_v31</a>)){</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span>((protocol_version&amp;0x7F) != <a class="code" href="a00161.html#a2235366a1661ec6f2d419375fb7c498e">PROTOCOL_VERSION_v31</a>){</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">connection_messages</a> == <span class="keyword">true</span>){</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Invalid protocol version %d in CONNECT from %s.&quot;</span>,</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                        protocol_version, context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#a8150907b0b3117ce6b043218046d4679">CONNACK_REFUSED_PROTOCOL_VERSION</a>);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(protocol_name);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> = <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807baec0219584979ad8a56648f7abcf454d6">mosq_p_mqtt31</a>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(protocol_name, <a class="code" href="a00161.html#a215f1ddfbecfe965591b44bb03195773">PROTOCOL_NAME_v311</a>)){</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">if</span>((protocol_version&amp;0x7F) != <a class="code" href="a00161.html#a76c605764338153a480294c114e11b58">PROTOCOL_VERSION_v311</a>){</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">connection_messages</a> == <span class="keyword">true</span>){</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Invalid protocol version %d in CONNECT from %s.&quot;</span>,</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        protocol_version, context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#a8150907b0b3117ce6b043218046d4679">CONNACK_REFUSED_PROTOCOL_VERSION</a>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(protocol_name);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">if</span>((context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">command</a>&amp;0x0F) != 0x00){</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="comment">/* Reserved flags not set to 0, must disconnect. */</span> </div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(protocol_name);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> = <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">connection_messages</a> == <span class="keyword">true</span>){</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Invalid protocol \&quot;%s\&quot; in CONNECT from %s.&quot;</span>,</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    protocol_name, context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(protocol_name);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(protocol_name);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1">_mosquitto_read_byte</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;connect_flags)){</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        rc = 1;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">if</span>((connect_flags &amp; 0x01) != 0x00){</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    clean_session = (connect_flags &amp; 0x02) &gt;&gt; 1;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    will = connect_flags &amp; 0x04;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    will_qos = (connect_flags &amp; 0x18) &gt;&gt; 3;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span>(will_qos == 3){</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Invalid Will QoS in CONNECT from %s.&quot;</span>,</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    will_retain = ((connect_flags &amp; 0x20) == 0x20); <span class="comment">// Temporary hack because MSVC&lt;1800 doesn&#39;t have stdbool.h.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    password_flag = connect_flags &amp; 0x40;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    username_flag = connect_flags &amp; 0x80;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;(context-&gt;<a class="code" href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">keepalive</a>))){</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        rc = 1;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;client_id)){</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        rc = 1;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    slen = strlen(client_id);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span>(slen == 0){</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807baec0219584979ad8a56648f7abcf454d6">mosq_p_mqtt31</a>){</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#a5d9f8225f090dd49b45ea8e91e826118">CONNACK_REFUSED_IDENTIFIER_REJECTED</a>);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        }<span class="keywordflow">else</span>{ <span class="comment">/* mqtt311 */</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(client_id);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            client_id = NULL;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <span class="keywordflow">if</span>(clean_session == 0 || db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#abca22e565e524aaf18a090b102808cea">allow_zero_length_clientid</a> == <span class="keyword">false</span>){</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#a5d9f8225f090dd49b45ea8e91e826118">CONNACK_REFUSED_IDENTIFIER_REJECTED</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                client_id = client_id_gen(db);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="keywordflow">if</span>(!client_id){</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                    rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                    <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">/* clientid_prefixes check */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a1c1eac5ebdeac653c7a20f08eca128e2">clientid_prefixes</a>){</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">if</span>(strncmp(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a1c1eac5ebdeac653c7a20f08eca128e2">clientid_prefixes</a>, client_id, strlen(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a1c1eac5ebdeac653c7a20f08eca128e2">clientid_prefixes</a>))){</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#a4b5a062bd031b6f494ede27ca7b7e528">CONNACK_REFUSED_NOT_AUTHORIZED</a>);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            rc = 1;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">if</span>(will){</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        will_struct = <a class="code" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00090.html">mosquitto_message</a>));</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">if</span>(!will_struct){</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;will_topic)){</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            rc = 1;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00160.html#aa9fa8be3ee867892799799376cfb9c3b">STREMPTY</a>(will_topic)){</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            rc = 1;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span>(context-&gt;listener &amp;&amp; context-&gt;listener-&gt;mount_point){</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            slen = strlen(context-&gt;listener-&gt;mount_point) + strlen(will_topic) + 1;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            will_topic_mount = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(slen+1);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="keywordflow">if</span>(!will_topic_mount){</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            snprintf(will_topic_mount, slen, <span class="stringliteral">&quot;%s%s&quot;</span>, context-&gt;listener-&gt;mount_point, will_topic);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            will_topic_mount[slen] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(will_topic);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            will_topic = will_topic_mount;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319">mosquitto_pub_topic_check</a>(will_topic)){</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            rc = 1;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;will_payloadlen)){</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            rc = 1;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">if</span>(will_payloadlen &gt; 0){</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            will_payload = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(will_payloadlen);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">if</span>(!will_payload){</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                rc = 1;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            rc = <a class="code" href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9">_mosquitto_read_bytes</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, will_payload, will_payloadlen);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                rc = 1;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">if</span>(will_qos != 0 || will_retain != 0){</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">if</span>(username_flag){</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        rc = <a class="code" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;username);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span>(rc == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="keywordflow">if</span>(password_flag){</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                rc = <a class="code" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;password);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                <span class="keywordflow">if</span>(rc == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>){</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(rc == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>){</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807baec0219584979ad8a56648f7abcf454d6">mosq_p_mqtt31</a>){</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                        <span class="comment">/* Password flag given, but no password. Ignore. */</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                        password_flag = 0;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                        rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                        <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(rc == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>){</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807baec0219584979ad8a56648f7abcf454d6">mosq_p_mqtt31</a>){</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                <span class="comment">/* Username flag given, but no username. Ignore. */</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                username_flag = 0;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">if</span>(password_flag){</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="comment">/* username_flag == 0 &amp;&amp; password_flag == 1 is forbidden */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span>(context-&gt;listener &amp;&amp; context-&gt;listener-&gt;ssl_ctx &amp;&amp; context-&gt;listener-&gt;use_identity_as_username){</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">if</span>(!context-&gt;ssl){</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#aced9e444e25ec0c595487ca671984f85">CONNACK_REFUSED_BAD_USERNAME_PASSWORD</a>);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            rc = 1;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">#ifdef REAL_WITH_TLS_PSK</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span>(context-&gt;listener-&gt;psk_hint){</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="comment">/* Client should have provided an identity to get this far. */</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">if</span>(!context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#aced9e444e25ec0c595487ca671984f85">CONNACK_REFUSED_BAD_USERNAME_PASSWORD</a>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                rc = 1;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* REAL_WITH_TLS_PSK */</span><span class="preprocessor"></span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            client_cert = SSL_get_peer_certificate(context-&gt;ssl);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">if</span>(!client_cert){</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#aced9e444e25ec0c595487ca671984f85">CONNACK_REFUSED_BAD_USERNAME_PASSWORD</a>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                rc = 1;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            name = X509_get_subject_name(client_cert);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="keywordflow">if</span>(!name){</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#aced9e444e25ec0c595487ca671984f85">CONNACK_REFUSED_BAD_USERNAME_PASSWORD</a>);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                rc = 1;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            i = X509_NAME_get_index_by_NID(name, NID_commonName, -1);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="keywordflow">if</span>(i == -1){</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#aced9e444e25ec0c595487ca671984f85">CONNACK_REFUSED_BAD_USERNAME_PASSWORD</a>);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                rc = 1;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            name_entry = X509_NAME_get_entry(name, i);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>((<span class="keywordtype">char</span> *)ASN1_STRING_data(X509_NAME_ENTRY_get_data(name_entry)));</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">if</span>(!context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                rc = 1;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            X509_free(client_cert);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            client_cert = NULL;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="preprocessor">#ifdef REAL_WITH_TLS_PSK</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* REAL_WITH_TLS_PSK */</span><span class="preprocessor"></span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* WITH_TLS */</span><span class="preprocessor"></span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">if</span>(username_flag){</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            rc = <a class="code" href="a00196.html#afb27e1ef0cdde6bee2d77265380bef54">mosquitto_unpwd_check</a>(db, username, password);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <span class="keywordflow">switch</span>(rc){</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>:</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a>:</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                    <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#a4b5a062bd031b6f494ede27ca7b7e528">CONNACK_REFUSED_NOT_AUTHORIZED</a>);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                    <a class="code" href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738">mqtt3_context_disconnect</a>(db, context);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                    rc = 1;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                    <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">default</span>:</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    <a class="code" href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738">mqtt3_context_disconnect</a>(db, context);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    rc = 1;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a> = username;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            context-&gt;<a class="code" href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">password</a> = password;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            username = NULL; <span class="comment">/* Avoid free() in error: below. */</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            password = NULL;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">if</span>(!username_flag &amp;&amp; db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a5d81a9540395cbfe6d04949f457caf8f">allow_anonymous</a> == <span class="keyword">false</span>){</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#a4b5a062bd031b6f494ede27ca7b7e528">CONNACK_REFUSED_NOT_AUTHORIZED</a>);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            rc = 1;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span>(context-&gt;listener &amp;&amp; context-&gt;listener-&gt;use_username_as_clientid){</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(client_id);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            client_id = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keywordflow">if</span>(!client_id){</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, 0, <a class="code" href="a00161.html#a4b5a062bd031b6f494ede27ca7b7e528">CONNACK_REFUSED_NOT_AUTHORIZED</a>);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            rc = 1;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="keywordflow">goto</span> handle_connect_error;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">/* Find if this client already has an entry. This must be done *after* any security checks. */</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="a00209.html#ad4a1cd39c3044936c0e49d3f372c9dbf">HASH_FIND</a>(hh_id, db-&gt;<a class="code" href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">contexts_by_id</a>, client_id, strlen(client_id), found_context);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span>(found_context){</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="comment">/* Found a matching client */</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span>(found_context-&gt;<a class="code" href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">sock</a> == <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>){</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="comment">/* Client is reconnecting after a disconnect */</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            <span class="comment">/* FIXME - does anything need to be done here? */</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="comment">/* Client is already connected, disconnect old version. This is</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">             * done in mqtt3_context_cleanup() below. */</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">connection_messages</a> == <span class="keyword">true</span>){</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Client %s already connected, closing old connection.&quot;</span>, client_id);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordflow">if</span>(clean_session == 0){</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                connect_ack |= 0x01;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> = clean_session;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> == <span class="keyword">false</span> &amp;&amp; found_context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> == <span class="keyword">false</span>){</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">if</span>(found_context-&gt;msgs){</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                context-&gt;msgs = found_context-&gt;msgs;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                found_context-&gt;msgs = NULL;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <a class="code" href="a00191.html#a0e9e6632cd5553fd9aa4529b6416447b">mqtt3_db_message_reconnect_reset</a>(db, context);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            }</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            context-&gt;subs = found_context-&gt;subs;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            found_context-&gt;subs = NULL;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            context-&gt;sub_count = found_context-&gt;sub_count;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            found_context-&gt;sub_count = 0;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            context-&gt;<a class="code" href="a00086.html#ac51d22e18aab61d6cef627d58d8721ff">last_mid</a> = found_context-&gt;<a class="code" href="a00086.html#ac51d22e18aab61d6cef627d58d8721ff">last_mid</a>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">for</span>(i=0; i&lt;context-&gt;sub_count; i++){</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <span class="keywordflow">if</span>(context-&gt;subs[i]){</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                    leaf = context-&gt;subs[i]-&gt;subs;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    <span class="keywordflow">while</span>(leaf){</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                        <span class="keywordflow">if</span>(leaf-&gt;<a class="code" href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">context</a> == found_context){</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                            leaf-&gt;<a class="code" href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">context</a> = <a class="code" href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">context</a>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                        }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        leaf = leaf-&gt;<a class="code" href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">next</a>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                    }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        found_context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        found_context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <a class="code" href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a>(db, found_context);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">/* Associate user with its ACL, assuming we have ACLs loaded. */</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#a442ec343cb4b1102971160795eeed54d">acl_list</a>){</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        acl_tail = db-&gt;<a class="code" href="a00089.html#a442ec343cb4b1102971160795eeed54d">acl_list</a>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">while</span>(acl_tail){</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                <span class="keywordflow">if</span>(acl_tail-&gt;<a class="code" href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">username</a> &amp;&amp; !strcmp(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>, acl_tail-&gt;<a class="code" href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">username</a>)){</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                    context-&gt;acl_list = acl_tail;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                }</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                <span class="keywordflow">if</span>(acl_tail-&gt;<a class="code" href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">username</a> == NULL){</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    context-&gt;acl_list = acl_tail;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            acl_tail = acl_tail-&gt;<a class="code" href="a00009.html#aa97bb7e861123feead61d94ae0e5325f">next</a>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        context-&gt;acl_list = NULL;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span>(will_struct){</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a> = will_struct;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a>-&gt;<a class="code" href="a00090.html#acdc58bc163635058f4de09af79b59967">topic</a> = will_topic;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">if</span>(will_payload){</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a>-&gt;<a class="code" href="a00090.html#a4e243c2366d3d16e68846b61fc59c3df">payload</a> = will_payload;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a>-&gt;<a class="code" href="a00090.html#ab2e1ae99c2cd11eb8eac71eacc88d3a0">payloadlen</a> = will_payloadlen;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a>-&gt;<a class="code" href="a00090.html#a4e243c2366d3d16e68846b61fc59c3df">payload</a> = NULL;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a>-&gt;<a class="code" href="a00090.html#ab2e1ae99c2cd11eb8eac71eacc88d3a0">payloadlen</a> = 0;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a>-&gt;<a class="code" href="a00090.html#a5e9f64c323eba2deffb72d1d78cd8a4d">qos</a> = will_qos;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        context-&gt;<a class="code" href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">will</a>-&gt;<a class="code" href="a00090.html#a3ba1c96cd9ab5e8bda600b5b6b8c7468">retain</a> = will_retain;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">connection_messages</a> == <span class="keyword">true</span>){</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span>(context-&gt;is_bridge){</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;New bridge connected from %s as %s (c%d, k%d, u&#39;%s&#39;).&quot;</span>, context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>, client_id, clean_session, context-&gt;<a class="code" href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">keepalive</a>, context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;New bridge connected from %s as %s (c%d, k%d).&quot;</span>, context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>, client_id, clean_session, context-&gt;<a class="code" href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">keepalive</a>);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            }</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>){</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;New client connected from %s as %s (c%d, k%d, u&#39;%s&#39;).&quot;</span>, context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>, client_id, clean_session, context-&gt;<a class="code" href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">keepalive</a>, context-&gt;<a class="code" href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">username</a>);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;New client connected from %s as %s (c%d, k%d).&quot;</span>, context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>, client_id, clean_session, context-&gt;<a class="code" href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">keepalive</a>);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a> = <a class="code" href="a00483.html#a3e9d7ca53320ab5724302431905dac4e">client_id</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    client_id = NULL;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    context-&gt;<a class="code" href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">clean_session</a> = clean_session;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    context-&gt;<a class="code" href="a00086.html#afcd9d470e36f0a52613364bb4ede9e3a">ping_t</a> = 0;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    context-&gt;is_dropping = <span class="keyword">false</span>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span>((protocol_version&amp;0x80) == 0x80){</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        context-&gt;is_bridge = <span class="keyword">true</span>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    }</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">/* Remove any queued messages that are no longer allowed through ACL,</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">     * assuming a possible change of username. */</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    msg_tail = context-&gt;msgs;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    msg_prev = NULL;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">while</span>(msg_tail){</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keywordflow">if</span>(msg_tail-&gt;<a class="code" href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">direction</a> == <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a>){</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a>(db, context, msg_tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>-&gt;<a class="code" href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">topic</a>, <a class="code" href="a00198.html#af8ea2121bd604aeb622af53fc8beba35">MOSQ_ACL_READ</a>) != <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                <a class="code" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a>(db, &amp;msg_tail-&gt;<a class="code" href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">store</a>);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <span class="keywordflow">if</span>(msg_prev){</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                    msg_prev-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a> = msg_tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(msg_tail);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                    msg_tail = msg_prev-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                    context-&gt;msgs = context-&gt;msgs-&gt;next;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                    <span class="keywordflow">if</span>(context-&gt;last_msg == msg_tail){</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                        context-&gt;last_msg = NULL;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                    }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(msg_tail);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                    msg_tail = context-&gt;msgs;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                }</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                msg_prev = msg_tail;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                msg_tail = msg_tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            msg_prev = msg_tail;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            msg_tail = msg_tail-&gt;<a class="code" href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">next</a>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    }</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="a00209.html#a0b7468360b5c788762cdb2ccf9cd4d26">HASH_ADD_KEYPTR</a>(hh_id, db-&gt;<a class="code" href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">contexts_by_id</a>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, strlen(context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>), context);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span>(!clean_session){</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        db-&gt;<a class="code" href="a00089.html#a85ea76e88408ef3a3c00129214782028">persistence_changes</a>++;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d">mosq_cs_connected</a>;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a>(context, connect_ack, <a class="code" href="a00161.html#af091bde70bed3c1da6b8d03eafea7f5d">CONNACK_ACCEPTED</a>);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;handle_connect_error:</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span>(client_id) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(client_id);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span>(username) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(username);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span>(password) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(password);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">if</span>(will_payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(will_payload);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">if</span>(will_topic) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(will_topic);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span>(will_struct) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(will_struct);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">if</span>(client_cert) X509_free(client_cert);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">/* We return an error here which means the client is freed later on. */</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div><div class="ttc" id="a00086_html_afcd9d470e36f0a52613364bb4ede9e3a"><div class="ttname"><a href="a00086.html#afcd9d470e36f0a52613364bb4ede9e3a">mosquitto::ping_t</a></div><div class="ttdeci">time_t ping_t</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00171">mosquitto_internal.h:171</a></div></div>
<div class="ttc" id="a00089_html_a442ec343cb4b1102971160795eeed54d"><div class="ttname"><a href="a00089.html#a442ec343cb4b1102971160795eeed54d">mosquitto_db::acl_list</a></div><div class="ttdeci">struct _mosquitto_acl_user * acl_list</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00247">mosquitto_broker.h:247</a></div></div>
<div class="ttc" id="a00483_html_a3e9d7ca53320ab5724302431905dac4e"><div class="ttname"><a href="a00483.html#a3e9d7ca53320ab5724302431905dac4e">06-bridge-b2br-disconnect-qos1.client_id</a></div><div class="ttdeci">string client_id</div><div class="ttdef"><b>Definition:</b> <a href="a00256_source.html#l00017">06-bridge-b2br-disconnect-qos1.py:17</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9ae6f4a097429d6d8d619c56e24dafcd">MOSQ_ERR_AUTH</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00078">mosquitto.h:78</a></div></div>
<div class="ttc" id="a00161_html_ac58b6d8513e10bbe28bfdb5ea8c82df6"><div class="ttname"><a href="a00161.html#ac58b6d8513e10bbe28bfdb5ea8c82df6">PROTOCOL_NAME_v31</a></div><div class="ttdeci">#define PROTOCOL_NAME_v31</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00022">mqtt3_protocol.h:22</a></div></div>
<div class="ttc" id="a00086_html_a63df5a9670ff1c1336edc45e9a9500d6"><div class="ttname"><a href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">mosquitto::protocol</a></div><div class="ttdeci">enum _mosquitto_protocol protocol</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00161">mosquitto_internal.h:161</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ab1d5422d5d96716b73af1c11c4891e2d">mosq_cs_connected</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00094">mosquitto_internal.h:94</a></div></div>
<div class="ttc" id="a00088_html_a3a37d2ec3ec40dbb0ee15332baf82b45"><div class="ttname"><a href="a00088.html#a3a37d2ec3ec40dbb0ee15332baf82b45">mosquitto_client_msg::store</a></div><div class="ttdeci">struct mosquitto_msg_store * store</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00195">mosquitto_broker.h:195</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732a1ac025e41ce0956042188241aaa91c02"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732a1ac025e41ce0956042188241aaa91c02">mosq_cs_new</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00093">mosquitto_internal.h:93</a></div></div>
<div class="ttc" id="a00493_html_abac88f1e2cd624816e669d98f0e94613"><div class="ttname"><a href="a00493.html#abac88f1e2cd624816e669d98f0e94613">07-will-null.will</a></div><div class="ttdeci">will</div><div class="ttdef"><b>Definition:</b> <a href="a00268_source.html#l00033">07-will-null.py:33</a></div></div>
<div class="ttc" id="a00161_html_aced9e444e25ec0c595487ca671984f85"><div class="ttname"><a href="a00161.html#aced9e444e25ec0c595487ca671984f85">CONNACK_REFUSED_BAD_USERNAME_PASSWORD</a></div><div class="ttdeci">#define CONNACK_REFUSED_BAD_USERNAME_PASSWORD</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00048">mqtt3_protocol.h:48</a></div></div>
<div class="ttc" id="a00088_html"><div class="ttname"><a href="a00088.html">mosquitto_client_msg</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00193">mosquitto_broker.h:193</a></div></div>
<div class="ttc" id="a00097_html_a5d81a9540395cbfe6d04949f457caf8f"><div class="ttname"><a href="a00097.html#a5d81a9540395cbfe6d04949f457caf8f">mqtt3_config::allow_anonymous</a></div><div class="ttdeci">bool allow_anonymous</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00106">mosquitto_broker.h:106</a></div></div>
<div class="ttc" id="a00090_html_ab2e1ae99c2cd11eb8eac71eacc88d3a0"><div class="ttname"><a href="a00090.html#ab2e1ae99c2cd11eb8eac71eacc88d3a0">mosquitto_message::payloadlen</a></div><div class="ttdeci">int payloadlen</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00101">mosquitto.h:101</a></div></div>
<div class="ttc" id="a00160_html_a157834b9c1df5876b0fd037d3765807baec0219584979ad8a56648f7abcf454d6"><div class="ttname"><a href="a00160.html#a157834b9c1df5876b0fd037d3765807baec0219584979ad8a56648f7abcf454d6">mosq_p_mqtt31</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00113">mosquitto_internal.h:113</a></div></div>
<div class="ttc" id="a00086_html_ac51d22e18aab61d6cef627d58d8721ff"><div class="ttname"><a href="a00086.html#ac51d22e18aab61d6cef627d58d8721ff">mosquitto::last_mid</a></div><div class="ttdeci">uint16_t last_mid</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00167">mosquitto_internal.h:167</a></div></div>
<div class="ttc" id="a00159_html_a37608453ba85c5b8f9f15cff802a8319"><div class="ttname"><a href="a00159.html#a37608453ba85c5b8f9f15cff802a8319">mosquitto_pub_topic_check</a></div><div class="ttdeci">libmosq_EXPORT int mosquitto_pub_topic_check(const char *topic)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00179">util_mosq.c:179</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00086_html_ad0dd0827ca5d6aa033c36eb0ad447aa8"><div class="ttname"><a href="a00086.html#ad0dd0827ca5d6aa033c36eb0ad447aa8">mosquitto::password</a></div><div class="ttdeci">char * password</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00165">mosquitto_internal.h:165</a></div></div>
<div class="ttc" id="a00196_html_a6c132b4fe96e98b267516e77036cd409"><div class="ttname"><a href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a></div><div class="ttdeci">int mosquitto_acl_check(struct mosquitto_db *db, struct mosquitto *context, const char *topic, int access)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00218">security.c:218</a></div></div>
<div class="ttc" id="a00013_html_a942cc8378e37d1c3426cd0a11d6ef29d"><div class="ttname"><a href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">_mosquitto_subleaf::context</a></div><div class="ttdeci">struct mosquitto * context</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00157">mosquitto_broker.h:157</a></div></div>
<div class="ttc" id="a00089_html_ac5b775be8b87233bb22f20b10bbac0bd"><div class="ttname"><a href="a00089.html#ac5b775be8b87233bb22f20b10bbac0bd">mosquitto_db::contexts_by_id</a></div><div class="ttdeci">struct mosquitto * contexts_by_id</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00250">mosquitto_broker.h:250</a></div></div>
<div class="ttc" id="a00161_html_a76c605764338153a480294c114e11b58"><div class="ttname"><a href="a00161.html#a76c605764338153a480294c114e11b58">PROTOCOL_VERSION_v311</a></div><div class="ttdeci">#define PROTOCOL_VERSION_v311</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00026">mqtt3_protocol.h:26</a></div></div>
<div class="ttc" id="a00162_html_aa0425b094c40c000e3bdcef6c2766fc1"><div class="ttname"><a href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1">_mosquitto_read_byte</a></div><div class="ttdeci">int _mosquitto_read_byte(struct _mosquitto_packet *packet, uint8_t *byte)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00661">net_mosq.c:661</a></div></div>
<div class="ttc" id="a00009_html_a2db3d9318cbb28329cbc748f5e0df14f"><div class="ttname"><a href="a00009.html#a2db3d9318cbb28329cbc748f5e0df14f">_mosquitto_acl_user::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00226">mosquitto_broker.h:226</a></div></div>
<div class="ttc" id="a00097_html_a1c1eac5ebdeac653c7a20f08eca128e2"><div class="ttname"><a href="a00097.html#a1c1eac5ebdeac653c7a20f08eca128e2">mqtt3_config::clientid_prefixes</a></div><div class="ttdeci">char * clientid_prefixes</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00114">mosquitto_broker.h:114</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00088_html_a83facd74fd028e6d26f152f4a29aef8d"><div class="ttname"><a href="a00088.html#a83facd74fd028e6d26f152f4a29aef8d">mosquitto_client_msg::next</a></div><div class="ttdeci">struct mosquitto_client_msg * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00194">mosquitto_broker.h:194</a></div></div>
<div class="ttc" id="a00163_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00045">net_mosq.h:45</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00190_html_a1952df5bc9a6a0c54817fb60c955c738"><div class="ttname"><a href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738">mqtt3_context_disconnect</a></div><div class="ttdeci">void mqtt3_context_disconnect(struct mosquitto_db *db, struct mosquitto *ctxt)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00202">context.c:202</a></div></div>
<div class="ttc" id="a00011_html_a42171b2c83d8c83babc555d32ef84f7f"><div class="ttname"><a href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">_mosquitto_packet::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00140">mosquitto_internal.h:140</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00095">mosquitto_internal.h:95</a></div></div>
<div class="ttc" id="a00086_html_ab9d8935077ef424c322233a19a9cbf5c"><div class="ttname"><a href="a00086.html#ab9d8935077ef424c322233a19a9cbf5c">mosquitto::clean_session</a></div><div class="ttdeci">bool clean_session</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00205">mosquitto_internal.h:205</a></div></div>
<div class="ttc" id="a00090_html_a4e243c2366d3d16e68846b61fc59c3df"><div class="ttname"><a href="a00090.html#a4e243c2366d3d16e68846b61fc59c3df">mosquitto_message::payload</a></div><div class="ttdeci">void * payload</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00100">mosquitto.h:100</a></div></div>
<div class="ttc" id="a00086_html_a962322fe14ee02b439cc236a85dab410"><div class="ttname"><a href="a00086.html#a962322fe14ee02b439cc236a85dab410">mosquitto::address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00162">mosquitto_internal.h:162</a></div></div>
<div class="ttc" id="a00161_html_a4b5a062bd031b6f494ede27ca7b7e528"><div class="ttname"><a href="a00161.html#a4b5a062bd031b6f494ede27ca7b7e528">CONNACK_REFUSED_NOT_AUTHORIZED</a></div><div class="ttdeci">#define CONNACK_REFUSED_NOT_AUTHORIZED</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00049">mqtt3_protocol.h:49</a></div></div>
<div class="ttc" id="a00009_html"><div class="ttname"><a href="a00009.html">_mosquitto_acl_user</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00224">mosquitto_broker.h:224</a></div></div>
<div class="ttc" id="a00090_html"><div class="ttname"><a href="a00090.html">mosquitto_message</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00097">mosquitto.h:97</a></div></div>
<div class="ttc" id="a00159_html_a9813111aaf5eaafd2eaac66e1dc4659d"><div class="ttname"><a href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a></div><div class="ttdeci">#define MOSQ_LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00055">mosquitto.h:55</a></div></div>
<div class="ttc" id="a00086_html_a1bba05196d3100d3aa3ea78b7aa0bd14"><div class="ttname"><a href="a00086.html#a1bba05196d3100d3aa3ea78b7aa0bd14">mosquitto::keepalive</a></div><div class="ttdeci">uint16_t keepalive</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00166">mosquitto_internal.h:166</a></div></div>
<div class="ttc" id="a00086_html_a26a90a9bba5628b617203725c220aca5"><div class="ttname"><a href="a00086.html#a26a90a9bba5628b617203725c220aca5">mosquitto::state</a></div><div class="ttdeci">enum mosquitto_client_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00168">mosquitto_internal.h:168</a></div></div>
<div class="ttc" id="a00086_html_a31930c9d3d288fc2fdf253ccf01d10a3"><div class="ttname"><a href="a00086.html#a31930c9d3d288fc2fdf253ccf01d10a3">mosquitto::sock</a></div><div class="ttdeci">mosq_sock_t sock</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00154">mosquitto_internal.h:154</a></div></div>
<div class="ttc" id="a00161_html_a215f1ddfbecfe965591b44bb03195773"><div class="ttname"><a href="a00161.html#a215f1ddfbecfe965591b44bb03195773">PROTOCOL_NAME_v311</a></div><div class="ttdeci">#define PROTOCOL_NAME_v311</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00025">mqtt3_protocol.h:25</a></div></div>
<div class="ttc" id="a00160_html_a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4"><div class="ttname"><a href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00114">mosquitto_internal.h:114</a></div></div>
<div class="ttc" id="a00160_html_a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032"><div class="ttname"><a href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a120d221fb10f57c9074ce90ac7cce032">mosq_md_out</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00074">mosquitto_internal.h:74</a></div></div>
<div class="ttc" id="a00161_html_a8150907b0b3117ce6b043218046d4679"><div class="ttname"><a href="a00161.html#a8150907b0b3117ce6b043218046d4679">CONNACK_REFUSED_PROTOCOL_VERSION</a></div><div class="ttdeci">#define CONNACK_REFUSED_PROTOCOL_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00045">mqtt3_protocol.h:45</a></div></div>
<div class="ttc" id="a00009_html_aa97bb7e861123feead61d94ae0e5325f"><div class="ttname"><a href="a00009.html#aa97bb7e861123feead61d94ae0e5325f">_mosquitto_acl_user::next</a></div><div class="ttdeci">struct _mosquitto_acl_user * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00225">mosquitto_broker.h:225</a></div></div>
<div class="ttc" id="a00160_html_aa9fa8be3ee867892799799376cfb9c3b"><div class="ttname"><a href="a00160.html#aa9fa8be3ee867892799799376cfb9c3b">STREMPTY</a></div><div class="ttdeci">#define STREMPTY(str)</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00277">mosquitto_internal.h:277</a></div></div>
<div class="ttc" id="a00086_html_a03bed0e0b9a2f3eeecc5f26a6c247448"><div class="ttname"><a href="a00086.html#a03bed0e0b9a2f3eeecc5f26a6c247448">mosquitto::will</a></div><div class="ttdeci">struct mosquitto_message * will</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00175">mosquitto_internal.h:175</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00086_html_a31ecd6b5e37dbd8ea64c179259561d0f"><div class="ttname"><a href="a00086.html#a31ecd6b5e37dbd8ea64c179259561d0f">mosquitto::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00164">mosquitto_internal.h:164</a></div></div>
<div class="ttc" id="a00196_html_acfb0b5d2c57d066432343097452b9094"><div class="ttname"><a href="a00196.html#acfb0b5d2c57d066432343097452b9094">_mosquitto_send_connack</a></div><div class="ttdeci">int _mosquitto_send_connack(struct mosquitto *context, int ack, int result)</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00024">send_server.c:24</a></div></div>
<div class="ttc" id="a00198_html_af8ea2121bd604aeb622af53fc8beba35"><div class="ttname"><a href="a00198.html#af8ea2121bd604aeb622af53fc8beba35">MOSQ_ACL_READ</a></div><div class="ttdeci">#define MOSQ_ACL_READ</div><div class="ttdef"><b>Definition:</b> <a href="a00198_source.html#l00023">mosquitto_plugin.h:23</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00209_html_ad4a1cd39c3044936c0e49d3f372c9dbf"><div class="ttname"><a href="a00209.html#ad4a1cd39c3044936c0e49d3f372c9dbf">HASH_FIND</a></div><div class="ttdeci">#define HASH_FIND(hh, head, keyptr, keylen, out)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00094">uthash.h:94</a></div></div>
<div class="ttc" id="a00092_html_a9f27c2318268a2034571e2bbe91f69c6"><div class="ttname"><a href="a00092.html#a9f27c2318268a2034571e2bbe91f69c6">mosquitto_msg_store::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00184">mosquitto_broker.h:184</a></div></div>
<div class="ttc" id="a00191_html_af19cbc47cd971cdb22e9f48566bb3e68"><div class="ttname"><a href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68">mosquitto__db_msg_store_deref</a></div><div class="ttdeci">void mosquitto__db_msg_store_deref(struct mosquitto_db *db, struct mosquitto_msg_store **store)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00188">database.c:188</a></div></div>
<div class="ttc" id="a00161_html_a2235366a1661ec6f2d419375fb7c498e"><div class="ttname"><a href="a00161.html#a2235366a1661ec6f2d419375fb7c498e">PROTOCOL_VERSION_v31</a></div><div class="ttdeci">#define PROTOCOL_VERSION_v31</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00023">mqtt3_protocol.h:23</a></div></div>
<div class="ttc" id="a00159_html_a53ca7e5700e1a592fc72d43cdff68dd3"><div class="ttname"><a href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a></div><div class="ttdeci">#define MOSQ_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00054">mosquitto.h:54</a></div></div>
<div class="ttc" id="a00013_html"><div class="ttname"><a href="a00013.html">_mosquitto_subleaf</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00154">mosquitto_broker.h:154</a></div></div>
<div class="ttc" id="a00196_html_afb27e1ef0cdde6bee2d77265380bef54"><div class="ttname"><a href="a00196.html#afb27e1ef0cdde6bee2d77265380bef54">mosquitto_unpwd_check</a></div><div class="ttdeci">int mosquitto_unpwd_check(struct mosquitto_db *db, const char *username, const char *password)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00257">security.c:257</a></div></div>
<div class="ttc" id="a00162_html_a01f59932d591f15b0376fd1f24a437e8"><div class="ttname"><a href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a></div><div class="ttdeci">int _mosquitto_read_uint16(struct _mosquitto_packet *packet, uint16_t *word)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00731">net_mosq.c:731</a></div></div>
<div class="ttc" id="a00086_html"><div class="ttname"><a href="a00086.html">mosquitto</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00153">mosquitto_internal.h:153</a></div></div>
<div class="ttc" id="a00088_html_a323f6ea0b036b886cf7998e24d60c997"><div class="ttname"><a href="a00088.html#a323f6ea0b036b886cf7998e24d60c997">mosquitto_client_msg::direction</a></div><div class="ttdeci">enum mosquitto_msg_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00200">mosquitto_broker.h:200</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00069">mosquitto.h:69</a></div></div>
<div class="ttc" id="a00161_html_a5d9f8225f090dd49b45ea8e91e826118"><div class="ttname"><a href="a00161.html#a5d9f8225f090dd49b45ea8e91e826118">CONNACK_REFUSED_IDENTIFIER_REJECTED</a></div><div class="ttdeci">#define CONNACK_REFUSED_IDENTIFIER_REJECTED</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00046">mqtt3_protocol.h:46</a></div></div>
<div class="ttc" id="a00090_html_acdc58bc163635058f4de09af79b59967"><div class="ttname"><a href="a00090.html#acdc58bc163635058f4de09af79b59967">mosquitto_message::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00099">mosquitto.h:99</a></div></div>
<div class="ttc" id="a00097_html_a2bc58933451bd6d17a5e9a58ebea1428"><div class="ttname"><a href="a00097.html#a2bc58933451bd6d17a5e9a58ebea1428">mqtt3_config::connection_messages</a></div><div class="ttdeci">bool connection_messages</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00115">mosquitto_broker.h:115</a></div></div>
<div class="ttc" id="a00153_html_a1ecbcb0ab8e51c000672d9d2bdf8172c"><div class="ttname"><a href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a></div><div class="ttdeci">void * _mosquitto_calloc(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00040">memory_mosq.c:40</a></div></div>
<div class="ttc" id="a00090_html_a5e9f64c323eba2deffb72d1d78cd8a4d"><div class="ttname"><a href="a00090.html#a5e9f64c323eba2deffb72d1d78cd8a4d">mosquitto_message::qos</a></div><div class="ttdeci">int qos</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00102">mosquitto.h:102</a></div></div>
<div class="ttc" id="a00090_html_a3ba1c96cd9ab5e8bda600b5b6b8c7468"><div class="ttname"><a href="a00090.html#a3ba1c96cd9ab5e8bda600b5b6b8c7468">mosquitto_message::retain</a></div><div class="ttdeci">bool retain</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00103">mosquitto.h:103</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00162_html_a3f8290ea4ea68607b546aaac08a4d8d7"><div class="ttname"><a href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a></div><div class="ttdeci">int _mosquitto_read_string(struct _mosquitto_packet *packet, char **str)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00701">net_mosq.c:701</a></div></div>
<div class="ttc" id="a00097_html_abca22e565e524aaf18a090b102808cea"><div class="ttname"><a href="a00097.html#abca22e565e524aaf18a090b102808cea">mqtt3_config::allow_zero_length_clientid</a></div><div class="ttdeci">bool allow_zero_length_clientid</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00108">mosquitto_broker.h:108</a></div></div>
<div class="ttc" id="a00089_html_a85ea76e88408ef3a3c00129214782028"><div class="ttname"><a href="a00089.html#a85ea76e88408ef3a3c00129214782028">mosquitto_db::persistence_changes</a></div><div class="ttdeci">int persistence_changes</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00264">mosquitto_broker.h:264</a></div></div>
<div class="ttc" id="a00013_html_ac3373712c2cf873c9d806f8c071f44a6"><div class="ttname"><a href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">_mosquitto_subleaf::next</a></div><div class="ttdeci">struct _mosquitto_subleaf * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00156">mosquitto_broker.h:156</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00162_html_a668e43fc39fa0ae062aaa427b15382a9"><div class="ttname"><a href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9">_mosquitto_read_bytes</a></div><div class="ttdeci">int _mosquitto_read_bytes(struct _mosquitto_packet *packet, void *bytes, uint32_t count)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00681">net_mosq.c:681</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
<div class="ttc" id="a00161_html_af091bde70bed3c1da6b8d03eafea7f5d"><div class="ttname"><a href="a00161.html#af091bde70bed3c1da6b8d03eafea7f5d">CONNACK_ACCEPTED</a></div><div class="ttdeci">#define CONNACK_ACCEPTED</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00044">mqtt3_protocol.h:44</a></div></div>
<div class="ttc" id="a00191_html_a0e9e6632cd5553fd9aa4529b6416447b"><div class="ttname"><a href="a00191.html#a0e9e6632cd5553fd9aa4529b6416447b">mqtt3_db_message_reconnect_reset</a></div><div class="ttdeci">int mqtt3_db_message_reconnect_reset(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00621">database.c:621</a></div></div>
<div class="ttc" id="a00195_html_af52acda25b9090675773beafeca25264"><div class="ttname"><a href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a></div><div class="ttdeci">void do_disconnect(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00195_source.html#l00424">loop.c:424</a></div></div>
<div class="ttc" id="a00209_html_a0b7468360b5c788762cdb2ccf9cd4d26"><div class="ttname"><a href="a00209.html#a0b7468360b5c788762cdb2ccf9cd4d26">HASH_ADD_KEYPTR</a></div><div class="ttdeci">#define HASH_ADD_KEYPTR(hh, head, keyptr, keylen_in, add)</div><div class="ttdef"><b>Definition:</b> <a href="a00209_source.html#l00173">uthash.h:173</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_ab7f0afc1ca9700b58f5e6a817687d081_cgraph.png" border="0" usemap="#a00196_ab7f0afc1ca9700b58f5e6a817687d081_cgraph" alt=""/></div>
<map name="a00196_ab7f0afc1ca9700b58f5e6a817687d081_cgraph" id="a00196_ab7f0afc1ca9700b58f5e6a817687d081_cgraph">
<area shape="rect" id="node2" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="1409,1554,1566,1581"/>
<area shape="rect" id="node3" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="1649,226,1809,253"/>
<area shape="rect" id="node4" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="1663,1504,1794,1530"/>
<area shape="rect" id="node5" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1" title="_mosquitto_read_byte" alt="" coords="231,1866,382,1893"/>
<area shape="rect" id="node6" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="1655,505,1802,532"/>
<area shape="rect" id="node7" href="a00196.html#acfb0b5d2c57d066432343097452b9094" title="_mosquitto_send_connack" alt="" coords="218,1069,395,1096"/>
<area shape="rect" id="node8" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="1424,1149,1551,1176"/>
<area shape="rect" id="node15" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1864,1301,1979,1328"/>
<area shape="rect" id="node30" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319" title="mosquitto_pub_topic\l_check" alt="" coords="235,1918,378,1959"/>
<area shape="rect" id="node31" href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9" title="_mosquitto_read_bytes" alt="" coords="228,1984,385,2010"/>
<area shape="rect" id="node32" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="1664,1706,1793,1733"/>
<area shape="rect" id="node33" href="a00196.html#afb27e1ef0cdde6bee2d77265380bef54" title="mosquitto_unpwd_check" alt="" coords="459,68,625,94"/>
<area shape="rect" id="node35" href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738" title="mqtt3_context_disconnect" alt="" coords="455,968,629,994"/>
<area shape="rect" id="node37" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="933,1402,1078,1429"/>
<area shape="rect" id="node46" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="1400,1934,1575,1975"/>
<area shape="rect" id="node48" href="a00191.html#a0e9e6632cd5553fd9aa4529b6416447b" title="mqtt3_db_message_reconnect\l_reset" alt="" coords="207,2035,407,2076"/>
<area shape="rect" id="node49" href="a00195.html#af52acda25b9090675773beafeca25264" title="do_disconnect" alt="" coords="253,708,360,734"/>
<area shape="rect" id="node9" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="459,913,625,940"/>
<area shape="rect" id="node19" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="455,850,629,877"/>
<area shape="rect" id="node10" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="701,902,844,943"/>
<area shape="rect" id="node11" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="677,733,868,760"/>
<area shape="rect" id="node12" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="1183,581,1293,608"/>
<area shape="rect" id="node13" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="920,901,1091,928"/>
<area shape="rect" id="node18" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="920,632,1091,658"/>
<area shape="rect" id="node14" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1157,835,1319,876"/>
<area shape="rect" id="node16" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1157,952,1319,994"/>
<area shape="rect" id="node17" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1143,901,1333,928"/>
<area shape="rect" id="node20" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="689,564,856,590"/>
<area shape="rect" id="node21" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="932,429,1079,456"/>
<area shape="rect" id="node22" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="1146,530,1330,557"/>
<area shape="rect" id="node23" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="923,378,1087,405"/>
<area shape="rect" id="node24" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="1167,378,1309,405"/>
<area shape="rect" id="node25" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="1165,226,1311,253"/>
<area shape="rect" id="node29" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="1149,277,1327,304"/>
<area shape="rect" id="node26" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="1397,277,1577,304"/>
<area shape="rect" id="node27" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="1394,328,1581,354"/>
<area shape="rect" id="node28" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="1381,226,1593,253"/>
<area shape="rect" id="node34" href="a00196.html#a20315c474619e67362c6472ac7d46e3f" title="mosquitto_unpwd_check\l_default" alt="" coords="689,59,856,100"/>
<area shape="rect" id="node36" href="a00190.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="689,1504,856,1530"/>
<area shape="rect" id="node43" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="916,1656,1095,1698"/>
<area shape="rect" id="node38" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="1165,1424,1311,1466"/>
<area shape="rect" id="node39" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="1388,1504,1587,1530"/>
<area shape="rect" id="node40" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="1425,1352,1550,1378"/>
<area shape="rect" id="node41" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="1450,1757,1525,1784"/>
<area shape="rect" id="node42" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="1427,1453,1548,1480"/>
<area shape="rect" id="node44" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="1401,1656,1573,1682"/>
<area shape="rect" id="node45" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="1145,1816,1331,1842"/>
<area shape="rect" id="node47" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="1641,1883,1816,1924"/>
<area shape="rect" id="node50" href="a00190.html#a7310ffcd887c91eef7b5f087ff04af3f" title="mosquitto__add_context\l_to_disused" alt="" coords="460,700,624,742"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1e6ad6e84cfeebd256ba58cd2553aca2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_handle_disconnect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00202_source.html#l00600">600</a> of file <a class="el" href="a00202_source.html">read_handle_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;{</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span>(!context){</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">remaining_length</a> != 0){</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Received DISCONNECT from %s&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">if</span>((context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">command</a>&amp;0x0F) != 0x00){</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <a class="code" href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a>(db, context);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    context-&gt;<a class="code" href="a00086.html#a26a90a9bba5628b617203725c220aca5">state</a> = <a class="code" href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <a class="code" href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a>(db, context);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div><div class="ttc" id="a00086_html_a63df5a9670ff1c1336edc45e9a9500d6"><div class="ttname"><a href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">mosquitto::protocol</a></div><div class="ttdeci">enum _mosquitto_protocol protocol</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00161">mosquitto_internal.h:161</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00011_html_a42171b2c83d8c83babc555d32ef84f7f"><div class="ttname"><a href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">_mosquitto_packet::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00140">mosquitto_internal.h:140</a></div></div>
<div class="ttc" id="a00160_html_ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb"><div class="ttname"><a href="a00160.html#ae88f365ea35936854748d46b06557732ac7101bbc53e7869ee050ea4cb5444fbb">mosq_cs_disconnecting</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00095">mosquitto_internal.h:95</a></div></div>
<div class="ttc" id="a00086_html_a26a90a9bba5628b617203725c220aca5"><div class="ttname"><a href="a00086.html#a26a90a9bba5628b617203725c220aca5">mosquitto::state</a></div><div class="ttdeci">enum mosquitto_client_state state</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00168">mosquitto_internal.h:168</a></div></div>
<div class="ttc" id="a00160_html_a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4"><div class="ttname"><a href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00114">mosquitto_internal.h:114</a></div></div>
<div class="ttc" id="a00159_html_a9a0714eb912755e4dc621c1e902c0bcf"><div class="ttname"><a href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a></div><div class="ttdeci">#define MOSQ_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00058">mosquitto.h:58</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00069">mosquitto.h:69</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00011_html_a5616fcfbaf0e409e06b1c857c940471a"><div class="ttname"><a href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">_mosquitto_packet::remaining_length</a></div><div class="ttdeci">uint32_t remaining_length</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00135">mosquitto_internal.h:135</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
<div class="ttc" id="a00195_html_af52acda25b9090675773beafeca25264"><div class="ttname"><a href="a00195.html#af52acda25b9090675773beafeca25264">do_disconnect</a></div><div class="ttdeci">void do_disconnect(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00195_source.html#l00424">loop.c:424</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a1e6ad6e84cfeebd256ba58cd2553aca2_cgraph.png" border="0" usemap="#a00196_a1e6ad6e84cfeebd256ba58cd2553aca2_cgraph" alt=""/></div>
<map name="a00196_a1e6ad6e84cfeebd256ba58cd2553aca2_cgraph" id="a00196_a1e6ad6e84cfeebd256ba58cd2553aca2_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2227,708,2374,735"/>
<area shape="rect" id="node3" href="a00195.html#af52acda25b9090675773beafeca25264" title="do_disconnect" alt="" coords="224,2228,331,2255"/>
<area shape="rect" id="node4" href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738" title="mqtt3_context_disconnect" alt="" coords="1240,2759,1415,2786"/>
<area shape="rect" id="node10" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="2243,2531,2358,2558"/>
<area shape="rect" id="node20" href="a00190.html#a7310ffcd887c91eef7b5f087ff04af3f" title="mosquitto__add_context\l_to_disused" alt="" coords="380,2585,544,2626"/>
<area shape="rect" id="node21" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="379,2534,545,2560"/>
<area shape="rect" id="node25" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="593,1606,757,1632"/>
<area shape="rect" id="node5" href="a00190.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="1478,2527,1645,2554"/>
<area shape="rect" id="node16" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1476,3020,1647,3047"/>
<area shape="rect" id="node6" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="1740,1866,1885,1892"/>
<area shape="rect" id="node13" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="1723,2490,1902,2532"/>
<area shape="rect" id="node7" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="1987,2034,2133,2076"/>
<area shape="rect" id="node8" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2201,1962,2400,1988"/>
<area shape="rect" id="node9" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2235,1628,2366,1655"/>
<area shape="rect" id="node11" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2236,2071,2365,2098"/>
<area shape="rect" id="node12" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2237,2962,2364,2988"/>
<area shape="rect" id="node14" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="1974,1983,2146,2010"/>
<area shape="rect" id="node15" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="1967,2506,2153,2532"/>
<area shape="rect" id="node17" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1732,3130,1893,3172"/>
<area shape="rect" id="node18" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1732,3013,1893,3054"/>
<area shape="rect" id="node19" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1717,3079,1908,3106"/>
<area shape="rect" id="node22" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1041,1663,1187,1690"/>
<area shape="rect" id="node23" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="805,2708,989,2735"/>
<area shape="rect" id="node24" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2245,2328,2356,2355"/>
<area shape="rect" id="node26" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="1043,1207,1185,1234"/>
<area shape="rect" id="node27" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="824,751,971,778"/>
<area shape="rect" id="node48" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="1239,548,1416,575"/>
<area shape="rect" id="node28" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="1471,447,1651,474"/>
<area shape="rect" id="node30" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="1468,244,1655,271"/>
<area shape="rect" id="node35" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="1707,346,1919,372"/>
<area shape="rect" id="node36" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="1487,1942,1635,1968"/>
<area shape="rect" id="node40" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="1724,548,1901,575"/>
<area shape="rect" id="node41" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="1475,346,1648,372"/>
<area shape="rect" id="node42" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="1037,1815,1191,1842"/>
<area shape="rect" id="node43" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="1480,1258,1643,1284"/>
<area shape="rect" id="node44" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="1473,1004,1650,1031"/>
<area shape="rect" id="node45" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="1483,2439,1639,2466"/>
<area shape="rect" id="node46" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="1723,1106,1903,1132"/>
<area shape="rect" id="node47" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="1464,700,1659,727"/>
<area shape="rect" id="node29" href="a00171.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="1971,480,2149,507"/>
<area shape="rect" id="node31" href="a00169.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="1707,295,1919,322"/>
<area shape="rect" id="node32" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="1980,827,2140,854"/>
<area shape="rect" id="node33" href="a00191.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="1971,430,2149,456"/>
<area shape="rect" id="node34" href="a00155.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="1987,313,2133,354"/>
<area shape="rect" id="node37" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="1734,1308,1891,1335"/>
<area shape="rect" id="node38" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319" title="mosquitto_pub_topic\l_check" alt="" coords="1741,2322,1884,2364"/>
<area shape="rect" id="node39" href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9" title="_mosquitto_read_bytes" alt="" coords="1734,1764,1891,1791"/>
<area shape="rect" id="node49" href="a00164.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="1472,1359,1651,1386"/>
<area shape="rect" id="node50" href="a00166.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="1967,683,2153,710"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab73094667db8b9226ef81e7895b934f6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_handle_publish </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00165_source.html#l00075">75</a> of file <a class="el" href="a00165_source.html">read_handle.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">char</span> *topic;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">void</span> *payload = NULL;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    uint32_t payloadlen;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    uint8_t dup, <a class="code" href="a00013.html#aa1ddfac26492a4103cf0a20509eb4395">qos</a>, retain;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    uint16_t <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a> = 0;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = 0;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    uint8_t header = context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">command</a>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00092.html">mosquitto_msg_store</a> *stored = NULL;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">int</span> len;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">char</span> *topic_mount;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">char</span> *topic_temp;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00016.html">_mqtt3_bridge_topic</a> *cur_topic;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordtype">bool</span> match;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    dup = (header &amp; 0x08)&gt;&gt;3;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    qos = (header &amp; 0x06)&gt;&gt;1;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span>(qos == 3){</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <span class="stringliteral">&quot;Invalid QoS in PUBLISH from %s, disconnecting.&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    retain = (header &amp; 0x01);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;topic)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00160.html#aa9fa8be3ee867892799799376cfb9c3b">STREMPTY</a>(topic)){</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="comment">/* Invalid publish topic, disconnect client. */</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span>(context-&gt;bridge &amp;&amp; context-&gt;bridge-&gt;topics &amp;&amp; context-&gt;bridge-&gt;topic_remapping){</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">for</span>(i=0; i&lt;context-&gt;bridge-&gt;topic_count; i++){</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            cur_topic = &amp;context-&gt;bridge-&gt;topics[i];</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keywordflow">if</span>((cur_topic-&gt;<a class="code" href="a00016.html#a88b23b4adfa1c1f7c019eb4b972f5d14">direction</a> == <a class="code" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75">bd_both</a> || cur_topic-&gt;<a class="code" href="a00016.html#a88b23b4adfa1c1f7c019eb4b972f5d14">direction</a> == <a class="code" href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8">bd_in</a>) </div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    &amp;&amp; (cur_topic-&gt;<a class="code" href="a00016.html#aeed460cf6b45e2e993434395a1221e86">remote_prefix</a> || cur_topic-&gt;<a class="code" href="a00016.html#afd755fdffab432e79e32a2989e03baa2">local_prefix</a>)){</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <span class="comment">/* Topic mapping required on this topic if the message matches */</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                rc = <a class="code" href="a00159.html#abebbf4017c11827f1ac999082980cf2f">mosquitto_topic_matches_sub</a>(cur_topic-&gt;<a class="code" href="a00016.html#aebfc8793aee8b135c4c4d22f9160f0c1">remote_topic</a>, topic, &amp;match);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="keywordflow">if</span>(rc){</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <span class="keywordflow">if</span>(match){</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    <span class="keywordflow">if</span>(cur_topic-&gt;<a class="code" href="a00016.html#aeed460cf6b45e2e993434395a1221e86">remote_prefix</a>){</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <span class="comment">/* This prefix needs removing. */</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                        <span class="keywordflow">if</span>(!strncmp(cur_topic-&gt;<a class="code" href="a00016.html#aeed460cf6b45e2e993434395a1221e86">remote_prefix</a>, topic, strlen(cur_topic-&gt;<a class="code" href="a00016.html#aeed460cf6b45e2e993434395a1221e86">remote_prefix</a>))){</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                            topic_temp = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(topic+strlen(cur_topic-&gt;<a class="code" href="a00016.html#aeed460cf6b45e2e993434395a1221e86">remote_prefix</a>));</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                            <span class="keywordflow">if</span>(!topic_temp){</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                            }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                            topic = topic_temp;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                        }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    <span class="keywordflow">if</span>(cur_topic-&gt;<a class="code" href="a00016.html#afd755fdffab432e79e32a2989e03baa2">local_prefix</a>){</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        <span class="comment">/* This prefix needs adding. */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        len = strlen(topic) + strlen(cur_topic-&gt;<a class="code" href="a00016.html#afd755fdffab432e79e32a2989e03baa2">local_prefix</a>)+1;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        topic_temp = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(len+1);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                        <span class="keywordflow">if</span>(!topic_temp){</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                        snprintf(topic_temp, len, <span class="stringliteral">&quot;%s%s&quot;</span>, cur_topic-&gt;<a class="code" href="a00016.html#afd755fdffab432e79e32a2989e03baa2">local_prefix</a>, topic);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                        topic_temp[len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                        topic = topic_temp;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                    }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319">mosquitto_pub_topic_check</a>(topic) != <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">/* Invalid publish topic, just swallow it. */</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span>(qos &gt; 0){</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;mid)){</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    payloadlen = context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">remaining_length</a> - context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#aee3849504ce401add5fdf9235541f274">pos</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    g_pub_bytes_received += payloadlen;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span>(context-&gt;listener &amp;&amp; context-&gt;listener-&gt;mount_point){</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        len = strlen(context-&gt;listener-&gt;mount_point) + strlen(topic) + 1;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        topic_mount = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(len+1);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span>(!topic_mount){</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        snprintf(topic_mount, len, <span class="stringliteral">&quot;%s%s&quot;</span>, context-&gt;listener-&gt;mount_point, topic);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        topic_mount[len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        topic = topic_mount;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span>(payloadlen){</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2debc661bbf726e22a560f511a181979">message_size_limit</a> &amp;&amp; payloadlen &gt; db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#a2debc661bbf726e22a560f511a181979">message_size_limit</a>){</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Dropped too large PUBLISH from %s (d%d, q%d, r%d, m%d, &#39;%s&#39;, ... (%ld bytes))&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, dup, qos, retain, mid, topic, (<span class="keywordtype">long</span>)payloadlen);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">goto</span> process_bad_message;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        payload = <a class="code" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a>(payloadlen+1, 1);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">if</span>(!payload){</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9">_mosquitto_read_bytes</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, payload, payloadlen)){</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">/* Check for topic access */</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    rc = <a class="code" href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a>(db, context, topic, <a class="code" href="a00198.html#a8297ba287fb051c8890c2d27c692e389">MOSQ_ACL_WRITE</a>);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span>(rc == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>){</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Denied PUBLISH from %s (d%d, q%d, r%d, m%d, &#39;%s&#39;, ... (%ld bytes))&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, dup, qos, retain, mid, topic, (<span class="keywordtype">long</span>)payloadlen);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">goto</span> process_bad_message;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(rc != <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Received PUBLISH from %s (d%d, q%d, r%d, m%d, &#39;%s&#39;, ... (%ld bytes))&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, dup, qos, retain, mid, topic, (<span class="keywordtype">long</span>)payloadlen);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">if</span>(qos &gt; 0){</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <a class="code" href="a00191.html#a69b7b5c13ef8ca9d3968a208b3cbb7f6">mqtt3_db_message_store_find</a>(context, mid, &amp;stored);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span>(!stored){</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        dup = 0;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00191.html#a36e4902f860237756538cc4a58e1321b">mqtt3_db_message_store</a>(db, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, mid, topic, qos, payloadlen, payload, retain, &amp;stored, 0)){</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        dup = 1;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">switch</span>(qos){</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca">mqtt3_db_messages_queue</a>(db, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, topic, qos, retain, &amp;stored)) rc = 1;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca">mqtt3_db_messages_queue</a>(db, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, topic, qos, retain, &amp;stored)) rc = 1;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00171.html#ab1b844a445f74762e20a3411cbf7ac2f">_mosquitto_send_puback</a>(context, mid)) rc = 1;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span>(!dup){</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                res = <a class="code" href="a00191.html#a273c85b4bc9f22d097948f4021190bc8">mqtt3_db_message_insert</a>(db, context, mid, <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020">mosq_md_in</a>, qos, retain, stored);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                res = 0;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="comment">/* mqtt3_db_message_insert() returns 2 to indicate dropped message</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">             * due to queue. This isn&#39;t an error so don&#39;t disconnect them. */</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">if</span>(!res){</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630">_mosquitto_send_pubrec</a>(context, mid)) rc = 1;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(res == 1){</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                rc = 1;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;process_bad_message:</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(topic);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">switch</span>(qos){</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00171.html#ab1b844a445f74762e20a3411cbf7ac2f">_mosquitto_send_puback</a>(context, mid);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <a class="code" href="a00191.html#a69b7b5c13ef8ca9d3968a208b3cbb7f6">mqtt3_db_message_store_find</a>(context, mid, &amp;stored);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">if</span>(!stored){</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="a00191.html#a36e4902f860237756538cc4a58e1321b">mqtt3_db_message_store</a>(db, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, mid, NULL, qos, 0, NULL, <span class="keyword">false</span>, &amp;stored, 0)){</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                res = <a class="code" href="a00191.html#a273c85b4bc9f22d097948f4021190bc8">mqtt3_db_message_insert</a>(db, context, mid, <a class="code" href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020">mosq_md_in</a>, qos, <span class="keyword">false</span>, stored);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                res = 0;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">if</span>(!res){</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                res = <a class="code" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630">_mosquitto_send_pubrec</a>(context, mid);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div><div class="ttc" id="a00016_html_aebfc8793aee8b135c4c4d22f9160f0c1"><div class="ttname"><a href="a00016.html#aebfc8793aee8b135c4c4d22f9160f0c1">_mqtt3_bridge_topic::remote_topic</a></div><div class="ttdeci">char * remote_topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00293">mosquitto_broker.h:293</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00171_html_ab1b844a445f74762e20a3411cbf7ac2f"><div class="ttname"><a href="a00171.html#ab1b844a445f74762e20a3411cbf7ac2f">_mosquitto_send_puback</a></div><div class="ttdeci">int _mosquitto_send_puback(struct mosquitto *mosq, uint16_t mid)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00064">send_mosq.c:64</a></div></div>
<div class="ttc" id="a00198_html_a8297ba287fb051c8890c2d27c692e389"><div class="ttname"><a href="a00198.html#a8297ba287fb051c8890c2d27c692e389">MOSQ_ACL_WRITE</a></div><div class="ttdeci">#define MOSQ_ACL_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="a00198_source.html#l00024">mosquitto_plugin.h:24</a></div></div>
<div class="ttc" id="a00011_html_aee3849504ce401add5fdf9235541f274"><div class="ttname"><a href="a00011.html#aee3849504ce401add5fdf9235541f274">_mosquitto_packet::pos</a></div><div class="ttdeci">uint32_t pos</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00138">mosquitto_internal.h:138</a></div></div>
<div class="ttc" id="a00171_html_a07fb7f8b0c76e21162abb92404ac8630"><div class="ttname"><a href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630">_mosquitto_send_pubrec</a></div><div class="ttdeci">int _mosquitto_send_pubrec(struct mosquitto *mosq, uint16_t mid)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00179">send_mosq.c:179</a></div></div>
<div class="ttc" id="a00191_html_a36e4902f860237756538cc4a58e1321b"><div class="ttname"><a href="a00191.html#a36e4902f860237756538cc4a58e1321b">mqtt3_db_message_store</a></div><div class="ttdeci">int mqtt3_db_message_store(struct mosquitto_db *db, const char *source, uint16_t source_mid, const char *topic, int qos, uint32_t payloadlen, const void *payload, int retain, struct mosquitto_msg_store **stored, dbid_t store_id)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00526">database.c:526</a></div></div>
<div class="ttc" id="a00159_html_a37608453ba85c5b8f9f15cff802a8319"><div class="ttname"><a href="a00159.html#a37608453ba85c5b8f9f15cff802a8319">mosquitto_pub_topic_check</a></div><div class="ttdeci">libmosq_EXPORT int mosquitto_pub_topic_check(const char *topic)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00179">util_mosq.c:179</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00159_html_abebbf4017c11827f1ac999082980cf2f"><div class="ttname"><a href="a00159.html#abebbf4017c11827f1ac999082980cf2f">mosquitto_topic_matches_sub</a></div><div class="ttdeci">libmosq_EXPORT int mosquitto_topic_matches_sub(const char *sub, const char *topic, bool *result)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00225">util_mosq.c:225</a></div></div>
<div class="ttc" id="a00196_html_a6c132b4fe96e98b267516e77036cd409"><div class="ttname"><a href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a></div><div class="ttdeci">int mosquitto_acl_check(struct mosquitto_db *db, struct mosquitto *context, const char *topic, int access)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00218">security.c:218</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00196_html_a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75"><div class="ttname"><a href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a6726bee8759240b307cd94963c469b75">bd_both</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00276">mosquitto_broker.h:276</a></div></div>
<div class="ttc" id="a00016_html_aeed460cf6b45e2e993434395a1221e86"><div class="ttname"><a href="a00016.html#aeed460cf6b45e2e993434395a1221e86">_mqtt3_bridge_topic::remote_prefix</a></div><div class="ttdeci">char * remote_prefix</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00291">mosquitto_broker.h:291</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00011_html_a42171b2c83d8c83babc555d32ef84f7f"><div class="ttname"><a href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">_mosquitto_packet::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00140">mosquitto_internal.h:140</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00079">mosquitto.h:79</a></div></div>
<div class="ttc" id="a00016_html_afd755fdffab432e79e32a2989e03baa2"><div class="ttname"><a href="a00016.html#afd755fdffab432e79e32a2989e03baa2">_mqtt3_bridge_topic::local_prefix</a></div><div class="ttdeci">char * local_prefix</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00290">mosquitto_broker.h:290</a></div></div>
<div class="ttc" id="a00159_html_a9a0714eb912755e4dc621c1e902c0bcf"><div class="ttname"><a href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a></div><div class="ttdeci">#define MOSQ_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00058">mosquitto.h:58</a></div></div>
<div class="ttc" id="a00160_html_aa9fa8be3ee867892799799376cfb9c3b"><div class="ttname"><a href="a00160.html#aa9fa8be3ee867892799799376cfb9c3b">STREMPTY</a></div><div class="ttdeci">#define STREMPTY(str)</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00277">mosquitto_internal.h:277</a></div></div>
<div class="ttc" id="a00191_html_a273c85b4bc9f22d097948f4021190bc8"><div class="ttname"><a href="a00191.html#a273c85b4bc9f22d097948f4021190bc8">mqtt3_db_message_insert</a></div><div class="ttdeci">int mqtt3_db_message_insert(struct mosquitto_db *db, struct mosquitto *context, uint16_t mid, enum mosquitto_msg_direction dir, int qos, bool retain, struct mosquitto_msg_store *stored)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00303">database.c:303</a></div></div>
<div class="ttc" id="a00191_html_a69b7b5c13ef8ca9d3968a208b3cbb7f6"><div class="ttname"><a href="a00191.html#a69b7b5c13ef8ca9d3968a208b3cbb7f6">mqtt3_db_message_store_find</a></div><div class="ttdeci">int mqtt3_db_message_store_find(struct mosquitto *context, uint16_t mid, struct mosquitto_msg_store **stored)</div><div class="ttdef"><b>Definition:</b> <a href="a00191_source.html#l00600">database.c:600</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00159_html_a53ca7e5700e1a592fc72d43cdff68dd3"><div class="ttname"><a href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a></div><div class="ttdeci">#define MOSQ_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00054">mosquitto.h:54</a></div></div>
<div class="ttc" id="a00162_html_a01f59932d591f15b0376fd1f24a437e8"><div class="ttname"><a href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a></div><div class="ttdeci">int _mosquitto_read_uint16(struct _mosquitto_packet *packet, uint16_t *word)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00731">net_mosq.c:731</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00153_html_a1ecbcb0ab8e51c000672d9d2bdf8172c"><div class="ttname"><a href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c">_mosquitto_calloc</a></div><div class="ttdeci">void * _mosquitto_calloc(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00040">memory_mosq.c:40</a></div></div>
<div class="ttc" id="a00097_html_a2debc661bbf726e22a560f511a181979"><div class="ttname"><a href="a00097.html#a2debc661bbf726e22a560f511a181979">mqtt3_config::message_size_limit</a></div><div class="ttdeci">uint32_t message_size_limit</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00126">mosquitto_broker.h:126</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00162_html_a3f8290ea4ea68607b546aaac08a4d8d7"><div class="ttname"><a href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a></div><div class="ttdeci">int _mosquitto_read_string(struct _mosquitto_packet *packet, char **str)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00701">net_mosq.c:701</a></div></div>
<div class="ttc" id="a00092_html"><div class="ttname"><a href="a00092.html">mosquitto_msg_store</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00176">mosquitto_broker.h:176</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00196_html_a7a90d0b3b46b09f07e3fa99074e80eca"><div class="ttname"><a href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca">mqtt3_db_messages_queue</a></div><div class="ttdeci">int mqtt3_db_messages_queue(struct mosquitto_db *db, const char *source_id, const char *topic, int qos, int retain, struct mosquitto_msg_store **stored)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00507">subs.c:507</a></div></div>
<div class="ttc" id="a00016_html"><div class="ttname"><a href="a00016.html">_mqtt3_bridge_topic</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00286">mosquitto_broker.h:286</a></div></div>
<div class="ttc" id="a00160_html_a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020"><div class="ttname"><a href="a00160.html#a0ddbf4e46aceb72a173e52d7d15e0c84a163ade994e1623a1a2d789c20cb95020">mosq_md_in</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00073">mosquitto_internal.h:73</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00162_html_a668e43fc39fa0ae062aaa427b15382a9"><div class="ttname"><a href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9">_mosquitto_read_bytes</a></div><div class="ttdeci">int _mosquitto_read_bytes(struct _mosquitto_packet *packet, void *bytes, uint32_t count)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00681">net_mosq.c:681</a></div></div>
<div class="ttc" id="a00011_html_a5616fcfbaf0e409e06b1c857c940471a"><div class="ttname"><a href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">_mosquitto_packet::remaining_length</a></div><div class="ttdeci">uint32_t remaining_length</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00135">mosquitto_internal.h:135</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
<div class="ttc" id="a00196_html_a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8"><div class="ttname"><a href="a00196.html#a0c9951678faa52bd7a1c19be5f175689a75a8ca294459d4875531640b769852b8">bd_in</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00275">mosquitto_broker.h:275</a></div></div>
<div class="ttc" id="a00016_html_a88b23b4adfa1c1f7c019eb4b972f5d14"><div class="ttname"><a href="a00016.html#a88b23b4adfa1c1f7c019eb4b972f5d14">_mqtt3_bridge_topic::direction</a></div><div class="ttdeci">enum mqtt3_bridge_direction direction</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00289">mosquitto_broker.h:289</a></div></div>
<div class="ttc" id="a00013_html_aa1ddfac26492a4103cf0a20509eb4395"><div class="ttname"><a href="a00013.html#aa1ddfac26492a4103cf0a20509eb4395">_mosquitto_subleaf::qos</a></div><div class="ttdeci">int qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00158">mosquitto_broker.h:158</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_ab73094667db8b9226ef81e7895b934f6_cgraph.png" border="0" usemap="#a00196_ab73094667db8b9226ef81e7895b934f6_cgraph" alt=""/></div>
<map name="a00196_ab73094667db8b9226ef81e7895b934f6_cgraph" id="a00196_ab73094667db8b9226ef81e7895b934f6_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2748,1177,2895,1203"/>
<area shape="rect" id="node3" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="223,366,380,393"/>
<area shape="rect" id="node4" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="455,315,615,342"/>
<area shape="rect" id="node5" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2756,594,2887,621"/>
<area shape="rect" id="node6" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="2971,1578,3085,1605"/>
<area shape="rect" id="node7" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2473,214,2672,241"/>
<area shape="rect" id="node8" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2757,265,2886,291"/>
<area shape="rect" id="node9" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319" title="mosquitto_pub_topic\l_check" alt="" coords="230,781,373,823"/>
<area shape="rect" id="node10" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2758,1913,2885,1939"/>
<area shape="rect" id="node11" href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9" title="_mosquitto_read_bytes" alt="" coords="223,898,380,925"/>
<area shape="rect" id="node12" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="2032,586,2177,613"/>
<area shape="rect" id="node17" href="a00191.html#a69b7b5c13ef8ca9d3968a208b3cbb7f6" title="mqtt3_db_message_store_find" alt="" coords="201,999,401,1026"/>
<area shape="rect" id="node18" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="2487,113,2659,139"/>
<area shape="rect" id="node20" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="2240,2438,2425,2465"/>
<area shape="rect" id="node23" href="a00171.html#ab1b844a445f74762e20a3411cbf7ac2f" title="_mosquitto_send_puback" alt="" coords="673,974,844,1001"/>
<area shape="rect" id="node40" href="a00191.html#a273c85b4bc9f22d097948f4021190bc8" title="mqtt3_db_message_insert" alt="" coords="214,1227,389,1254"/>
<area shape="rect" id="node48" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630" title="_mosquitto_send_pubrec" alt="" coords="675,1434,842,1461"/>
<area shape="rect" id="node13" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="2260,485,2405,527"/>
<area shape="rect" id="node14" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="2510,467,2635,494"/>
<area shape="rect" id="node15" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="2535,366,2610,393"/>
<area shape="rect" id="node16" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="2512,417,2633,443"/>
<area shape="rect" id="node19" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="2720,113,2923,139"/>
<area shape="rect" id="node21" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="2485,2431,2660,2472"/>
<area shape="rect" id="node22" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="2734,2393,2909,2435"/>
<area shape="rect" id="node24" href="a00171.html#a45df200bf3b771869380b69c143ed251" title="_mosquitto_send_command\l_with_mid" alt="" coords="897,1431,1083,1472"/>
<area shape="rect" id="node25" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="1131,1438,1297,1465"/>
<area shape="rect" id="node35" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="2017,1633,2192,1659"/>
<area shape="rect" id="node26" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="1369,1431,1512,1472"/>
<area shape="rect" id="node27" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="1345,1615,1536,1642"/>
<area shape="rect" id="node28" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2766,2114,2877,2141"/>
<area shape="rect" id="node29" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="2487,1734,2658,1761"/>
<area shape="rect" id="node33" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="1584,1615,1755,1642"/>
<area shape="rect" id="node30" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="2741,1731,2902,1772"/>
<area shape="rect" id="node31" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="2741,1796,2902,1837"/>
<area shape="rect" id="node32" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="2726,1862,2917,1889"/>
<area shape="rect" id="node34" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="1803,1608,1969,1649"/>
<area shape="rect" id="node36" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="2249,1633,2416,1659"/>
<area shape="rect" id="node37" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="2499,1531,2646,1558"/>
<area shape="rect" id="node38" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="2729,1629,2913,1655"/>
<area shape="rect" id="node39" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="2491,1633,2655,1659"/>
<area shape="rect" id="node41" href="a00153.html#a60e49e66df31d85392b2000c75a088dd" title="_mosquitto_realloc" alt="" coords="469,1379,600,1406"/>
<area shape="rect" id="node42" href="a00191.html#aee64ee8f7ce7e65f696aa1bbf5c0674c" title="mqtt3_db_message_write" alt="" coords="449,1329,620,1355"/>
<area shape="rect" id="node43" href="a00171.html#a7b111a5ceccb7bbc5fdadab085a33c03" title="_mosquitto_send_publish" alt="" coords="674,822,843,849"/>
<area shape="rect" id="node49" href="a00171.html#afbde2c162bd4b8e9fa52b0d45aa43b81" title="_mosquitto_send_pubrel" alt="" coords="677,1329,840,1355"/>
<area shape="rect" id="node50" href="a00171.html#aaeba60c4fd6e50c8f7f599246c6f91fb" title="_mosquitto_send_pubcomp" alt="" coords="668,1379,849,1406"/>
<area shape="rect" id="node44" href="a00171.html#aec1dbc12b0482663fdfbc95c13124bf3" title="_mosquitto_send_real\l_publish" alt="" coords="915,1089,1065,1131"/>
<area shape="rect" id="node45" href="a00162.html#a74c4a3cbe02bca478cb9621cca8191e8" title="_mosquitto_write_string" alt="" coords="1134,1075,1294,1102"/>
<area shape="rect" id="node46" href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f" title="_mosquitto_write_uint16" alt="" coords="1359,1025,1522,1051"/>
<area shape="rect" id="node47" href="a00162.html#a307413f45257069e76295c70a6d899d8" title="_mosquitto_write_bytes" alt="" coords="1361,1075,1521,1102"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad028e30a6047ea57b94d503668d6ea80"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_handle_subscribe </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00202_source.html#l00621">621</a> of file <a class="el" href="a00202_source.html">read_handle_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;{</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = 0;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordtype">int</span> rc2;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    uint16_t <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a>;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="a00126.html">sub</a>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    uint8_t <a class="code" href="a00016.html#ab8821eeb209c87b661b17d37a4e6d711">qos</a>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    uint8_t *payload = NULL, *tmp_payload;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    uint32_t payloadlen = 0;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordtype">int</span> len;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordtype">char</span> *sub_mount;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Received SUBSCRIBE from %s&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">/* FIXME - plenty of potential for memory leaks here */</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">if</span>((context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">command</a>&amp;0x0F) != 0x02){</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        }</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;mid)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">while</span>(context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#aee3849504ce401add5fdf9235541f274">pos</a> &lt; context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">remaining_length</a>){</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        sub = NULL;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;sub)){</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="keywordflow">if</span>(sub){</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <span class="keywordflow">if</span>(!strlen(sub)){</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Empty subscription string from %s, disconnecting.&quot;</span>,</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                    context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00159.html#ace749e7f40c51e0c28587edba83e9b3b">mosquitto_sub_topic_check</a>(sub)){</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Invalid subscription string from %s, disconnecting.&quot;</span>,</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1">_mosquitto_read_byte</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;qos)){</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <span class="keywordflow">if</span>(qos &gt; 2){</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Invalid QoS in subscription command from %s, disconnecting.&quot;</span>,</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                    context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <span class="keywordflow">if</span>(context-&gt;listener &amp;&amp; context-&gt;listener-&gt;mount_point){</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                len = strlen(context-&gt;listener-&gt;mount_point) + strlen(sub) + 1;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                sub_mount = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(len+1);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                <span class="keywordflow">if</span>(!sub_mount){</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                    <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                snprintf(sub_mount, len, <span class="stringliteral">&quot;%s%s&quot;</span>, context-&gt;listener-&gt;mount_point, sub);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                sub_mount[len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                sub = sub_mount;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;\t%s (QoS %d)&quot;</span>, sub, qos);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="comment">/* FIXME</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">             * This section has been disabled temporarily. mosquitto_acl_check</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">             * calls mosquitto_topic_matches_sub, which can&#39;t cope with</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">             * checking subscriptions that have wildcards against ACLs that</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">             * have wildcards. Bug #1374291 is related.</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">             *</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">             * It&#39;s a very difficult problem when an ACL looks like foo/+/bar</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">             * and a subscription request to foo/# is made.</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">             *</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">             * This should be changed to using MOSQ_ACL_SUBSCRIPTION in the</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">             * future anyway.</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                rc = <a class="code" href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a>(db, context, sub, <a class="code" href="a00198.html#af8ea2121bd604aeb622af53fc8beba35">MOSQ_ACL_READ</a>);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                <span class="keywordflow">switch</span>(rc){</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>:</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a>:</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                        qos = 0x80;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                }</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            }</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">if</span>(qos != 0x80){</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                rc2 = <a class="code" href="a00196.html#afe850bdd3f238f7c555bdd861944d6fc">mqtt3_sub_add</a>(db, context, sub, qos, &amp;db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <span class="keywordflow">if</span>(rc2 == <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>){</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="a00196.html#a59294f37b85b3e5b13ccf682e9a4de68">mqtt3_retain_queue</a>(db, context, sub, qos)) rc = 1;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(rc2 != -1){</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                    rc = rc2;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#afc670d4696465494259a49d31fdc2097">MOSQ_LOG_SUBSCRIBE</a>, <span class="stringliteral">&quot;%s %d %s&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, qos, sub);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            tmp_payload = <a class="code" href="a00153.html#a60e49e66df31d85392b2000c75a088dd">_mosquitto_realloc</a>(payload, payloadlen + 1);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="keywordflow">if</span>(tmp_payload){</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                payload = tmp_payload;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                payload[payloadlen] = <a class="code" href="a00016.html#ab8821eeb209c87b661b17d37a4e6d711">qos</a>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                payloadlen++;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                <span class="keywordflow">if</span>(payload) <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    }</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span>(payloadlen == 0){</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="comment">/* No subscriptions specified, protocol error. */</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        }</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    }</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00196.html#a3ddecfe61813ca01280eb8e3417f8b2f">_mosquitto_send_suback</a>(context, mid, payloadlen, payload)) rc = 1;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(payload);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    </div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    db-&gt;<a class="code" href="a00089.html#a85ea76e88408ef3a3c00129214782028">persistence_changes</a>++;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;}</div><div class="ttc" id="a00086_html_a63df5a9670ff1c1336edc45e9a9500d6"><div class="ttname"><a href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">mosquitto::protocol</a></div><div class="ttdeci">enum _mosquitto_protocol protocol</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00161">mosquitto_internal.h:161</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00196_html_a59294f37b85b3e5b13ccf682e9a4de68"><div class="ttname"><a href="a00196.html#a59294f37b85b3e5b13ccf682e9a4de68">mqtt3_retain_queue</a></div><div class="ttdeci">int mqtt3_retain_queue(struct mosquitto_db *db, struct mosquitto *context, const char *sub, int sub_qos)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00738">subs.c:738</a></div></div>
<div class="ttc" id="a00011_html_aee3849504ce401add5fdf9235541f274"><div class="ttname"><a href="a00011.html#aee3849504ce401add5fdf9235541f274">_mosquitto_packet::pos</a></div><div class="ttdeci">uint32_t pos</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00138">mosquitto_internal.h:138</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00196_html_a6c132b4fe96e98b267516e77036cd409"><div class="ttname"><a href="a00196.html#a6c132b4fe96e98b267516e77036cd409">mosquitto_acl_check</a></div><div class="ttdeci">int mosquitto_acl_check(struct mosquitto_db *db, struct mosquitto *context, const char *topic, int access)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00218">security.c:218</a></div></div>
<div class="ttc" id="a00162_html_aa0425b094c40c000e3bdcef6c2766fc1"><div class="ttname"><a href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1">_mosquitto_read_byte</a></div><div class="ttdeci">int _mosquitto_read_byte(struct _mosquitto_packet *packet, uint8_t *byte)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00661">net_mosq.c:661</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00011_html_a42171b2c83d8c83babc555d32ef84f7f"><div class="ttname"><a href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">_mosquitto_packet::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00140">mosquitto_internal.h:140</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a72b02d30d71e2fb0d8b600f7e79cfb6d">MOSQ_ERR_ACL_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00079">mosquitto.h:79</a></div></div>
<div class="ttc" id="a00086_html_a962322fe14ee02b439cc236a85dab410"><div class="ttname"><a href="a00086.html#a962322fe14ee02b439cc236a85dab410">mosquitto::address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00162">mosquitto_internal.h:162</a></div></div>
<div class="ttc" id="a00126_html"><div class="ttname"><a href="a00126.html">sub</a></div><div class="ttdef"><b>Definition:</b> <a href="a00374_source.html#l00016">qos.c:16</a></div></div>
<div class="ttc" id="a00196_html_afe850bdd3f238f7c555bdd861944d6fc"><div class="ttname"><a href="a00196.html#afe850bdd3f238f7c555bdd861944d6fc">mqtt3_sub_add</a></div><div class="ttdeci">int mqtt3_sub_add(struct mosquitto_db *db, struct mosquitto *context, const char *sub, int qos, struct _mosquitto_subhier *root)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00428">subs.c:428</a></div></div>
<div class="ttc" id="a00160_html_a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4"><div class="ttname"><a href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00114">mosquitto_internal.h:114</a></div></div>
<div class="ttc" id="a00016_html_ab8821eeb209c87b661b17d37a4e6d711"><div class="ttname"><a href="a00016.html#ab8821eeb209c87b661b17d37a4e6d711">_mqtt3_bridge_topic::qos</a></div><div class="ttdeci">int qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00288">mosquitto_broker.h:288</a></div></div>
<div class="ttc" id="a00159_html_a9a0714eb912755e4dc621c1e902c0bcf"><div class="ttname"><a href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a></div><div class="ttdeci">#define MOSQ_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00058">mosquitto.h:58</a></div></div>
<div class="ttc" id="a00198_html_af8ea2121bd604aeb622af53fc8beba35"><div class="ttname"><a href="a00198.html#af8ea2121bd604aeb622af53fc8beba35">MOSQ_ACL_READ</a></div><div class="ttdeci">#define MOSQ_ACL_READ</div><div class="ttdef"><b>Definition:</b> <a href="a00198_source.html#l00023">mosquitto_plugin.h:23</a></div></div>
<div class="ttc" id="a00159_html_a53ca7e5700e1a592fc72d43cdff68dd3"><div class="ttname"><a href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a></div><div class="ttdeci">#define MOSQ_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00054">mosquitto.h:54</a></div></div>
<div class="ttc" id="a00196_html_a3ddecfe61813ca01280eb8e3417f8b2f"><div class="ttname"><a href="a00196.html#a3ddecfe61813ca01280eb8e3417f8b2f">_mosquitto_send_suback</a></div><div class="ttdeci">int _mosquitto_send_suback(struct mosquitto *context, uint16_t mid, uint32_t payloadlen, const void *payload)</div><div class="ttdef"><b>Definition:</b> <a href="a00205_source.html#l00053">send_server.c:53</a></div></div>
<div class="ttc" id="a00162_html_a01f59932d591f15b0376fd1f24a437e8"><div class="ttname"><a href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a></div><div class="ttdeci">int _mosquitto_read_uint16(struct _mosquitto_packet *packet, uint16_t *word)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00731">net_mosq.c:731</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00069">mosquitto.h:69</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00162_html_a3f8290ea4ea68607b546aaac08a4d8d7"><div class="ttname"><a href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a></div><div class="ttdeci">int _mosquitto_read_string(struct _mosquitto_packet *packet, char **str)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00701">net_mosq.c:701</a></div></div>
<div class="ttc" id="a00153_html_a60e49e66df31d85392b2000c75a088dd"><div class="ttname"><a href="a00153.html#a60e49e66df31d85392b2000c75a088dd">_mosquitto_realloc</a></div><div class="ttdeci">void * _mosquitto_realloc(void *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00091">memory_mosq.c:91</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00089_html_a85ea76e88408ef3a3c00129214782028"><div class="ttname"><a href="a00089.html#a85ea76e88408ef3a3c00129214782028">mosquitto_db::persistence_changes</a></div><div class="ttdeci">int persistence_changes</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00264">mosquitto_broker.h:264</a></div></div>
<div class="ttc" id="a00159_html_ace749e7f40c51e0c28587edba83e9b3b"><div class="ttname"><a href="a00159.html#ace749e7f40c51e0c28587edba83e9b3b">mosquitto_sub_topic_check</a></div><div class="ttdeci">libmosq_EXPORT int mosquitto_sub_topic_check(const char *topic)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00201">util_mosq.c:201</a></div></div>
<div class="ttc" id="a00089_html_a2f96cc353b06a96922b1310c87327e0b"><div class="ttname"><a href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">mosquitto_db::subs</a></div><div class="ttdeci">struct _mosquitto_subhier subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00245">mosquitto_broker.h:245</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00011_html_a5616fcfbaf0e409e06b1c857c940471a"><div class="ttname"><a href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">_mosquitto_packet::remaining_length</a></div><div class="ttdeci">uint32_t remaining_length</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00135">mosquitto_internal.h:135</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
<div class="ttc" id="a00159_html_afc670d4696465494259a49d31fdc2097"><div class="ttname"><a href="a00159.html#afc670d4696465494259a49d31fdc2097">MOSQ_LOG_SUBSCRIBE</a></div><div class="ttdeci">#define MOSQ_LOG_SUBSCRIBE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00059">mosquitto.h:59</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_ad028e30a6047ea57b94d503668d6ea80_cgraph.png" border="0" usemap="#a00196_ad028e30a6047ea57b94d503668d6ea80_cgraph" alt=""/></div>
<map name="a00196_ad028e30a6047ea57b94d503668d6ea80_cgraph" id="a00196_ad028e30a6047ea57b94d503668d6ea80_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2946,1275,3093,1301"/>
<area shape="rect" id="node3" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="2707,1123,2867,1149"/>
<area shape="rect" id="node4" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="2469,464,2626,491"/>
<area shape="rect" id="node5" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="3167,224,3297,251"/>
<area shape="rect" id="node6" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="3175,1933,3289,1960"/>
<area shape="rect" id="node7" href="a00159.html#ace749e7f40c51e0c28587edba83e9b3b" title="mosquitto_sub_topic\l_check" alt="" coords="2476,195,2619,237"/>
<area shape="rect" id="node8" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1" title="_mosquitto_read_byte" alt="" coords="2472,515,2623,541"/>
<area shape="rect" id="node9" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="2475,565,2620,592"/>
<area shape="rect" id="node17" href="a00196.html#afe850bdd3f238f7c555bdd861944d6fc" title="mqtt3_sub_add" alt="" coords="2731,717,2842,744"/>
<area shape="rect" id="node18" href="a00196.html#a59294f37b85b3e5b13ccf682e9a4de68" title="mqtt3_retain_queue" alt="" coords="905,2389,1041,2416"/>
<area shape="rect" id="node19" href="a00153.html#a60e49e66df31d85392b2000c75a088dd" title="_mosquitto_realloc" alt="" coords="236,1953,367,1980"/>
<area shape="rect" id="node20" href="a00196.html#a3ddecfe61813ca01280eb8e3417f8b2f" title="_mosquitto_send_suback" alt="" coords="216,1903,387,1929"/>
<area shape="rect" id="node10" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="2714,499,2859,541"/>
<area shape="rect" id="node11" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2920,705,3119,732"/>
<area shape="rect" id="node12" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="2957,351,3082,377"/>
<area shape="rect" id="node13" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="2982,553,3057,580"/>
<area shape="rect" id="node14" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="3167,604,3297,631"/>
<area shape="rect" id="node15" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="2959,452,3080,479"/>
<area shape="rect" id="node16" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2956,1680,3083,1707"/>
<area shape="rect" id="node21" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="435,1725,601,1752"/>
<area shape="rect" id="node31" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1321,1793,1496,1820"/>
<area shape="rect" id="node48" href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f" title="_mosquitto_write_uint16" alt="" coords="437,1953,599,1980"/>
<area shape="rect" id="node50" href="a00162.html#a307413f45257069e76295c70a6d899d8" title="_mosquitto_write_bytes" alt="" coords="438,2004,598,2031"/>
<area shape="rect" id="node22" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="673,1718,816,1759"/>
<area shape="rect" id="node23" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="649,1649,840,1676"/>
<area shape="rect" id="node24" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2017,1548,2128,1575"/>
<area shape="rect" id="node25" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1759,1808,1929,1835"/>
<area shape="rect" id="node29" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="888,1649,1059,1676"/>
<area shape="rect" id="node26" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="1992,1802,2153,1843"/>
<area shape="rect" id="node27" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="1992,1867,2153,1909"/>
<area shape="rect" id="node28" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="1977,1751,2168,1777"/>
<area shape="rect" id="node30" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="1107,1837,1273,1878"/>
<area shape="rect" id="node32" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="1544,1751,1711,1777"/>
<area shape="rect" id="node33" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1771,1701,1917,1728"/>
<area shape="rect" id="node34" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="1981,2035,2165,2061"/>
<area shape="rect" id="node35" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="1762,1447,1926,1473"/>
<area shape="rect" id="node36" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="2715,1680,2858,1707"/>
<area shape="rect" id="node37" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="1999,1325,2146,1352"/>
<area shape="rect" id="node47" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="2216,1477,2393,1504"/>
<area shape="rect" id="node38" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2457,1680,2637,1707"/>
<area shape="rect" id="node39" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2454,1629,2641,1656"/>
<area shape="rect" id="node40" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2441,1325,2653,1352"/>
<area shape="rect" id="node41" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2231,857,2379,884"/>
<area shape="rect" id="node42" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2459,1376,2636,1403"/>
<area shape="rect" id="node43" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2461,1477,2634,1504"/>
<area shape="rect" id="node44" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="2228,743,2381,769"/>
<area shape="rect" id="node45" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="2701,1224,2872,1251"/>
<area shape="rect" id="node46" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="2216,337,2393,364"/>
<area shape="rect" id="node49" href="a00162.html#adc64d22375628582aa20cb1f8e9435a3" title="_mosquitto_write_byte" alt="" coords="668,1953,821,1980"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2fb8082975605cecae2cd5e0a5789a13"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_handle_unsubscribe </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00202_source.html#l00764">764</a> of file <a class="el" href="a00202_source.html">read_handle_server.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;{</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    uint16_t <a class="code" href="a00443.html#a37759e081882db58436303e92962515d">mid</a>;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordtype">char</span> *<a class="code" href="a00126.html">sub</a>;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;Received UNSUBSCRIBE from %s&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">if</span>(context-&gt;<a class="code" href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">protocol</a> == <a class="code" href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a>){</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">if</span>((context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">command</a>&amp;0x0F) != 0x02){</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;mid)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">while</span>(context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#aee3849504ce401add5fdf9235541f274">pos</a> &lt; context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">remaining_length</a>){</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        sub = NULL;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a>(&amp;context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>, &amp;sub)){</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">if</span>(sub){</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <span class="keywordflow">if</span>(!strlen(sub)){</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Empty unsubscription string from %s, disconnecting.&quot;</span>,</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                    context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="a00159.html#ace749e7f40c51e0c28587edba83e9b3b">mosquitto_sub_topic_check</a>(sub)){</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Invalid unsubscription string from %s, disconnecting.&quot;</span>,</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                    context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            }</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a>, <span class="stringliteral">&quot;\t%s&quot;</span>, sub);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <a class="code" href="a00196.html#a25dfd4d59b3e689243ef6187b45fadeb">mqtt3_sub_remove</a>(db, context, sub, &amp;db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#afb14a1121f0d4304d31e87fd7f419588">MOSQ_LOG_UNSUBSCRIBE</a>, <span class="stringliteral">&quot;%s %s&quot;</span>, context-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, sub);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(sub);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    }</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="preprocessor">#ifdef WITH_PERSISTENCE</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    db-&gt;<a class="code" href="a00089.html#a85ea76e88408ef3a3c00129214782028">persistence_changes</a>++;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00171.html#a45df200bf3b771869380b69c143ed251">_mosquitto_send_command_with_mid</a>(context, <a class="code" href="a00161.html#aa84e1b771dd8ef3e8f74f01b7a108b3a">UNSUBACK</a>, mid, <span class="keyword">false</span>);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;}</div><div class="ttc" id="a00171_html_a45df200bf3b771869380b69c143ed251"><div class="ttname"><a href="a00171.html#a45df200bf3b771869380b69c143ed251">_mosquitto_send_command_with_mid</a></div><div class="ttdeci">int _mosquitto_send_command_with_mid(struct mosquitto *mosq, uint8_t command, uint16_t mid, bool dup)</div><div class="ttdef"><b>Definition:</b> <a href="a00171_source.html#l00200">send_mosq.c:200</a></div></div>
<div class="ttc" id="a00086_html_a63df5a9670ff1c1336edc45e9a9500d6"><div class="ttname"><a href="a00086.html#a63df5a9670ff1c1336edc45e9a9500d6">mosquitto::protocol</a></div><div class="ttdeci">enum _mosquitto_protocol protocol</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00161">mosquitto_internal.h:161</a></div></div>
<div class="ttc" id="a00011_html_aee3849504ce401add5fdf9235541f274"><div class="ttname"><a href="a00011.html#aee3849504ce401add5fdf9235541f274">_mosquitto_packet::pos</a></div><div class="ttdeci">uint32_t pos</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00138">mosquitto_internal.h:138</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00161_html_aa84e1b771dd8ef3e8f74f01b7a108b3a"><div class="ttname"><a href="a00161.html#aa84e1b771dd8ef3e8f74f01b7a108b3a">UNSUBACK</a></div><div class="ttdeci">#define UNSUBACK</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00039">mqtt3_protocol.h:39</a></div></div>
<div class="ttc" id="a00011_html_a42171b2c83d8c83babc555d32ef84f7f"><div class="ttname"><a href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">_mosquitto_packet::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00140">mosquitto_internal.h:140</a></div></div>
<div class="ttc" id="a00196_html_a25dfd4d59b3e689243ef6187b45fadeb"><div class="ttname"><a href="a00196.html#a25dfd4d59b3e689243ef6187b45fadeb">mqtt3_sub_remove</a></div><div class="ttdeci">int mqtt3_sub_remove(struct mosquitto_db *db, struct mosquitto *context, const char *sub, struct _mosquitto_subhier *root)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00482">subs.c:482</a></div></div>
<div class="ttc" id="a00126_html"><div class="ttname"><a href="a00126.html">sub</a></div><div class="ttdef"><b>Definition:</b> <a href="a00374_source.html#l00016">qos.c:16</a></div></div>
<div class="ttc" id="a00160_html_a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4"><div class="ttname"><a href="a00160.html#a157834b9c1df5876b0fd037d3765807ba1936285f402b5d9e522879d2e5a039b4">mosq_p_mqtt311</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00114">mosquitto_internal.h:114</a></div></div>
<div class="ttc" id="a00159_html_a9a0714eb912755e4dc621c1e902c0bcf"><div class="ttname"><a href="a00159.html#a9a0714eb912755e4dc621c1e902c0bcf">MOSQ_LOG_DEBUG</a></div><div class="ttdeci">#define MOSQ_LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00058">mosquitto.h:58</a></div></div>
<div class="ttc" id="a00159_html_a53ca7e5700e1a592fc72d43cdff68dd3"><div class="ttname"><a href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a></div><div class="ttdeci">#define MOSQ_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00054">mosquitto.h:54</a></div></div>
<div class="ttc" id="a00162_html_a01f59932d591f15b0376fd1f24a437e8"><div class="ttname"><a href="a00162.html#a01f59932d591f15b0376fd1f24a437e8">_mosquitto_read_uint16</a></div><div class="ttdeci">int _mosquitto_read_uint16(struct _mosquitto_packet *packet, uint16_t *word)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00731">net_mosq.c:731</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00069">mosquitto.h:69</a></div></div>
<div class="ttc" id="a00159_html_afb14a1121f0d4304d31e87fd7f419588"><div class="ttname"><a href="a00159.html#afb14a1121f0d4304d31e87fd7f419588">MOSQ_LOG_UNSUBSCRIBE</a></div><div class="ttdeci">#define MOSQ_LOG_UNSUBSCRIBE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00060">mosquitto.h:60</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00162_html_a3f8290ea4ea68607b546aaac08a4d8d7"><div class="ttname"><a href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7">_mosquitto_read_string</a></div><div class="ttdeci">int _mosquitto_read_string(struct _mosquitto_packet *packet, char **str)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l00701">net_mosq.c:701</a></div></div>
<div class="ttc" id="a00443_html_a37759e081882db58436303e92962515d"><div class="ttname"><a href="a00443.html#a37759e081882db58436303e92962515d">02-subpub-qos0.mid</a></div><div class="ttdeci">int mid</div><div class="ttdef"><b>Definition:</b> <a href="a00222_source.html#l00014">02-subpub-qos0.py:14</a></div></div>
<div class="ttc" id="a00089_html_a85ea76e88408ef3a3c00129214782028"><div class="ttname"><a href="a00089.html#a85ea76e88408ef3a3c00129214782028">mosquitto_db::persistence_changes</a></div><div class="ttdeci">int persistence_changes</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00264">mosquitto_broker.h:264</a></div></div>
<div class="ttc" id="a00159_html_ace749e7f40c51e0c28587edba83e9b3b"><div class="ttname"><a href="a00159.html#ace749e7f40c51e0c28587edba83e9b3b">mosquitto_sub_topic_check</a></div><div class="ttdeci">libmosq_EXPORT int mosquitto_sub_topic_check(const char *topic)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00201">util_mosq.c:201</a></div></div>
<div class="ttc" id="a00089_html_a2f96cc353b06a96922b1310c87327e0b"><div class="ttname"><a href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">mosquitto_db::subs</a></div><div class="ttdeci">struct _mosquitto_subhier subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00245">mosquitto_broker.h:245</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00011_html_a5616fcfbaf0e409e06b1c857c940471a"><div class="ttname"><a href="a00011.html#a5616fcfbaf0e409e06b1c857c940471a">_mosquitto_packet::remaining_length</a></div><div class="ttdeci">uint32_t remaining_length</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00135">mosquitto_internal.h:135</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a2fb8082975605cecae2cd5e0a5789a13_cgraph.png" border="0" usemap="#a00196_a2fb8082975605cecae2cd5e0a5789a13_cgraph" alt=""/></div>
<map name="a00196_a2fb8082975605cecae2cd5e0a5789a13_cgraph" id="a00196_a2fb8082975605cecae2cd5e0a5789a13_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="2764,777,2911,804"/>
<area shape="rect" id="node3" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="2757,1284,2917,1311"/>
<area shape="rect" id="node4" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="2515,2085,2673,2112"/>
<area shape="rect" id="node6" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="2537,1563,2651,1589"/>
<area shape="rect" id="node7" href="a00159.html#ace749e7f40c51e0c28587edba83e9b3b" title="mosquitto_sub_topic\l_check" alt="" coords="2523,2390,2665,2431"/>
<area shape="rect" id="node8" href="a00196.html#a25dfd4d59b3e689243ef6187b45fadeb" title="mqtt3_sub_remove" alt="" coords="257,2393,390,2420"/>
<area shape="rect" id="node9" href="a00171.html#a45df200bf3b771869380b69c143ed251" title="_mosquitto_send_command\l_with_mid" alt="" coords="231,1657,416,1698"/>
<area shape="rect" id="node5" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="2772,2136,2903,2163"/>
<area shape="rect" id="node10" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="2531,1512,2657,1539"/>
<area shape="rect" id="node11" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="464,1443,631,1469"/>
<area shape="rect" id="node21" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1351,708,1525,735"/>
<area shape="rect" id="node12" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="703,1435,845,1477"/>
<area shape="rect" id="node13" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="679,549,869,576"/>
<area shape="rect" id="node14" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2975,169,3085,196"/>
<area shape="rect" id="node15" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="1788,549,1959,576"/>
<area shape="rect" id="node19" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="917,645,1088,672"/>
<area shape="rect" id="node16" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="2021,297,2183,338"/>
<area shape="rect" id="node17" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="2021,362,2183,403"/>
<area shape="rect" id="node18" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="2007,428,2197,455"/>
<area shape="rect" id="node20" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="1136,1149,1303,1190"/>
<area shape="rect" id="node22" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="1573,701,1740,728"/>
<area shape="rect" id="node23" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="1800,600,1947,627"/>
<area shape="rect" id="node24" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="2010,1411,2194,1437"/>
<area shape="rect" id="node25" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="1791,701,1955,728"/>
<area shape="rect" id="node26" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="2031,585,2173,612"/>
<area shape="rect" id="node27" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="2029,980,2175,1007"/>
<area shape="rect" id="node48" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="2013,701,2191,728"/>
<area shape="rect" id="node28" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2253,701,2433,728"/>
<area shape="rect" id="node30" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2249,549,2436,576"/>
<area shape="rect" id="node34" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2488,448,2700,475"/>
<area shape="rect" id="node35" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2269,1925,2417,1952"/>
<area shape="rect" id="node40" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2505,1005,2683,1032"/>
<area shape="rect" id="node41" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2256,955,2429,981"/>
<area shape="rect" id="node42" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="2266,1867,2419,1893"/>
<area shape="rect" id="node43" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="2257,904,2428,931"/>
<area shape="rect" id="node44" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="2261,2085,2424,2112"/>
<area shape="rect" id="node45" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="2265,1259,2421,1285"/>
<area shape="rect" id="node46" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="2253,1208,2433,1235"/>
<area shape="rect" id="node47" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="2245,853,2440,880"/>
<area shape="rect" id="node29" href="a00171.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="2505,701,2683,728"/>
<area shape="rect" id="node31" href="a00169.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2488,499,2700,525"/>
<area shape="rect" id="node32" href="a00191.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="2748,511,2927,537"/>
<area shape="rect" id="node33" href="a00155.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="2764,445,2911,486"/>
<area shape="rect" id="node36" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="2495,2136,2693,2163"/>
<area shape="rect" id="node37" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="2529,1984,2659,2011"/>
<area shape="rect" id="node38" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319" title="mosquitto_pub_topic\l_check" alt="" coords="2523,1918,2665,1959"/>
<area shape="rect" id="node39" href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9" title="_mosquitto_read_bytes" alt="" coords="2515,1867,2673,1893"/>
<area shape="rect" id="node49" href="a00164.html#a819a75a1f9631089244fa64738731a17" title="_mosquitto_handle_publish" alt="" coords="2253,1157,2432,1184"/>
<area shape="rect" id="node50" href="a00166.html#a455f01d5b31fc8090bc97c89c7849e91" title="_mosquitto_handle_connack" alt="" coords="2249,651,2436,677"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a90e4e3b03b0226658f92987b81d31de8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_log_close </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00097.html">mqtt3_config</a> *&#160;</td>
          <td class="paramname"><em>config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00194_source.html#l00084">84</a> of file <a class="el" href="a00194_source.html">logging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">if</span>(log_destinations &amp; <a class="code" href="a00196.html#ac3c1f3254dec106a3f762c90c1cec113">MQTT3_LOG_SYSLOG</a>){</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#ifndef WIN32</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        closelog();</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        CloseEventLog(syslog_h);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">if</span>(log_destinations &amp; <a class="code" href="a00196.html#afb1ed89c5b0349726632c68a1960e0ca">MQTT3_LOG_FILE</a>){</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">if</span>(config-&gt;<a class="code" href="a00097.html#a39e2542bceca984969543bfbaafd336a">log_fptr</a>){</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            fclose(config-&gt;<a class="code" href="a00097.html#a39e2542bceca984969543bfbaafd336a">log_fptr</a>);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            config-&gt;<a class="code" href="a00097.html#a39e2542bceca984969543bfbaafd336a">log_fptr</a> = NULL;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">/* FIXME - do something for all destinations! */</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00196_html_ac3c1f3254dec106a3f762c90c1cec113"><div class="ttname"><a href="a00196.html#ac3c1f3254dec106a3f762c90c1cec113">MQTT3_LOG_SYSLOG</a></div><div class="ttdeci">#define MQTT3_LOG_SYSLOG</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00055">mosquitto_broker.h:55</a></div></div>
<div class="ttc" id="a00097_html_a39e2542bceca984969543bfbaafd336a"><div class="ttname"><a href="a00097.html#a39e2542bceca984969543bfbaafd336a">mqtt3_config::log_fptr</a></div><div class="ttdeci">FILE * log_fptr</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00125">mosquitto_broker.h:125</a></div></div>
<div class="ttc" id="a00196_html_afb1ed89c5b0349726632c68a1960e0ca"><div class="ttname"><a href="a00196.html#afb1ed89c5b0349726632c68a1960e0ca">MQTT3_LOG_FILE</a></div><div class="ttdeci">#define MQTT3_LOG_FILE</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00056">mosquitto_broker.h:56</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a429931ef889c50f3a75f674c7029843b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_log_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00097.html">mqtt3_config</a> *&#160;</td>
          <td class="paramname"><em>config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00194_source.html#l00053">53</a> of file <a class="el" href="a00194_source.html">logging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = 0;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    log_priorities = config-&gt;<a class="code" href="a00097.html#ad3732c093fcc47811af63c25b259b008">log_type</a>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    log_destinations = config-&gt;<a class="code" href="a00097.html#a86b6c8f306e5586f7a1b4dd51d31f03c">log_dest</a>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span>(log_destinations &amp; <a class="code" href="a00196.html#ac3c1f3254dec106a3f762c90c1cec113">MQTT3_LOG_SYSLOG</a>){</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#ifndef WIN32</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        openlog(<span class="stringliteral">&quot;mosquitto&quot;</span>, LOG_PID|LOG_CONS, config-&gt;<a class="code" href="a00097.html#a717e504a70ceaedeee6602e5359767bb">log_facility</a>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        syslog_h = OpenEventLog(NULL, <span class="stringliteral">&quot;mosquitto&quot;</span>);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">if</span>(log_destinations &amp; <a class="code" href="a00196.html#afb1ed89c5b0349726632c68a1960e0ca">MQTT3_LOG_FILE</a>){</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00158.html#a58d0ace4df75ecf8a8a0eb995e8f9cd6">drop_privileges</a>(config, <span class="keyword">true</span>)){</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        config-&gt;<a class="code" href="a00097.html#a39e2542bceca984969543bfbaafd336a">log_fptr</a> = <a class="code" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a">_mosquitto_fopen</a>(config-&gt;<a class="code" href="a00097.html#a6b85d63153f6da0aff7aa461888d5a59">log_file</a>, <span class="stringliteral">&quot;at&quot;</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">if</span>(!config-&gt;<a class="code" href="a00097.html#a39e2542bceca984969543bfbaafd336a">log_fptr</a>){</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            log_destinations = <a class="code" href="a00196.html#a45919568a54c27470e1cd90c4a144010">MQTT3_LOG_STDERR</a>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            log_priorities = <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <a class="code" href="a00194.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to open log file %s for writing.&quot;</span>, config-&gt;<a class="code" href="a00097.html#a6b85d63153f6da0aff7aa461888d5a59">log_file</a>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <a class="code" href="a00158.html#a05c162f84fcabc09090f53489e3ab27f">restore_privileges</a>();</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;}</div><div class="ttc" id="a00097_html_ad3732c093fcc47811af63c25b259b008"><div class="ttname"><a href="a00097.html#ad3732c093fcc47811af63c25b259b008">mqtt3_config::log_type</a></div><div class="ttdeci">int log_type</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00122">mosquitto_broker.h:122</a></div></div>
<div class="ttc" id="a00194_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00194.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00194_source.html#l00256">logging.c:256</a></div></div>
<div class="ttc" id="a00196_html_a45919568a54c27470e1cd90c4a144010"><div class="ttname"><a href="a00196.html#a45919568a54c27470e1cd90c4a144010">MQTT3_LOG_STDERR</a></div><div class="ttdeci">#define MQTT3_LOG_STDERR</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00058">mosquitto_broker.h:58</a></div></div>
<div class="ttc" id="a00181_html_ae82763dc715f9b4c44d210b886e1f41a"><div class="ttname"><a href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a">_mosquitto_fopen</a></div><div class="ttdeci">FILE * _mosquitto_fopen(const char *path, const char *mode, bool restrict_read)</div><div class="ttdef"><b>Definition:</b> <a href="a00181_source.html#l00346">util_mosq.c:346</a></div></div>
<div class="ttc" id="a00196_html_ac3c1f3254dec106a3f762c90c1cec113"><div class="ttname"><a href="a00196.html#ac3c1f3254dec106a3f762c90c1cec113">MQTT3_LOG_SYSLOG</a></div><div class="ttdeci">#define MQTT3_LOG_SYSLOG</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00055">mosquitto_broker.h:55</a></div></div>
<div class="ttc" id="a00097_html_a717e504a70ceaedeee6602e5359767bb"><div class="ttname"><a href="a00097.html#a717e504a70ceaedeee6602e5359767bb">mqtt3_config::log_facility</a></div><div class="ttdeci">int log_facility</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00121">mosquitto_broker.h:121</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00158_html_a58d0ace4df75ecf8a8a0eb995e8f9cd6"><div class="ttname"><a href="a00158.html#a58d0ace4df75ecf8a8a0eb995e8f9cd6">drop_privileges</a></div><div class="ttdeci">int drop_privileges(struct mqtt3_config *config, bool temporary)</div><div class="ttdef"><b>Definition:</b> <a href="a00158_source.html#l00085">mosquitto.c:85</a></div></div>
<div class="ttc" id="a00097_html_a86b6c8f306e5586f7a1b4dd51d31f03c"><div class="ttname"><a href="a00097.html#a86b6c8f306e5586f7a1b4dd51d31f03c">mqtt3_config::log_dest</a></div><div class="ttdeci">int log_dest</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00120">mosquitto_broker.h:120</a></div></div>
<div class="ttc" id="a00097_html_a39e2542bceca984969543bfbaafd336a"><div class="ttname"><a href="a00097.html#a39e2542bceca984969543bfbaafd336a">mqtt3_config::log_fptr</a></div><div class="ttdeci">FILE * log_fptr</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00125">mosquitto_broker.h:125</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00158_html_a05c162f84fcabc09090f53489e3ab27f"><div class="ttname"><a href="a00158.html#a05c162f84fcabc09090f53489e3ab27f">restore_privileges</a></div><div class="ttdeci">int restore_privileges(void)</div><div class="ttdef"><b>Definition:</b> <a href="a00158_source.html#l00133">mosquitto.c:133</a></div></div>
<div class="ttc" id="a00097_html_a6b85d63153f6da0aff7aa461888d5a59"><div class="ttname"><a href="a00097.html#a6b85d63153f6da0aff7aa461888d5a59">mqtt3_config::log_file</a></div><div class="ttdeci">char * log_file</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00124">mosquitto_broker.h:124</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00196_html_afb1ed89c5b0349726632c68a1960e0ca"><div class="ttname"><a href="a00196.html#afb1ed89c5b0349726632c68a1960e0ca">MQTT3_LOG_FILE</a></div><div class="ttdeci">#define MQTT3_LOG_FILE</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00056">mosquitto_broker.h:56</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a429931ef889c50f3a75f674c7029843b_cgraph.png" border="0" usemap="#a00196_a429931ef889c50f3a75f674c7029843b_cgraph" alt=""/></div>
<map name="a00196_a429931ef889c50f3a75f674c7029843b_cgraph" id="a00196_a429931ef889c50f3a75f674c7029843b_cgraph">
<area shape="rect" id="node2" href="a00158.html#a58d0ace4df75ecf8a8a0eb995e8f9cd6" title="drop_privileges" alt="" coords="373,5,482,32"/>
<area shape="rect" id="node4" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="167,157,292,184"/>
<area shape="rect" id="node5" href="a00194.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="156,107,303,133"/>
<area shape="rect" id="node16" href="a00158.html#a05c162f84fcabc09090f53489e3ab27f" title="restore_privileges" alt="" coords="579,56,703,83"/>
<area shape="rect" id="node3" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="1040,5,1187,32"/>
<area shape="rect" id="node6" href="a00194.html#a876c3aded28d27d0f1a0506647cb05fa" title="_mosquitto_log_vprintf" alt="" coords="351,233,504,260"/>
<area shape="rect" id="node7" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="1048,208,1179,235"/>
<area shape="rect" id="node8" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1485,317,1600,344"/>
<area shape="rect" id="node9" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="552,255,731,297"/>
<area shape="rect" id="node10" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="785,128,957,155"/>
<area shape="rect" id="node13" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="779,263,964,289"/>
<area shape="rect" id="node11" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="1049,107,1178,133"/>
<area shape="rect" id="node12" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="1012,157,1215,184"/>
<area shape="rect" id="node14" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="1026,334,1201,375"/>
<area shape="rect" id="node15" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="1263,310,1437,351"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a09d1e4a05c245369c22ecae0e8a42bfb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_packet_handle </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00165_source.html#l00034">34</a> of file <a class="el" href="a00165_source.html">read_handle.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span>(!context) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">switch</span>((context-&gt;<a class="code" href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">in_packet</a>.<a class="code" href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">command</a>)&amp;0xF0){</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#ad22b3f2caca5c864a3c7b0dd9bd2aceb">PINGREQ</a>:</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae">_mosquitto_handle_pingreq</a>(context);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a3bab410dbcf4cfc9e964c75e448ff029">PINGRESP</a>:</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a">_mosquitto_handle_pingresp</a>(context);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a2bd19736deca6adf997e4eda00972650">PUBACK</a>:</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24">_mosquitto_handle_pubackcomp</a>(db, context, <span class="stringliteral">&quot;PUBACK&quot;</span>);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a0a6a49b630b9aae2e28576b4e9668e03">PUBCOMP</a>:</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24">_mosquitto_handle_pubackcomp</a>(db, context, <span class="stringliteral">&quot;PUBCOMP&quot;</span>);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a6be85d4e88c1e5319a2fdf3df859ec40">PUBLISH</a>:</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00165.html#ab73094667db8b9226ef81e7895b934f6">mqtt3_handle_publish</a>(db, context);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#ab16edd237b86d488fc9bc2ea993a1fab">PUBREC</a>:</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046">_mosquitto_handle_pubrec</a>(context);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a53b95ad17cd3071a64577d786db0430f">PUBREL</a>:</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00166.html#a467343261ece717bef7eea433f48ee0d">_mosquitto_handle_pubrel</a>(db, context);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a65528c74adc6691eac2c7a2f39328064">CONNECT</a>:</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081">mqtt3_handle_connect</a>(db, context);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a587604e6f3570c0fc32794384d4d0d1f">DISCONNECT</a>:</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2">mqtt3_handle_disconnect</a>(db, context);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#ac0688f5c56ae77c72deb4a9fe83f7057">SUBSCRIBE</a>:</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80">mqtt3_handle_subscribe</a>(db, context);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a3fa10093f760d21b96de7bdfbe7caa80">UNSUBSCRIBE</a>:</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13">mqtt3_handle_unsubscribe</a>(db, context);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#ifdef WITH_BRIDGE</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#a8fdbc4a06d36325fba03cafa89fabcd5">CONNACK</a>:</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7">mqtt3_handle_connack</a>(db, context);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#afe3cc225212c5765b3a2ed0700237db5">SUBACK</a>:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8">_mosquitto_handle_suback</a>(context);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="a00161.html#aa84e1b771dd8ef3e8f74f01b7a108b3a">UNSUBACK</a>:</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00166.html#a006c0821c402b954b3665cd28a99e833">_mosquitto_handle_unsuback</a>(context);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="comment">/* If we don&#39;t recognise the command, return an error straight away. */</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div><div class="ttc" id="a00196_html_ab7f0afc1ca9700b58f5e6a817687d081"><div class="ttname"><a href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081">mqtt3_handle_connect</a></div><div class="ttdeci">int mqtt3_handle_connect(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00202_source.html#l00077">read_handle_server.c:77</a></div></div>
<div class="ttc" id="a00161_html_ab16edd237b86d488fc9bc2ea993a1fab"><div class="ttname"><a href="a00161.html#ab16edd237b86d488fc9bc2ea993a1fab">PUBREC</a></div><div class="ttdeci">#define PUBREC</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00033">mqtt3_protocol.h:33</a></div></div>
<div class="ttc" id="a00196_html_ad028e30a6047ea57b94d503668d6ea80"><div class="ttname"><a href="a00196.html#ad028e30a6047ea57b94d503668d6ea80">mqtt3_handle_subscribe</a></div><div class="ttdeci">int mqtt3_handle_subscribe(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00202_source.html#l00621">read_handle_server.c:621</a></div></div>
<div class="ttc" id="a00166_html_a467343261ece717bef7eea433f48ee0d"><div class="ttname"><a href="a00166.html#a467343261ece717bef7eea433f48ee0d">_mosquitto_handle_pubrel</a></div><div class="ttdeci">int _mosquitto_handle_pubrel(struct mosquitto_db *db, struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00169_source.html#l00127">read_handle_shared.c:127</a></div></div>
<div class="ttc" id="a00161_html_a6be85d4e88c1e5319a2fdf3df859ec40"><div class="ttname"><a href="a00161.html#a6be85d4e88c1e5319a2fdf3df859ec40">PUBLISH</a></div><div class="ttdeci">#define PUBLISH</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00031">mqtt3_protocol.h:31</a></div></div>
<div class="ttc" id="a00166_html_a8b0332f54846d87207a9f5c0b7c5213a"><div class="ttname"><a href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a">_mosquitto_handle_pingresp</a></div><div class="ttdeci">int _mosquitto_handle_pingresp(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00169_source.html#l00045">read_handle_shared.c:45</a></div></div>
<div class="ttc" id="a00161_html_a65528c74adc6691eac2c7a2f39328064"><div class="ttname"><a href="a00161.html#a65528c74adc6691eac2c7a2f39328064">CONNECT</a></div><div class="ttdeci">#define CONNECT</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00029">mqtt3_protocol.h:29</a></div></div>
<div class="ttc" id="a00161_html_aa84e1b771dd8ef3e8f74f01b7a108b3a"><div class="ttname"><a href="a00161.html#aa84e1b771dd8ef3e8f74f01b7a108b3a">UNSUBACK</a></div><div class="ttdeci">#define UNSUBACK</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00039">mqtt3_protocol.h:39</a></div></div>
<div class="ttc" id="a00011_html_a42171b2c83d8c83babc555d32ef84f7f"><div class="ttname"><a href="a00011.html#a42171b2c83d8c83babc555d32ef84f7f">_mosquitto_packet::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00140">mosquitto_internal.h:140</a></div></div>
<div class="ttc" id="a00166_html_a006c0821c402b954b3665cd28a99e833"><div class="ttname"><a href="a00166.html#a006c0821c402b954b3665cd28a99e833">_mosquitto_handle_unsuback</a></div><div class="ttdeci">int _mosquitto_handle_unsuback(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00169_source.html#l00217">read_handle_shared.c:217</a></div></div>
<div class="ttc" id="a00161_html_ad22b3f2caca5c864a3c7b0dd9bd2aceb"><div class="ttname"><a href="a00161.html#ad22b3f2caca5c864a3c7b0dd9bd2aceb">PINGREQ</a></div><div class="ttdeci">#define PINGREQ</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00040">mqtt3_protocol.h:40</a></div></div>
<div class="ttc" id="a00161_html_a8fdbc4a06d36325fba03cafa89fabcd5"><div class="ttname"><a href="a00161.html#a8fdbc4a06d36325fba03cafa89fabcd5">CONNACK</a></div><div class="ttdeci">#define CONNACK</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00030">mqtt3_protocol.h:30</a></div></div>
<div class="ttc" id="a00161_html_a587604e6f3570c0fc32794384d4d0d1f"><div class="ttname"><a href="a00161.html#a587604e6f3570c0fc32794384d4d0d1f">DISCONNECT</a></div><div class="ttdeci">#define DISCONNECT</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00042">mqtt3_protocol.h:42</a></div></div>
<div class="ttc" id="a00166_html_a7d98465bd0a71f82092b31ff17cbad24"><div class="ttname"><a href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24">_mosquitto_handle_pubackcomp</a></div><div class="ttdeci">int _mosquitto_handle_pubackcomp(struct mosquitto *mosq, const char *type)</div><div class="ttdef"><b>Definition:</b> <a href="a00169_source.html#l00060">read_handle_shared.c:60</a></div></div>
<div class="ttc" id="a00166_html_a9d1c01afbdb0b171d789389b04285dae"><div class="ttname"><a href="a00166.html#a9d1c01afbdb0b171d789389b04285dae">_mosquitto_handle_pingreq</a></div><div class="ttdeci">int _mosquitto_handle_pingreq(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00169_source.html#l00034">read_handle_shared.c:34</a></div></div>
<div class="ttc" id="a00161_html_a0a6a49b630b9aae2e28576b4e9668e03"><div class="ttname"><a href="a00161.html#a0a6a49b630b9aae2e28576b4e9668e03">PUBCOMP</a></div><div class="ttdeci">#define PUBCOMP</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00035">mqtt3_protocol.h:35</a></div></div>
<div class="ttc" id="a00166_html_ac0e4ec24207865a6040b2e0b484b8bc8"><div class="ttname"><a href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8">_mosquitto_handle_suback</a></div><div class="ttdeci">int _mosquitto_handle_suback(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00169_source.html#l00173">read_handle_shared.c:173</a></div></div>
<div class="ttc" id="a00196_html_a2fb8082975605cecae2cd5e0a5789a13"><div class="ttname"><a href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13">mqtt3_handle_unsubscribe</a></div><div class="ttdeci">int mqtt3_handle_unsubscribe(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00202_source.html#l00764">read_handle_server.c:764</a></div></div>
<div class="ttc" id="a00196_html_a1e6ad6e84cfeebd256ba58cd2553aca2"><div class="ttname"><a href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2">mqtt3_handle_disconnect</a></div><div class="ttdeci">int mqtt3_handle_disconnect(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00202_source.html#l00600">read_handle_server.c:600</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5ae3b280b8a7d893c462c4c171a31b64bd">MOSQ_ERR_PROTOCOL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00069">mosquitto.h:69</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00161_html_a53b95ad17cd3071a64577d786db0430f"><div class="ttname"><a href="a00161.html#a53b95ad17cd3071a64577d786db0430f">PUBREL</a></div><div class="ttdeci">#define PUBREL</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00034">mqtt3_protocol.h:34</a></div></div>
<div class="ttc" id="a00161_html_afe3cc225212c5765b3a2ed0700237db5"><div class="ttname"><a href="a00161.html#afe3cc225212c5765b3a2ed0700237db5">SUBACK</a></div><div class="ttdeci">#define SUBACK</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00037">mqtt3_protocol.h:37</a></div></div>
<div class="ttc" id="a00196_html_ad6b09e9305be77b254fbff1759f3c7c7"><div class="ttname"><a href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7">mqtt3_handle_connack</a></div><div class="ttdeci">int mqtt3_handle_connack(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00168_source.html#l00027">read_handle_client.c:27</a></div></div>
<div class="ttc" id="a00161_html_a3bab410dbcf4cfc9e964c75e448ff029"><div class="ttname"><a href="a00161.html#a3bab410dbcf4cfc9e964c75e448ff029">PINGRESP</a></div><div class="ttdeci">#define PINGRESP</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00041">mqtt3_protocol.h:41</a></div></div>
<div class="ttc" id="a00161_html_a2bd19736deca6adf997e4eda00972650"><div class="ttname"><a href="a00161.html#a2bd19736deca6adf997e4eda00972650">PUBACK</a></div><div class="ttdeci">#define PUBACK</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00032">mqtt3_protocol.h:32</a></div></div>
<div class="ttc" id="a00086_html_a369673718987016a39c5e8ea6fdb3b95"><div class="ttname"><a href="a00086.html#a369673718987016a39c5e8ea6fdb3b95">mosquitto::in_packet</a></div><div class="ttdeci">struct _mosquitto_packet in_packet</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00172">mosquitto_internal.h:172</a></div></div>
<div class="ttc" id="a00161_html_a3fa10093f760d21b96de7bdfbe7caa80"><div class="ttname"><a href="a00161.html#a3fa10093f760d21b96de7bdfbe7caa80">UNSUBSCRIBE</a></div><div class="ttdeci">#define UNSUBSCRIBE</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00038">mqtt3_protocol.h:38</a></div></div>
<div class="ttc" id="a00166_html_ad23085c99d7e0c4b83d3f0c3c95b6046"><div class="ttname"><a href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046">_mosquitto_handle_pubrec</a></div><div class="ttdeci">int _mosquitto_handle_pubrec(struct mosquitto *mosq)</div><div class="ttdef"><b>Definition:</b> <a href="a00169_source.html#l00099">read_handle_shared.c:99</a></div></div>
<div class="ttc" id="a00165_html_ab73094667db8b9226ef81e7895b934f6"><div class="ttname"><a href="a00165.html#ab73094667db8b9226ef81e7895b934f6">mqtt3_handle_publish</a></div><div class="ttdeci">int mqtt3_handle_publish(struct mosquitto_db *db, struct mosquitto *context)</div><div class="ttdef"><b>Definition:</b> <a href="a00165_source.html#l00075">read_handle.c:75</a></div></div>
<div class="ttc" id="a00161_html_ac0688f5c56ae77c72deb4a9fe83f7057"><div class="ttname"><a href="a00161.html#ac0688f5c56ae77c72deb4a9fe83f7057">SUBSCRIBE</a></div><div class="ttdeci">#define SUBSCRIBE</div><div class="ttdef"><b>Definition:</b> <a href="a00161_source.html#l00036">mqtt3_protocol.h:36</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a09d1e4a05c245369c22ecae0e8a42bfb_cgraph.png" border="0" usemap="#a00196_a09d1e4a05c245369c22ecae0e8a42bfb_cgraph" alt=""/></div>
<map name="a00196_a09d1e4a05c245369c22ecae0e8a42bfb_cgraph" id="a00196_a09d1e4a05c245369c22ecae0e8a42bfb_cgraph">
<area shape="rect" id="node2" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="451,2055,631,2082"/>
<area shape="rect" id="node5" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="200,2324,387,2351"/>
<area shape="rect" id="node13" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="435,2730,647,2756"/>
<area shape="rect" id="node14" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="467,1092,615,1119"/>
<area shape="rect" id="node30" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="452,2907,629,2934"/>
<area shape="rect" id="node34" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="207,2068,380,2095"/>
<area shape="rect" id="node37" href="a00196.html#ab7f0afc1ca9700b58f5e6a817687d081" title="mqtt3_handle_connect" alt="" coords="464,544,617,571"/>
<area shape="rect" id="node44" href="a00196.html#a1e6ad6e84cfeebd256ba58cd2553aca2" title="mqtt3_handle_disconnect" alt="" coords="455,1042,626,1068"/>
<area shape="rect" id="node45" href="a00196.html#ad028e30a6047ea57b94d503668d6ea80" title="mqtt3_handle_subscribe" alt="" coords="459,1852,622,1879"/>
<area shape="rect" id="node47" href="a00196.html#a2fb8082975605cecae2cd5e0a5789a13" title="mqtt3_handle_unsubscribe" alt="" coords="452,2244,629,2271"/>
<area shape="rect" id="node48" href="a00196.html#ad6b09e9305be77b254fbff1759f3c7c7" title="mqtt3_handle_connack" alt="" coords="717,1244,873,1271"/>
<area shape="rect" id="node49" href="a00166.html#ac0e4ec24207865a6040b2e0b484b8bc8" title="_mosquitto_handle_suback" alt="" coords="705,1295,885,1322"/>
<area shape="rect" id="node50" href="a00166.html#a006c0821c402b954b3665cd28a99e833" title="_mosquitto_handle_unsuback" alt="" coords="697,2426,892,2452"/>
<area shape="rect" id="node3" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="957,1751,1103,1778"/>
<area shape="rect" id="node4" href="a00171.html#afc621f5b30461d6e90cb0e13d8a8044a" title="_mosquitto_send_pingresp" alt="" coords="706,2106,883,2132"/>
<area shape="rect" id="node6" href="a00169.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="435,2628,647,2655"/>
<area shape="rect" id="node7" href="a00162.html#a01f59932d591f15b0376fd1f24a437e8" title="_mosquitto_read_uint16" alt="" coords="950,2375,1110,2402"/>
<area shape="rect" id="node8" href="a00191.html#afd644b64d7bc7a0f7a06688a3aca8e4f" title="mqtt3_db_message_delete" alt="" coords="705,2679,884,2706"/>
<area shape="rect" id="node9" href="a00155.html#acd91f51fa239a0490db5f5cfcb1e2be7" title="_mosquitto_message\l_delete" alt="" coords="721,2984,868,3025"/>
<area shape="rect" id="node10" href="a00155.html#a6b113b8436762caeb1d53e384ea558b1" title="_mosquitto_message\l_remove" alt="" coords="957,3129,1103,3170"/>
<area shape="rect" id="node11" href="a00155.html#a6a97f20e0fac5e9ce65ce9bb207539ae" title="_mosquitto_message\l_cleanup" alt="" coords="957,2984,1103,3025"/>
<area shape="rect" id="node12" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1165,1143,1280,1170"/>
<area shape="rect" id="node15" href="a00162.html#a3f8290ea4ea68607b546aaac08a4d8d7" title="_mosquitto_read_string" alt="" coords="716,1751,873,1778"/>
<area shape="rect" id="node16" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="965,1143,1095,1170"/>
<area shape="rect" id="node17" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="695,991,894,1018"/>
<area shape="rect" id="node18" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="965,763,1095,790"/>
<area shape="rect" id="node19" href="a00159.html#a37608453ba85c5b8f9f15cff802a8319" title="mosquitto_pub_topic\l_check" alt="" coords="723,672,866,713"/>
<area shape="rect" id="node20" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="967,124,1093,151"/>
<area shape="rect" id="node21" href="a00162.html#a668e43fc39fa0ae062aaa427b15382a9" title="_mosquitto_read_bytes" alt="" coords="716,620,873,647"/>
<area shape="rect" id="node22" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="722,1548,867,1575"/>
<area shape="rect" id="node23" href="a00191.html#a69b7b5c13ef8ca9d3968a208b3cbb7f6" title="mqtt3_db_message_store_find" alt="" coords="695,1042,895,1068"/>
<area shape="rect" id="node24" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="709,788,881,815"/>
<area shape="rect" id="node25" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="702,1092,887,1119"/>
<area shape="rect" id="node27" href="a00171.html#ab1b844a445f74762e20a3411cbf7ac2f" title="_mosquitto_send_puback" alt="" coords="709,1447,880,1474"/>
<area shape="rect" id="node28" href="a00191.html#a273c85b4bc9f22d097948f4021190bc8" title="mqtt3_db_message_insert" alt="" coords="707,890,882,916"/>
<area shape="rect" id="node29" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630" title="_mosquitto_send_pubrec" alt="" coords="711,1650,878,1676"/>
<area shape="rect" id="node26" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="943,1026,1117,1068"/>
<area shape="rect" id="node31" href="a00191.html#a89e1a33a5ba53721bbb006eb9ff6c048" title="mqtt3_db_message_update" alt="" coords="703,3115,886,3142"/>
<area shape="rect" id="node32" href="a00155.html#ab57363e22eb54533b1fb2be945c62217" title="_mosquitto_message\l_out_update" alt="" coords="721,3049,868,3090"/>
<area shape="rect" id="node33" href="a00171.html#afbde2c162bd4b8e9fa52b0d45aa43b81" title="_mosquitto_send_pubrel" alt="" coords="713,2831,876,2858"/>
<area shape="rect" id="node35" href="a00191.html#ab17a596b2baedf8dace3f85db644b4ec" title="mqtt3_db_message_release" alt="" coords="448,1650,633,1676"/>
<area shape="rect" id="node36" href="a00171.html#aaeba60c4fd6e50c8f7f599246c6f91fb" title="_mosquitto_send_pubcomp" alt="" coords="450,1954,631,1980"/>
<area shape="rect" id="node38" href="a00162.html#aa0425b094c40c000e3bdcef6c2766fc1" title="_mosquitto_read_byte" alt="" coords="955,1295,1105,1322"/>
<area shape="rect" id="node39" href="a00196.html#acfb0b5d2c57d066432343097452b9094" title="_mosquitto_send_connack" alt="" coords="706,175,883,202"/>
<area shape="rect" id="node40" href="a00196.html#afb27e1ef0cdde6bee2d77265380bef54" title="mosquitto_unpwd_check" alt="" coords="711,276,878,303"/>
<area shape="rect" id="node41" href="a00190.html#a1952df5bc9a6a0c54817fb60c955c738" title="mqtt3_context_disconnect" alt="" coords="943,408,1117,435"/>
<area shape="rect" id="node42" href="a00191.html#a0e9e6632cd5553fd9aa4529b6416447b" title="mqtt3_db_message_reconnect\l_reset" alt="" coords="695,328,895,369"/>
<area shape="rect" id="node43" href="a00195.html#af52acda25b9090675773beafeca25264" title="do_disconnect" alt="" coords="741,468,848,495"/>
<area shape="rect" id="node46" href="a00159.html#ace749e7f40c51e0c28587edba83e9b3b" title="mosquitto_sub_topic\l_check" alt="" coords="723,2208,866,2249"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a59294f37b85b3e5b13ccf682e9a4de68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_retain_queue </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sub_qos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00207_source.html#l00738">738</a> of file <a class="el" href="a00207_source.html">subs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;{</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00012.html">_mosquitto_subhier</a> *subhier;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00018.html">_sub_token</a> *tokens = NULL, *tail;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    assert(db);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    assert(context);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    assert(<a class="code" href="a00126.html">sub</a>);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">if</span>(_sub_topic_tokenise(<a class="code" href="a00126.html">sub</a>, &amp;tokens)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    subhier = db-&gt;<a class="code" href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">subs</a>.<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">while</span>(subhier){</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">if</span>(!strcmp(subhier-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a>, tokens-&gt;<a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>)){</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            _retain_search(db, subhier, tokens, context, <a class="code" href="a00126.html">sub</a>, sub_qos, 0);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        }</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        subhier = subhier-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordflow">while</span>(tokens){</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        tail = tokens-&gt;<a class="code" href="a00018.html#a0464e66d5520f27d2545ebe59a0f91eb">next</a>;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(tokens-&gt;<a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(tokens);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        tokens = tail;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00012_html_a00428a09aa6cf18392af6a4b3eec8232"><div class="ttname"><a href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">_mosquitto_subhier::next</a></div><div class="ttdeci">struct _mosquitto_subhier * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00164">mosquitto_broker.h:164</a></div></div>
<div class="ttc" id="a00018_html_af44d6135ad74423ca467bc0574e47b36"><div class="ttname"><a href="a00018.html#af44d6135ad74423ca467bc0574e47b36">_sub_token::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00060">subs.c:60</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00012_html_a4e5dfd42f0c74c957b234fcecf3c4225"><div class="ttname"><a href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">_mosquitto_subhier::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00166">mosquitto_broker.h:166</a></div></div>
<div class="ttc" id="a00018_html"><div class="ttname"><a href="a00018.html">_sub_token</a></div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00058">subs.c:58</a></div></div>
<div class="ttc" id="a00126_html"><div class="ttname"><a href="a00126.html">sub</a></div><div class="ttdef"><b>Definition:</b> <a href="a00374_source.html#l00016">qos.c:16</a></div></div>
<div class="ttc" id="a00012_html"><div class="ttname"><a href="a00012.html">_mosquitto_subhier</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00161">mosquitto_broker.h:161</a></div></div>
<div class="ttc" id="a00018_html_a0464e66d5520f27d2545ebe59a0f91eb"><div class="ttname"><a href="a00018.html#a0464e66d5520f27d2545ebe59a0f91eb">_sub_token::next</a></div><div class="ttdeci">struct _sub_token * next</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00059">subs.c:59</a></div></div>
<div class="ttc" id="a00012_html_a33db1bd6285c730939b53887cf9e2226"><div class="ttname"><a href="a00012.html#a33db1bd6285c730939b53887cf9e2226">_mosquitto_subhier::children</a></div><div class="ttdeci">struct _mosquitto_subhier * children</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00163">mosquitto_broker.h:163</a></div></div>
<div class="ttc" id="a00089_html_a2f96cc353b06a96922b1310c87327e0b"><div class="ttname"><a href="a00089.html#a2f96cc353b06a96922b1310c87327e0b">mosquitto_db::subs</a></div><div class="ttdeci">struct _mosquitto_subhier subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00245">mosquitto_broker.h:245</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a59294f37b85b3e5b13ccf682e9a4de68_cgraph.png" border="0" usemap="#a00196_a59294f37b85b3e5b13ccf682e9a4de68_cgraph" alt=""/></div>
<map name="a00196_a59294f37b85b3e5b13ccf682e9a4de68_cgraph" id="a00196_a59294f37b85b3e5b13ccf682e9a4de68_cgraph">
<area shape="rect" id="node2" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="189,5,304,32"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3f89551c5a87457efb044a33b91a76dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_socket_accept </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a>&#160;</td>
          <td class="paramname"><em>listensock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00199_source.html#l00086">86</a> of file <a class="el" href="a00199_source.html">net.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">int</span> j;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a> new_sock = <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00086.html">mosquitto</a> *new_context;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    BIO *bio;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">char</span> ebuf[256];</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> e;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#ifdef WITH_WRAP</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keyword">struct </span>request_info wrap_req;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="a00483.html#ac8d0c7ffaf90c43eaeaf251e3b0f3bdb">address</a>[1024];</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    new_sock = accept(listensock, NULL, 0);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span>(new_sock == <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    g_socket_connections++;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253">_mosquitto_socket_nonblock</a>(new_sock)){</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#ifdef WITH_WRAP</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">/* Use tcpd / libwrap to determine whether a connection is allowed. */</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    request_init(&amp;wrap_req, RQ_FILE, new_sock, RQ_DAEMON, <span class="stringliteral">&quot;mosquitto&quot;</span>, 0);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    fromhost(&amp;wrap_req);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span>(!hosts_access(&amp;wrap_req)){</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="comment">/* Access is denied */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="a00199.html#a76632d665060f0325b7a5a639de9cc40">_mosquitto_socket_get_address</a>(new_sock, address, 1024)){</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;Client connection from %s denied access by tcpd.&quot;</span>, address);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(new_sock);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    new_context = <a class="code" href="a00190.html#a5caa657eeafaaf5aaddf16d5c8d77773">mqtt3_context_init</a>(db, new_sock);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">if</span>(!new_context){</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(new_sock);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>; i++){</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">for</span>(j=0; j&lt;db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a>; j++){</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a>[j] == listensock){</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                new_context-&gt;listener = &amp;db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i];</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                new_context-&gt;listener-&gt;client_count++;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">if</span>(!new_context-&gt;listener){</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0">mqtt3_context_cleanup</a>(db, new_context, <span class="keyword">true</span>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span>(new_context-&gt;listener-&gt;max_connections &gt; 0 &amp;&amp; new_context-&gt;listener-&gt;client_count &gt; new_context-&gt;listener-&gt;max_connections){</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;Client connection from %s denied: max_connections exceeded.&quot;</span>, new_context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <a class="code" href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0">mqtt3_context_cleanup</a>(db, new_context, <span class="keyword">true</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">/* TLS init */</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">listener_count</a>; i++){</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">for</span>(j=0; j&lt;db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a>; j++){</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a>[j] == listensock){</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                <span class="keywordflow">if</span>(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].ssl_ctx){</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                    new_context-&gt;ssl = SSL_new(db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i].ssl_ctx);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                    <span class="keywordflow">if</span>(!new_context-&gt;ssl){</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                        <a class="code" href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0">mqtt3_context_cleanup</a>(db, new_context, <span class="keyword">true</span>);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                    SSL_set_ex_data(new_context-&gt;ssl, tls_ex_index_context, new_context);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                    SSL_set_ex_data(new_context-&gt;ssl, tls_ex_index_listener, &amp;db-&gt;<a class="code" href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">config</a>-&gt;<a class="code" href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">listeners</a>[i]);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                    new_context-&gt;<a class="code" href="a00086.html#ac425da4c098a8fce4f398ba727a6c58b">want_write</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                    bio = BIO_new_socket(new_sock, BIO_NOCLOSE);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    SSL_set_bio(new_context-&gt;ssl, bio, bio);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    ERR_clear_error();</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                    rc = SSL_accept(new_context-&gt;ssl);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    <span class="keywordflow">if</span>(rc != 1){</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        rc = SSL_get_error(new_context-&gt;ssl, rc);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                        <span class="keywordflow">if</span>(rc == SSL_ERROR_WANT_READ){</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                            <span class="comment">/* We always want to read. */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(rc == SSL_ERROR_WANT_WRITE){</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                            new_context-&gt;<a class="code" href="a00086.html#ac425da4c098a8fce4f398ba727a6c58b">want_write</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                            e = ERR_get_error();</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                            <span class="keywordflow">while</span>(e){</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>,</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                        <span class="stringliteral">&quot;Client connection from %s failed: %s.&quot;</span>,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                        new_context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>, ERR_error_string(e, ebuf));</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                e = ERR_get_error();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                            }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                            <a class="code" href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0">mqtt3_context_cleanup</a>(db, new_context, <span class="keyword">true</span>);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                        }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                    }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a>, <span class="stringliteral">&quot;New connection from %s on port %d.&quot;</span>, new_context-&gt;<a class="code" href="a00086.html#a962322fe14ee02b439cc236a85dab410">address</a>, new_context-&gt;listener-&gt;<a class="code" href="a00086.html#ae2aebd955d302f9673c57f49cb327f9b">port</a>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">return</span> new_sock;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div><div class="ttc" id="a00017_html_aac74fcfd0ef8ab1775b8e8292b9a5b95"><div class="ttname"><a href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">_mqtt3_listener::sock_count</a></div><div class="ttdeci">int sock_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00079">mosquitto_broker.h:79</a></div></div>
<div class="ttc" id="a00190_html_a5caa657eeafaaf5aaddf16d5c8d77773"><div class="ttname"><a href="a00190.html#a5caa657eeafaaf5aaddf16d5c8d77773">mqtt3_context_init</a></div><div class="ttdeci">struct mosquitto * mqtt3_context_init(struct mosquitto_db *db, mosq_sock_t sock)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00028">context.c:28</a></div></div>
<div class="ttc" id="a00097_html_aeabd210b57d1ddc66dad927c96d4a74d"><div class="ttname"><a href="a00097.html#aeabd210b57d1ddc66dad927c96d4a74d">mqtt3_config::listener_count</a></div><div class="ttdeci">int listener_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00119">mosquitto_broker.h:119</a></div></div>
<div class="ttc" id="a00097_html_ae4138e4cbbcf7ceb8097672df20faf05"><div class="ttname"><a href="a00097.html#ae4138e4cbbcf7ceb8097672df20faf05">mqtt3_config::listeners</a></div><div class="ttdeci">struct _mqtt3_listener * listeners</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00118">mosquitto_broker.h:118</a></div></div>
<div class="ttc" id="a00163_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00045">net_mosq.h:45</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00160_html_ae9ecb8ae965b1d3af4bebd2cc031998e"><div class="ttname"><a href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a></div><div class="ttdeci">int mosq_sock_t</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00069">mosquitto_internal.h:69</a></div></div>
<div class="ttc" id="a00086_html_a962322fe14ee02b439cc236a85dab410"><div class="ttname"><a href="a00086.html#a962322fe14ee02b439cc236a85dab410">mosquitto::address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00162">mosquitto_internal.h:162</a></div></div>
<div class="ttc" id="a00159_html_a9813111aaf5eaafd2eaac66e1dc4659d"><div class="ttname"><a href="a00159.html#a9813111aaf5eaafd2eaac66e1dc4659d">MOSQ_LOG_NOTICE</a></div><div class="ttdeci">#define MOSQ_LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00055">mosquitto.h:55</a></div></div>
<div class="ttc" id="a00199_html_a76632d665060f0325b7a5a639de9cc40"><div class="ttname"><a href="a00199.html#a76632d665060f0325b7a5a639de9cc40">_mosquitto_socket_get_address</a></div><div class="ttdeci">int _mosquitto_socket_get_address(mosq_sock_t sock, char *buf, int len)</div><div class="ttdef"><b>Definition:</b> <a href="a00199_source.html#l00514">net.c:514</a></div></div>
<div class="ttc" id="a00190_html_ac919bd8bbc017773fc9d75c098faaae0"><div class="ttname"><a href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0">mqtt3_context_cleanup</a></div><div class="ttdeci">void mqtt3_context_cleanup(struct mosquitto_db *db, struct mosquitto *context, bool do_free)</div><div class="ttdef"><b>Definition:</b> <a href="a00190_source.html#l00092">context.c:92</a></div></div>
<div class="ttc" id="a00086_html_ac425da4c098a8fce4f398ba727a6c58b"><div class="ttname"><a href="a00086.html#ac425da4c098a8fce4f398ba727a6c58b">mosquitto::want_write</a></div><div class="ttdeci">bool want_write</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00191">mosquitto_internal.h:191</a></div></div>
<div class="ttc" id="a00162_html_a09dc43fbc8f662dd7f71b56937af5253"><div class="ttname"><a href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253">_mosquitto_socket_nonblock</a></div><div class="ttdeci">int _mosquitto_socket_nonblock(mosq_sock_t sock)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l01151">net_mosq.c:1151</a></div></div>
<div class="ttc" id="a00086_html"><div class="ttname"><a href="a00086.html">mosquitto</a></div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00153">mosquitto_internal.h:153</a></div></div>
<div class="ttc" id="a00089_html_af815fe0e54c2a149e5601c4648ddff64"><div class="ttname"><a href="a00089.html#af815fe0e54c2a149e5601c4648ddff64">mosquitto_db::config</a></div><div class="ttdeci">struct mqtt3_config * config</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00263">mosquitto_broker.h:263</a></div></div>
<div class="ttc" id="a00163_html_a96f0a0623f6cf73432200776459fa4df"><div class="ttname"><a href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a></div><div class="ttdeci">#define COMPAT_CLOSE(a)</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00038">net_mosq.h:38</a></div></div>
<div class="ttc" id="a00017_html_a60a8b4323b336b3033ebcf904716fe09"><div class="ttname"><a href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">_mqtt3_listener::socks</a></div><div class="ttdeci">mosq_sock_t * socks</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00078">mosquitto_broker.h:78</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00483_html_ac8d0c7ffaf90c43eaeaf251e3b0f3bdb"><div class="ttname"><a href="a00483.html#ac8d0c7ffaf90c43eaeaf251e3b0f3bdb">06-bridge-b2br-disconnect-qos1.address</a></div><div class="ttdeci">address</div><div class="ttdef"><b>Definition:</b> <a href="a00256_source.html#l00047">06-bridge-b2br-disconnect-qos1.py:47</a></div></div>
<div class="ttc" id="a00086_html_ae2aebd955d302f9673c57f49cb327f9b"><div class="ttname"><a href="a00086.html#ae2aebd955d302f9673c57f49cb327f9b">mosquitto::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00254">mosquitto_internal.h:254</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a3f89551c5a87457efb044a33b91a76dd_cgraph.png" border="0" usemap="#a00196_a3f89551c5a87457efb044a33b91a76dd_cgraph" alt=""/></div>
<map name="a00196_a3f89551c5a87457efb044a33b91a76dd_cgraph" id="a00196_a3f89551c5a87457efb044a33b91a76dd_cgraph">
<area shape="rect" id="node2" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="627,328,817,355"/>
<area shape="rect" id="node3" href="a00199.html#a76632d665060f0325b7a5a639de9cc40" title="_mosquitto_socket_get\l_address" alt="" coords="201,60,359,101"/>
<area shape="rect" id="node4" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="1127,1452,1273,1479"/>
<area shape="rect" id="node5" href="a00190.html#a5caa657eeafaaf5aaddf16d5c8d77773" title="mqtt3_context_init" alt="" coords="893,126,1023,152"/>
<area shape="rect" id="node6" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="1137,328,1263,355"/>
<area shape="rect" id="node9" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="1577,703,1692,730"/>
<area shape="rect" id="node11" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="1375,1022,1504,1048"/>
<area shape="rect" id="node12" href="a00190.html#ac919bd8bbc017773fc9d75c098faaae0" title="mqtt3_context_cleanup" alt="" coords="201,638,359,664"/>
<area shape="rect" id="node32" href="a00158.html#a5970ed3ba87bd3fe42bd275db57ad26d" title="_mosquitto_get_db" alt="" coords="214,1047,346,1074"/>
<area shape="rect" id="node33" href="a00196.html#aa17174a4b0aedc61fac238bb6d89b56d" title="mosquitto_psk_key_get" alt="" coords="200,286,360,312"/>
<area shape="rect" id="node7" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="1145,59,1255,86"/>
<area shape="rect" id="node8" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="1108,227,1292,254"/>
<area shape="rect" id="node10" href="a00196.html#a76632d665060f0325b7a5a639de9cc40" title="_mosquitto_socket_get\l_address" alt="" coords="1121,110,1279,152"/>
<area shape="rect" id="node13" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="408,472,579,499"/>
<area shape="rect" id="node16" href="a00196.html#a6f5d696cb546ec16f63ef7855b624fe0" title="mqtt3_subs_clean_session" alt="" coords="1349,602,1529,628"/>
<area shape="rect" id="node17" href="a00191.html#aa62ed0d7c268d8756b3b91951d59bac2" title="mqtt3_db_messages_delete" alt="" coords="865,714,1051,740"/>
<area shape="rect" id="node18" href="a00191.html#af19cbc47cd971cdb22e9f48566bb3e68" title="mosquitto__db_msg_store\l_deref" alt="" coords="1113,728,1287,769"/>
<area shape="rect" id="node20" href="a00190.html#ae4b59315a689849d8f78a1361271acc5" title="mqtt3_context_send_will" alt="" coords="410,1123,577,1150"/>
<area shape="rect" id="node14" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="641,496,803,537"/>
<area shape="rect" id="node15" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="641,430,803,472"/>
<area shape="rect" id="node19" href="a00191.html#a0cdc24cdccc64a0e398b093e2a1bf1b3" title="mosquitto__db_msg_store\l_remove" alt="" coords="1352,754,1527,796"/>
<area shape="rect" id="node21" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="649,1199,795,1226"/>
<area shape="rect" id="node28" href="a00191.html#abe58c783467b8953116641c9a2eb81a9" title="mqtt3_db_messages_easy\l_queue" alt="" coords="633,930,811,972"/>
<area shape="rect" id="node22" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="885,1192,1031,1233"/>
<area shape="rect" id="node23" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="1101,1148,1299,1175"/>
<area shape="rect" id="node24" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="1374,1250,1505,1276"/>
<area shape="rect" id="node25" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="1137,1098,1263,1124"/>
<area shape="rect" id="node26" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="1163,1300,1237,1327"/>
<area shape="rect" id="node27" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="1139,1199,1261,1226"/>
<area shape="rect" id="node29" href="a00191.html#a36e4902f860237756538cc4a58e1321b" title="mqtt3_db_message_store" alt="" coords="872,942,1044,968"/>
<area shape="rect" id="node31" href="a00196.html#a7a90d0b3b46b09f07e3fa99074e80eca" title="mqtt3_db_messages_queue" alt="" coords="865,815,1051,842"/>
<area shape="rect" id="node30" href="a00191.html#a838cff02f4134c5c060e16009cc7254c" title="mosquitto__db_msg_store_add" alt="" coords="1099,946,1301,972"/>
<area shape="rect" id="node34" href="a00196.html#aadb5a441176967dc1937d0f702edbdb7" title="mosquitto_psk_key_get\l_default" alt="" coords="413,274,573,316"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a82f30f5e1002c310cdee164c9af71ea0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_socket_listen </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00017.html">_mqtt3_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00199_source.html#l00343">343</a> of file <a class="el" href="a00199_source.html">net.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a> <a class="code" href="a00427.html#a7908f70ce5b165788133870c881f016a">sock</a> = <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keyword">struct </span>addrinfo hints;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keyword">struct </span>addrinfo *ainfo, *rp;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordtype">char</span> service[10];</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor">#ifndef WIN32</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">int</span> ss_opt = 1;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordtype">char</span> ss_opt = 1;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    X509_STORE *store;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    X509_LOOKUP *lookup;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span>(!listener) <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a>;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    snprintf(service, 10, <span class="stringliteral">&quot;%d&quot;</span>, listener-&gt;<a class="code" href="a00017.html#ae260347bb57e825c09097bff30b69c88">port</a>);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    memset(&amp;hints, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> addrinfo));</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    hints.ai_family = PF_UNSPEC;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    hints.ai_flags = AI_PASSIVE;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    hints.ai_socktype = SOCK_STREAM;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span>(getaddrinfo(listener-&gt;<a class="code" href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">host</a>, service, &amp;hints, &amp;ainfo)) <span class="keywordflow">return</span> <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    listener-&gt;<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a> = 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    listener-&gt;<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a> = NULL;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">for</span>(rp = ainfo; rp; rp = rp-&gt;ai_next){</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordflow">if</span>(rp-&gt;ai_family == AF_INET){</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Opening ipv4 listen socket on port %d.&quot;</span>, ntohs(((<span class="keyword">struct</span> sockaddr_in *)rp-&gt;ai_addr)-&gt;sin_port));</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(rp-&gt;ai_family == AF_INET6){</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a>, <span class="stringliteral">&quot;Opening ipv6 listen socket on port %d.&quot;</span>, ntohs(((<span class="keyword">struct</span> sockaddr_in6 *)rp-&gt;ai_addr)-&gt;sin6_port));</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        sock = socket(rp-&gt;ai_family, rp-&gt;ai_socktype, rp-&gt;ai_protocol);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">if</span>(sock == <a class="code" href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a>){</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            net__print_error(<a class="code" href="a00159.html#af42b074947ad51304b224e61307ff523">MOSQ_LOG_WARNING</a>, <span class="stringliteral">&quot;Warning: %s&quot;</span>);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        listener-&gt;<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a>++;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        listener-&gt;<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a> = <a class="code" href="a00153.html#a60e49e66df31d85392b2000c75a088dd">_mosquitto_realloc</a>(listener-&gt;<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a>, <span class="keyword">sizeof</span>(<a class="code" href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a>)*listener-&gt;<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a>);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">if</span>(!listener-&gt;<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a>){</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        listener-&gt;<a class="code" href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">socks</a>[listener-&gt;<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a>-1] = <a class="code" href="a00427.html#a7908f70ce5b165788133870c881f016a">sock</a>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#ifndef WIN32</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        ss_opt = 1;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        setsockopt(sock, SOL_SOCKET, SO_REUSEADDR, &amp;ss_opt, <span class="keyword">sizeof</span>(ss_opt));</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        ss_opt = 1;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        setsockopt(sock, IPPROTO_IPV6, IPV6_V6ONLY, &amp;ss_opt, <span class="keyword">sizeof</span>(ss_opt));</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253">_mosquitto_socket_nonblock</a>(sock)){</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">if</span>(bind(sock, rp-&gt;ai_addr, rp-&gt;ai_addrlen) == -1){</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            net__print_error(<a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: %s&quot;</span>);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">if</span>(listen(sock, 100) == -1){</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            net__print_error(<a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: %s&quot;</span>);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    freeaddrinfo(ainfo);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">/* We need to have at least one working socket. */</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span>(listener-&gt;<a class="code" href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">sock_count</a> &gt; 0){</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="preprocessor">#ifdef WITH_TLS</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">if</span>((listener-&gt;cafile || listener-&gt;capath) &amp;&amp; listener-&gt;certfile &amp;&amp; listener-&gt;keyfile){</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordflow">if</span>(_mosquitto_tls_server_ctx(listener)){</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            rc = SSL_CTX_load_verify_locations(listener-&gt;ssl_ctx, listener-&gt;cafile, listener-&gt;capath);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keywordflow">if</span>(rc == 0){</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                <span class="keywordflow">if</span>(listener-&gt;cafile &amp;&amp; listener-&gt;capath){</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to load CA certificates. Check cafile \&quot;%s\&quot; and capath \&quot;%s\&quot;.&quot;</span>, listener-&gt;cafile, listener-&gt;capath);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(listener-&gt;cafile){</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to load CA certificates. Check cafile \&quot;%s\&quot;.&quot;</span>, listener-&gt;cafile);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to load CA certificates. Check capath \&quot;%s\&quot;.&quot;</span>, listener-&gt;capath);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            }</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <span class="comment">/* FIXME user data? */</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="keywordflow">if</span>(listener-&gt;require_certificate){</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                SSL_CTX_set_verify(listener-&gt;ssl_ctx, SSL_VERIFY_PEER | SSL_VERIFY_FAIL_IF_NO_PEER_CERT, client_certificate_verify);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                SSL_CTX_set_verify(listener-&gt;ssl_ctx, SSL_VERIFY_NONE, client_certificate_verify);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            rc = SSL_CTX_use_certificate_chain_file(listener-&gt;ssl_ctx, listener-&gt;certfile);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="keywordflow">if</span>(rc != 1){</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to load server certificate \&quot;%s\&quot;. Check certfile.&quot;</span>, listener-&gt;certfile);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            rc = SSL_CTX_use_PrivateKey_file(listener-&gt;ssl_ctx, listener-&gt;keyfile, SSL_FILETYPE_PEM);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordflow">if</span>(rc != 1){</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to load server key file \&quot;%s\&quot;. Check keyfile.&quot;</span>, listener-&gt;keyfile);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            rc = SSL_CTX_check_private_key(listener-&gt;ssl_ctx);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="keywordflow">if</span>(rc != 1){</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Server certificate/key are inconsistent.&quot;</span>);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="comment">/* Load CRLs if they exist. */</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">if</span>(listener-&gt;crlfile){</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                store = SSL_CTX_get_cert_store(listener-&gt;ssl_ctx);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <span class="keywordflow">if</span>(!store){</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to obtain TLS store.&quot;</span>);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                    <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                lookup = X509_STORE_add_lookup(store, X509_LOOKUP_file());</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                rc = X509_load_crl_file(lookup, listener-&gt;crlfile, X509_FILETYPE_PEM);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                <span class="keywordflow">if</span>(rc != 1){</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to load certificate revocation file \&quot;%s\&quot;. Check crlfile.&quot;</span>, listener-&gt;crlfile);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                    <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                X509_STORE_set_flags(store, X509_V_FLAG_CRL_CHECK);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="preprocessor">#  ifdef REAL_WITH_TLS_PSK</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(listener-&gt;psk_hint){</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keywordflow">if</span>(tls_ex_index_context == -1){</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                tls_ex_index_context = SSL_get_ex_new_index(0, <span class="stringliteral">&quot;client context&quot;</span>, NULL, NULL, NULL);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">if</span>(tls_ex_index_listener == -1){</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                tls_ex_index_listener = SSL_get_ex_new_index(0, <span class="stringliteral">&quot;listener&quot;</span>, NULL, NULL, NULL);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            }</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">if</span>(_mosquitto_tls_server_ctx(listener)){</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            }</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            SSL_CTX_set_psk_server_callback(listener-&gt;ssl_ctx, psk_server_callback);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">if</span>(listener-&gt;psk_hint){</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                rc = SSL_CTX_use_psk_identity_hint(listener-&gt;ssl_ctx, listener-&gt;psk_hint);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="keywordflow">if</span>(rc == 0){</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                    <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Unable to set TLS PSK hint.&quot;</span>);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                    <a class="code" href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a>(sock);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor">#  endif </span><span class="comment">/* REAL_WITH_TLS_PSK */</span><span class="preprocessor"></span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* WITH_TLS */</span><span class="preprocessor"></span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;}</div><div class="ttc" id="a00017_html_aac74fcfd0ef8ab1775b8e8292b9a5b95"><div class="ttname"><a href="a00017.html#aac74fcfd0ef8ab1775b8e8292b9a5b95">_mqtt3_listener::sock_count</a></div><div class="ttdeci">int sock_count</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00079">mosquitto_broker.h:79</a></div></div>
<div class="ttc" id="a00017_html_ae260347bb57e825c09097bff30b69c88"><div class="ttname"><a href="a00017.html#ae260347bb57e825c09097bff30b69c88">_mqtt3_listener::port</a></div><div class="ttdeci">uint16_t port</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00075">mosquitto_broker.h:75</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00163_html_a26769957ec1a2beaf223f33b66ee64ab"><div class="ttname"><a href="a00163.html#a26769957ec1a2beaf223f33b66ee64ab">INVALID_SOCKET</a></div><div class="ttdeci">#define INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00045">net_mosq.h:45</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00160_html_ae9ecb8ae965b1d3af4bebd2cc031998e"><div class="ttname"><a href="a00160.html#ae9ecb8ae965b1d3af4bebd2cc031998e">mosq_sock_t</a></div><div class="ttdeci">int mosq_sock_t</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00069">mosquitto_internal.h:69</a></div></div>
<div class="ttc" id="a00427_html_a7908f70ce5b165788133870c881f016a"><div class="ttname"><a href="a00427.html#a7908f70ce5b165788133870c881f016a">01-connect-anon-denied.sock</a></div><div class="ttdeci">sock</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00021">01-connect-anon-denied.py:21</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00017_html_a8f3e15dab6e5bae10bb2d930034f4d9f"><div class="ttname"><a href="a00017.html#a8f3e15dab6e5bae10bb2d930034f4d9f">_mqtt3_listener::host</a></div><div class="ttdeci">char * host</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00074">mosquitto_broker.h:74</a></div></div>
<div class="ttc" id="a00159_html_a53ca7e5700e1a592fc72d43cdff68dd3"><div class="ttname"><a href="a00159.html#a53ca7e5700e1a592fc72d43cdff68dd3">MOSQ_LOG_INFO</a></div><div class="ttdeci">#define MOSQ_LOG_INFO</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00054">mosquitto.h:54</a></div></div>
<div class="ttc" id="a00162_html_a09dc43fbc8f662dd7f71b56937af5253"><div class="ttname"><a href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253">_mosquitto_socket_nonblock</a></div><div class="ttdeci">int _mosquitto_socket_nonblock(mosq_sock_t sock)</div><div class="ttdef"><b>Definition:</b> <a href="a00162_source.html#l01151">net_mosq.c:1151</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9fc59ed2d318deb411d268ef7087518a">MOSQ_ERR_INVAL</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00070">mosquitto.h:70</a></div></div>
<div class="ttc" id="a00163_html_a96f0a0623f6cf73432200776459fa4df"><div class="ttname"><a href="a00163.html#a96f0a0623f6cf73432200776459fa4df">COMPAT_CLOSE</a></div><div class="ttdeci">#define COMPAT_CLOSE(a)</div><div class="ttdef"><b>Definition:</b> <a href="a00163_source.html#l00038">net_mosq.h:38</a></div></div>
<div class="ttc" id="a00153_html_a60e49e66df31d85392b2000c75a088dd"><div class="ttname"><a href="a00153.html#a60e49e66df31d85392b2000c75a088dd">_mosquitto_realloc</a></div><div class="ttdeci">void * _mosquitto_realloc(void *ptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00091">memory_mosq.c:91</a></div></div>
<div class="ttc" id="a00017_html_a60a8b4323b336b3033ebcf904716fe09"><div class="ttname"><a href="a00017.html#a60a8b4323b336b3033ebcf904716fe09">_mqtt3_listener::socks</a></div><div class="ttdeci">mosq_sock_t * socks</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00078">mosquitto_broker.h:78</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
<div class="ttc" id="a00159_html_af42b074947ad51304b224e61307ff523"><div class="ttname"><a href="a00159.html#af42b074947ad51304b224e61307ff523">MOSQ_LOG_WARNING</a></div><div class="ttdeci">#define MOSQ_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00056">mosquitto.h:56</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a82f30f5e1002c310cdee164c9af71ea0_cgraph.png" border="0" usemap="#a00196_a82f30f5e1002c310cdee164c9af71ea0_cgraph" alt=""/></div>
<map name="a00196_a82f30f5e1002c310cdee164c9af71ea0_cgraph" id="a00196_a82f30f5e1002c310cdee164c9af71ea0_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="214,5,361,32"/>
<area shape="rect" id="node3" href="a00153.html#a60e49e66df31d85392b2000c75a088dd" title="_mosquitto_realloc" alt="" coords="222,56,353,83"/>
<area shape="rect" id="node4" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="192,107,383,133"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afe850bdd3f238f7c555bdd861944d6fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_sub_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00012.html">_mosquitto_subhier</a> *&#160;</td>
          <td class="paramname"><em>root</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00207_source.html#l00428">428</a> of file <a class="el" href="a00207_source.html">subs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;{</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = 0;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00012.html">_mosquitto_subhier</a> *subhier, *child;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00018.html">_sub_token</a> *tokens = NULL;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    assert(root);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    assert(<a class="code" href="a00126.html">sub</a>);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span>(_sub_topic_tokenise(<a class="code" href="a00126.html">sub</a>, &amp;tokens)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    subhier = root-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">while</span>(subhier){</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">if</span>(!strcmp(subhier-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a>, tokens-&gt;<a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>)){</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            rc = _sub_add(db, context, qos, subhier, tokens);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        subhier = subhier-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a>;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span>(!subhier){</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        child = <a class="code" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="a00012.html">_mosquitto_subhier</a>));</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">if</span>(!child){</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            _sub_topic_tokens_free(tokens);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        }</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        child-&gt;<a class="code" href="a00012.html#addcde11a0ac8bf0c12d8716ded87fbe4">parent</a> = root;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        child-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a> = <a class="code" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a>(tokens-&gt;<a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">if</span>(!child-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a>){</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            _sub_topic_tokens_free(tokens);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(child);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error: Out of memory.&quot;</span>);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        }</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        child-&gt;<a class="code" href="a00012.html#ad6054fd88882fc67bdeb291696df6b81">subs</a> = NULL;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        child-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a> = NULL;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        child-&gt;<a class="code" href="a00012.html#aeede44aaca8140d0e130be6ce710a6c6">retained</a> = NULL;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">if</span>(root-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>){</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            child-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a> = root-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            child-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a> = NULL;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        root-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a> = child;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        rc = _sub_add(db, context, qos, child, tokens);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    _sub_topic_tokens_free(tokens);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">/* We aren&#39;t worried about -1 (already subscribed) return codes. */</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span>(rc == -1) rc = <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00012_html_a00428a09aa6cf18392af6a4b3eec8232"><div class="ttname"><a href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">_mosquitto_subhier::next</a></div><div class="ttdeci">struct _mosquitto_subhier * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00164">mosquitto_broker.h:164</a></div></div>
<div class="ttc" id="a00018_html_af44d6135ad74423ca467bc0574e47b36"><div class="ttname"><a href="a00018.html#af44d6135ad74423ca467bc0574e47b36">_sub_token::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00060">subs.c:60</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00012_html_a4e5dfd42f0c74c957b234fcecf3c4225"><div class="ttname"><a href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">_mosquitto_subhier::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00166">mosquitto_broker.h:166</a></div></div>
<div class="ttc" id="a00012_html_addcde11a0ac8bf0c12d8716ded87fbe4"><div class="ttname"><a href="a00012.html#addcde11a0ac8bf0c12d8716ded87fbe4">_mosquitto_subhier::parent</a></div><div class="ttdeci">struct _mosquitto_subhier * parent</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00162">mosquitto_broker.h:162</a></div></div>
<div class="ttc" id="a00012_html_ad6054fd88882fc67bdeb291696df6b81"><div class="ttname"><a href="a00012.html#ad6054fd88882fc67bdeb291696df6b81">_mosquitto_subhier::subs</a></div><div class="ttdeci">struct _mosquitto_subleaf * subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00165">mosquitto_broker.h:165</a></div></div>
<div class="ttc" id="a00018_html"><div class="ttname"><a href="a00018.html">_sub_token</a></div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00058">subs.c:58</a></div></div>
<div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a5a7098f2f59ec49126110b033c934ba6">MOSQ_ERR_NOMEM</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00068">mosquitto.h:68</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00126_html"><div class="ttname"><a href="a00126.html">sub</a></div><div class="ttdef"><b>Definition:</b> <a href="a00374_source.html#l00016">qos.c:16</a></div></div>
<div class="ttc" id="a00012_html"><div class="ttname"><a href="a00012.html">_mosquitto_subhier</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00161">mosquitto_broker.h:161</a></div></div>
<div class="ttc" id="a00012_html_aeede44aaca8140d0e130be6ce710a6c6"><div class="ttname"><a href="a00012.html#aeede44aaca8140d0e130be6ce710a6c6">_mosquitto_subhier::retained</a></div><div class="ttdeci">struct mosquitto_msg_store * retained</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00167">mosquitto_broker.h:167</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00153_html_ae6550bff1e45b4c074746b31f29ef537"><div class="ttname"><a href="a00153.html#ae6550bff1e45b4c074746b31f29ef537">_mosquitto_strdup</a></div><div class="ttdeci">char * _mosquitto_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00111">memory_mosq.c:111</a></div></div>
<div class="ttc" id="a00012_html_a33db1bd6285c730939b53887cf9e2226"><div class="ttname"><a href="a00012.html#a33db1bd6285c730939b53887cf9e2226">_mosquitto_subhier::children</a></div><div class="ttdeci">struct _mosquitto_subhier * children</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00163">mosquitto_broker.h:163</a></div></div>
<div class="ttc" id="a00153_html_af77494a3afe6d474b2cedb3b9a99283e"><div class="ttname"><a href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e">_mosquitto_malloc</a></div><div class="ttdeci">void * _mosquitto_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00065">memory_mosq.c:65</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_afe850bdd3f238f7c555bdd861944d6fc_cgraph.png" border="0" usemap="#a00196_afe850bdd3f238f7c555bdd861944d6fc_cgraph" alt=""/></div>
<map name="a00196_afe850bdd3f238f7c555bdd861944d6fc_cgraph" id="a00196_afe850bdd3f238f7c555bdd861944d6fc_cgraph">
<area shape="rect" id="node2" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="172,5,303,32"/>
<area shape="rect" id="node3" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="164,56,311,83"/>
<area shape="rect" id="node4" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="173,107,302,133"/>
<area shape="rect" id="node5" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="180,157,295,184"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a25dfd4d59b3e689243ef6187b45fadeb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_sub_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00012.html">_mosquitto_subhier</a> *&#160;</td>
          <td class="paramname"><em>root</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00207_source.html#l00482">482</a> of file <a class="el" href="a00207_source.html">subs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;{</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a> = 0;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00012.html">_mosquitto_subhier</a> *subhier;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00018.html">_sub_token</a> *tokens = NULL;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    assert(root);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    assert(<a class="code" href="a00126.html">sub</a>);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span>(_sub_topic_tokenise(<a class="code" href="a00126.html">sub</a>, &amp;tokens)) <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    subhier = root-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">while</span>(subhier){</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">if</span>(!strcmp(subhier-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a>, tokens-&gt;<a class="code" href="a00018.html#af44d6135ad74423ca467bc0574e47b36">topic</a>)){</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            rc = _sub_remove(db, context, subhier, tokens);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        subhier = subhier-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    _sub_topic_tokens_free(tokens);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div><div class="ttc" id="a00012_html_a00428a09aa6cf18392af6a4b3eec8232"><div class="ttname"><a href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">_mosquitto_subhier::next</a></div><div class="ttdeci">struct _mosquitto_subhier * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00164">mosquitto_broker.h:164</a></div></div>
<div class="ttc" id="a00018_html_af44d6135ad74423ca467bc0574e47b36"><div class="ttname"><a href="a00018.html#af44d6135ad74423ca467bc0574e47b36">_sub_token::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00060">subs.c:60</a></div></div>
<div class="ttc" id="a00012_html_a4e5dfd42f0c74c957b234fcecf3c4225"><div class="ttname"><a href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">_mosquitto_subhier::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00166">mosquitto_broker.h:166</a></div></div>
<div class="ttc" id="a00018_html"><div class="ttname"><a href="a00018.html">_sub_token</a></div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00058">subs.c:58</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00126_html"><div class="ttname"><a href="a00126.html">sub</a></div><div class="ttdef"><b>Definition:</b> <a href="a00374_source.html#l00016">qos.c:16</a></div></div>
<div class="ttc" id="a00012_html"><div class="ttname"><a href="a00012.html">_mosquitto_subhier</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00161">mosquitto_broker.h:161</a></div></div>
<div class="ttc" id="a00012_html_a33db1bd6285c730939b53887cf9e2226"><div class="ttname"><a href="a00012.html#a33db1bd6285c730939b53887cf9e2226">_mosquitto_subhier::children</a></div><div class="ttdeci">struct _mosquitto_subhier * children</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00163">mosquitto_broker.h:163</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1720ad6940222086291d6bf505cfbba0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_sub_search </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00012.html">_mosquitto_subhier</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>source_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>retain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00092.html">mosquitto_msg_store</a> *&#160;</td>
          <td class="paramname"><em>stored</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a70c65656337b203d320f63e798e79f9f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mqtt3_sub_tree_print </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00012.html">_mosquitto_subhier</a> *&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00207_source.html#l00640">640</a> of file <a class="el" href="a00207_source.html">subs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;{</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00012.html">_mosquitto_subhier</a> *branch;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00013.html">_mosquitto_subleaf</a> *leaf;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;level*2; i++){</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        printf(<span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    printf(<span class="stringliteral">&quot;%s&quot;</span>, root-&gt;<a class="code" href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">topic</a>);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    leaf = root-&gt;<a class="code" href="a00012.html#ad6054fd88882fc67bdeb291696df6b81">subs</a>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">while</span>(leaf){</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">if</span>(leaf-&gt;<a class="code" href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">context</a>){</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            printf(<span class="stringliteral">&quot; (%s, %d)&quot;</span>, leaf-&gt;<a class="code" href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">context</a>-&gt;<a class="code" href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">id</a>, leaf-&gt;<a class="code" href="a00013.html#aa1ddfac26492a4103cf0a20509eb4395">qos</a>);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            printf(<span class="stringliteral">&quot; (%s, %d)&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, leaf-&gt;<a class="code" href="a00013.html#aa1ddfac26492a4103cf0a20509eb4395">qos</a>);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        leaf = leaf-&gt;<a class="code" href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">next</a>;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">if</span>(root-&gt;<a class="code" href="a00012.html#aeede44aaca8140d0e130be6ce710a6c6">retained</a>){</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        printf(<span class="stringliteral">&quot; (r)&quot;</span>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    branch = root-&gt;<a class="code" href="a00012.html#a33db1bd6285c730939b53887cf9e2226">children</a>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">while</span>(branch){</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <a class="code" href="a00207.html#a70c65656337b203d320f63e798e79f9f">mqtt3_sub_tree_print</a>(branch, level+1);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        branch = branch-&gt;<a class="code" href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">next</a>;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div><div class="ttc" id="a00012_html_a00428a09aa6cf18392af6a4b3eec8232"><div class="ttname"><a href="a00012.html#a00428a09aa6cf18392af6a4b3eec8232">_mosquitto_subhier::next</a></div><div class="ttdeci">struct _mosquitto_subhier * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00164">mosquitto_broker.h:164</a></div></div>
<div class="ttc" id="a00207_html_a70c65656337b203d320f63e798e79f9f"><div class="ttname"><a href="a00207.html#a70c65656337b203d320f63e798e79f9f">mqtt3_sub_tree_print</a></div><div class="ttdeci">void mqtt3_sub_tree_print(struct _mosquitto_subhier *root, int level)</div><div class="ttdef"><b>Definition:</b> <a href="a00207_source.html#l00640">subs.c:640</a></div></div>
<div class="ttc" id="a00012_html_a4e5dfd42f0c74c957b234fcecf3c4225"><div class="ttname"><a href="a00012.html#a4e5dfd42f0c74c957b234fcecf3c4225">_mosquitto_subhier::topic</a></div><div class="ttdeci">char * topic</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00166">mosquitto_broker.h:166</a></div></div>
<div class="ttc" id="a00013_html_a942cc8378e37d1c3426cd0a11d6ef29d"><div class="ttname"><a href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">_mosquitto_subleaf::context</a></div><div class="ttdeci">struct mosquitto * context</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00157">mosquitto_broker.h:157</a></div></div>
<div class="ttc" id="a00012_html_ad6054fd88882fc67bdeb291696df6b81"><div class="ttname"><a href="a00012.html#ad6054fd88882fc67bdeb291696df6b81">_mosquitto_subhier::subs</a></div><div class="ttdeci">struct _mosquitto_subleaf * subs</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00165">mosquitto_broker.h:165</a></div></div>
<div class="ttc" id="a00086_html_a6c7e54cb56bc80a99cc96f4005166dcd"><div class="ttname"><a href="a00086.html#a6c7e54cb56bc80a99cc96f4005166dcd">mosquitto::id</a></div><div class="ttdeci">char * id</div><div class="ttdef"><b>Definition:</b> <a href="a00160_source.html#l00163">mosquitto_internal.h:163</a></div></div>
<div class="ttc" id="a00012_html"><div class="ttname"><a href="a00012.html">_mosquitto_subhier</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00161">mosquitto_broker.h:161</a></div></div>
<div class="ttc" id="a00012_html_aeede44aaca8140d0e130be6ce710a6c6"><div class="ttname"><a href="a00012.html#aeede44aaca8140d0e130be6ce710a6c6">_mosquitto_subhier::retained</a></div><div class="ttdeci">struct mosquitto_msg_store * retained</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00167">mosquitto_broker.h:167</a></div></div>
<div class="ttc" id="a00012_html_a33db1bd6285c730939b53887cf9e2226"><div class="ttname"><a href="a00012.html#a33db1bd6285c730939b53887cf9e2226">_mosquitto_subhier::children</a></div><div class="ttdeci">struct _mosquitto_subhier * children</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00163">mosquitto_broker.h:163</a></div></div>
<div class="ttc" id="a00013_html"><div class="ttname"><a href="a00013.html">_mosquitto_subleaf</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00154">mosquitto_broker.h:154</a></div></div>
<div class="ttc" id="a00013_html_ac3373712c2cf873c9d806f8c071f44a6"><div class="ttname"><a href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">_mosquitto_subleaf::next</a></div><div class="ttdeci">struct _mosquitto_subleaf * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00156">mosquitto_broker.h:156</a></div></div>
<div class="ttc" id="a00013_html_aa1ddfac26492a4103cf0a20509eb4395"><div class="ttname"><a href="a00013.html#aa1ddfac26492a4103cf0a20509eb4395">_mosquitto_subleaf::qos</a></div><div class="ttdeci">int qos</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00158">mosquitto_broker.h:158</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a70c65656337b203d320f63e798e79f9f_cgraph.png" border="0" usemap="#a00196_a70c65656337b203d320f63e798e79f9f_cgraph" alt=""/></div>
<map name="a00196_a70c65656337b203d320f63e798e79f9f_cgraph" id="a00196_a70c65656337b203d320f63e798e79f9f_cgraph">
<area shape="rect" id="node2" href="a00196.html#a6c132b4fe96e98b267516e77036cd409" title="mosquitto_acl_check" alt="" coords="3113,519,3258,546"/>
<area shape="rect" id="node13" href="a00181.html#a6c57944aa63895ebcf0edc405e08a92b" title="_mosquitto_mid_generate" alt="" coords="199,359,370,386"/>
<area shape="rect" id="node14" href="a00191.html#a273c85b4bc9f22d097948f4021190bc8" title="mqtt3_db_message_insert" alt="" coords="197,831,372,858"/>
<area shape="rect" id="node3" href="a00196.html#a084d088ea3e95fcd1745f2707d669e4a" title="mosquitto_acl_check\l_default" alt="" coords="3344,453,3489,495"/>
<area shape="rect" id="node5" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="3583,1422,3730,1449"/>
<area shape="rect" id="node4" href="a00159.html#abebbf4017c11827f1ac999082980cf2f" title="mosquitto_topic_matches_sub" alt="" coords="3557,301,3756,327"/>
<area shape="rect" id="node6" href="a00153.html#af77494a3afe6d474b2cedb3b9a99283e" title="_mosquitto_malloc" alt="" coords="3804,301,3935,327"/>
<area shape="rect" id="node7" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="3812,1034,3927,1061"/>
<area shape="rect" id="node8" href="a00181.html#ae82763dc715f9b4c44d210b886e1f41a" title="_mosquitto_fopen" alt="" coords="3594,503,3719,530"/>
<area shape="rect" id="node9" href="a00204.html#aacc0db98cfc94805b422418dd5dde022" title="_add_acl" alt="" coords="3619,605,3694,631"/>
<area shape="rect" id="node10" href="a00153.html#ae6550bff1e45b4c074746b31f29ef537" title="_mosquitto_strdup" alt="" coords="3805,579,3934,606"/>
<area shape="rect" id="node11" href="a00204.html#a9cf4fb360306466805940e3d7599a667" title="_add_acl_pattern" alt="" coords="3596,554,3717,581"/>
<area shape="rect" id="node12" href="a00153.html#a1ecbcb0ab8e51c000672d9d2bdf8172c" title="_mosquitto_calloc" alt="" coords="3593,866,3720,893"/>
<area shape="rect" id="node15" href="a00177.html#a9fb48d8f8ce208443e2e7bae489770fe" title="mosquitto_time" alt="" coords="2636,991,2747,1018"/>
<area shape="rect" id="node16" href="a00153.html#a60e49e66df31d85392b2000c75a088dd" title="_mosquitto_realloc" alt="" coords="440,1614,571,1641"/>
<area shape="rect" id="node17" href="a00191.html#aee64ee8f7ce7e65f696aa1bbf5c0674c" title="mqtt3_db_message_write" alt="" coords="420,1563,591,1590"/>
<area shape="rect" id="node18" href="a00171.html#a7b111a5ceccb7bbc5fdadab085a33c03" title="_mosquitto_send_publish" alt="" coords="639,765,808,791"/>
<area shape="rect" id="node40" href="a00171.html#a07fb7f8b0c76e21162abb92404ac8630" title="_mosquitto_send_pubrec" alt="" coords="3102,1077,3269,1103"/>
<area shape="rect" id="node43" href="a00171.html#afbde2c162bd4b8e9fa52b0d45aa43b81" title="_mosquitto_send_pubrel" alt="" coords="3104,1295,3267,1322"/>
<area shape="rect" id="node45" href="a00171.html#aaeba60c4fd6e50c8f7f599246c6f91fb" title="_mosquitto_send_pubcomp" alt="" coords="3095,1599,3276,1626"/>
<area shape="rect" id="node19" href="a00171.html#aec1dbc12b0482663fdfbc95c13124bf3" title="_mosquitto_send_real\l_publish" alt="" coords="856,757,1005,799"/>
<area shape="rect" id="node20" href="a00181.html#a3c897feee454d60aec163e3bd0eab52e" title="_mosquitto_packet_alloc" alt="" coords="1053,845,1220,871"/>
<area shape="rect" id="node29" href="a00162.html#ae1643651ecb33c5a8d5138851bcfd986" title="_mosquitto_packet_queue" alt="" coords="1940,1310,2115,1337"/>
<area shape="rect" id="node47" href="a00162.html#a74c4a3cbe02bca478cb9621cca8191e8" title="_mosquitto_write_string" alt="" coords="1057,714,1217,741"/>
<area shape="rect" id="node48" href="a00162.html#a73189d0cf764846d8b74fe2d4a55d79f" title="_mosquitto_write_uint16" alt="" coords="1282,714,1445,741"/>
<area shape="rect" id="node50" href="a00162.html#a307413f45257069e76295c70a6d899d8" title="_mosquitto_write_bytes" alt="" coords="1283,663,1443,690"/>
<area shape="rect" id="node21" href="a00524.html#a1a90c42e436a349a4c5dd9a39a015644" title="mosq_test.remaining\l_length" alt="" coords="1292,867,1435,908"/>
<area shape="rect" id="node22" href="a00181.html#ae8314371001e5cbc7ed7f9c03efb3ca8" title="_mosquitto_check_keepalive" alt="" coords="1268,1093,1459,1119"/>
<area shape="rect" id="node23" href="a00162.html#af8fce1657e21306ca1e448b75774ccfb" title="_mosquitto_socket_close" alt="" coords="2377,1578,2548,1605"/>
<area shape="rect" id="node27" href="a00171.html#add1543fe2a0a0f158610a8e9f83c91bf" title="_mosquitto_send_pingreq" alt="" coords="1507,979,1677,1006"/>
<area shape="rect" id="node24" href="a00163.html#aba710f8004a961fbbc7b9a47952ca49a" title="_mosquitto_try_connect\l_step1" alt="" coords="2611,1549,2772,1591"/>
<area shape="rect" id="node25" href="a00163.html#a6c7a52047909e92de2f75c334923500d" title="_mosquitto_try_connect\l_step2" alt="" coords="2611,1615,2772,1656"/>
<area shape="rect" id="node26" href="a00162.html#a09dc43fbc8f662dd7f71b56937af5253" title="_mosquitto_socket_nonblock" alt="" coords="2596,1681,2787,1707"/>
<area shape="rect" id="node28" href="a00171.html#a271c30997be399041e068b2ea604c6ec" title="_mosquitto_send_simple\l_command" alt="" coords="1725,824,1892,865"/>
<area shape="rect" id="node30" href="a00162.html#a7554da94994edf7f11886ba9bd042e2f" title="_mosquitto_packet_write" alt="" coords="2163,1498,2329,1525"/>
<area shape="rect" id="node31" href="a00162.html#ac25f5eedd4fdb5e35e32e9d0eaf7351f" title="_mosquitto_net_write" alt="" coords="3343,1751,3490,1778"/>
<area shape="rect" id="node32" href="a00162.html#a1f5ae38a1ad0ff58a7c7aba084282cb5" title="_mosquitto_packet_cleanup" alt="" coords="2599,1782,2783,1809"/>
<area shape="rect" id="node33" href="a00162.html#afab51e299ec6bfa4fcf4c9fb4860d2e0" title="_mosquitto_packet_read" alt="" coords="2381,1498,2545,1525"/>
<area shape="rect" id="node34" href="a00162.html#a2c3799cccb12ac4785061599ff18e153" title="_mosquitto_net_read" alt="" coords="3345,1701,3488,1727"/>
<area shape="rect" id="node35" href="a00196.html#a09d1e4a05c245369c22ecae0e8a42bfb" title="mqtt3_packet_handle" alt="" coords="2618,1397,2765,1423"/>
<area shape="rect" id="node46" href="a00164.html#a907a402de77d5cd171278a02d026afc7" title="_mosquitto_packet_handle" alt="" coords="2603,1447,2780,1474"/>
<area shape="rect" id="node36" href="a00166.html#a9d1c01afbdb0b171d789389b04285dae" title="_mosquitto_handle_pingreq" alt="" coords="2851,1397,3031,1423"/>
<area shape="rect" id="node37" href="a00166.html#a8b0332f54846d87207a9f5c0b7c5213a" title="_mosquitto_handle_pingresp" alt="" coords="2847,1447,3034,1474"/>
<area shape="rect" id="node38" href="a00166.html#a7d98465bd0a71f82092b31ff17cbad24" title="_mosquitto_handle_pubackcomp" alt="" coords="2835,1498,3047,1525"/>
<area shape="rect" id="node39" href="a00165.html#ab73094667db8b9226ef81e7895b934f6" title="mqtt3_handle_publish" alt="" coords="2867,595,3015,622"/>
<area shape="rect" id="node42" href="a00166.html#ad23085c99d7e0c4b83d3f0c3c95b6046" title="_mosquitto_handle_pubrec" alt="" coords="2852,1346,3029,1373"/>
<area shape="rect" id="node44" href="a00166.html#a467343261ece717bef7eea433f48ee0d" title="_mosquitto_handle_pubrel" alt="" coords="2854,1549,3027,1575"/>
<area shape="rect" id="node41" href="a00171.html#a45df200bf3b771869380b69c143ed251" title="_mosquitto_send_command\l_with_mid" alt="" coords="3324,1027,3509,1068"/>
<area shape="rect" id="node49" href="a00162.html#adc64d22375628582aa20cb1f8e9435a3" title="_mosquitto_write_byte" alt="" coords="1515,714,1669,741"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6f5d696cb546ec16f63ef7855b624fe0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mqtt3_subs_clean_session </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00089.html">mosquitto_db</a> *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="a00086.html">mosquitto</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00207_source.html#l00592">592</a> of file <a class="el" href="a00207_source.html">subs.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;{</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00013.html">_mosquitto_subleaf</a> *leaf;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keyword">struct </span><a class="code" href="a00012.html">_mosquitto_subhier</a> *hier;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;context-&gt;sub_count; i++){</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">if</span>(context-&gt;subs[i] == NULL){</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        leaf = context-&gt;subs[i]-&gt;subs;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">while</span>(leaf){</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            <span class="keywordflow">if</span>(leaf-&gt;<a class="code" href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">context</a>==context){</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="preprocessor">#ifdef WITH_SYS_TREE</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                db-&gt;subscription_count--;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                <span class="keywordflow">if</span>(leaf-&gt;<a class="code" href="a00013.html#a6f15edc3cd0e2ccb224ac10aa8eb945c">prev</a>){</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                    leaf-&gt;<a class="code" href="a00013.html#a6f15edc3cd0e2ccb224ac10aa8eb945c">prev</a>-&gt;<a class="code" href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">next</a> = leaf-&gt;<a class="code" href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">next</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                    context-&gt;subs[i]-&gt;subs = leaf-&gt;<a class="code" href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">next</a>;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="keywordflow">if</span>(leaf-&gt;<a class="code" href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">next</a>){</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                    leaf-&gt;<a class="code" href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">next</a>-&gt;<a class="code" href="a00013.html#a6f15edc3cd0e2ccb224ac10aa8eb945c">prev</a> = leaf-&gt;<a class="code" href="a00013.html#a6f15edc3cd0e2ccb224ac10aa8eb945c">prev</a>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(leaf);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            }</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            leaf = leaf-&gt;<a class="code" href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">next</a>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordflow">if</span>(context-&gt;subs[i]-&gt;subs == NULL</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                &amp;&amp; context-&gt;subs[i]-&gt;children == NULL</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                &amp;&amp; context-&gt;subs[i]-&gt;retained == NULL</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                &amp;&amp; context-&gt;subs[i]-&gt;parent){</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            hier = context-&gt;subs[i];</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            context-&gt;subs[i] = NULL;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">do</span>{</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                hier = tmp_remove_subs(hier);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            }<span class="keywordflow">while</span>(hier);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <a class="code" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a>(context-&gt;subs);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    context-&gt;subs = NULL;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    context-&gt;sub_count = 0;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00153_html_a1d3fe4692d190d384133af9cfb8019ae"><div class="ttname"><a href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae">_mosquitto_free</a></div><div class="ttdeci">void _mosquitto_free(void *mem)</div><div class="ttdef"><b>Definition:</b> <a href="a00153_source.html#l00054">memory_mosq.c:54</a></div></div>
<div class="ttc" id="a00013_html_a942cc8378e37d1c3426cd0a11d6ef29d"><div class="ttname"><a href="a00013.html#a942cc8378e37d1c3426cd0a11d6ef29d">_mosquitto_subleaf::context</a></div><div class="ttdeci">struct mosquitto * context</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00157">mosquitto_broker.h:157</a></div></div>
<div class="ttc" id="a00012_html"><div class="ttname"><a href="a00012.html">_mosquitto_subhier</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00161">mosquitto_broker.h:161</a></div></div>
<div class="ttc" id="a00013_html"><div class="ttname"><a href="a00013.html">_mosquitto_subleaf</a></div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00154">mosquitto_broker.h:154</a></div></div>
<div class="ttc" id="a00013_html_a6f15edc3cd0e2ccb224ac10aa8eb945c"><div class="ttname"><a href="a00013.html#a6f15edc3cd0e2ccb224ac10aa8eb945c">_mosquitto_subleaf::prev</a></div><div class="ttdeci">struct _mosquitto_subleaf * prev</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00155">mosquitto_broker.h:155</a></div></div>
<div class="ttc" id="a00013_html_ac3373712c2cf873c9d806f8c071f44a6"><div class="ttname"><a href="a00013.html#ac3373712c2cf873c9d806f8c071f44a6">_mosquitto_subleaf::next</a></div><div class="ttdeci">struct _mosquitto_subleaf * next</div><div class="ttdef"><b>Definition:</b> <a href="a00196_source.html#l00156">mosquitto_broker.h:156</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a6f5d696cb546ec16f63ef7855b624fe0_cgraph.png" border="0" usemap="#a00196_a6f5d696cb546ec16f63ef7855b624fe0_cgraph" alt=""/></div>
<map name="a00196_a6f5d696cb546ec16f63ef7855b624fe0_cgraph" id="a00196_a6f5d696cb546ec16f63ef7855b624fe0_cgraph">
<area shape="rect" id="node2" href="a00153.html#a1d3fe4692d190d384133af9cfb8019ae" title="_mosquitto_free" alt="" coords="233,5,348,32"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a05c162f84fcabc09090f53489e3ab27f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int restore_privileges </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="a00158_source.html#l00133">133</a> of file <a class="el" href="a00158_source.html">mosquitto.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#if !defined(__CYGWIN__) &amp;&amp; !defined(WIN32)</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">char</span> err[256];</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">rc</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span>(getuid() == 0){</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        rc = setegid(0);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">if</span>(rc == -1){</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            strerror_r(errno, err, 256);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error setting gid whilst restoring privileges: %s.&quot;</span>, err);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        rc = seteuid(0);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span>(rc == -1){</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            strerror_r(errno, err, 256);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <a class="code" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a>(NULL, <a class="code" href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a>, <span class="stringliteral">&quot;Error setting uid whilst restoring privileges: %s.&quot;</span>, err);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div><div class="ttc" id="a00159_html_a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2"><div class="ttname"><a href="a00159.html#a8edcb6a39bbaf5d5895bf204b0f57da5a9933a6888ec02c72e08c6eda7b1ed5b2">MOSQ_ERR_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00067">mosquitto.h:67</a></div></div>
<div class="ttc" id="a00427_html_a64b6ff859f6938c4b3c1d92ba0abe053"><div class="ttname"><a href="a00427.html#a64b6ff859f6938c4b3c1d92ba0abe053">01-connect-anon-denied.rc</a></div><div class="ttdeci">int rc</div><div class="ttdef"><b>Definition:</b> <a href="a00211_source.html#l00013">01-connect-anon-denied.py:13</a></div></div>
<div class="ttc" id="a00159_html_a5ba508d1cafe32cffa0c8a1ef2fa9bd8"><div class="ttname"><a href="a00159.html#a5ba508d1cafe32cffa0c8a1ef2fa9bd8">MOSQ_LOG_ERR</a></div><div class="ttdeci">#define MOSQ_LOG_ERR</div><div class="ttdef"><b>Definition:</b> <a href="a00159_source.html#l00057">mosquitto.h:57</a></div></div>
<div class="ttc" id="a00151_html_ab88a2fffe8ac34ae60e449e2e6ec506a"><div class="ttname"><a href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a">_mosquitto_log_printf</a></div><div class="ttdeci">int _mosquitto_log_printf(struct mosquitto *mosq, int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="a00151_source.html#l00025">logging_mosq.c:25</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00196_a05c162f84fcabc09090f53489e3ab27f_cgraph.png" border="0" usemap="#a00196_a05c162f84fcabc09090f53489e3ab27f_cgraph" alt=""/></div>
<map name="a00196_a05c162f84fcabc09090f53489e3ab27f_cgraph" id="a00196_a05c162f84fcabc09090f53489e3ab27f_cgraph">
<area shape="rect" id="node2" href="a00151.html#ab88a2fffe8ac34ae60e449e2e6ec506a" title="_mosquitto_log_printf" alt="" coords="177,5,324,32"/>
</map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2c12105386bcc5c3935feab96f296a41.html">Downloads</a></li><li class="navelem"><a class="el" href="dir_fc335ca7d1193ba7b396ec7f5696994c.html">mosquitto-1.4.14</a></li><li class="navelem"><a class="el" href="dir_421886cf52001fe71666e068384a3838.html">src</a></li><li class="navelem"><a class="el" href="a00196.html">mosquitto_broker.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
